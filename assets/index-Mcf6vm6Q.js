(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function a(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerPolicy&&(p.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?p.credentials="include":h.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(h){if(h.ep)return;h.ep=!0;const p=a(h);fetch(h.href,p)}})();/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function pv(n,s){const a=new Set(n.split(","));return l=>a.has(l)}const At={},La=[],qi=()=>{},zF=()=>!1,lp=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),fv=n=>n.startsWith("onUpdate:"),Xt=Object.assign,mv=(n,s)=>{const a=n.indexOf(s);a>-1&&n.splice(a,1)},GF=Object.prototype.hasOwnProperty,ot=(n,s)=>GF.call(n,s),ze=Array.isArray,Ml=n=>up(n)==="[object Map]",KF=n=>up(n)==="[object Set]",Ye=n=>typeof n=="function",ti=n=>typeof n=="string",tu=n=>typeof n=="symbol",xt=n=>n!==null&&typeof n=="object",d2=n=>(xt(n)||Ye(n))&&Ye(n.then)&&Ye(n.catch),JF=Object.prototype.toString,up=n=>JF.call(n),YF=n=>up(n).slice(8,-1),qF=n=>up(n)==="[object Object]",_v=n=>ti(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Ll=pv(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),dp=n=>{const s=Object.create(null);return a=>s[a]||(s[a]=n(a))},XF=/-(\w)/g,Ba=dp(n=>n.replace(XF,(s,a)=>a?a.toUpperCase():"")),QF=/\B([A-Z])/g,Wa=dp(n=>n.replace(QF,"-$1").toLowerCase()),h2=dp(n=>n.charAt(0).toUpperCase()+n.slice(1)),h0=dp(n=>n?`on${h2(n)}`:""),Ao=(n,s)=>!Object.is(n,s),p0=(n,s)=>{for(let a=0;a<n.length;a++)n[a](s)},p2=(n,s,a,l=!1)=>{Object.defineProperty(n,s,{configurable:!0,enumerable:!1,writable:l,value:a})},ZF=n=>{const s=parseFloat(n);return isNaN(s)?n:s};let _C;const f2=()=>_C||(_C=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function gv(n){if(ze(n)){const s={};for(let a=0;a<n.length;a++){const l=n[a],h=ti(l)?iB(l):gv(l);if(h)for(const p in h)s[p]=h[p]}return s}else if(ti(n)||xt(n))return n}const $F=/;(?![^(]*\))/g,eB=/:([^]+)/,tB=/\/\*[^]*?\*\//g;function iB(n){const s={};return n.replace(tB,"").split($F).forEach(a=>{if(a){const l=a.split(eB);l.length>1&&(s[l[0].trim()]=l[1].trim())}}),s}function vv(n){let s="";if(ti(n))s=n;else if(ze(n))for(let a=0;a<n.length;a++){const l=vv(n[a]);l&&(s+=l+" ")}else if(xt(n))for(const a in n)n[a]&&(s+=a+" ");return s.trim()}const nB="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",rB=pv(nB);function m2(n){return!!n||n===""}/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let un;class sB{constructor(s=!1){this.detached=s,this._active=!0,this.effects=[],this.cleanups=[],this.parent=un,!s&&un&&(this.index=(un.scopes||(un.scopes=[])).push(this)-1)}get active(){return this._active}run(s){if(this._active){const a=un;try{return un=this,s()}finally{un=a}}}on(){un=this}off(){un=this.parent}stop(s){if(this._active){let a,l;for(a=0,l=this.effects.length;a<l;a++)this.effects[a].stop();for(a=0,l=this.cleanups.length;a<l;a++)this.cleanups[a]();if(this.scopes)for(a=0,l=this.scopes.length;a<l;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!s){const h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0,this._active=!1}}}function oB(n,s=un){s&&s.active&&s.effects.push(n)}function aB(){return un}let Eo;class yv{constructor(s,a,l,h){this.fn=s,this.trigger=a,this.scheduler=l,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,oB(this,h)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,_s();for(let s=0;s<this._depsLength;s++){const a=this.deps[s];if(a.computed&&(cB(a.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),gs()}return this._dirtyLevel>=4}set dirty(s){this._dirtyLevel=s?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let s=ds,a=Eo;try{return ds=!0,Eo=this,this._runnings++,gC(this),this.fn()}finally{vC(this),this._runnings--,Eo=a,ds=s}}stop(){this.active&&(gC(this),vC(this),this.onStop&&this.onStop(),this.active=!1)}}function cB(n){return n.value}function gC(n){n._trackId++,n._depsLength=0}function vC(n){if(n.deps.length>n._depsLength){for(let s=n._depsLength;s<n.deps.length;s++)_2(n.deps[s],n);n.deps.length=n._depsLength}}function _2(n,s){const a=n.get(s);a!==void 0&&s._trackId!==a&&(n.delete(s),n.size===0&&n.cleanup())}let ds=!0,K0=0;const g2=[];function _s(){g2.push(ds),ds=!1}function gs(){const n=g2.pop();ds=n===void 0?!0:n}function Ev(){K0++}function Tv(){for(K0--;!K0&&J0.length;)J0.shift()()}function v2(n,s,a){if(s.get(n)!==n._trackId){s.set(n,n._trackId);const l=n.deps[n._depsLength];l!==s?(l&&_2(l,n),n.deps[n._depsLength++]=s):n._depsLength++}}const J0=[];function y2(n,s,a){Ev();for(const l of n.keys()){let h;l._dirtyLevel<s&&(h??(h=n.get(l)===l._trackId))&&(l._shouldSchedule||(l._shouldSchedule=l._dirtyLevel===0),l._dirtyLevel=s),l._shouldSchedule&&(h??(h=n.get(l)===l._trackId))&&(l.trigger(),(!l._runnings||l.allowRecurse)&&l._dirtyLevel!==2&&(l._shouldSchedule=!1,l.scheduler&&J0.push(l.scheduler)))}Tv()}const E2=(n,s)=>{const a=new Map;return a.cleanup=n,a.computed=s,a},Y0=new WeakMap,To=Symbol(""),q0=Symbol("");function Ri(n,s,a){if(ds&&Eo){let l=Y0.get(n);l||Y0.set(n,l=new Map);let h=l.get(a);h||l.set(a,h=E2(()=>l.delete(a))),v2(Eo,h)}}function yr(n,s,a,l,h,p){const m=Y0.get(n);if(!m)return;let v=[];if(s==="clear")v=[...m.values()];else if(a==="length"&&ze(n)){const y=Number(l);m.forEach((g,T)=>{(T==="length"||!tu(T)&&T>=y)&&v.push(g)})}else switch(a!==void 0&&v.push(m.get(a)),s){case"add":ze(n)?_v(a)&&v.push(m.get("length")):(v.push(m.get(To)),Ml(n)&&v.push(m.get(q0)));break;case"delete":ze(n)||(v.push(m.get(To)),Ml(n)&&v.push(m.get(q0)));break;case"set":Ml(n)&&v.push(m.get(To));break}Ev();for(const y of v)y&&y2(y,4);Tv()}const lB=pv("__proto__,__v_isRef,__isVue"),T2=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(tu)),yC=uB();function uB(){const n={};return["includes","indexOf","lastIndexOf"].forEach(s=>{n[s]=function(...a){const l=vt(this);for(let p=0,m=this.length;p<m;p++)Ri(l,"get",p+"");const h=l[s](...a);return h===-1||h===!1?l[s](...a.map(vt)):h}}),["push","pop","shift","unshift","splice"].forEach(s=>{n[s]=function(...a){_s(),Ev();const l=vt(this)[s].apply(this,a);return Tv(),gs(),l}}),n}function dB(n){tu(n)||(n=String(n));const s=vt(this);return Ri(s,"has",n),s.hasOwnProperty(n)}class S2{constructor(s=!1,a=!1){this._isReadonly=s,this._isShallow=a}get(s,a,l){const h=this._isReadonly,p=this._isShallow;if(a==="__v_isReactive")return!h;if(a==="__v_isReadonly")return h;if(a==="__v_isShallow")return p;if(a==="__v_raw")return l===(h?p?bB:R2:p?A2:b2).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(l)?s:void 0;const m=ze(s);if(!h){if(m&&ot(yC,a))return Reflect.get(yC,a,l);if(a==="hasOwnProperty")return dB}const v=Reflect.get(s,a,l);return(tu(a)?T2.has(a):lB(a))||(h||Ri(s,"get",a),p)?v:xi(v)?m&&_v(a)?v:v.value:xt(v)?h?C2(v):bv(v):v}}class I2 extends S2{constructor(s=!1){super(!1,s)}set(s,a,l,h){let p=s[a];if(!this._isShallow){const y=Zh(p);if(!X0(l)&&!Zh(l)&&(p=vt(p),l=vt(l)),!ze(s)&&xi(p)&&!xi(l))return y?!1:(p.value=l,!0)}const m=ze(s)&&_v(a)?Number(a)<s.length:ot(s,a),v=Reflect.set(s,a,l,h);return s===vt(h)&&(m?Ao(l,p)&&yr(s,"set",a,l):yr(s,"add",a,l)),v}deleteProperty(s,a){const l=ot(s,a);s[a];const h=Reflect.deleteProperty(s,a);return h&&l&&yr(s,"delete",a,void 0),h}has(s,a){const l=Reflect.has(s,a);return(!tu(a)||!T2.has(a))&&Ri(s,"has",a),l}ownKeys(s){return Ri(s,"iterate",ze(s)?"length":To),Reflect.ownKeys(s)}}class hB extends S2{constructor(s=!1){super(!0,s)}set(s,a){return!0}deleteProperty(s,a){return!0}}const pB=new I2,fB=new hB,mB=new I2(!0);const Sv=n=>n,hp=n=>Reflect.getPrototypeOf(n);function Rh(n,s,a=!1,l=!1){n=n.__v_raw;const h=vt(n),p=vt(s);a||(Ao(s,p)&&Ri(h,"get",s),Ri(h,"get",p));const{has:m}=hp(h),v=l?Sv:a?Cv:Rv;if(m.call(h,s))return v(n.get(s));if(m.call(h,p))return v(n.get(p));n!==h&&n.get(s)}function Ch(n,s=!1){const a=this.__v_raw,l=vt(a),h=vt(n);return s||(Ao(n,h)&&Ri(l,"has",n),Ri(l,"has",h)),n===h?a.has(n):a.has(n)||a.has(h)}function wh(n,s=!1){return n=n.__v_raw,!s&&Ri(vt(n),"iterate",To),Reflect.get(n,"size",n)}function EC(n){n=vt(n);const s=vt(this);return hp(s).has.call(s,n)||(s.add(n),yr(s,"add",n,n)),this}function TC(n,s){s=vt(s);const a=vt(this),{has:l,get:h}=hp(a);let p=l.call(a,n);p||(n=vt(n),p=l.call(a,n));const m=h.call(a,n);return a.set(n,s),p?Ao(s,m)&&yr(a,"set",n,s):yr(a,"add",n,s),this}function SC(n){const s=vt(this),{has:a,get:l}=hp(s);let h=a.call(s,n);h||(n=vt(n),h=a.call(s,n)),l&&l.call(s,n);const p=s.delete(n);return h&&yr(s,"delete",n,void 0),p}function IC(){const n=vt(this),s=n.size!==0,a=n.clear();return s&&yr(n,"clear",void 0,void 0),a}function kh(n,s){return function(l,h){const p=this,m=p.__v_raw,v=vt(m),y=s?Sv:n?Cv:Rv;return!n&&Ri(v,"iterate",To),m.forEach((g,T)=>l.call(h,y(g),y(T),p))}}function Nh(n,s,a){return function(...l){const h=this.__v_raw,p=vt(h),m=Ml(p),v=n==="entries"||n===Symbol.iterator&&m,y=n==="keys"&&m,g=h[n](...l),T=a?Sv:s?Cv:Rv;return!s&&Ri(p,"iterate",y?q0:To),{next(){const{value:A,done:C}=g.next();return C?{value:A,done:C}:{value:v?[T(A[0]),T(A[1])]:T(A),done:C}},[Symbol.iterator](){return this}}}}function $r(n){return function(...s){return n==="delete"?!1:n==="clear"?void 0:this}}function _B(){const n={get(p){return Rh(this,p)},get size(){return wh(this)},has:Ch,add:EC,set:TC,delete:SC,clear:IC,forEach:kh(!1,!1)},s={get(p){return Rh(this,p,!1,!0)},get size(){return wh(this)},has:Ch,add:EC,set:TC,delete:SC,clear:IC,forEach:kh(!1,!0)},a={get(p){return Rh(this,p,!0)},get size(){return wh(this,!0)},has(p){return Ch.call(this,p,!0)},add:$r("add"),set:$r("set"),delete:$r("delete"),clear:$r("clear"),forEach:kh(!0,!1)},l={get(p){return Rh(this,p,!0,!0)},get size(){return wh(this,!0)},has(p){return Ch.call(this,p,!0)},add:$r("add"),set:$r("set"),delete:$r("delete"),clear:$r("clear"),forEach:kh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(p=>{n[p]=Nh(p,!1,!1),a[p]=Nh(p,!0,!1),s[p]=Nh(p,!1,!0),l[p]=Nh(p,!0,!0)}),[n,a,s,l]}const[gB,vB,yB,EB]=_B();function Iv(n,s){const a=s?n?EB:yB:n?vB:gB;return(l,h,p)=>h==="__v_isReactive"?!n:h==="__v_isReadonly"?n:h==="__v_raw"?l:Reflect.get(ot(a,h)&&h in l?a:l,h,p)}const TB={get:Iv(!1,!1)},SB={get:Iv(!1,!0)},IB={get:Iv(!0,!1)};const b2=new WeakMap,A2=new WeakMap,R2=new WeakMap,bB=new WeakMap;function AB(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function RB(n){return n.__v_skip||!Object.isExtensible(n)?0:AB(YF(n))}function bv(n){return Zh(n)?n:Av(n,!1,pB,TB,b2)}function CB(n){return Av(n,!1,mB,SB,A2)}function C2(n){return Av(n,!0,fB,IB,R2)}function Av(n,s,a,l,h){if(!xt(n)||n.__v_raw&&!(s&&n.__v_isReactive))return n;const p=h.get(n);if(p)return p;const m=RB(n);if(m===0)return n;const v=new Proxy(n,m===2?l:a);return h.set(n,v),v}function xl(n){return Zh(n)?xl(n.__v_raw):!!(n&&n.__v_isReactive)}function Zh(n){return!!(n&&n.__v_isReadonly)}function X0(n){return!!(n&&n.__v_isShallow)}function w2(n){return n?!!n.__v_raw:!1}function vt(n){const s=n&&n.__v_raw;return s?vt(s):n}function wB(n){return Object.isExtensible(n)&&p2(n,"__v_skip",!0),n}const Rv=n=>xt(n)?bv(n):n,Cv=n=>xt(n)?C2(n):n;class k2{constructor(s,a,l,h){this.getter=s,this._setter=a,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new yv(()=>s(this._value),()=>f0(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!h,this.__v_isReadonly=l}get value(){const s=vt(this);return(!s._cacheable||s.effect.dirty)&&Ao(s._value,s._value=s.effect.run())&&f0(s,4),NB(s),s.effect._dirtyLevel>=2&&f0(s,2),s._value}set value(s){this._setter(s)}get _dirty(){return this.effect.dirty}set _dirty(s){this.effect.dirty=s}}function kB(n,s,a=!1){let l,h;const p=Ye(n);return p?(l=n,h=qi):(l=n.get,h=n.set),new k2(l,h,p||!h,a)}function NB(n){var s;ds&&Eo&&(n=vt(n),v2(Eo,(s=n.dep)!=null?s:n.dep=E2(()=>n.dep=void 0,n instanceof k2?n:void 0)))}function f0(n,s=4,a){n=vt(n);const l=n.dep;l&&y2(l,s)}function xi(n){return!!(n&&n.__v_isRef===!0)}function DB(n){return xi(n)?n.value:n}const OB={get:(n,s,a)=>DB(Reflect.get(n,s,a)),set:(n,s,a,l)=>{const h=n[s];return xi(h)&&!xi(a)?(h.value=a,!0):Reflect.set(n,s,a,l)}};function N2(n){return xl(n)?n:new Proxy(n,OB)}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function hs(n,s,a,l){try{return l?n(...l):n()}catch(h){pp(h,s,a)}}function hn(n,s,a,l){if(Ye(n)){const h=hs(n,s,a,l);return h&&d2(h)&&h.catch(p=>{pp(p,s,a)}),h}if(ze(n)){const h=[];for(let p=0;p<n.length;p++)h.push(hn(n[p],s,a,l));return h}}function pp(n,s,a,l=!0){const h=s?s.vnode:null;if(s){let p=s.parent;const m=s.proxy,v=`https://vuejs.org/error-reference/#runtime-${a}`;for(;p;){const g=p.ec;if(g){for(let T=0;T<g.length;T++)if(g[T](n,m,v)===!1)return}p=p.parent}const y=s.appContext.config.errorHandler;if(y){_s(),hs(y,null,10,[n,m,v]),gs();return}}PB(n,a,h,l)}function PB(n,s,a,l=!0){console.error(n)}let Kl=!1,Q0=!1;const ui=[];let Vn=0;const xa=[];let rs=null,so=0;const D2=Promise.resolve();let wv=null;function MB(n){const s=wv||D2;return n?s.then(this?n.bind(this):n):s}function LB(n){let s=Vn+1,a=ui.length;for(;s<a;){const l=s+a>>>1,h=ui[l],p=Jl(h);p<n||p===n&&h.pre?s=l+1:a=l}return s}function kv(n){(!ui.length||!ui.includes(n,Kl&&n.allowRecurse?Vn+1:Vn))&&(n.id==null?ui.push(n):ui.splice(LB(n.id),0,n),O2())}function O2(){!Kl&&!Q0&&(Q0=!0,wv=D2.then(M2))}function xB(n){const s=ui.indexOf(n);s>Vn&&ui.splice(s,1)}function VB(n){ze(n)?xa.push(...n):(!rs||!rs.includes(n,n.allowRecurse?so+1:so))&&xa.push(n),O2()}function bC(n,s,a=Kl?Vn+1:0){for(;a<ui.length;a++){const l=ui[a];if(l&&l.pre){if(n&&l.id!==n.uid)continue;ui.splice(a,1),a--,l()}}}function P2(n){if(xa.length){const s=[...new Set(xa)].sort((a,l)=>Jl(a)-Jl(l));if(xa.length=0,rs){rs.push(...s);return}for(rs=s,so=0;so<rs.length;so++)rs[so]();rs=null,so=0}}const Jl=n=>n.id==null?1/0:n.id,UB=(n,s)=>{const a=Jl(n)-Jl(s);if(a===0){if(n.pre&&!s.pre)return-1;if(s.pre&&!n.pre)return 1}return a};function M2(n){Q0=!1,Kl=!0,ui.sort(UB);try{for(Vn=0;Vn<ui.length;Vn++){const s=ui[Vn];s&&s.active!==!1&&hs(s,null,14)}}finally{Vn=0,ui.length=0,P2(),Kl=!1,wv=null,(ui.length||xa.length)&&M2()}}function FB(n,s,...a){if(n.isUnmounted)return;const l=n.vnode.props||At;let h=a;const p=s.startsWith("update:"),m=p&&s.slice(7);if(m&&m in l){const T=`${m==="modelValue"?"model":m}Modifiers`,{number:A,trim:C}=l[T]||At;C&&(h=a.map(I=>ti(I)?I.trim():I)),A&&(h=a.map(ZF))}let v,y=l[v=h0(s)]||l[v=h0(Ba(s))];!y&&p&&(y=l[v=h0(Wa(s))]),y&&hn(y,n,6,h);const g=l[v+"Once"];if(g){if(!n.emitted)n.emitted={};else if(n.emitted[v])return;n.emitted[v]=!0,hn(g,n,6,h)}}function L2(n,s,a=!1){const l=s.emitsCache,h=l.get(n);if(h!==void 0)return h;const p=n.emits;let m={},v=!1;if(!Ye(n)){const y=g=>{const T=L2(g,s,!0);T&&(v=!0,Xt(m,T))};!a&&s.mixins.length&&s.mixins.forEach(y),n.extends&&y(n.extends),n.mixins&&n.mixins.forEach(y)}return!p&&!v?(xt(n)&&l.set(n,null),null):(ze(p)?p.forEach(y=>m[y]=null):Xt(m,p),xt(n)&&l.set(n,m),m)}function fp(n,s){return!n||!lp(s)?!1:(s=s.slice(2).replace(/Once$/,""),ot(n,s[0].toLowerCase()+s.slice(1))||ot(n,Wa(s))||ot(n,s))}let Hn=null,x2=null;function $h(n){const s=Hn;return Hn=n,x2=n&&n.type.__scopeId||null,s}function BB(n,s=Hn,a){if(!s||n._n)return n;const l=(...h)=>{l._d&&MC(-1);const p=$h(s);let m;try{m=n(...h)}finally{$h(p),l._d&&MC(1)}return m};return l._n=!0,l._c=!0,l._d=!0,l}function m0(n){const{type:s,vnode:a,proxy:l,withProxy:h,propsOptions:[p],slots:m,attrs:v,emit:y,render:g,renderCache:T,props:A,data:C,setupState:I,ctx:O,inheritAttrs:D}=n,w=$h(n);let L,M;try{if(a.shapeFlag&4){const V=h||l,G=V;L=xn(g.call(G,V,T,A,I,C,O)),M=v}else{const V=s;L=xn(V.length>1?V(A,{attrs:v,slots:m,emit:y}):V(A,null)),M=s.props?v:HB(v)}}catch(V){Fl.length=0,pp(V,n,1),L=So(Yl)}let P=L;if(M&&D!==!1){const V=Object.keys(M),{shapeFlag:G}=P;V.length&&G&7&&(p&&V.some(fv)&&(M=jB(M,p)),P=Ha(P,M,!1,!0))}return a.dirs&&(P=Ha(P,null,!1,!0),P.dirs=P.dirs?P.dirs.concat(a.dirs):a.dirs),a.transition&&(P.transition=a.transition),L=P,$h(w),L}const HB=n=>{let s;for(const a in n)(a==="class"||a==="style"||lp(a))&&((s||(s={}))[a]=n[a]);return s},jB=(n,s)=>{const a={};for(const l in n)(!fv(l)||!(l.slice(9)in s))&&(a[l]=n[l]);return a};function WB(n,s,a){const{props:l,children:h,component:p}=n,{props:m,children:v,patchFlag:y}=s,g=p.emitsOptions;if(s.dirs||s.transition)return!0;if(a&&y>=0){if(y&1024)return!0;if(y&16)return l?AC(l,m,g):!!m;if(y&8){const T=s.dynamicProps;for(let A=0;A<T.length;A++){const C=T[A];if(m[C]!==l[C]&&!fp(g,C))return!0}}}else return(h||v)&&(!v||!v.$stable)?!0:l===m?!1:l?m?AC(l,m,g):!0:!!m;return!1}function AC(n,s,a){const l=Object.keys(s);if(l.length!==Object.keys(n).length)return!0;for(let h=0;h<l.length;h++){const p=l[h];if(s[p]!==n[p]&&!fp(a,p))return!0}return!1}function zB({vnode:n,parent:s},a){for(;s;){const l=s.subTree;if(l.suspense&&l.suspense.activeBranch===n&&(l.el=n.el),l===n)(n=s.vnode).el=a,s=s.parent;else break}}const GB=Symbol.for("v-ndc"),KB=n=>n.__isSuspense;function JB(n,s){s&&s.pendingBranch?ze(n)?s.effects.push(...n):s.effects.push(n):VB(n)}const YB=Symbol.for("v-scx"),qB=()=>Wh(YB),Dh={};function _0(n,s,a){return V2(n,s,a)}function V2(n,s,{immediate:a,deep:l,flush:h,once:p,onTrack:m,onTrigger:v}=At){if(s&&p){const H=s;s=(...W)=>{H(...W),G()}}const y=gi,g=H=>l===!0?H:Oa(H,l===!1?1:void 0);let T,A=!1,C=!1;if(xi(n)?(T=()=>n.value,A=X0(n)):xl(n)?(T=()=>g(n),A=!0):ze(n)?(C=!0,A=n.some(H=>xl(H)||X0(H)),T=()=>n.map(H=>{if(xi(H))return H.value;if(xl(H))return g(H);if(Ye(H))return hs(H,y,2)})):Ye(n)?s?T=()=>hs(n,y,2):T=()=>(I&&I(),hn(n,y,3,[O])):T=qi,s&&l){const H=T;T=()=>Oa(H())}let I,O=H=>{I=P.onStop=()=>{hs(H,y,4),I=P.onStop=void 0}},D;if(gp)if(O=qi,s?a&&hn(s,y,3,[T(),C?[]:void 0,O]):T(),h==="sync"){const H=qB();D=H.__watcherHandles||(H.__watcherHandles=[])}else return qi;let w=C?new Array(n.length).fill(Dh):Dh;const L=()=>{if(!(!P.active||!P.dirty))if(s){const H=P.run();(l||A||(C?H.some((W,z)=>Ao(W,w[z])):Ao(H,w)))&&(I&&I(),hn(s,y,3,[H,w===Dh?void 0:C&&w[0]===Dh?[]:w,O]),w=H)}else P.run()};L.allowRecurse=!!s;let M;h==="sync"?M=L:h==="post"?M=()=>Ii(L,y&&y.suspense):(L.pre=!0,y&&(L.id=y.uid),M=()=>kv(L));const P=new yv(T,qi,M),V=aB(),G=()=>{P.stop(),V&&mv(V.effects,P)};return s?a?L():w=P.run():h==="post"?Ii(P.run.bind(P),y&&y.suspense):P.run(),D&&D.push(G),G}function XB(n,s,a){const l=this.proxy,h=ti(n)?n.includes(".")?U2(l,n):()=>l[n]:n.bind(l,l);let p;Ye(s)?p=s:(p=s.handler,a=s);const m=iu(this),v=V2(h,p.bind(l),a);return m(),v}function U2(n,s){const a=s.split(".");return()=>{let l=n;for(let h=0;h<a.length&&l;h++)l=l[a[h]];return l}}function Oa(n,s=1/0,a){if(s<=0||!xt(n)||n.__v_skip||(a=a||new Set,a.has(n)))return n;if(a.add(n),s--,xi(n))Oa(n.value,s,a);else if(ze(n))for(let l=0;l<n.length;l++)Oa(n[l],s,a);else if(KF(n)||Ml(n))n.forEach(l=>{Oa(l,s,a)});else if(qF(n))for(const l in n)Oa(n[l],s,a);return n}function $s(n,s,a,l){const h=n.dirs,p=s&&s.dirs;for(let m=0;m<h.length;m++){const v=h[m];p&&(v.oldValue=p[m].value);let y=v.dir[l];y&&(_s(),hn(y,a,8,[n.el,v,n,s]),gs())}}/*! #__NO_SIDE_EFFECTS__ */function QB(n,s){return Ye(n)?Xt({name:n.name},s,{setup:n}):n}const jh=n=>!!n.type.__asyncLoader,F2=n=>n.type.__isKeepAlive;function ZB(n,s){B2(n,"a",s)}function $B(n,s){B2(n,"da",s)}function B2(n,s,a=gi){const l=n.__wdc||(n.__wdc=()=>{let h=a;for(;h;){if(h.isDeactivated)return;h=h.parent}return n()});if(mp(s,l,a),a){let h=a.parent;for(;h&&h.parent;)F2(h.parent.vnode)&&e9(l,s,a,h),h=h.parent}}function e9(n,s,a,l){const h=mp(s,n,l,!0);j2(()=>{mv(l[s],h)},a)}function mp(n,s,a=gi,l=!1){if(a){const h=a[n]||(a[n]=[]),p=s.__weh||(s.__weh=(...m)=>{if(a.isUnmounted)return;_s();const v=iu(a),y=hn(s,a,n,m);return v(),gs(),y});return l?h.unshift(p):h.push(p),p}}const Er=n=>(s,a=gi)=>(!gp||n==="sp")&&mp(n,(...l)=>s(...l),a),t9=Er("bm"),H2=Er("m"),i9=Er("bu"),n9=Er("u"),r9=Er("bum"),j2=Er("um"),s9=Er("sp"),o9=Er("rtg"),a9=Er("rtc");function c9(n,s=gi){mp("ec",n,s)}const Z0=n=>n?ik(n)?Pv(n)||n.proxy:Z0(n.parent):null,Vl=Xt(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Z0(n.parent),$root:n=>Z0(n.root),$emit:n=>n.emit,$options:n=>Nv(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,kv(n.update)}),$nextTick:n=>n.n||(n.n=MB.bind(n.proxy)),$watch:n=>XB.bind(n)}),g0=(n,s)=>n!==At&&!n.__isScriptSetup&&ot(n,s),l9={get({_:n},s){if(s==="__v_skip")return!0;const{ctx:a,setupState:l,data:h,props:p,accessCache:m,type:v,appContext:y}=n;let g;if(s[0]!=="$"){const I=m[s];if(I!==void 0)switch(I){case 1:return l[s];case 2:return h[s];case 4:return a[s];case 3:return p[s]}else{if(g0(l,s))return m[s]=1,l[s];if(h!==At&&ot(h,s))return m[s]=2,h[s];if((g=n.propsOptions[0])&&ot(g,s))return m[s]=3,p[s];if(a!==At&&ot(a,s))return m[s]=4,a[s];$0&&(m[s]=0)}}const T=Vl[s];let A,C;if(T)return s==="$attrs"&&Ri(n.attrs,"get",""),T(n);if((A=v.__cssModules)&&(A=A[s]))return A;if(a!==At&&ot(a,s))return m[s]=4,a[s];if(C=y.config.globalProperties,ot(C,s))return C[s]},set({_:n},s,a){const{data:l,setupState:h,ctx:p}=n;return g0(h,s)?(h[s]=a,!0):l!==At&&ot(l,s)?(l[s]=a,!0):ot(n.props,s)||s[0]==="$"&&s.slice(1)in n?!1:(p[s]=a,!0)},has({_:{data:n,setupState:s,accessCache:a,ctx:l,appContext:h,propsOptions:p}},m){let v;return!!a[m]||n!==At&&ot(n,m)||g0(s,m)||(v=p[0])&&ot(v,m)||ot(l,m)||ot(Vl,m)||ot(h.config.globalProperties,m)},defineProperty(n,s,a){return a.get!=null?n._.accessCache[s]=0:ot(a,"value")&&this.set(n,s,a.value,null),Reflect.defineProperty(n,s,a)}};function RC(n){return ze(n)?n.reduce((s,a)=>(s[a]=null,s),{}):n}let $0=!0;function u9(n){const s=Nv(n),a=n.proxy,l=n.ctx;$0=!1,s.beforeCreate&&CC(s.beforeCreate,n,"bc");const{data:h,computed:p,methods:m,watch:v,provide:y,inject:g,created:T,beforeMount:A,mounted:C,beforeUpdate:I,updated:O,activated:D,deactivated:w,beforeDestroy:L,beforeUnmount:M,destroyed:P,unmounted:V,render:G,renderTracked:H,renderTriggered:W,errorCaptured:z,serverPrefetch:Z,expose:F,inheritAttrs:J,components:X,directives:ee,filters:ve}=s;if(g&&d9(g,l,null),m)for(const Se in m){const _e=m[Se];Ye(_e)&&(l[Se]=_e.bind(a))}if(h){const Se=h.call(a,a);xt(Se)&&(n.data=bv(Se))}if($0=!0,p)for(const Se in p){const _e=p[Se],Fe=Ye(_e)?_e.bind(a,a):Ye(_e.get)?_e.get.bind(a,a):qi,dt=!Ye(_e)&&Ye(_e.set)?_e.set.bind(a):qi,te=G9({get:Fe,set:dt});Object.defineProperty(l,Se,{enumerable:!0,configurable:!0,get:()=>te.value,set:$=>te.value=$})}if(v)for(const Se in v)W2(v[Se],l,a,Se);if(y){const Se=Ye(y)?y.call(a):y;Reflect.ownKeys(Se).forEach(_e=>{g9(_e,Se[_e])})}T&&CC(T,n,"c");function Ae(Se,_e){ze(_e)?_e.forEach(Fe=>Se(Fe.bind(a))):_e&&Se(_e.bind(a))}if(Ae(t9,A),Ae(H2,C),Ae(i9,I),Ae(n9,O),Ae(ZB,D),Ae($B,w),Ae(c9,z),Ae(a9,H),Ae(o9,W),Ae(r9,M),Ae(j2,V),Ae(s9,Z),ze(F))if(F.length){const Se=n.exposed||(n.exposed={});F.forEach(_e=>{Object.defineProperty(Se,_e,{get:()=>a[_e],set:Fe=>a[_e]=Fe})})}else n.exposed||(n.exposed={});G&&n.render===qi&&(n.render=G),J!=null&&(n.inheritAttrs=J),X&&(n.components=X),ee&&(n.directives=ee)}function d9(n,s,a=qi){ze(n)&&(n=ev(n));for(const l in n){const h=n[l];let p;xt(h)?"default"in h?p=Wh(h.from||l,h.default,!0):p=Wh(h.from||l):p=Wh(h),xi(p)?Object.defineProperty(s,l,{enumerable:!0,configurable:!0,get:()=>p.value,set:m=>p.value=m}):s[l]=p}}function CC(n,s,a){hn(ze(n)?n.map(l=>l.bind(s.proxy)):n.bind(s.proxy),s,a)}function W2(n,s,a,l){const h=l.includes(".")?U2(a,l):()=>a[l];if(ti(n)){const p=s[n];Ye(p)&&_0(h,p)}else if(Ye(n))_0(h,n.bind(a));else if(xt(n))if(ze(n))n.forEach(p=>W2(p,s,a,l));else{const p=Ye(n.handler)?n.handler.bind(a):s[n.handler];Ye(p)&&_0(h,p,n)}}function Nv(n){const s=n.type,{mixins:a,extends:l}=s,{mixins:h,optionsCache:p,config:{optionMergeStrategies:m}}=n.appContext,v=p.get(s);let y;return v?y=v:!h.length&&!a&&!l?y=s:(y={},h.length&&h.forEach(g=>ep(y,g,m,!0)),ep(y,s,m)),xt(s)&&p.set(s,y),y}function ep(n,s,a,l=!1){const{mixins:h,extends:p}=s;p&&ep(n,p,a,!0),h&&h.forEach(m=>ep(n,m,a,!0));for(const m in s)if(!(l&&m==="expose")){const v=h9[m]||a&&a[m];n[m]=v?v(n[m],s[m]):s[m]}return n}const h9={data:wC,props:kC,emits:kC,methods:Ol,computed:Ol,beforeCreate:_i,created:_i,beforeMount:_i,mounted:_i,beforeUpdate:_i,updated:_i,beforeDestroy:_i,beforeUnmount:_i,destroyed:_i,unmounted:_i,activated:_i,deactivated:_i,errorCaptured:_i,serverPrefetch:_i,components:Ol,directives:Ol,watch:f9,provide:wC,inject:p9};function wC(n,s){return s?n?function(){return Xt(Ye(n)?n.call(this,this):n,Ye(s)?s.call(this,this):s)}:s:n}function p9(n,s){return Ol(ev(n),ev(s))}function ev(n){if(ze(n)){const s={};for(let a=0;a<n.length;a++)s[n[a]]=n[a];return s}return n}function _i(n,s){return n?[...new Set([].concat(n,s))]:s}function Ol(n,s){return n?Xt(Object.create(null),n,s):s}function kC(n,s){return n?ze(n)&&ze(s)?[...new Set([...n,...s])]:Xt(Object.create(null),RC(n),RC(s??{})):s}function f9(n,s){if(!n)return s;if(!s)return n;const a=Xt(Object.create(null),n);for(const l in s)a[l]=_i(n[l],s[l]);return a}function z2(){return{app:null,config:{isNativeTag:zF,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let m9=0;function _9(n,s){return function(l,h=null){Ye(l)||(l=Xt({},l)),h!=null&&!xt(h)&&(h=null);const p=z2(),m=new WeakSet;let v=!1;const y=p.app={_uid:m9++,_component:l,_props:h,_container:null,_context:p,_instance:null,version:K9,get config(){return p.config},set config(g){},use(g,...T){return m.has(g)||(g&&Ye(g.install)?(m.add(g),g.install(y,...T)):Ye(g)&&(m.add(g),g(y,...T))),y},mixin(g){return p.mixins.includes(g)||p.mixins.push(g),y},component(g,T){return T?(p.components[g]=T,y):p.components[g]},directive(g,T){return T?(p.directives[g]=T,y):p.directives[g]},mount(g,T,A){if(!v){const C=So(l,h);return C.appContext=p,A===!0?A="svg":A===!1&&(A=void 0),T&&s?s(C,g):n(C,g,A),v=!0,y._container=g,g.__vue_app__=y,Pv(C.component)||C.component.proxy}},unmount(){v&&(n(null,y._container),delete y._container.__vue_app__)},provide(g,T){return p.provides[g]=T,y},runWithContext(g){const T=Ul;Ul=y;try{return g()}finally{Ul=T}}};return y}}let Ul=null;function g9(n,s){if(gi){let a=gi.provides;const l=gi.parent&&gi.parent.provides;l===a&&(a=gi.provides=Object.create(l)),a[n]=s}}function Wh(n,s,a=!1){const l=gi||Hn;if(l||Ul){const h=l?l.parent==null?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides:Ul._context.provides;if(h&&n in h)return h[n];if(arguments.length>1)return a&&Ye(s)?s.call(l&&l.proxy):s}}const G2={},K2=()=>Object.create(G2),J2=n=>Object.getPrototypeOf(n)===G2;function v9(n,s,a,l=!1){const h={},p=K2();n.propsDefaults=Object.create(null),Y2(n,s,h,p);for(const m in n.propsOptions[0])m in h||(h[m]=void 0);a?n.props=l?h:CB(h):n.type.props?n.props=h:n.props=p,n.attrs=p}function y9(n,s,a,l){const{props:h,attrs:p,vnode:{patchFlag:m}}=n,v=vt(h),[y]=n.propsOptions;let g=!1;if((l||m>0)&&!(m&16)){if(m&8){const T=n.vnode.dynamicProps;for(let A=0;A<T.length;A++){let C=T[A];if(fp(n.emitsOptions,C))continue;const I=s[C];if(y)if(ot(p,C))I!==p[C]&&(p[C]=I,g=!0);else{const O=Ba(C);h[O]=tv(y,v,O,I,n,!1)}else I!==p[C]&&(p[C]=I,g=!0)}}}else{Y2(n,s,h,p)&&(g=!0);let T;for(const A in v)(!s||!ot(s,A)&&((T=Wa(A))===A||!ot(s,T)))&&(y?a&&(a[A]!==void 0||a[T]!==void 0)&&(h[A]=tv(y,v,A,void 0,n,!0)):delete h[A]);if(p!==v)for(const A in p)(!s||!ot(s,A))&&(delete p[A],g=!0)}g&&yr(n.attrs,"set","")}function Y2(n,s,a,l){const[h,p]=n.propsOptions;let m=!1,v;if(s)for(let y in s){if(Ll(y))continue;const g=s[y];let T;h&&ot(h,T=Ba(y))?!p||!p.includes(T)?a[T]=g:(v||(v={}))[T]=g:fp(n.emitsOptions,y)||(!(y in l)||g!==l[y])&&(l[y]=g,m=!0)}if(p){const y=vt(a),g=v||At;for(let T=0;T<p.length;T++){const A=p[T];a[A]=tv(h,y,A,g[A],n,!ot(g,A))}}return m}function tv(n,s,a,l,h,p){const m=n[a];if(m!=null){const v=ot(m,"default");if(v&&l===void 0){const y=m.default;if(m.type!==Function&&!m.skipFactory&&Ye(y)){const{propsDefaults:g}=h;if(a in g)l=g[a];else{const T=iu(h);l=g[a]=y.call(null,s),T()}}else l=y}m[0]&&(p&&!v?l=!1:m[1]&&(l===""||l===Wa(a))&&(l=!0))}return l}function q2(n,s,a=!1){const l=s.propsCache,h=l.get(n);if(h)return h;const p=n.props,m={},v=[];let y=!1;if(!Ye(n)){const T=A=>{y=!0;const[C,I]=q2(A,s,!0);Xt(m,C),I&&v.push(...I)};!a&&s.mixins.length&&s.mixins.forEach(T),n.extends&&T(n.extends),n.mixins&&n.mixins.forEach(T)}if(!p&&!y)return xt(n)&&l.set(n,La),La;if(ze(p))for(let T=0;T<p.length;T++){const A=Ba(p[T]);NC(A)&&(m[A]=At)}else if(p)for(const T in p){const A=Ba(T);if(NC(A)){const C=p[T],I=m[A]=ze(C)||Ye(C)?{type:C}:Xt({},C);if(I){const O=PC(Boolean,I.type),D=PC(String,I.type);I[0]=O>-1,I[1]=D<0||O<D,(O>-1||ot(I,"default"))&&v.push(A)}}}const g=[m,v];return xt(n)&&l.set(n,g),g}function NC(n){return n[0]!=="$"&&!Ll(n)}function DC(n){return n===null?"null":typeof n=="function"?n.name||"":typeof n=="object"&&n.constructor&&n.constructor.name||""}function OC(n,s){return DC(n)===DC(s)}function PC(n,s){return ze(s)?s.findIndex(a=>OC(a,n)):Ye(s)&&OC(s,n)?0:-1}const X2=n=>n[0]==="_"||n==="$stable",Dv=n=>ze(n)?n.map(xn):[xn(n)],E9=(n,s,a)=>{if(s._n)return s;const l=BB((...h)=>Dv(s(...h)),a);return l._c=!1,l},Q2=(n,s,a)=>{const l=n._ctx;for(const h in n){if(X2(h))continue;const p=n[h];if(Ye(p))s[h]=E9(h,p,l);else if(p!=null){const m=Dv(p);s[h]=()=>m}}},Z2=(n,s)=>{const a=Dv(s);n.slots.default=()=>a},T9=(n,s)=>{const a=n.slots=K2();if(n.vnode.shapeFlag&32){const l=s._;l?(Xt(a,s),p2(a,"_",l,!0)):Q2(s,a)}else s&&Z2(n,s)},S9=(n,s,a)=>{const{vnode:l,slots:h}=n;let p=!0,m=At;if(l.shapeFlag&32){const v=s._;v?a&&v===1?p=!1:(Xt(h,s),!a&&v===1&&delete h._):(p=!s.$stable,Q2(s,h)),m=s}else s&&(Z2(n,s),m={default:1});if(p)for(const v in h)!X2(v)&&m[v]==null&&delete h[v]};function iv(n,s,a,l,h=!1){if(ze(n)){n.forEach((C,I)=>iv(C,s&&(ze(s)?s[I]:s),a,l,h));return}if(jh(l)&&!h)return;const p=l.shapeFlag&4?Pv(l.component)||l.component.proxy:l.el,m=h?null:p,{i:v,r:y}=n,g=s&&s.r,T=v.refs===At?v.refs={}:v.refs,A=v.setupState;if(g!=null&&g!==y&&(ti(g)?(T[g]=null,ot(A,g)&&(A[g]=null)):xi(g)&&(g.value=null)),Ye(y))hs(y,v,12,[m,T]);else{const C=ti(y),I=xi(y);if(C||I){const O=()=>{if(n.f){const D=C?ot(A,y)?A[y]:T[y]:y.value;h?ze(D)&&mv(D,p):ze(D)?D.includes(p)||D.push(p):C?(T[y]=[p],ot(A,y)&&(A[y]=T[y])):(y.value=[p],n.k&&(T[n.k]=y.value))}else C?(T[y]=m,ot(A,y)&&(A[y]=m)):I&&(y.value=m,n.k&&(T[n.k]=m))};m?(O.id=-1,Ii(O,a)):O()}}}const Ii=JB;function I9(n){return b9(n)}function b9(n,s){const a=f2();a.__VUE__=!0;const{insert:l,remove:h,patchProp:p,createElement:m,createText:v,createComment:y,setText:g,setElementText:T,parentNode:A,nextSibling:C,setScopeId:I=qi,insertStaticContent:O}=n,D=(x,j,q,ce=null,ae=null,fe=null,ye=void 0,he=null,me=!!j.dynamicChildren)=>{if(x===j)return;x&&!kl(x,j)&&(ce=jt(x),$(x,ae,fe,!0),x=null),j.patchFlag===-2&&(me=!1,j.dynamicChildren=null);const{type:ue,ref:Ee,shapeFlag:Pe}=j;switch(ue){case _p:w(x,j,q,ce);break;case Yl:L(x,j,q,ce);break;case y0:x==null&&M(j,q,ce,ye);break;case fr:X(x,j,q,ce,ae,fe,ye,he,me);break;default:Pe&1?G(x,j,q,ce,ae,fe,ye,he,me):Pe&6?ee(x,j,q,ce,ae,fe,ye,he,me):(Pe&64||Pe&128)&&ue.process(x,j,q,ce,ae,fe,ye,he,me,Qi)}Ee!=null&&ae&&iv(Ee,x&&x.ref,fe,j||x,!j)},w=(x,j,q,ce)=>{if(x==null)l(j.el=v(j.children),q,ce);else{const ae=j.el=x.el;j.children!==x.children&&g(ae,j.children)}},L=(x,j,q,ce)=>{x==null?l(j.el=y(j.children||""),q,ce):j.el=x.el},M=(x,j,q,ce)=>{[x.el,x.anchor]=O(x.children,j,q,ce,x.el,x.anchor)},P=({el:x,anchor:j},q,ce)=>{let ae;for(;x&&x!==j;)ae=C(x),l(x,q,ce),x=ae;l(j,q,ce)},V=({el:x,anchor:j})=>{let q;for(;x&&x!==j;)q=C(x),h(x),x=q;h(j)},G=(x,j,q,ce,ae,fe,ye,he,me)=>{j.type==="svg"?ye="svg":j.type==="math"&&(ye="mathml"),x==null?H(j,q,ce,ae,fe,ye,he,me):Z(x,j,ae,fe,ye,he,me)},H=(x,j,q,ce,ae,fe,ye,he)=>{let me,ue;const{props:Ee,shapeFlag:Pe,transition:we,dirs:Me}=x;if(me=x.el=m(x.type,fe,Ee&&Ee.is,Ee),Pe&8?T(me,x.children):Pe&16&&z(x.children,me,null,ce,ae,v0(x,fe),ye,he),Me&&$s(x,null,ce,"created"),W(me,x,x.scopeId,ye,ce),Ee){for(const tt in Ee)tt!=="value"&&!Ll(tt)&&p(me,tt,null,Ee[tt],fe,x.children,ce,ae,at);"value"in Ee&&p(me,"value",null,Ee.value,fe),(ue=Ee.onVnodeBeforeMount)&&On(ue,ce,x)}Me&&$s(x,null,ce,"beforeMount");const Ge=A9(ae,we);Ge&&we.beforeEnter(me),l(me,j,q),((ue=Ee&&Ee.onVnodeMounted)||Ge||Me)&&Ii(()=>{ue&&On(ue,ce,x),Ge&&we.enter(me),Me&&$s(x,null,ce,"mounted")},ae)},W=(x,j,q,ce,ae)=>{if(q&&I(x,q),ce)for(let fe=0;fe<ce.length;fe++)I(x,ce[fe]);if(ae){let fe=ae.subTree;if(j===fe){const ye=ae.vnode;W(x,ye,ye.scopeId,ye.slotScopeIds,ae.parent)}}},z=(x,j,q,ce,ae,fe,ye,he,me=0)=>{for(let ue=me;ue<x.length;ue++){const Ee=x[ue]=he?ss(x[ue]):xn(x[ue]);D(null,Ee,j,q,ce,ae,fe,ye,he)}},Z=(x,j,q,ce,ae,fe,ye)=>{const he=j.el=x.el;let{patchFlag:me,dynamicChildren:ue,dirs:Ee}=j;me|=x.patchFlag&16;const Pe=x.props||At,we=j.props||At;let Me;if(q&&eo(q,!1),(Me=we.onVnodeBeforeUpdate)&&On(Me,q,j,x),Ee&&$s(j,x,q,"beforeUpdate"),q&&eo(q,!0),ue?F(x.dynamicChildren,ue,he,q,ce,v0(j,ae),fe):ye||_e(x,j,he,null,q,ce,v0(j,ae),fe,!1),me>0){if(me&16)J(he,j,Pe,we,q,ce,ae);else if(me&2&&Pe.class!==we.class&&p(he,"class",null,we.class,ae),me&4&&p(he,"style",Pe.style,we.style,ae),me&8){const Ge=j.dynamicProps;for(let tt=0;tt<Ge.length;tt++){const ht=Ge[tt],Et=Pe[ht],Vt=we[ht];(Vt!==Et||ht==="value")&&p(he,ht,Et,Vt,ae,x.children,q,ce,at)}}me&1&&x.children!==j.children&&T(he,j.children)}else!ye&&ue==null&&J(he,j,Pe,we,q,ce,ae);((Me=we.onVnodeUpdated)||Ee)&&Ii(()=>{Me&&On(Me,q,j,x),Ee&&$s(j,x,q,"updated")},ce)},F=(x,j,q,ce,ae,fe,ye)=>{for(let he=0;he<j.length;he++){const me=x[he],ue=j[he],Ee=me.el&&(me.type===fr||!kl(me,ue)||me.shapeFlag&70)?A(me.el):q;D(me,ue,Ee,null,ce,ae,fe,ye,!0)}},J=(x,j,q,ce,ae,fe,ye)=>{if(q!==ce){if(q!==At)for(const he in q)!Ll(he)&&!(he in ce)&&p(x,he,q[he],null,ye,j.children,ae,fe,at);for(const he in ce){if(Ll(he))continue;const me=ce[he],ue=q[he];me!==ue&&he!=="value"&&p(x,he,ue,me,ye,j.children,ae,fe,at)}"value"in ce&&p(x,"value",q.value,ce.value,ye)}},X=(x,j,q,ce,ae,fe,ye,he,me)=>{const ue=j.el=x?x.el:v(""),Ee=j.anchor=x?x.anchor:v("");let{patchFlag:Pe,dynamicChildren:we,slotScopeIds:Me}=j;Me&&(he=he?he.concat(Me):Me),x==null?(l(ue,q,ce),l(Ee,q,ce),z(j.children||[],q,Ee,ae,fe,ye,he,me)):Pe>0&&Pe&64&&we&&x.dynamicChildren?(F(x.dynamicChildren,we,q,ae,fe,ye,he),(j.key!=null||ae&&j===ae.subTree)&&$2(x,j,!0)):_e(x,j,q,Ee,ae,fe,ye,he,me)},ee=(x,j,q,ce,ae,fe,ye,he,me)=>{j.slotScopeIds=he,x==null?j.shapeFlag&512?ae.ctx.activate(j,q,ce,ye,me):ve(j,q,ce,ae,fe,ye,me):Ce(x,j,me)},ve=(x,j,q,ce,ae,fe,ye)=>{const he=x.component=F9(x,ce,ae);if(F2(x)&&(he.ctx.renderer=Qi),B9(he),he.asyncDep){if(ae&&ae.registerDep(he,Ae),!x.el){const me=he.subTree=So(Yl);L(null,me,j,q)}}else Ae(he,x,j,q,ae,fe,ye)},Ce=(x,j,q)=>{const ce=j.component=x.component;if(WB(x,j,q))if(ce.asyncDep&&!ce.asyncResolved){Se(ce,j,q);return}else ce.next=j,xB(ce.update),ce.effect.dirty=!0,ce.update();else j.el=x.el,ce.vnode=j},Ae=(x,j,q,ce,ae,fe,ye)=>{const he=()=>{if(x.isMounted){let{next:Ee,bu:Pe,u:we,parent:Me,vnode:Ge}=x;{const di=ek(x);if(di){Ee&&(Ee.el=Ge.el,Se(x,Ee,ye)),di.asyncDep.then(()=>{x.isUnmounted||he()});return}}let tt=Ee,ht;eo(x,!1),Ee?(Ee.el=Ge.el,Se(x,Ee,ye)):Ee=Ge,Pe&&p0(Pe),(ht=Ee.props&&Ee.props.onVnodeBeforeUpdate)&&On(ht,Me,Ee,Ge),eo(x,!0);const Et=m0(x),Vt=x.subTree;x.subTree=Et,D(Vt,Et,A(Vt.el),jt(Vt),x,ae,fe),Ee.el=Et.el,tt===null&&zB(x,Et.el),we&&Ii(we,ae),(ht=Ee.props&&Ee.props.onVnodeUpdated)&&Ii(()=>On(ht,Me,Ee,Ge),ae)}else{let Ee;const{el:Pe,props:we}=j,{bm:Me,m:Ge,parent:tt}=x,ht=jh(j);if(eo(x,!1),Me&&p0(Me),!ht&&(Ee=we&&we.onVnodeBeforeMount)&&On(Ee,tt,j),eo(x,!0),Pe&&ii){const Et=()=>{x.subTree=m0(x),ii(Pe,x.subTree,x,ae,null)};ht?j.type.__asyncLoader().then(()=>!x.isUnmounted&&Et()):Et()}else{const Et=x.subTree=m0(x);D(null,Et,q,ce,x,ae,fe),j.el=Et.el}if(Ge&&Ii(Ge,ae),!ht&&(Ee=we&&we.onVnodeMounted)){const Et=j;Ii(()=>On(Ee,tt,Et),ae)}(j.shapeFlag&256||tt&&jh(tt.vnode)&&tt.vnode.shapeFlag&256)&&x.a&&Ii(x.a,ae),x.isMounted=!0,j=q=ce=null}},me=x.effect=new yv(he,qi,()=>kv(ue),x.scope),ue=x.update=()=>{me.dirty&&me.run()};ue.id=x.uid,eo(x,!0),ue()},Se=(x,j,q)=>{j.component=x;const ce=x.vnode.props;x.vnode=j,x.next=null,y9(x,j.props,ce,q),S9(x,j.children,q),_s(),bC(x),gs()},_e=(x,j,q,ce,ae,fe,ye,he,me=!1)=>{const ue=x&&x.children,Ee=x?x.shapeFlag:0,Pe=j.children,{patchFlag:we,shapeFlag:Me}=j;if(we>0){if(we&128){dt(ue,Pe,q,ce,ae,fe,ye,he,me);return}else if(we&256){Fe(ue,Pe,q,ce,ae,fe,ye,he,me);return}}Me&8?(Ee&16&&at(ue,ae,fe),Pe!==ue&&T(q,Pe)):Ee&16?Me&16?dt(ue,Pe,q,ce,ae,fe,ye,he,me):at(ue,ae,fe,!0):(Ee&8&&T(q,""),Me&16&&z(Pe,q,ce,ae,fe,ye,he,me))},Fe=(x,j,q,ce,ae,fe,ye,he,me)=>{x=x||La,j=j||La;const ue=x.length,Ee=j.length,Pe=Math.min(ue,Ee);let we;for(we=0;we<Pe;we++){const Me=j[we]=me?ss(j[we]):xn(j[we]);D(x[we],Me,q,null,ae,fe,ye,he,me)}ue>Ee?at(x,ae,fe,!0,!1,Pe):z(j,q,ce,ae,fe,ye,he,me,Pe)},dt=(x,j,q,ce,ae,fe,ye,he,me)=>{let ue=0;const Ee=j.length;let Pe=x.length-1,we=Ee-1;for(;ue<=Pe&&ue<=we;){const Me=x[ue],Ge=j[ue]=me?ss(j[ue]):xn(j[ue]);if(kl(Me,Ge))D(Me,Ge,q,null,ae,fe,ye,he,me);else break;ue++}for(;ue<=Pe&&ue<=we;){const Me=x[Pe],Ge=j[we]=me?ss(j[we]):xn(j[we]);if(kl(Me,Ge))D(Me,Ge,q,null,ae,fe,ye,he,me);else break;Pe--,we--}if(ue>Pe){if(ue<=we){const Me=we+1,Ge=Me<Ee?j[Me].el:ce;for(;ue<=we;)D(null,j[ue]=me?ss(j[ue]):xn(j[ue]),q,Ge,ae,fe,ye,he,me),ue++}}else if(ue>we)for(;ue<=Pe;)$(x[ue],ae,fe,!0),ue++;else{const Me=ue,Ge=ue,tt=new Map;for(ue=Ge;ue<=we;ue++){const Ut=j[ue]=me?ss(j[ue]):xn(j[ue]);Ut.key!=null&&tt.set(Ut.key,ue)}let ht,Et=0;const Vt=we-Ge+1;let di=!1,jn=0;const mn=new Array(Vt);for(ue=0;ue<Vt;ue++)mn[ue]=0;for(ue=Me;ue<=Pe;ue++){const Ut=x[ue];if(Et>=Vt){$(Ut,ae,fe,!0);continue}let Wt;if(Ut.key!=null)Wt=tt.get(Ut.key);else for(ht=Ge;ht<=we;ht++)if(mn[ht-Ge]===0&&kl(Ut,j[ht])){Wt=ht;break}Wt===void 0?$(Ut,ae,fe,!0):(mn[Wt-Ge]=ue+1,Wt>=jn?jn=Wt:di=!0,D(Ut,j[Wt],q,null,ae,fe,ye,he,me),Et++)}const mt=di?R9(mn):La;for(ht=mt.length-1,ue=Vt-1;ue>=0;ue--){const Ut=Ge+ue,Wt=j[Ut],Ro=Ut+1<Ee?j[Ut+1].el:ce;mn[ue]===0?D(null,Wt,q,Ro,ae,fe,ye,he,me):di&&(ht<0||ue!==mt[ht]?te(Wt,q,Ro,2):ht--)}}},te=(x,j,q,ce,ae=null)=>{const{el:fe,type:ye,transition:he,children:me,shapeFlag:ue}=x;if(ue&6){te(x.component.subTree,j,q,ce);return}if(ue&128){x.suspense.move(j,q,ce);return}if(ue&64){ye.move(x,j,q,Qi);return}if(ye===fr){l(fe,j,q);for(let Pe=0;Pe<me.length;Pe++)te(me[Pe],j,q,ce);l(x.anchor,j,q);return}if(ye===y0){P(x,j,q);return}if(ce!==2&&ue&1&&he)if(ce===0)he.beforeEnter(fe),l(fe,j,q),Ii(()=>he.enter(fe),ae);else{const{leave:Pe,delayLeave:we,afterLeave:Me}=he,Ge=()=>l(fe,j,q),tt=()=>{Pe(fe,()=>{Ge(),Me&&Me()})};we?we(fe,Ge,tt):tt()}else l(fe,j,q)},$=(x,j,q,ce=!1,ae=!1)=>{const{type:fe,props:ye,ref:he,children:me,dynamicChildren:ue,shapeFlag:Ee,patchFlag:Pe,dirs:we}=x;if(he!=null&&iv(he,null,q,x,!0),Ee&256){j.ctx.deactivate(x);return}const Me=Ee&1&&we,Ge=!jh(x);let tt;if(Ge&&(tt=ye&&ye.onVnodeBeforeUnmount)&&On(tt,j,x),Ee&6)Pt(x.component,q,ce);else{if(Ee&128){x.suspense.unmount(q,ce);return}Me&&$s(x,null,j,"beforeUnmount"),Ee&64?x.type.remove(x,j,q,ae,Qi,ce):ue&&(fe!==fr||Pe>0&&Pe&64)?at(ue,j,q,!1,!0):(fe===fr&&Pe&384||!ae&&Ee&16)&&at(me,j,q),ce&&ne(x)}(Ge&&(tt=ye&&ye.onVnodeUnmounted)||Me)&&Ii(()=>{tt&&On(tt,j,x),Me&&$s(x,null,j,"unmounted")},q)},ne=x=>{const{type:j,el:q,anchor:ce,transition:ae}=x;if(j===fr){de(q,ce);return}if(j===y0){V(x);return}const fe=()=>{h(q),ae&&!ae.persisted&&ae.afterLeave&&ae.afterLeave()};if(x.shapeFlag&1&&ae&&!ae.persisted){const{leave:ye,delayLeave:he}=ae,me=()=>ye(q,fe);he?he(x.el,fe,me):me()}else fe()},de=(x,j)=>{let q;for(;x!==j;)q=C(x),h(x),x=q;h(j)},Pt=(x,j,q)=>{const{bum:ce,scope:ae,update:fe,subTree:ye,um:he}=x;ce&&p0(ce),ae.stop(),fe&&(fe.active=!1,$(ye,x,j,q)),he&&Ii(he,j),Ii(()=>{x.isUnmounted=!0},j),j&&j.pendingBranch&&!j.isUnmounted&&x.asyncDep&&!x.asyncResolved&&x.suspenseId===j.pendingId&&(j.deps--,j.deps===0&&j.resolve())},at=(x,j,q,ce=!1,ae=!1,fe=0)=>{for(let ye=fe;ye<x.length;ye++)$(x[ye],j,q,ce,ae)},jt=x=>x.shapeFlag&6?jt(x.component.subTree):x.shapeFlag&128?x.suspense.next():C(x.anchor||x.el);let Ci=!1;const yt=(x,j,q)=>{x==null?j._vnode&&$(j._vnode,null,null,!0):D(j._vnode||null,x,j,null,null,null,q),Ci||(Ci=!0,bC(),P2(),Ci=!1),j._vnode=x},Qi={p:D,um:$,m:te,r:ne,mt:ve,mc:z,pc:_e,pbc:F,n:jt,o:n};let fn,ii;return{render:yt,hydrate:fn,createApp:_9(yt,fn)}}function v0({type:n,props:s},a){return a==="svg"&&n==="foreignObject"||a==="mathml"&&n==="annotation-xml"&&s&&s.encoding&&s.encoding.includes("html")?void 0:a}function eo({effect:n,update:s},a){n.allowRecurse=s.allowRecurse=a}function A9(n,s){return(!n||n&&!n.pendingBranch)&&s&&!s.persisted}function $2(n,s,a=!1){const l=n.children,h=s.children;if(ze(l)&&ze(h))for(let p=0;p<l.length;p++){const m=l[p];let v=h[p];v.shapeFlag&1&&!v.dynamicChildren&&((v.patchFlag<=0||v.patchFlag===32)&&(v=h[p]=ss(h[p]),v.el=m.el),a||$2(m,v)),v.type===_p&&(v.el=m.el)}}function R9(n){const s=n.slice(),a=[0];let l,h,p,m,v;const y=n.length;for(l=0;l<y;l++){const g=n[l];if(g!==0){if(h=a[a.length-1],n[h]<g){s[l]=h,a.push(l);continue}for(p=0,m=a.length-1;p<m;)v=p+m>>1,n[a[v]]<g?p=v+1:m=v;g<n[a[p]]&&(p>0&&(s[l]=a[p-1]),a[p]=l)}}for(p=a.length,m=a[p-1];p-- >0;)a[p]=m,m=s[m];return a}function ek(n){const s=n.subTree.component;if(s)return s.asyncDep&&!s.asyncResolved?s:ek(s)}const C9=n=>n.__isTeleport,fr=Symbol.for("v-fgt"),_p=Symbol.for("v-txt"),Yl=Symbol.for("v-cmt"),y0=Symbol.for("v-stc"),Fl=[];let dn=null;function w9(n=!1){Fl.push(dn=n?null:[])}function k9(){Fl.pop(),dn=Fl[Fl.length-1]||null}let ql=1;function MC(n){ql+=n}function N9(n){return n.dynamicChildren=ql>0?dn||La:null,k9(),ql>0&&dn&&dn.push(n),n}function D9(n,s,a,l,h,p){return N9(Ln(n,s,a,l,h,p,!0))}function O9(n){return n?n.__v_isVNode===!0:!1}function kl(n,s){return n.type===s.type&&n.key===s.key}const tk=({key:n})=>n??null,zh=({ref:n,ref_key:s,ref_for:a})=>(typeof n=="number"&&(n=""+n),n!=null?ti(n)||xi(n)||Ye(n)?{i:Hn,r:n,k:s,f:!!a}:n:null);function Ln(n,s=null,a=null,l=0,h=null,p=n===fr?0:1,m=!1,v=!1){const y={__v_isVNode:!0,__v_skip:!0,type:n,props:s,key:s&&tk(s),ref:s&&zh(s),scopeId:x2,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:p,patchFlag:l,dynamicProps:h,dynamicChildren:null,appContext:null,ctx:Hn};return v?(Ov(y,a),p&128&&n.normalize(y)):a&&(y.shapeFlag|=ti(a)?8:16),ql>0&&!m&&dn&&(y.patchFlag>0||p&6)&&y.patchFlag!==32&&dn.push(y),y}const So=P9;function P9(n,s=null,a=null,l=0,h=null,p=!1){if((!n||n===GB)&&(n=Yl),O9(n)){const v=Ha(n,s,!0);return a&&Ov(v,a),ql>0&&!p&&dn&&(v.shapeFlag&6?dn[dn.indexOf(n)]=v:dn.push(v)),v.patchFlag|=-2,v}if(z9(n)&&(n=n.__vccOpts),s){s=M9(s);let{class:v,style:y}=s;v&&!ti(v)&&(s.class=vv(v)),xt(y)&&(w2(y)&&!ze(y)&&(y=Xt({},y)),s.style=gv(y))}const m=ti(n)?1:KB(n)?128:C9(n)?64:xt(n)?4:Ye(n)?2:0;return Ln(n,s,a,l,h,m,p,!0)}function M9(n){return n?w2(n)||J2(n)?Xt({},n):n:null}function Ha(n,s,a=!1,l=!1){const{props:h,ref:p,patchFlag:m,children:v,transition:y}=n,g=s?x9(h||{},s):h,T={__v_isVNode:!0,__v_skip:!0,type:n.type,props:g,key:g&&tk(g),ref:s&&s.ref?a&&p?ze(p)?p.concat(zh(s)):[p,zh(s)]:zh(s):p,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:v,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:s&&n.type!==fr?m===-1?16:m|16:m,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:y,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Ha(n.ssContent),ssFallback:n.ssFallback&&Ha(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return y&&l&&(T.transition=y.clone(T)),T}function L9(n=" ",s=0){return So(_p,null,n,s)}function xn(n){return n==null||typeof n=="boolean"?So(Yl):ze(n)?So(fr,null,n.slice()):typeof n=="object"?ss(n):So(_p,null,String(n))}function ss(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Ha(n)}function Ov(n,s){let a=0;const{shapeFlag:l}=n;if(s==null)s=null;else if(ze(s))a=16;else if(typeof s=="object")if(l&65){const h=s.default;h&&(h._c&&(h._d=!1),Ov(n,h()),h._c&&(h._d=!0));return}else{a=32;const h=s._;!h&&!J2(s)?s._ctx=Hn:h===3&&Hn&&(Hn.slots._===1?s._=1:(s._=2,n.patchFlag|=1024))}else Ye(s)?(s={default:s,_ctx:Hn},a=32):(s=String(s),l&64?(a=16,s=[L9(s)]):a=8);n.children=s,n.shapeFlag|=a}function x9(...n){const s={};for(let a=0;a<n.length;a++){const l=n[a];for(const h in l)if(h==="class")s.class!==l.class&&(s.class=vv([s.class,l.class]));else if(h==="style")s.style=gv([s.style,l.style]);else if(lp(h)){const p=s[h],m=l[h];m&&p!==m&&!(ze(p)&&p.includes(m))&&(s[h]=p?[].concat(p,m):m)}else h!==""&&(s[h]=l[h])}return s}function On(n,s,a,l=null){hn(n,s,7,[a,l])}const V9=z2();let U9=0;function F9(n,s,a){const l=n.type,h=(s?s.appContext:n.appContext)||V9,p={uid:U9++,vnode:n,type:l,parent:s,appContext:h,root:null,next:null,subTree:null,effect:null,update:null,scope:new sB(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(h.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:q2(l,h),emitsOptions:L2(l,h),emit:null,emitted:null,propsDefaults:At,inheritAttrs:l.inheritAttrs,ctx:At,data:At,props:At,attrs:At,slots:At,refs:At,setupState:At,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return p.ctx={_:p},p.root=s?s.root:p,p.emit=FB.bind(null,p),n.ce&&n.ce(p),p}let gi=null,tp,nv;{const n=f2(),s=(a,l)=>{let h;return(h=n[a])||(h=n[a]=[]),h.push(l),p=>{h.length>1?h.forEach(m=>m(p)):h[0](p)}};tp=s("__VUE_INSTANCE_SETTERS__",a=>gi=a),nv=s("__VUE_SSR_SETTERS__",a=>gp=a)}const iu=n=>{const s=gi;return tp(n),n.scope.on(),()=>{n.scope.off(),tp(s)}},LC=()=>{gi&&gi.scope.off(),tp(null)};function ik(n){return n.vnode.shapeFlag&4}let gp=!1;function B9(n,s=!1){s&&nv(s);const{props:a,children:l}=n.vnode,h=ik(n);v9(n,a,h,s),T9(n,l);const p=h?H9(n,s):void 0;return s&&nv(!1),p}function H9(n,s){const a=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,l9);const{setup:l}=a;if(l){const h=n.setupContext=l.length>1?W9(n):null,p=iu(n);_s();const m=hs(l,n,0,[n.props,h]);if(gs(),p(),d2(m)){if(m.then(LC,LC),s)return m.then(v=>{xC(n,v,s)}).catch(v=>{pp(v,n,0)});n.asyncDep=m}else xC(n,m,s)}else nk(n,s)}function xC(n,s,a){Ye(s)?n.type.__ssrInlineRender?n.ssrRender=s:n.render=s:xt(s)&&(n.setupState=N2(s)),nk(n,a)}let VC;function nk(n,s,a){const l=n.type;if(!n.render){if(!s&&VC&&!l.render){const h=l.template||Nv(n).template;if(h){const{isCustomElement:p,compilerOptions:m}=n.appContext.config,{delimiters:v,compilerOptions:y}=l,g=Xt(Xt({isCustomElement:p,delimiters:v},m),y);l.render=VC(h,g)}}n.render=l.render||qi}{const h=iu(n);_s();try{u9(n)}finally{gs(),h()}}}const j9={get(n,s){return Ri(n,"get",""),n[s]}};function W9(n){const s=a=>{n.exposed=a||{}};return{attrs:new Proxy(n.attrs,j9),slots:n.slots,emit:n.emit,expose:s}}function Pv(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(N2(wB(n.exposed)),{get(s,a){if(a in s)return s[a];if(a in Vl)return Vl[a](n)},has(s,a){return a in s||a in Vl}}))}function z9(n){return Ye(n)&&"__vccOpts"in n}const G9=(n,s)=>kB(n,s,gp),K9="3.4.27";/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const J9="http://www.w3.org/2000/svg",Y9="http://www.w3.org/1998/Math/MathML",os=typeof document<"u"?document:null,UC=os&&os.createElement("template"),q9={insert:(n,s,a)=>{s.insertBefore(n,a||null)},remove:n=>{const s=n.parentNode;s&&s.removeChild(n)},createElement:(n,s,a,l)=>{const h=s==="svg"?os.createElementNS(J9,n):s==="mathml"?os.createElementNS(Y9,n):os.createElement(n,a?{is:a}:void 0);return n==="select"&&l&&l.multiple!=null&&h.setAttribute("multiple",l.multiple),h},createText:n=>os.createTextNode(n),createComment:n=>os.createComment(n),setText:(n,s)=>{n.nodeValue=s},setElementText:(n,s)=>{n.textContent=s},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>os.querySelector(n),setScopeId(n,s){n.setAttribute(s,"")},insertStaticContent(n,s,a,l,h,p){const m=a?a.previousSibling:s.lastChild;if(h&&(h===p||h.nextSibling))for(;s.insertBefore(h.cloneNode(!0),a),!(h===p||!(h=h.nextSibling)););else{UC.innerHTML=l==="svg"?`<svg>${n}</svg>`:l==="mathml"?`<math>${n}</math>`:n;const v=UC.content;if(l==="svg"||l==="mathml"){const y=v.firstChild;for(;y.firstChild;)v.appendChild(y.firstChild);v.removeChild(y)}s.insertBefore(v,a)}return[m?m.nextSibling:s.firstChild,a?a.previousSibling:s.lastChild]}},X9=Symbol("_vtc");function Q9(n,s,a){const l=n[X9];l&&(s=(s?[s,...l]:[...l]).join(" ")),s==null?n.removeAttribute("class"):a?n.setAttribute("class",s):n.className=s}const FC=Symbol("_vod"),Z9=Symbol("_vsh"),$9=Symbol(""),eH=/(^|;)\s*display\s*:/;function tH(n,s,a){const l=n.style,h=ti(a);let p=!1;if(a&&!h){if(s)if(ti(s))for(const m of s.split(";")){const v=m.slice(0,m.indexOf(":")).trim();a[v]==null&&Gh(l,v,"")}else for(const m in s)a[m]==null&&Gh(l,m,"");for(const m in a)m==="display"&&(p=!0),Gh(l,m,a[m])}else if(h){if(s!==a){const m=l[$9];m&&(a+=";"+m),l.cssText=a,p=eH.test(a)}}else s&&n.removeAttribute("style");FC in n&&(n[FC]=p?l.display:"",n[Z9]&&(l.display="none"))}const BC=/\s*!important$/;function Gh(n,s,a){if(ze(a))a.forEach(l=>Gh(n,s,l));else if(a==null&&(a=""),s.startsWith("--"))n.setProperty(s,a);else{const l=iH(n,s);BC.test(a)?n.setProperty(Wa(l),a.replace(BC,""),"important"):n[l]=a}}const HC=["Webkit","Moz","ms"],E0={};function iH(n,s){const a=E0[s];if(a)return a;let l=Ba(s);if(l!=="filter"&&l in n)return E0[s]=l;l=h2(l);for(let h=0;h<HC.length;h++){const p=HC[h]+l;if(p in n)return E0[s]=p}return s}const jC="http://www.w3.org/1999/xlink";function nH(n,s,a,l,h){if(l&&s.startsWith("xlink:"))a==null?n.removeAttributeNS(jC,s.slice(6,s.length)):n.setAttributeNS(jC,s,a);else{const p=rB(s);a==null||p&&!m2(a)?n.removeAttribute(s):n.setAttribute(s,p?"":a)}}function rH(n,s,a,l,h,p,m){if(s==="innerHTML"||s==="textContent"){l&&m(l,h,p),n[s]=a??"";return}const v=n.tagName;if(s==="value"&&v!=="PROGRESS"&&!v.includes("-")){const g=v==="OPTION"?n.getAttribute("value")||"":n.value,T=a??"";(g!==T||!("_value"in n))&&(n.value=T),a==null&&n.removeAttribute(s),n._value=a;return}let y=!1;if(a===""||a==null){const g=typeof n[s];g==="boolean"?a=m2(a):a==null&&g==="string"?(a="",y=!0):g==="number"&&(a=0,y=!0)}try{n[s]=a}catch{}y&&n.removeAttribute(s)}function sH(n,s,a,l){n.addEventListener(s,a,l)}function oH(n,s,a,l){n.removeEventListener(s,a,l)}const WC=Symbol("_vei");function aH(n,s,a,l,h=null){const p=n[WC]||(n[WC]={}),m=p[s];if(l&&m)m.value=l;else{const[v,y]=cH(s);if(l){const g=p[s]=dH(l,h);sH(n,v,g,y)}else m&&(oH(n,v,m,y),p[s]=void 0)}}const zC=/(?:Once|Passive|Capture)$/;function cH(n){let s;if(zC.test(n)){s={};let l;for(;l=n.match(zC);)n=n.slice(0,n.length-l[0].length),s[l[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Wa(n.slice(2)),s]}let T0=0;const lH=Promise.resolve(),uH=()=>T0||(lH.then(()=>T0=0),T0=Date.now());function dH(n,s){const a=l=>{if(!l._vts)l._vts=Date.now();else if(l._vts<=a.attached)return;hn(hH(l,a.value),s,5,[l])};return a.value=n,a.attached=uH(),a}function hH(n,s){if(ze(s)){const a=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{a.call(n),n._stopped=!0},s.map(l=>h=>!h._stopped&&l&&l(h))}else return s}const GC=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,pH=(n,s,a,l,h,p,m,v,y)=>{const g=h==="svg";s==="class"?Q9(n,l,g):s==="style"?tH(n,a,l):lp(s)?fv(s)||aH(n,s,a,l,m):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):fH(n,s,l,g))?rH(n,s,l,p,m,v,y):(s==="true-value"?n._trueValue=l:s==="false-value"&&(n._falseValue=l),nH(n,s,l,g))};function fH(n,s,a,l){if(l)return!!(s==="innerHTML"||s==="textContent"||s in n&&GC(s)&&Ye(a));if(s==="spellcheck"||s==="draggable"||s==="translate"||s==="form"||s==="list"&&n.tagName==="INPUT"||s==="type"&&n.tagName==="TEXTAREA")return!1;if(s==="width"||s==="height"){const h=n.tagName;if(h==="IMG"||h==="VIDEO"||h==="CANVAS"||h==="SOURCE")return!1}return GC(s)&&ti(a)?!1:s in n}const mH=Xt({patchProp:pH},q9);let KC;function _H(){return KC||(KC=I9(mH))}const gH=(...n)=>{const s=_H().createApp(...n),{mount:a}=s;return s.mount=l=>{const h=yH(l);if(!h)return;const p=s._component;!Ye(p)&&!p.render&&!p.template&&(p.template=h.innerHTML),h.innerHTML="";const m=a(h,!1,vH(h));return h instanceof Element&&(h.removeAttribute("v-cloak"),h.setAttribute("data-v-app","")),m},s};function vH(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function yH(n){return ti(n)?document.querySelector(n):n}var S0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function EH(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rk={exports:{}};(function(n,s){(function(a,l){n.exports=l()})(S0,function(){function a(e,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(r){if(r!=="default"&&!(r in e)){var o=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return i[r]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof S0<"u"?S0:typeof self<"u"?self:{},h=function(e){try{return!!e()}catch{return!0}},p=!h(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),m=p,v=Function.prototype,y=v.call,g=m&&v.bind.bind(y,y),T=m?g:function(e){return function(){return y.apply(e,arguments)}},A=T,C=A({}.toString),I=A("".slice),O=function(e){return I(C(e),8,-1)},D=h,w=O,L=Object,M=T("".split),P=D(function(){return!L("z").propertyIsEnumerable(0)})?function(e){return w(e)=="String"?M(e,""):L(e)}:L,V=function(e){return e==null},G=V,H=TypeError,W=function(e){if(G(e))throw H("Can't call method on "+e);return e},z=P,Z=W,F=function(e){return z(Z(e))},J=function(e){return e&&e.Math==Math&&e},X=J(typeof globalThis=="object"&&globalThis)||J(typeof window=="object"&&window)||J(typeof self=="object"&&self)||J(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),ee={},ve={get exports(){return ee},set exports(e){ee=e}},Ce=X,Ae=Object.defineProperty,Se=function(e,t){try{Ae(Ce,e,{value:t,configurable:!0,writable:!0})}catch{Ce[e]=t}return t},_e=Se,Fe="__core-js_shared__",dt=X[Fe]||_e(Fe,{}),te=dt;(ve.exports=function(e,t){return te[e]||(te[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.30.0",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.0/LICENSE",source:"https://github.com/zloirock/core-js"});var $,ne,de=W,Pt=Object,at=function(e){return Pt(de(e))},jt=at,Ci=T({}.hasOwnProperty),yt=Object.hasOwn||function(e,t){return Ci(jt(e),t)},Qi=T,fn=0,ii=Math.random(),x=Qi(1 .toString),j=function(e){return"Symbol("+(e===void 0?"":e)+")_"+x(++fn+ii,36)},q=typeof navigator<"u"&&String(navigator.userAgent)||"",ce=X,ae=q,fe=ce.process,ye=ce.Deno,he=fe&&fe.versions||ye&&ye.version,me=he&&he.v8;me&&(ne=($=me.split("."))[0]>0&&$[0]<4?1:+($[0]+$[1])),!ne&&ae&&(!($=ae.match(/Edge\/(\d+)/))||$[1]>=74)&&($=ae.match(/Chrome\/(\d+)/))&&(ne=+$[1]);var ue=ne,Ee=ue,Pe=h,we=!!Object.getOwnPropertySymbols&&!Pe(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ee&&Ee<41}),Me=we&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ge=ee,tt=yt,ht=j,Et=we,Vt=Me,di=X.Symbol,jn=Ge("wks"),mn=Vt?di.for||di:di&&di.withoutSetter||ht,mt=function(e){return tt(jn,e)||(jn[e]=Et&&tt(di,e)?di[e]:mn("Symbol."+e)),jn[e]},Ut=typeof document=="object"&&document.all,Wt={all:Ut,IS_HTMLDDA:Ut===void 0&&Ut!==void 0},Ro=Wt.all,lt=Wt.IS_HTMLDDA?function(e){return typeof e=="function"||e===Ro}:function(e){return typeof e=="function"},_n=lt,yp=Wt.all,zt=Wt.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:_n(e)||e===yp}:function(e){return typeof e=="object"?e!==null:_n(e)},Ep=zt,Tp=String,Sp=TypeError,Ft=function(e){if(Ep(e))return e;throw Sp(Tp(e)+" is not an object")},au={},Mt=!h(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ga=Mt&&h(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),vi={},Ka=zt,Wn=X.document,cu=Ka(Wn)&&Ka(Wn.createElement),lu=function(e){return cu?Wn.createElement(e):{}},Gk=lu,Gv=!Mt&&!h(function(){return Object.defineProperty(Gk("div"),"a",{get:function(){return 7}}).a!=7}),Kk=p,uu=Function.prototype.call,Rt=Kk?uu.bind(uu):function(){return uu.apply(uu,arguments)},Ip=X,Jk=lt,Tr=function(e,t){return arguments.length<2?(i=Ip[e],Jk(i)?i:void 0):Ip[e]&&Ip[e][t];var i},Sr=T({}.isPrototypeOf),Yk=Tr,qk=lt,Xk=Sr,Qk=Object,bp=Me?function(e){return typeof e=="symbol"}:function(e){var t=Yk("Symbol");return qk(t)&&Xk(t.prototype,Qk(e))},Zk=String,Co=function(e){try{return Zk(e)}catch{return"Object"}},$k=lt,eN=Co,tN=TypeError,Zi=function(e){if($k(e))return e;throw tN(eN(e)+" is not a function")},iN=Zi,nN=V,Ja=function(e,t){var i=e[t];return nN(i)?void 0:iN(i)},Ap=Rt,Rp=lt,Cp=zt,rN=TypeError,sN=Rt,Kv=zt,Jv=bp,oN=Ja,aN=function(e,t){var i,r;if(t==="string"&&Rp(i=e.toString)&&!Cp(r=Ap(i,e))||Rp(i=e.valueOf)&&!Cp(r=Ap(i,e))||t!=="string"&&Rp(i=e.toString)&&!Cp(r=Ap(i,e)))return r;throw rN("Can't convert object to primitive value")},cN=TypeError,lN=mt("toPrimitive"),Yv=function(e,t){if(!Kv(e)||Jv(e))return e;var i,r=oN(e,lN);if(r){if(t===void 0&&(t="default"),i=sN(r,e,t),!Kv(i)||Jv(i))return i;throw cN("Can't convert object to primitive value")}return t===void 0&&(t="number"),aN(e,t)},uN=Yv,dN=bp,du=function(e){var t=uN(e,"string");return dN(t)?t:t+""},hN=Mt,pN=Gv,fN=Ga,hu=Ft,qv=du,mN=TypeError,wp=Object.defineProperty,_N=Object.getOwnPropertyDescriptor,kp="enumerable",Np="configurable",Dp="writable";vi.f=hN?fN?function(e,t,i){if(hu(e),t=qv(t),hu(i),typeof e=="function"&&t==="prototype"&&"value"in i&&Dp in i&&!i[Dp]){var r=_N(e,t);r&&r[Dp]&&(e[t]=i.value,i={configurable:Np in i?i[Np]:r[Np],enumerable:kp in i?i[kp]:r[kp],writable:!1})}return wp(e,t,i)}:wp:function(e,t,i){if(hu(e),t=qv(t),hu(i),pN)try{return wp(e,t,i)}catch{}if("get"in i||"set"in i)throw mN("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var gN=Math.ceil,vN=Math.floor,yN=Math.trunc||function(e){var t=+e;return(t>0?vN:gN)(t)},EN=yN,Ir=function(e){var t=+e;return t!=t||t===0?0:EN(t)},TN=Ir,SN=Math.max,IN=Math.min,pu=function(e,t){var i=TN(e);return i<0?SN(i+t,0):IN(i,t)},bN=Ir,AN=Math.min,vs=function(e){return e>0?AN(bN(e),9007199254740991):0},RN=vs,gn=function(e){return RN(e.length)},CN=F,wN=pu,kN=gn,Xv=function(e){return function(t,i,r){var o,c=CN(t),u=kN(c),f=wN(r,u);if(e&&i!=i){for(;u>f;)if((o=c[f++])!=o)return!0}else for(;u>f;f++)if((e||f in c)&&c[f]===i)return e||f||0;return!e&&-1}},Qv={includes:Xv(!0),indexOf:Xv(!1)},Op={},Pp=yt,NN=F,DN=Qv.indexOf,ON=Op,Zv=T([].push),$v=function(e,t){var i,r=NN(e),o=0,c=[];for(i in r)!Pp(ON,i)&&Pp(r,i)&&Zv(c,i);for(;t.length>o;)Pp(r,i=t[o++])&&(~DN(c,i)||Zv(c,i));return c},Mp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],PN=$v,MN=Mp,ey=Object.keys||function(e){return PN(e,MN)},LN=Mt,xN=Ga,VN=vi,UN=Ft,FN=F,BN=ey;au.f=LN&&!xN?Object.defineProperties:function(e,t){UN(e);for(var i,r=FN(t),o=BN(t),c=o.length,u=0;c>u;)VN.f(e,i=o[u++],r[i]);return e};var fu,ty=Tr("document","documentElement"),HN=j,iy=ee("keys"),Lp=function(e){return iy[e]||(iy[e]=HN(e))},jN=Ft,WN=au,ny=Mp,zN=Op,GN=ty,KN=lu,xp="prototype",Vp="script",ry=Lp("IE_PROTO"),Up=function(){},sy=function(e){return"<"+Vp+">"+e+"</"+Vp+">"},oy=function(e){e.write(sy("")),e.close();var t=e.parentWindow.Object;return e=null,t},mu=function(){try{fu=new ActiveXObject("htmlfile")}catch{}var e,t,i;mu=typeof document<"u"?document.domain&&fu?oy(fu):(t=KN("iframe"),i="java"+Vp+":",t.style.display="none",GN.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(sy("document.F=Object")),e.close(),e.F):oy(fu);for(var r=ny.length;r--;)delete mu[xp][ny[r]];return mu()};zN[ry]=!0;var Ya=Object.create||function(e,t){var i;return e!==null?(Up[xp]=jN(e),i=new Up,Up[xp]=null,i[ry]=e):i=mu(),t===void 0?i:WN.f(i,t)},JN=mt,YN=Ya,qN=vi.f,Fp=JN("unscopables"),Bp=Array.prototype;Bp[Fp]==null&&qN(Bp,Fp,{configurable:!0,value:YN(null)});var _u,qa,gu,ay=function(e){Bp[Fp][e]=!0},Xa={},XN=lt,cy=X.WeakMap,QN=XN(cy)&&/native code/.test(String(cy)),wo=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ZN=vi,$N=wo,zn=Mt?function(e,t,i){return ZN.f(e,t,$N(1,i))}:function(e,t,i){return e[t]=i,e},eD=QN,ly=X,tD=zt,iD=zn,Hp=yt,jp=dt,nD=Lp,rD=Op,uy="Object already initialized",Wp=ly.TypeError,sD=ly.WeakMap;if(eD||jp.state){var vn=jp.state||(jp.state=new sD);vn.get=vn.get,vn.has=vn.has,vn.set=vn.set,_u=function(e,t){if(vn.has(e))throw Wp(uy);return t.facade=e,vn.set(e,t),t},qa=function(e){return vn.get(e)||{}},gu=function(e){return vn.has(e)}}else{var ko=nD("state");rD[ko]=!0,_u=function(e,t){if(Hp(e,ko))throw Wp(uy);return t.facade=e,iD(e,ko,t),t},qa=function(e){return Hp(e,ko)?e[ko]:{}},gu=function(e){return Hp(e,ko)}}var hi={set:_u,get:qa,has:gu,enforce:function(e){return gu(e)?qa(e):_u(e,{})},getterFor:function(e){return function(t){var i;if(!tD(t)||(i=qa(t)).type!==e)throw Wp("Incompatible receiver, "+e+" required");return i}}},Qa={},zp={},dy={}.propertyIsEnumerable,hy=Object.getOwnPropertyDescriptor,oD=hy&&!dy.call({1:2},1);zp.f=oD?function(e){var t=hy(this,e);return!!t&&t.enumerable}:dy;var aD=Mt,cD=Rt,lD=zp,uD=wo,dD=F,hD=du,pD=yt,fD=Gv,py=Object.getOwnPropertyDescriptor;Qa.f=aD?py:function(e,t){if(e=dD(e),t=hD(t),fD)try{return py(e,t)}catch{}if(pD(e,t))return uD(!cD(lD.f,e,t),e[t])};var vu={},mD={get exports(){return vu},set exports(e){vu=e}},Gp=Mt,_D=yt,fy=Function.prototype,gD=Gp&&Object.getOwnPropertyDescriptor,Kp=_D(fy,"name"),Za={EXISTS:Kp,PROPER:Kp&&(function(){}).name==="something",CONFIGURABLE:Kp&&(!Gp||Gp&&gD(fy,"name").configurable)},vD=lt,Jp=dt,yD=T(Function.toString);vD(Jp.inspectSource)||(Jp.inspectSource=function(e){return yD(e)});var Yp=Jp.inspectSource,qp=T,ED=h,TD=lt,yu=yt,Xp=Mt,SD=Za.CONFIGURABLE,ID=Yp,bD=hi.enforce,AD=hi.get,my=String,Eu=Object.defineProperty,RD=qp("".slice),CD=qp("".replace),wD=qp([].join),kD=Xp&&!ED(function(){return Eu(function(){},"length",{value:8}).length!==8}),ND=String(String).split("String"),DD=mD.exports=function(e,t,i){RD(my(t),0,7)==="Symbol("&&(t="["+CD(my(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(t="get "+t),i&&i.setter&&(t="set "+t),(!yu(e,"name")||SD&&e.name!==t)&&(Xp?Eu(e,"name",{value:t,configurable:!0}):e.name=t),kD&&i&&yu(i,"arity")&&e.length!==i.arity&&Eu(e,"length",{value:i.arity});try{i&&yu(i,"constructor")&&i.constructor?Xp&&Eu(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var r=bD(e);return yu(r,"source")||(r.source=wD(ND,typeof t=="string"?t:"")),e};Function.prototype.toString=DD(function(){return TD(this)&&AD(this).source||ID(this)},"toString");var OD=lt,PD=vi,MD=vu,LD=Se,Vi=function(e,t,i,r){r||(r={});var o=r.enumerable,c=r.name!==void 0?r.name:t;if(OD(i)&&MD(i,c,r),r.global)o?e[t]=i:LD(t,i);else{try{r.unsafe?e[t]&&(o=!0):delete e[t]}catch{}o?e[t]=i:PD.f(e,t,{value:i,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},$a={},xD=$v,VD=Mp.concat("length","prototype");$a.f=Object.getOwnPropertyNames||function(e){return xD(e,VD)};var Qp={};Qp.f=Object.getOwnPropertySymbols;var ys,_y,gy,UD=Tr,FD=$a,BD=Qp,HD=Ft,jD=T([].concat),WD=UD("Reflect","ownKeys")||function(e){var t=FD.f(HD(e)),i=BD.f;return i?jD(t,i(e)):t},vy=yt,zD=WD,GD=Qa,KD=vi,yy=function(e,t,i){for(var r=zD(t),o=KD.f,c=GD.f,u=0;u<r.length;u++){var f=r[u];vy(e,f)||i&&vy(i,f)||o(e,f,c(t,f))}},JD=h,YD=lt,qD=/#|\.prototype\./,ec=function(e,t){var i=QD[XD(e)];return i==$D||i!=ZD&&(YD(t)?JD(t):!!t)},XD=ec.normalize=function(e){return String(e).replace(qD,".").toLowerCase()},QD=ec.data={},ZD=ec.NATIVE="N",$D=ec.POLYFILL="P",Zp=ec,$p=X,eO=Qa.f,tO=zn,iO=Vi,nO=Se,rO=yy,sO=Zp,Nt=function(e,t){var i,r,o,c,u,f=e.target,d=e.global,_=e.stat;if(i=d?$p:_?$p[f]||nO(f,{}):($p[f]||{}).prototype)for(r in t){if(c=t[r],o=e.dontCallGetSet?(u=eO(i,r))&&u.value:i[r],!sO(d?r:f+(_?".":"#")+r,e.forced)&&o!==void 0){if(typeof c==typeof o)continue;rO(c,o)}(e.sham||o&&o.sham)&&tO(c,"sham",!0),iO(i,r,c,e)}},oO=!h(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),aO=yt,cO=lt,lO=at,uO=oO,Ey=Lp("IE_PROTO"),ef=Object,dO=ef.prototype,Tu=uO?ef.getPrototypeOf:function(e){var t=lO(e);if(aO(t,Ey))return t[Ey];var i=t.constructor;return cO(i)&&t instanceof i?i.prototype:t instanceof ef?dO:null},hO=h,pO=lt,fO=zt,Ty=Tu,mO=Vi,tf=mt("iterator"),Sy=!1;[].keys&&("next"in(gy=[].keys())?(_y=Ty(Ty(gy)))!==Object.prototype&&(ys=_y):Sy=!0);var _O=!fO(ys)||hO(function(){var e={};return ys[tf].call(e)!==e});_O&&(ys={}),pO(ys[tf])||mO(ys,tf,function(){return this});var nf={IteratorPrototype:ys,BUGGY_SAFARI_ITERATORS:Sy},gO=vi.f,vO=yt,Iy=mt("toStringTag"),No=function(e,t,i){e&&!i&&(e=e.prototype),e&&!vO(e,Iy)&&gO(e,Iy,{configurable:!0,value:t})},yO=nf.IteratorPrototype,EO=Ya,TO=wo,SO=No,IO=Xa,bO=function(){return this},by=function(e,t,i,r){var o=t+" Iterator";return e.prototype=EO(yO,{next:TO(+!r,i)}),SO(e,o,!1),IO[o]=bO,e},AO=T,RO=Zi,CO=lt,wO=String,kO=TypeError,NO=function(e,t,i){try{return AO(RO(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},DO=Ft,OO=function(e){if(typeof e=="object"||CO(e))return e;throw kO("Can't set "+wO(e)+" as a prototype")},Do=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=NO(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(r,o){return DO(r),OO(o),t?e(r,o):r.__proto__=o,r}}():void 0),PO=Nt,MO=Rt,LO=lt,xO=by,Ay=Tu,Ry=Do,VO=No,UO=zn,rf=Vi,FO=Xa,BO=Za.PROPER,HO=Za.CONFIGURABLE,Cy=nf.IteratorPrototype,Su=nf.BUGGY_SAFARI_ITERATORS,tc=mt("iterator"),wy="keys",ic="values",ky="entries",jO=function(){return this},Ny=function(e,t,i,r,o,c,u){xO(i,t,r);var f,d,_,E=function(le){if(le===o&&K)return K;if(!Su&&le in k)return k[le];switch(le){case wy:case ic:case ky:return function(){return new i(this,le)}}return function(){return new i(this)}},S=t+" Iterator",R=!1,k=e.prototype,U=k[tc]||k["@@iterator"]||o&&k[o],K=!Su&&U||E(o),se=t=="Array"&&k.entries||U;if(se&&(f=Ay(se.call(new e)))!==Object.prototype&&f.next&&(Ay(f)!==Cy&&(Ry?Ry(f,Cy):LO(f[tc])||rf(f,tc,jO)),VO(f,S,!0)),BO&&o==ic&&U&&U.name!==ic&&(HO?UO(k,"name",ic):(R=!0,K=function(){return MO(U,this)})),o)if(d={values:E(ic),keys:c?K:E(wy),entries:E(ky)},u)for(_ in d)(Su||R||!(_ in k))&&rf(k,_,d[_]);else PO({target:t,proto:!0,forced:Su||R},d);return k[tc]!==K&&rf(k,tc,K,{name:o}),FO[t]=K,d},Dy=function(e,t){return{value:e,done:t}},WO=F,sf=ay,Oy=Xa,Py=hi,zO=vi.f,GO=Ny,My=Dy,KO=Mt,Ly="Array Iterator",JO=Py.set,YO=Py.getterFor(Ly),qO=GO(Array,"Array",function(e,t){JO(this,{type:Ly,target:WO(e),index:0,kind:t})},function(){var e=YO(this),t=e.target,i=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,My(void 0,!0)):My(i=="keys"?r:i=="values"?t[r]:[r,t[r]],!1)},"values"),xy=Oy.Arguments=Oy.Array;if(sf("keys"),sf("values"),sf("entries"),KO&&xy.name!=="values")try{zO(xy,"name",{value:"values"})}catch{}var Vy={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},of=lu("span").classList,Uy=of&&of.constructor&&of.constructor.prototype,Fy=Uy===Object.prototype?void 0:Uy,By=X,Hy=Vy,XO=Fy,nc=qO,af=zn,jy=mt,cf=jy("iterator"),Wy=jy("toStringTag"),lf=nc.values,zy=function(e,t){if(e){if(e[cf]!==lf)try{af(e,cf,lf)}catch{e[cf]=lf}if(e[Wy]||af(e,Wy,t),Hy[t]){for(var i in nc)if(e[i]!==nc[i])try{af(e,i,nc[i])}catch{e[i]=nc[i]}}}};for(var uf in Hy)zy(By[uf]&&By[uf].prototype,uf);zy(XO,"DOMTokenList");var rc=typeof process<"u"&&O(process)=="process",Gy=vu,QO=vi,Es=function(e,t,i){return i.get&&Gy(i.get,t,{getter:!0}),i.set&&Gy(i.set,t,{setter:!0}),QO.f(e,t,i)},ZO=Tr,$O=Es,eP=Mt,Ky=mt("species"),Iu=function(e){var t=ZO(e);eP&&t&&!t[Ky]&&$O(t,Ky,{configurable:!0,get:function(){return this}})},tP=Sr,iP=TypeError,sc=function(e,t){if(tP(t,e))return e;throw iP("Incorrect invocation")},Jy={};Jy[mt("toStringTag")]="z";var nP=String(Jy)==="[object z]",rP=lt,bu=O,sP=mt("toStringTag"),oP=Object,aP=bu(function(){return arguments}())=="Arguments",br=nP?bu:function(e){var t,i,r;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(o,c){try{return o[c]}catch{}}(t=oP(e),sP))=="string"?i:aP?bu(t):(r=bu(t))=="Object"&&rP(t.callee)?"Arguments":r},cP=T,lP=h,Yy=lt,uP=br,dP=Yp,qy=function(){},hP=[],Xy=Tr("Reflect","construct"),df=/^\s*(?:class|function)\b/,pP=cP(df.exec),fP=!df.exec(qy),oc=function(e){if(!Yy(e))return!1;try{return Xy(qy,hP,e),!0}catch{return!1}},Qy=function(e){if(!Yy(e))return!1;switch(uP(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return fP||!!pP(df,dP(e))}catch{return!0}};Qy.sham=!0;var ac,Oo,Zy,hf,pf=!Xy||lP(function(){var e;return oc(oc.call)||!oc(Object)||!oc(function(){e=!0})||e})?Qy:oc,mP=pf,_P=Co,gP=TypeError,$y=function(e){if(mP(e))return e;throw gP(_P(e)+" is not a constructor")},eE=Ft,vP=$y,yP=V,EP=mt("species"),ff=function(e,t){var i,r=eE(e).constructor;return r===void 0||yP(i=eE(r)[EP])?t:vP(i)},TP=p,tE=Function.prototype,iE=tE.apply,nE=tE.call,rE=typeof Reflect=="object"&&Reflect.apply||(TP?nE.bind(iE):function(){return nE.apply(iE,arguments)}),SP=O,IP=T,cc=function(e){if(SP(e)==="Function")return IP(e)},bP=Zi,AP=p,RP=cc(cc.bind),Ar=function(e,t){return bP(e),t===void 0?e:AP?RP(e,t):function(){return e.apply(t,arguments)}},CP=T([].slice),wP=TypeError,mf=function(e,t){if(e<t)throw wP("Not enough arguments");return e},sE=/(?:ipad|iphone|ipod).*applewebkit/i.test(q),wi=X,kP=rE,NP=Ar,oE=lt,DP=yt,aE=h,cE=ty,OP=CP,lE=lu,PP=mf,MP=sE,LP=rc,_f=wi.setImmediate,gf=wi.clearImmediate,xP=wi.process,vf=wi.Dispatch,VP=wi.Function,uE=wi.MessageChannel,UP=wi.String,yf=0,lc={},dE="onreadystatechange";aE(function(){ac=wi.location});var Ef=function(e){if(DP(lc,e)){var t=lc[e];delete lc[e],t()}},Tf=function(e){return function(){Ef(e)}},hE=function(e){Ef(e.data)},pE=function(e){wi.postMessage(UP(e),ac.protocol+"//"+ac.host)};_f&&gf||(_f=function(e){PP(arguments.length,1);var t=oE(e)?e:VP(e),i=OP(arguments,1);return lc[++yf]=function(){kP(t,void 0,i)},Oo(yf),yf},gf=function(e){delete lc[e]},LP?Oo=function(e){xP.nextTick(Tf(e))}:vf&&vf.now?Oo=function(e){vf.now(Tf(e))}:uE&&!MP?(hf=(Zy=new uE).port2,Zy.port1.onmessage=hE,Oo=NP(hf.postMessage,hf)):wi.addEventListener&&oE(wi.postMessage)&&!wi.importScripts&&ac&&ac.protocol!=="file:"&&!aE(pE)?(Oo=pE,wi.addEventListener("message",hE,!1)):Oo=dE in lE("script")?function(e){cE.appendChild(lE("script"))[dE]=function(){cE.removeChild(this),Ef(e)}}:function(e){setTimeout(Tf(e),0)});var fE={set:_f,clear:gf},mE=function(){this.head=null,this.tail=null};mE.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Po,Sf,If,bf,_E,gE=mE,FP=/ipad|iphone|ipod/i.test(q)&&typeof Pebble<"u",BP=/web0s(?!.*chrome)/i.test(q),Ts=X,vE=Ar,HP=Qa.f,Af=fE.set,jP=gE,WP=sE,zP=FP,GP=BP,Rf=rc,yE=Ts.MutationObserver||Ts.WebKitMutationObserver,EE=Ts.document,TE=Ts.process,Au=Ts.Promise,SE=HP(Ts,"queueMicrotask"),Cf=SE&&SE.value;if(!Cf){var Ru=new jP,Cu=function(){var e,t;for(Rf&&(e=TE.domain)&&e.exit();t=Ru.get();)try{t()}catch(i){throw Ru.head&&Po(),i}e&&e.enter()};WP||Rf||GP||!yE||!EE?!zP&&Au&&Au.resolve?((bf=Au.resolve(void 0)).constructor=Au,_E=vE(bf.then,bf),Po=function(){_E(Cu)}):Rf?Po=function(){TE.nextTick(Cu)}:(Af=vE(Af,Ts),Po=function(){Af(Cu)}):(Sf=!0,If=EE.createTextNode(""),new yE(Cu).observe(If,{characterData:!0}),Po=function(){If.data=Sf=!Sf}),Cf=function(e){Ru.head||Po(),Ru.add(e)}}var KP=Cf,wf=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},uc=X.Promise,IE=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",JP=!IE&&!rc&&typeof window=="object"&&typeof document=="object",YP=X,dc=uc,qP=lt,XP=Zp,QP=Yp,ZP=mt,$P=JP,eM=IE,kf=ue;dc&&dc.prototype;var tM=ZP("species"),bE=!1,AE=qP(YP.PromiseRejectionEvent),iM=XP("Promise",function(){var e=QP(dc),t=e!==String(dc);if(!t&&kf===66)return!0;if(!kf||kf<51||!/native code/.test(e)){var i=new dc(function(o){o(1)}),r=function(o){o(function(){},function(){})};if((i.constructor={})[tM]=r,!(bE=i.then(function(){})instanceof r))return!0}return!t&&($P||eM)&&!AE}),Ss={CONSTRUCTOR:iM,REJECTION_EVENT:AE,SUBCLASSING:bE},Mo={},RE=Zi,nM=TypeError,rM=function(e){var t,i;this.promise=new e(function(r,o){if(t!==void 0||i!==void 0)throw nM("Bad Promise constructor");t=r,i=o}),this.resolve=RE(t),this.reject=RE(i)};Mo.f=function(e){return new rM(e)};var Nf,CE,wE,sM=Nt,wu=rc,Rr=X,Lo=Rt,kE=Vi,NE=Do,oM=No,aM=Iu,cM=Zi,ku=lt,lM=zt,uM=sc,dM=ff,DE=fE.set,Df=KP,hM=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},pM=wf,fM=gE,OE=hi,Nu=uc,PE=Mo,Du="Promise",ME=Ss.CONSTRUCTOR,mM=Ss.REJECTION_EVENT,_M=Ss.SUBCLASSING,Of=OE.getterFor(Du),gM=OE.set,xo=Nu&&Nu.prototype,Vo=Nu,Ou=xo,LE=Rr.TypeError,Pf=Rr.document,Mf=Rr.process,Lf=PE.f,vM=Lf,yM=!!(Pf&&Pf.createEvent&&Rr.dispatchEvent),xE="unhandledrejection",VE=function(e){var t;return!(!lM(e)||!ku(t=e.then))&&t},UE=function(e,t){var i,r,o,c=t.value,u=t.state==1,f=u?e.ok:e.fail,d=e.resolve,_=e.reject,E=e.domain;try{f?(u||(t.rejection===2&&TM(t),t.rejection=1),f===!0?i=c:(E&&E.enter(),i=f(c),E&&(E.exit(),o=!0)),i===e.promise?_(LE("Promise-chain cycle")):(r=VE(i))?Lo(r,i,d,_):d(i)):_(c)}catch(S){E&&!o&&E.exit(),_(S)}},FE=function(e,t){e.notified||(e.notified=!0,Df(function(){for(var i,r=e.reactions;i=r.get();)UE(i,e);e.notified=!1,t&&!e.rejection&&EM(e)}))},BE=function(e,t,i){var r,o;yM?((r=Pf.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),Rr.dispatchEvent(r)):r={promise:t,reason:i},!mM&&(o=Rr["on"+e])?o(r):e===xE&&hM("Unhandled promise rejection",i)},EM=function(e){Lo(DE,Rr,function(){var t,i=e.facade,r=e.value;if(HE(e)&&(t=pM(function(){wu?Mf.emit("unhandledRejection",r,i):BE(xE,i,r)}),e.rejection=wu||HE(e)?2:1,t.error))throw t.value})},HE=function(e){return e.rejection!==1&&!e.parent},TM=function(e){Lo(DE,Rr,function(){var t=e.facade;wu?Mf.emit("rejectionHandled",t):BE("rejectionhandled",t,e.value)})},Uo=function(e,t,i){return function(r){e(t,r,i)}},Fo=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,FE(e,!0))},xf=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw LE("Promise can't be resolved itself");var r=VE(t);r?Df(function(){var o={done:!1};try{Lo(r,t,Uo(xf,o,e),Uo(Fo,o,e))}catch(c){Fo(o,c,e)}}):(e.value=t,e.state=1,FE(e,!1))}catch(o){Fo({done:!1},o,e)}}};if(ME&&(Ou=(Vo=function(e){uM(this,Ou),cM(e),Lo(Nf,this);var t=Of(this);try{e(Uo(xf,t),Uo(Fo,t))}catch(i){Fo(t,i)}}).prototype,(Nf=function(e){gM(this,{type:Du,done:!1,notified:!1,parent:!1,reactions:new fM,rejection:!1,state:0,value:void 0})}).prototype=kE(Ou,"then",function(e,t){var i=Of(this),r=Lf(dM(this,Vo));return i.parent=!0,r.ok=!ku(e)||e,r.fail=ku(t)&&t,r.domain=wu?Mf.domain:void 0,i.state==0?i.reactions.add(r):Df(function(){UE(r,i)}),r.promise}),CE=function(){var e=new Nf,t=Of(e);this.promise=e,this.resolve=Uo(xf,t),this.reject=Uo(Fo,t)},PE.f=Lf=function(e){return e===Vo||e===void 0?new CE(e):vM(e)},ku(Nu)&&xo!==Object.prototype)){wE=xo.then,_M||kE(xo,"then",function(e,t){var i=this;return new Vo(function(r,o){Lo(wE,i,r,o)}).then(e,t)},{unsafe:!0});try{delete xo.constructor}catch{}NE&&NE(xo,Ou)}sM({global:!0,constructor:!0,wrap:!0,forced:ME},{Promise:Vo}),oM(Vo,Du,!1),aM(Du);var SM=Xa,IM=mt("iterator"),bM=Array.prototype,Vf=function(e){return e!==void 0&&(SM.Array===e||bM[IM]===e)},AM=br,jE=Ja,RM=V,CM=Xa,wM=mt("iterator"),hc=function(e){if(!RM(e))return jE(e,wM)||jE(e,"@@iterator")||CM[AM(e)]},kM=Rt,NM=Zi,DM=Ft,OM=Co,PM=hc,MM=TypeError,Pu=function(e,t){var i=arguments.length<2?PM(e):t;if(NM(i))return DM(kM(i,e));throw MM(OM(e)+" is not iterable")},LM=Rt,WE=Ft,xM=Ja,zE=function(e,t,i){var r,o;WE(e);try{if(!(r=xM(e,"return"))){if(t==="throw")throw i;return i}r=LM(r,e)}catch(c){o=!0,r=c}if(t==="throw")throw i;if(o)throw r;return WE(r),i},VM=Ar,UM=Rt,FM=Ft,BM=Co,HM=Vf,jM=gn,GE=Sr,WM=Pu,zM=hc,KE=zE,GM=TypeError,Mu=function(e,t){this.stopped=e,this.result=t},JE=Mu.prototype,YE=function(e,t,i){var r,o,c,u,f,d,_,E=i&&i.that,S=!(!i||!i.AS_ENTRIES),R=!(!i||!i.IS_RECORD),k=!(!i||!i.IS_ITERATOR),U=!(!i||!i.INTERRUPTED),K=VM(t,E),se=function(Y){return r&&KE(r,"normal",Y),new Mu(!0,Y)},le=function(Y){return S?(FM(Y),U?K(Y[0],Y[1],se):K(Y[0],Y[1])):U?K(Y,se):K(Y)};if(R)r=e.iterator;else if(k)r=e;else{if(!(o=zM(e)))throw GM(BM(e)+" is not iterable");if(HM(o)){for(c=0,u=jM(e);u>c;c++)if((f=le(e[c]))&&GE(JE,f))return f;return new Mu(!1)}r=WM(e,o)}for(d=R?e.next:r.next;!(_=UM(d,r)).done;){try{f=le(_.value)}catch(Y){KE(r,"throw",Y)}if(typeof f=="object"&&f&&GE(JE,f))return f}return new Mu(!1)},qE=mt("iterator"),XE=!1;try{var KM=0,QE={next:function(){return{done:!!KM++}},return:function(){XE=!0}};QE[qE]=function(){return this},Array.from(QE,function(){throw 2})}catch{}var ZE=function(e,t){if(!t&&!XE)return!1;var i=!1;try{var r={};r[qE]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},JM=uc,$E=Ss.CONSTRUCTOR||!ZE(function(e){JM.all(e).then(void 0,function(){})}),YM=Rt,qM=Zi,XM=Mo,QM=wf,ZM=YE;Nt({target:"Promise",stat:!0,forced:$E},{all:function(e){var t=this,i=XM.f(t),r=i.resolve,o=i.reject,c=QM(function(){var u=qM(t.resolve),f=[],d=0,_=1;ZM(e,function(E){var S=d++,R=!1;_++,YM(u,t,E).then(function(k){R||(R=!0,f[S]=k,--_||r(f))},o)}),--_||r(f)});return c.error&&o(c.value),i.promise}});var $M=Nt,eL=Ss.CONSTRUCTOR,Uf=uc,tL=Tr,iL=lt,nL=Vi,eT=Uf&&Uf.prototype;if($M({target:"Promise",proto:!0,forced:eL,real:!0},{catch:function(e){return this.then(void 0,e)}}),iL(Uf)){var tT=tL("Promise").prototype.catch;eT.catch!==tT&&nL(eT,"catch",tT,{unsafe:!0})}var rL=Rt,sL=Zi,oL=Mo,aL=wf,cL=YE;Nt({target:"Promise",stat:!0,forced:$E},{race:function(e){var t=this,i=oL.f(t),r=i.reject,o=aL(function(){var c=sL(t.resolve);cL(e,function(u){rL(c,t,u).then(i.resolve,r)})});return o.error&&r(o.value),i.promise}});var lL=Rt,uL=Mo;Nt({target:"Promise",stat:!0,forced:Ss.CONSTRUCTOR},{reject:function(e){var t=uL.f(this);return lL(t.reject,void 0,e),t.promise}});var dL=Ft,hL=zt,pL=Mo,iT=function(e,t){if(dL(e),hL(t)&&t.constructor===e)return t;var i=pL.f(e);return(0,i.resolve)(t),i.promise},fL=Nt,mL=Ss.CONSTRUCTOR,_L=iT;Tr("Promise"),fL({target:"Promise",stat:!0,forced:mL},{resolve:function(e){return _L(this,e)}});var gL=lt,vL=zt,nT=Do,rT=function(e,t,i){var r,o;return nT&&gL(r=t.constructor)&&r!==i&&vL(o=r.prototype)&&o!==i.prototype&&nT(e,o),e},yL=zt,EL=O,TL=mt("match"),sT=function(e){var t;return yL(e)&&((t=e[TL])!==void 0?!!t:EL(e)=="RegExp")},SL=br,IL=String,ki=function(e){if(SL(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return IL(e)},bL=Ft,oT=function(){var e=bL(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},AL=Rt,RL=yt,CL=Sr,wL=oT,aT=RegExp.prototype,cT=function(e){var t=e.flags;return t!==void 0||"flags"in aT||RL(e,"flags")||!CL(aT,e)?t:AL(wL,e)},Ff=h,Bf=X.RegExp,Hf=Ff(function(){var e=Bf("a","y");return e.lastIndex=2,e.exec("abcd")!=null}),kL=Hf||Ff(function(){return!Bf("a","y").sticky}),NL=Hf||Ff(function(){var e=Bf("^r","gy");return e.lastIndex=2,e.exec("str")!=null}),lT={BROKEN_CARET:NL,MISSED_STICKY:kL,UNSUPPORTED_Y:Hf},DL=vi.f,OL=h,PL=X.RegExp,uT=OL(function(){var e=PL(".","s");return!(e.dotAll&&e.exec(`
`)&&e.flags==="s")}),ML=h,LL=X.RegExp,dT=ML(function(){var e=LL("(?<a>b)","g");return e.exec("b").groups.a!=="b"||"b".replace(e,"$<a>c")!=="bc"}),xL=Mt,jf=X,pc=T,VL=Zp,UL=rT,FL=zn,BL=$a.f,hT=Sr,HL=sT,pT=ki,jL=cT,fT=lT,WL=function(e,t,i){i in e||DL(e,i,{configurable:!0,get:function(){return t[i]},set:function(r){t[i]=r}})},zL=Vi,GL=h,KL=yt,JL=hi.enforce,YL=Iu,mT=uT,_T=dT,qL=mt("match"),Cr=jf.RegExp,Bo=Cr.prototype,XL=jf.SyntaxError,QL=pc(Bo.exec),Lu=pc("".charAt),gT=pc("".replace),vT=pc("".indexOf),ZL=pc("".slice),$L=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Is=/a/g,Wf=/a/g,e3=new Cr(Is)!==Is,yT=fT.MISSED_STICKY,t3=fT.UNSUPPORTED_Y,i3=xL&&(!e3||yT||mT||_T||GL(function(){return Wf[qL]=!1,Cr(Is)!=Is||Cr(Wf)==Wf||Cr(Is,"i")!="/a/i"}));if(VL("RegExp",i3)){for(var bs=function(e,t){var i,r,o,c,u,f,d=hT(Bo,this),_=HL(e),E=t===void 0,S=[],R=e;if(!d&&_&&E&&e.constructor===bs)return e;if((_||hT(Bo,e))&&(e=e.source,E&&(t=jL(R))),e=e===void 0?"":pT(e),t=t===void 0?"":pT(t),R=e,mT&&"dotAll"in Is&&(r=!!t&&vT(t,"s")>-1)&&(t=gT(t,/s/g,"")),i=t,yT&&"sticky"in Is&&(o=!!t&&vT(t,"y")>-1)&&t3&&(t=gT(t,/y/g,"")),_T&&(c=function(k){for(var U,K=k.length,se=0,le="",Y=[],Re={},Ne=!1,Le=!1,pt=0,gt="";se<=K;se++){if((U=Lu(k,se))==="\\")U+=Lu(k,++se);else if(U==="]")Ne=!1;else if(!Ne)switch(!0){case U==="[":Ne=!0;break;case U==="(":QL($L,ZL(k,se+1))&&(se+=2,Le=!0),le+=U,pt++;continue;case(U===">"&&Le):if(gt===""||KL(Re,gt))throw new XL("Invalid capture group name");Re[gt]=!0,Y[Y.length]=[gt,pt],Le=!1,gt="";continue}Le?gt+=U:le+=U}return[le,Y]}(e),e=c[0],S=c[1]),u=UL(Cr(e,t),d?this:Bo,bs),(r||o||S.length)&&(f=JL(u),r&&(f.dotAll=!0,f.raw=bs(function(k){for(var U,K=k.length,se=0,le="",Y=!1;se<=K;se++)(U=Lu(k,se))!=="\\"?Y||U!=="."?(U==="["?Y=!0:U==="]"&&(Y=!1),le+=U):le+="[\\s\\S]":le+=U+Lu(k,++se);return le}(e),i)),o&&(f.sticky=!0),S.length&&(f.groups=S)),e!==R)try{FL(u,"source",R===""?"(?:)":R)}catch{}return u},ET=BL(Cr),TT=0;ET.length>TT;)WL(bs,Cr,ET[TT++]);Bo.constructor=bs,bs.prototype=Bo,zL(jf,"RegExp",bs,{constructor:!0})}YL("RegExp");var Ho=Rt,xu=T,n3=ki,r3=oT,s3=lT,o3=Ya,a3=hi.get,c3=uT,l3=dT,u3=ee("native-string-replace",String.prototype.replace),Vu=RegExp.prototype.exec,zf=Vu,d3=xu("".charAt),h3=xu("".indexOf),p3=xu("".replace),Gf=xu("".slice),Kf=function(){var e=/a/,t=/b*/g;return Ho(Vu,e,"a"),Ho(Vu,t,"a"),e.lastIndex!==0||t.lastIndex!==0}(),ST=s3.BROKEN_CARET,Jf=/()??/.exec("")[1]!==void 0;(Kf||Jf||ST||c3||l3)&&(zf=function(e){var t,i,r,o,c,u,f,d=this,_=a3(d),E=n3(e),S=_.raw;if(S)return S.lastIndex=d.lastIndex,t=Ho(zf,S,E),d.lastIndex=S.lastIndex,t;var R=_.groups,k=ST&&d.sticky,U=Ho(r3,d),K=d.source,se=0,le=E;if(k&&(U=p3(U,"y",""),h3(U,"g")===-1&&(U+="g"),le=Gf(E,d.lastIndex),d.lastIndex>0&&(!d.multiline||d.multiline&&d3(E,d.lastIndex-1)!==`
`)&&(K="(?: "+K+")",le=" "+le,se++),i=new RegExp("^(?:"+K+")",U)),Jf&&(i=new RegExp("^"+K+"$(?!\\s)",U)),Kf&&(r=d.lastIndex),o=Ho(Vu,k?i:d,le),k?o?(o.input=Gf(o.input,se),o[0]=Gf(o[0],se),o.index=d.lastIndex,d.lastIndex+=o[0].length):d.lastIndex=0:Kf&&o&&(d.lastIndex=d.global?o.index+o[0].length:r),Jf&&o&&o.length>1&&Ho(u3,o[0],i,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(o[c]=void 0)}),o&&R)for(o.groups=u=o3(null),c=0;c<R.length;c++)u[(f=R[c])[0]]=o[f[1]];return o});var Uu=zf;Nt({target:"RegExp",proto:!0,forced:/./.exec!==Uu},{exec:Uu});var f3=O,IT=Array.isArray||function(e){return f3(e)=="Array"},bT=IT,m3=pf,_3=zt,g3=mt("species"),AT=Array,v3=function(e){var t;return bT(e)&&(t=e.constructor,(m3(t)&&(t===AT||bT(t.prototype))||_3(t)&&(t=t[g3])===null)&&(t=void 0)),t===void 0?AT:t},y3=Ar,E3=P,T3=at,S3=gn,I3=function(e,t){return new(v3(e))(t===0?0:t)},RT=T([].push),wr=function(e){var t=e==1,i=e==2,r=e==3,o=e==4,c=e==6,u=e==7,f=e==5||c;return function(d,_,E,S){for(var R,k,U=T3(d),K=E3(U),se=y3(_,E),le=S3(K),Y=0,Re=S||I3,Ne=t?Re(d,le):i||u?Re(d,0):void 0;le>Y;Y++)if((f||Y in K)&&(k=se(R=K[Y],Y,U),e))if(t)Ne[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return R;case 6:return Y;case 2:RT(Ne,R)}else switch(e){case 4:return!1;case 7:RT(Ne,R)}return c?-1:r||o?o:Ne}},CT={forEach:wr(0),map:wr(1),filter:wr(2),some:wr(3),every:wr(4),find:wr(5),findIndex:wr(6),filterReject:wr(7)},b3=h,Yf=function(e,t){var i=[][e];return!!i&&b3(function(){i.call(null,t||function(){return 1},1)})},A3=CT.forEach,R3=Yf("forEach")?[].forEach:function(e){return A3(this,e,arguments.length>1?arguments[1]:void 0)},wT=X,kT=Vy,C3=Fy,qf=R3,w3=zn,NT=function(e){if(e&&e.forEach!==qf)try{w3(e,"forEach",qf)}catch{e.forEach=qf}};for(var Xf in kT)kT[Xf]&&NT(wT[Xf]&&wT[Xf].prototype);NT(C3);var k3=Zi,N3=at,D3=P,O3=gn,P3=TypeError,DT=function(e){return function(t,i,r,o){k3(i);var c=N3(t),u=D3(c),f=O3(c),d=e?f-1:0,_=e?-1:1;if(r<2)for(;;){if(d in u){o=u[d],d+=_;break}if(d+=_,e?d<0:f<=d)throw P3("Reduce of empty array with no initial value")}for(;e?d>=0:f>d;d+=_)d in u&&(o=i(o,u[d],d,c));return o}},M3={left:DT(!1),right:DT(!0)}.left;Nt({target:"Array",proto:!0,forced:!rc&&ue>79&&ue<83||!Yf("reduce")},{reduce:function(e){var t=arguments.length;return M3(this,e,t,t>1?arguments[1]:void 0)}});var OT=cc,PT=Vi,L3=Uu,MT=h,LT=mt,x3=LT("species"),xT=RegExp.prototype,Qf=T,V3=Ir,U3=ki,F3=W,B3=Qf("".charAt),VT=Qf("".charCodeAt),H3=Qf("".slice),UT=function(e){return function(t,i){var r,o,c=U3(F3(t)),u=V3(i),f=c.length;return u<0||u>=f?e?"":void 0:(r=VT(c,u))<55296||r>56319||u+1===f||(o=VT(c,u+1))<56320||o>57343?e?B3(c,u):r:e?H3(c,u,u+2):o-56320+(r-55296<<10)+65536}},Zf={codeAt:UT(!1),charAt:UT(!0)},j3=Zf.charAt,$f=T,W3=at,z3=Math.floor,em=$f("".charAt),G3=$f("".replace),tm=$f("".slice),K3=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,J3=/\$([$&'`]|\d{1,2})/g,FT=function(e,t,i,r,o,c){var u=i+e.length,f=r.length,d=J3;return o!==void 0&&(o=W3(o),d=K3),G3(c,d,function(_,E){var S;switch(em(E,0)){case"$":return"$";case"&":return e;case"`":return tm(t,0,i);case"'":return tm(t,u);case"<":S=o[tm(E,1,-1)];break;default:var R=+E;if(R===0)return _;if(R>f){var k=z3(R/10);return k===0?_:k<=f?r[k-1]===void 0?em(E,1):r[k-1]+em(E,1):_}S=r[R-1]}return S===void 0?"":S})},BT=Rt,Y3=Ft,q3=lt,X3=O,Q3=Uu,Z3=TypeError,$3=rE,HT=Rt,Fu=T,e4=function(e,t,i,r){var o=LT(e),c=!MT(function(){var _={};return _[o]=function(){return 7},""[e](_)!=7}),u=c&&!MT(function(){var _=!1,E=/a/;return e==="split"&&((E={}).constructor={},E.constructor[x3]=function(){return E},E.flags="",E[o]=/./[o]),E.exec=function(){return _=!0,null},E[o](""),!_});if(!c||!u||i){var f=OT(/./[o]),d=t(o,""[e],function(_,E,S,R,k){var U=OT(_),K=E.exec;return K===L3||K===xT.exec?c&&!k?{done:!0,value:f(E,S,R)}:{done:!0,value:U(S,E,R)}:{done:!1}});PT(String.prototype,e,d[0]),PT(xT,o,d[1])}},t4=h,i4=Ft,n4=lt,r4=V,s4=Ir,o4=vs,jo=ki,a4=W,c4=function(e,t,i){return t+(i?j3(e,t).length:1)},l4=Ja,u4=FT,d4=function(e,t){var i=e.exec;if(q3(i)){var r=BT(i,e,t);return r!==null&&Y3(r),r}if(X3(e)==="RegExp")return BT(Q3,e,t);throw Z3("RegExp#exec called on incompatible receiver")},im=mt("replace"),h4=Math.max,p4=Math.min,f4=Fu([].concat),nm=Fu([].push),jT=Fu("".indexOf),WT=Fu("".slice),m4=function(e){return e===void 0?e:String(e)},_4="a".replace(/./,"$0")==="$0",zT=!!/./[im]&&/./[im]("a","$0")==="",g4=!t4(function(){var e=/./;return e.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(e,"$<a>")!=="7"});e4("replace",function(e,t,i){var r=zT?"$":"$0";return[function(o,c){var u=a4(this),f=r4(o)?void 0:l4(o,im);return f?HT(f,o,u,c):HT(t,jo(u),o,c)},function(o,c){var u=i4(this),f=jo(o);if(typeof c=="string"&&jT(c,r)===-1&&jT(c,"$<")===-1){var d=i(t,u,f,c);if(d.done)return d.value}var _=n4(c);_||(c=jo(c));var E=u.global;if(E){var S=u.unicode;u.lastIndex=0}for(var R=[];;){var k=d4(u,f);if(k===null||(nm(R,k),!E))break;jo(k[0])===""&&(u.lastIndex=c4(f,o4(u.lastIndex),S))}for(var U="",K=0,se=0;se<R.length;se++){for(var le=jo((k=R[se])[0]),Y=h4(p4(s4(k.index),f.length),0),Re=[],Ne=1;Ne<k.length;Ne++)nm(Re,m4(k[Ne]));var Le=k.groups;if(_){var pt=f4([le],Re,Y,f);Le!==void 0&&nm(pt,Le);var gt=jo($3(c,void 0,pt))}else gt=u4(le,f,Y,Re,Le,c);Y>=K&&(U+=WT(f,K,Y)+gt,K=Y+le.length)}return U+WT(f,K)}]},!g4||!_4||zT);var v4=Qv.includes,y4=ay;Nt({target:"Array",proto:!0,forced:h(function(){return!Array(1).includes()})},{includes:function(e){return v4(this,e,arguments.length>1?arguments[1]:void 0)}}),y4("includes");var E4=Ir,T4=ki,S4=W,I4=RangeError,GT=T,b4=vs,KT=ki,A4=function(e){var t=T4(S4(this)),i="",r=E4(e);if(r<0||r==1/0)throw I4("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i},R4=W,C4=GT(A4),w4=GT("".slice),k4=Math.ceil,JT=function(e){return function(t,i,r){var o,c,u=KT(R4(t)),f=b4(i),d=u.length,_=r===void 0?" ":KT(r);return f<=d||_==""?u:((c=C4(_,k4((o=f-d)/_.length))).length>o&&(c=w4(c,0,o)),e?u+c:c+u)}},N4={start:JT(!1),end:JT(!0)},D4=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(q),O4=N4.start;Nt({target:"String",proto:!0,forced:D4},{padStart:function(e){return O4(this,e,arguments.length>1?arguments[1]:void 0)}});var P4=h,M4=Mt,L4=mt("iterator"),YT=!P4(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i="";return e.pathname="c%20d",t.forEach(function(r,o){t.delete("b"),i+=o+r}),!t.size&&!M4||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[L4]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),x4=Vi,qT=function(e,t,i){for(var r in t)x4(e,r,t[r],i);return e},V4=du,U4=vi,F4=wo,XT=function(e,t,i){var r=V4(t);r in e?U4.f(e,r,F4(0,i)):e[r]=i},QT=pu,B4=gn,H4=XT,j4=Array,W4=Math.max,rm=function(e,t,i){for(var r=B4(e),o=QT(t,r),c=QT(i===void 0?r:i,r),u=j4(W4(c-o,0)),f=0;o<c;o++,f++)H4(u,f,e[o]);return u.length=f,u},ZT=rm,z4=Math.floor,sm=function(e,t){var i=e.length,r=z4(i/2);return i<8?G4(e,t):K4(e,sm(ZT(e,0,r),t),sm(ZT(e,r),t),t)},G4=function(e,t){for(var i,r,o=e.length,c=1;c<o;){for(r=c,i=e[c];r&&t(e[r-1],i)>0;)e[r]=e[--r];r!==c++&&(e[r]=i)}return e},K4=function(e,t,i,r){for(var o=t.length,c=i.length,u=0,f=0;u<o||f<c;)e[u+f]=u<o&&f<c?r(t[u],i[f])<=0?t[u++]:i[f++]:u<o?t[u++]:i[f++];return e},om=sm,am=Nt,Wo=X,Bu=Rt,yn=T,zo=Mt,$T=YT,eS=Vi,J4=Es,Y4=qT,q4=No,X4=by,cm=hi,tS=sc,lm=lt,Q4=yt,Z4=Ar,$4=br,ex=Ft,iS=zt,Ni=ki,tx=Ya,nS=wo,um=Pu,ix=hc,Go=mf,nx=om,rx=mt("iterator"),fc="URLSearchParams",rS=fc+"Iterator",sS=cm.set,Ui=cm.getterFor(fc),sx=cm.getterFor(rS),ox=Object.getOwnPropertyDescriptor,dm=function(e){if(!zo)return Wo[e];var t=ox(Wo,e);return t&&t.value},oS=dm("fetch"),Hu=dm("Request"),mc=dm("Headers"),hm=Hu&&Hu.prototype,aS=mc&&mc.prototype,ax=Wo.RegExp,cx=Wo.TypeError,cS=Wo.decodeURIComponent,lx=Wo.encodeURIComponent,ux=yn("".charAt),lS=yn([].join),As=yn([].push),pm=yn("".replace),dx=yn([].shift),uS=yn([].splice),dS=yn("".split),hx=yn("".slice),px=/\+/g,hS=Array(4),fx=function(e){return hS[e-1]||(hS[e-1]=ax("((?:%[\\da-f]{2}){"+e+"})","gi"))},mx=function(e){try{return cS(e)}catch{return e}},pS=function(e){var t=pm(e,px," "),i=4;try{return cS(t)}catch{for(;i;)t=pm(t,fx(i--),mx);return t}},_x=/[!'()~]|%20/g,gx={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vx=function(e){return gx[e]},fS=function(e){return pm(lx(e),_x,vx)},fm=X4(function(e,t){sS(this,{type:rS,iterator:um(Ui(e).entries),kind:t})},"Iterator",function(){var e=sx(this),t=e.kind,i=e.iterator.next(),r=i.value;return i.done||(i.value=t==="keys"?r.key:t==="values"?r.value:[r.key,r.value]),i},!0),mS=function(e){this.entries=[],this.url=null,e!==void 0&&(iS(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?ux(e,0)==="?"?hx(e,1):e:Ni(e)))};mS.prototype={type:fc,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,o,c,u,f,d=ix(e);if(d)for(i=(t=um(e,d)).next;!(r=Bu(i,t)).done;){if(c=(o=um(ex(r.value))).next,(u=Bu(c,o)).done||(f=Bu(c,o)).done||!Bu(c,o).done)throw cx("Expected sequence with length 2");As(this.entries,{key:Ni(u.value),value:Ni(f.value)})}else for(var _ in e)Q4(e,_)&&As(this.entries,{key:_,value:Ni(e[_])})},parseQuery:function(e){if(e)for(var t,i,r=dS(e,"&"),o=0;o<r.length;)(t=r[o++]).length&&(i=dS(t,"="),As(this.entries,{key:pS(dx(i)),value:pS(lS(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],As(i,fS(e.key)+"="+fS(e.value));return lS(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ju=function(){tS(this,Ko);var e=sS(this,new mS(arguments.length>0?arguments[0]:void 0));zo||(this.length=e.entries.length)},Ko=ju.prototype;if(Y4(Ko,{append:function(e,t){Go(arguments.length,2);var i=Ui(this);As(i.entries,{key:Ni(e),value:Ni(t)}),zo||this.length++,i.updateURL()},delete:function(e){Go(arguments.length,1);for(var t=Ui(this),i=t.entries,r=Ni(e),o=0;o<i.length;)i[o].key===r?uS(i,o,1):o++;zo||(this.length=i.length),t.updateURL()},get:function(e){Go(arguments.length,1);for(var t=Ui(this).entries,i=Ni(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){Go(arguments.length,1);for(var t=Ui(this).entries,i=Ni(e),r=[],o=0;o<t.length;o++)t[o].key===i&&As(r,t[o].value);return r},has:function(e){Go(arguments.length,1);for(var t=Ui(this).entries,i=Ni(e),r=0;r<t.length;)if(t[r++].key===i)return!0;return!1},set:function(e,t){Go(arguments.length,1);for(var i,r=Ui(this),o=r.entries,c=!1,u=Ni(e),f=Ni(t),d=0;d<o.length;d++)(i=o[d]).key===u&&(c?uS(o,d--,1):(c=!0,i.value=f));c||As(o,{key:u,value:f}),zo||(this.length=o.length),r.updateURL()},sort:function(){var e=Ui(this);nx(e.entries,function(t,i){return t.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,i=Ui(this).entries,r=Z4(e,arguments.length>1?arguments[1]:void 0),o=0;o<i.length;)r((t=i[o++]).value,t.key,this)},keys:function(){return new fm(this,"keys")},values:function(){return new fm(this,"values")},entries:function(){return new fm(this,"entries")}},{enumerable:!0}),eS(Ko,rx,Ko.entries,{name:"entries"}),eS(Ko,"toString",function(){return Ui(this).serialize()},{enumerable:!0}),zo&&J4(Ko,"size",{get:function(){return Ui(this).entries.length},configurable:!0,enumerable:!0}),q4(ju,fc),am({global:!0,constructor:!0,forced:!$T},{URLSearchParams:ju}),!$T&&lm(mc)){var yx=yn(aS.has),Ex=yn(aS.set),_S=function(e){if(iS(e)){var t,i=e.body;if($4(i)===fc)return t=e.headers?new mc(e.headers):new mc,yx(t,"content-type")||Ex(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),tx(e,{body:nS(0,Ni(i)),headers:nS(0,t)})}return e};if(lm(oS)&&am({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return oS(e,arguments.length>1?_S(arguments[1]):{})}}),lm(Hu)){var mm=function(e){return tS(this,hm),new Hu(e,arguments.length>1?_S(arguments[1]):{})};hm.constructor=mm,mm.prototype=hm,am({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:mm})}}var Tx={URLSearchParams:ju,getState:Ui},gS=`	
\v\f\r \u2028\u2029\uFEFF`,Sx=W,Ix=ki,_m=gS,vS=T("".replace),bx=RegExp("^["+_m+"]+"),Ax=RegExp("(^|[^"+_m+"])["+_m+"]+$"),gm=function(e){return function(t){var i=Ix(Sx(t));return 1&e&&(i=vS(i,bx,"")),2&e&&(i=vS(i,Ax,"$1")),i}},Rx={start:gm(1),end:gm(2),trim:gm(3)},Cx=Za.PROPER,wx=h,yS=gS,kx=Rx.trim;Nt({target:"String",proto:!0,forced:function(e){return wx(function(){return!!yS[e]()||""[e]()!==""||Cx&&yS[e].name!==e})}("trim")},{trim:function(){return kx(this)}});var Nx=Nt,Dx=Mt,Wu=T,Ox=yt,Px=lt,Mx=Sr,Lx=ki,xx=Es,Vx=yy,Gn=X.Symbol,Rs=Gn&&Gn.prototype;if(Dx&&Px(Gn)&&(!("description"in Rs)||Gn().description!==void 0)){var ES={},zu=function(){var e=arguments.length<1||arguments[0]===void 0?void 0:Lx(arguments[0]),t=Mx(Rs,this)?new Gn(e):e===void 0?Gn():Gn(e);return e===""&&(ES[t]=!0),t};Vx(zu,Gn),zu.prototype=Rs,Rs.constructor=zu;var Ux=String(Gn("test"))=="Symbol(test)",Fx=Wu(Rs.valueOf),Bx=Wu(Rs.toString),Hx=/^Symbol\((.*)\)[^)]+$/,jx=Wu("".replace),Wx=Wu("".slice);xx(Rs,"description",{configurable:!0,get:function(){var e=Fx(this);if(Ox(ES,e))return"";var t=Bx(e),i=Ux?Wx(t,7,-1):jx(t,Hx,"$1");return i===""?void 0:i}}),Nx({global:!0,constructor:!0,forced:!0},{Symbol:zu})}var zx=Zf.charAt,Gx=ki,TS=hi,Kx=Ny,SS=Dy,IS="String Iterator",Jx=TS.set,Yx=TS.getterFor(IS);Kx(String,"String",function(e){Jx(this,{type:IS,string:Gx(e),index:0})},function(){var e,t=Yx(this),i=t.string,r=t.index;return r>=i.length?SS(void 0,!0):(e=zx(i,r),t.index+=e.length,SS(e,!1))});var Fi,bS=Mt,qx=T,Xx=Rt,Qx=h,vm=ey,Zx=Qp,$x=zp,e5=at,t5=P,Jo=Object.assign,AS=Object.defineProperty,i5=qx([].concat),n5=!Jo||Qx(function(){if(bS&&Jo({b:1},Jo(AS({},"a",{enumerable:!0,get:function(){AS(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(o){t[o]=o}),Jo({},e)[i]!=7||vm(Jo({},t)).join("")!=r})?function(e,t){for(var i=e5(e),r=arguments.length,o=1,c=Zx.f,u=$x.f;r>o;)for(var f,d=t5(arguments[o++]),_=c?i5(vm(d),c(d)):vm(d),E=_.length,S=0;E>S;)f=_[S++],bS&&!Xx(u,d,f)||(i[f]=d[f]);return i}:Jo,r5=Ft,s5=zE,o5=Ar,a5=Rt,c5=at,l5=function(e,t,i,r){try{return r?t(r5(i)[0],i[1]):t(i)}catch(o){s5(e,"throw",o)}},u5=Vf,d5=pf,h5=gn,RS=XT,p5=Pu,f5=hc,CS=Array,Cs=T,ym=2147483647,m5=/[^\0-\u007E]/,wS=/[.\u3002\uFF0E\uFF61]/g,kS="Overflow: input needs wider integers to process",NS=RangeError,_5=Cs(wS.exec),Yo=Math.floor,Em=String.fromCharCode,DS=Cs("".charCodeAt),OS=Cs([].join),kr=Cs([].push),g5=Cs("".replace),v5=Cs("".split),y5=Cs("".toLowerCase),PS=function(e){return e+22+75*(e<26)},E5=function(e,t,i){var r=0;for(e=i?Yo(e/700):e>>1,e+=Yo(e/t);e>455;)e=Yo(e/35),r+=36;return Yo(r+36*e/(e+38))},T5=function(e){var t=[];e=function(le){for(var Y=[],Re=0,Ne=le.length;Re<Ne;){var Le=DS(le,Re++);if(Le>=55296&&Le<=56319&&Re<Ne){var pt=DS(le,Re++);(64512&pt)==56320?kr(Y,((1023&Le)<<10)+(1023&pt)+65536):(kr(Y,Le),Re--)}else kr(Y,Le)}return Y}(e);var i,r,o=e.length,c=128,u=0,f=72;for(i=0;i<e.length;i++)(r=e[i])<128&&kr(t,Em(r));var d=t.length,_=d;for(d&&kr(t,"-");_<o;){var E=ym;for(i=0;i<e.length;i++)(r=e[i])>=c&&r<E&&(E=r);var S=_+1;if(E-c>Yo((ym-u)/S))throw NS(kS);for(u+=(E-c)*S,c=E,i=0;i<e.length;i++){if((r=e[i])<c&&++u>ym)throw NS(kS);if(r==c){for(var R=u,k=36;;){var U=k<=f?1:k>=f+26?26:k-f;if(R<U)break;var K=R-U,se=36-U;kr(t,Em(PS(U+K%se))),R=Yo(K/se),k+=36}kr(t,Em(PS(R))),f=E5(u,S,_==d),u=0,_++}}u++,c++}return OS(t,"")},S5=Nt,Tm=Mt,I5=YT,Sm=X,MS=Ar,Bi=T,Gu=Vi,Hi=Es,b5=sc,Im=yt,bm=n5,qo=function(e){var t=c5(e),i=d5(this),r=arguments.length,o=r>1?arguments[1]:void 0,c=o!==void 0;c&&(o=o5(o,r>2?arguments[2]:void 0));var u,f,d,_,E,S,R=f5(t),k=0;if(!R||this===CS&&u5(R))for(u=h5(t),f=i?new this(u):CS(u);u>k;k++)S=c?o(t[k],k):t[k],RS(f,k,S);else for(E=(_=p5(t,R)).next,f=i?new this:[];!(d=a5(E,_)).done;k++)S=c?l5(_,o,[d.value,k],!0):d.value,RS(f,k,S);return f.length=k,f},$i=rm,A5=Zf.codeAt,R5=function(e){var t,i,r=[],o=v5(g5(y5(e),wS,"."),".");for(t=0;t<o.length;t++)i=o[t],kr(r,_5(m5,i)?"xn--"+T5(i):i);return OS(r,".")},Kn=ki,C5=No,w5=mf,LS=Tx,xS=hi,k5=xS.set,Ku=xS.getterFor("URL"),N5=LS.URLSearchParams,D5=LS.getState,_c=Sm.URL,Am=Sm.TypeError,Ju=Sm.parseInt,O5=Math.floor,VS=Math.pow,ji=Bi("".charAt),en=Bi(/./.exec),gc=Bi([].join),P5=Bi(1 .toString),M5=Bi([].pop),Xo=Bi([].push),Rm=Bi("".replace),L5=Bi([].shift),x5=Bi("".split),vc=Bi("".slice),Yu=Bi("".toLowerCase),V5=Bi([].unshift),Cm="Invalid scheme",ws="Invalid host",US="Invalid port",FS=/[a-z]/i,U5=/[\d+-.a-z]/i,wm=/\d/,F5=/^0x/i,B5=/^[0-7]+$/,H5=/^\d+$/,BS=/^[\da-f]+$/i,j5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,W5=/[\0\t\n\r #/:<>?@[\\\]^|]/,z5=/^[\u0000-\u0020]+/,G5=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,K5=/[\t\n\r]/g,yc=function(e){var t,i,r,o;if(typeof e=="number"){for(t=[],i=0;i<4;i++)V5(t,e%256),e=O5(e/256);return gc(t,".")}if(typeof e=="object"){for(t="",r=function(c){for(var u=null,f=1,d=null,_=0,E=0;E<8;E++)c[E]!==0?(_>f&&(u=d,f=_),d=null,_=0):(d===null&&(d=E),++_);return _>f&&(u=d,f=_),u}(e),i=0;i<8;i++)o&&e[i]===0||(o&&(o=!1),r===i?(t+=i?":":"::",o=!0):(t+=P5(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},qu={},HS=bm({},qu,{" ":1,'"':1,"<":1,">":1,"`":1}),jS=bm({},HS,{"#":1,"?":1,"{":1,"}":1}),km=bm({},jS,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Nr=function(e,t){var i=A5(e,0);return i>32&&i<127&&!Im(t,e)?e:encodeURIComponent(e)},Xu={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ec=function(e,t){var i;return e.length==2&&en(FS,ji(e,0))&&((i=ji(e,1))==":"||!t&&i=="|")},WS=function(e){var t;return e.length>1&&Ec(vc(e,0,2))&&(e.length==2||(t=ji(e,2))==="/"||t==="\\"||t==="?"||t==="#")},J5=function(e){return e==="."||Yu(e)==="%2e"},Nm={},zS={},Dm={},GS={},KS={},Om={},JS={},YS={},Qu={},Zu={},Pm={},Mm={},Lm={},xm={},qS={},Vm={},Qo={},En={},XS={},ks={},Jn={},Um=function(e,t,i){var r,o,c,u=Kn(e);if(t){if(o=this.parse(u))throw Am(o);this.searchParams=null}else{if(i!==void 0&&(r=new Um(i,!0)),o=this.parse(u,null,r))throw Am(o);(c=D5(new N5)).bindURL(this),this.searchParams=c}};Um.prototype={type:"URL",parse:function(e,t,i){var r,o,c,u,f,d=this,_=t||Nm,E=0,S="",R=!1,k=!1,U=!1;for(e=Kn(e),t||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,e=Rm(e,z5,""),e=Rm(e,G5,"$1")),e=Rm(e,K5,""),r=qo(e);E<=r.length;){switch(o=r[E],_){case Nm:if(!o||!en(FS,o)){if(t)return Cm;_=Dm;continue}S+=Yu(o),_=zS;break;case zS:if(o&&(en(U5,o)||o=="+"||o=="-"||o=="."))S+=Yu(o);else{if(o!=":"){if(t)return Cm;S="",_=Dm,E=0;continue}if(t&&(d.isSpecial()!=Im(Xu,S)||S=="file"&&(d.includesCredentials()||d.port!==null)||d.scheme=="file"&&!d.host))return;if(d.scheme=S,t)return void(d.isSpecial()&&Xu[d.scheme]==d.port&&(d.port=null));S="",d.scheme=="file"?_=xm:d.isSpecial()&&i&&i.scheme==d.scheme?_=GS:d.isSpecial()?_=YS:r[E+1]=="/"?(_=KS,E++):(d.cannotBeABaseURL=!0,Xo(d.path,""),_=XS)}break;case Dm:if(!i||i.cannotBeABaseURL&&o!="#")return Cm;if(i.cannotBeABaseURL&&o=="#"){d.scheme=i.scheme,d.path=$i(i.path),d.query=i.query,d.fragment="",d.cannotBeABaseURL=!0,_=Jn;break}_=i.scheme=="file"?xm:Om;continue;case GS:if(o!="/"||r[E+1]!="/"){_=Om;continue}_=Qu,E++;break;case KS:if(o=="/"){_=Zu;break}_=En;continue;case Om:if(d.scheme=i.scheme,o==Fi)d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=$i(i.path),d.query=i.query;else if(o=="/"||o=="\\"&&d.isSpecial())_=JS;else if(o=="?")d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=$i(i.path),d.query="",_=ks;else{if(o!="#"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=$i(i.path),d.path.length--,_=En;continue}d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=$i(i.path),d.query=i.query,d.fragment="",_=Jn}break;case JS:if(!d.isSpecial()||o!="/"&&o!="\\"){if(o!="/"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,_=En;continue}_=Zu}else _=Qu;break;case YS:if(_=Qu,o!="/"||ji(S,E+1)!="/")continue;E++;break;case Qu:if(o!="/"&&o!="\\"){_=Zu;continue}break;case Zu:if(o=="@"){R&&(S="%40"+S),R=!0,c=qo(S);for(var K=0;K<c.length;K++){var se=c[K];if(se!=":"||U){var le=Nr(se,km);U?d.password+=le:d.username+=le}else U=!0}S=""}else if(o==Fi||o=="/"||o=="?"||o=="#"||o=="\\"&&d.isSpecial()){if(R&&S=="")return"Invalid authority";E-=qo(S).length+1,S="",_=Pm}else S+=o;break;case Pm:case Mm:if(t&&d.scheme=="file"){_=Vm;continue}if(o!=":"||k){if(o==Fi||o=="/"||o=="?"||o=="#"||o=="\\"&&d.isSpecial()){if(d.isSpecial()&&S=="")return ws;if(t&&S==""&&(d.includesCredentials()||d.port!==null))return;if(u=d.parseHost(S))return u;if(S="",_=Qo,t)return;continue}o=="["?k=!0:o=="]"&&(k=!1),S+=o}else{if(S=="")return ws;if(u=d.parseHost(S))return u;if(S="",_=Lm,t==Mm)return}break;case Lm:if(!en(wm,o)){if(o==Fi||o=="/"||o=="?"||o=="#"||o=="\\"&&d.isSpecial()||t){if(S!=""){var Y=Ju(S,10);if(Y>65535)return US;d.port=d.isSpecial()&&Y===Xu[d.scheme]?null:Y,S=""}if(t)return;_=Qo;continue}return US}S+=o;break;case xm:if(d.scheme="file",o=="/"||o=="\\")_=qS;else{if(!i||i.scheme!="file"){_=En;continue}if(o==Fi)d.host=i.host,d.path=$i(i.path),d.query=i.query;else if(o=="?")d.host=i.host,d.path=$i(i.path),d.query="",_=ks;else{if(o!="#"){WS(gc($i(r,E),""))||(d.host=i.host,d.path=$i(i.path),d.shortenPath()),_=En;continue}d.host=i.host,d.path=$i(i.path),d.query=i.query,d.fragment="",_=Jn}}break;case qS:if(o=="/"||o=="\\"){_=Vm;break}i&&i.scheme=="file"&&!WS(gc($i(r,E),""))&&(Ec(i.path[0],!0)?Xo(d.path,i.path[0]):d.host=i.host),_=En;continue;case Vm:if(o==Fi||o=="/"||o=="\\"||o=="?"||o=="#"){if(!t&&Ec(S))_=En;else if(S==""){if(d.host="",t)return;_=Qo}else{if(u=d.parseHost(S))return u;if(d.host=="localhost"&&(d.host=""),t)return;S="",_=Qo}continue}S+=o;break;case Qo:if(d.isSpecial()){if(_=En,o!="/"&&o!="\\")continue}else if(t||o!="?")if(t||o!="#"){if(o!=Fi&&(_=En,o!="/"))continue}else d.fragment="",_=Jn;else d.query="",_=ks;break;case En:if(o==Fi||o=="/"||o=="\\"&&d.isSpecial()||!t&&(o=="?"||o=="#")){if((f=Yu(f=S))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(d.shortenPath(),o=="/"||o=="\\"&&d.isSpecial()||Xo(d.path,"")):J5(S)?o=="/"||o=="\\"&&d.isSpecial()||Xo(d.path,""):(d.scheme=="file"&&!d.path.length&&Ec(S)&&(d.host&&(d.host=""),S=ji(S,0)+":"),Xo(d.path,S)),S="",d.scheme=="file"&&(o==Fi||o=="?"||o=="#"))for(;d.path.length>1&&d.path[0]==="";)L5(d.path);o=="?"?(d.query="",_=ks):o=="#"&&(d.fragment="",_=Jn)}else S+=Nr(o,jS);break;case XS:o=="?"?(d.query="",_=ks):o=="#"?(d.fragment="",_=Jn):o!=Fi&&(d.path[0]+=Nr(o,qu));break;case ks:t||o!="#"?o!=Fi&&(o=="'"&&d.isSpecial()?d.query+="%27":d.query+=o=="#"?"%23":Nr(o,qu)):(d.fragment="",_=Jn);break;case Jn:o!=Fi&&(d.fragment+=Nr(o,HS))}E++}},parseHost:function(e){var t,i,r;if(ji(e,0)=="["){if(ji(e,e.length-1)!="]"||(t=function(o){var c,u,f,d,_,E,S,R=[0,0,0,0,0,0,0,0],k=0,U=null,K=0,se=function(){return ji(o,K)};if(se()==":"){if(ji(o,1)!=":")return;K+=2,U=++k}for(;se();){if(k==8)return;if(se()!=":"){for(c=u=0;u<4&&en(BS,se());)c=16*c+Ju(se(),16),K++,u++;if(se()=="."){if(u==0||(K-=u,k>6))return;for(f=0;se();){if(d=null,f>0){if(!(se()=="."&&f<4))return;K++}if(!en(wm,se()))return;for(;en(wm,se());){if(_=Ju(se(),10),d===null)d=_;else{if(d==0)return;d=10*d+_}if(d>255)return;K++}R[k]=256*R[k]+d,++f!=2&&f!=4||k++}if(f!=4)return;break}if(se()==":"){if(K++,!se())return}else if(se())return;R[k++]=c}else{if(U!==null)return;K++,U=++k}}if(U!==null)for(E=k-U,k=7;k!=0&&E>0;)S=R[k],R[k--]=R[U+E-1],R[U+--E]=S;else if(k!=8)return;return R}(vc(e,1,-1)),!t))return ws;this.host=t}else if(this.isSpecial()){if(e=R5(e),en(j5,e)||(t=function(o){var c,u,f,d,_,E,S,R=x5(o,".");if(R.length&&R[R.length-1]==""&&R.length--,(c=R.length)>4)return o;for(u=[],f=0;f<c;f++){if((d=R[f])=="")return o;if(_=10,d.length>1&&ji(d,0)=="0"&&(_=en(F5,d)?16:8,d=vc(d,_==8?1:2)),d==="")E=0;else{if(!en(_==10?H5:_==8?B5:BS,d))return o;E=Ju(d,_)}Xo(u,E)}for(f=0;f<c;f++)if(E=u[f],f==c-1){if(E>=VS(256,5-c))return null}else if(E>255)return null;for(S=M5(u),f=0;f<u.length;f++)S+=u[f]*VS(256,3-f);return S}(e),t===null))return ws;this.host=t}else{if(en(W5,e))return ws;for(t="",i=qo(e),r=0;r<i.length;r++)t+=Nr(i[r],qu);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return Im(Xu,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Ec(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,o=e.host,c=e.port,u=e.path,f=e.query,d=e.fragment,_=t+":";return o!==null?(_+="//",e.includesCredentials()&&(_+=i+(r?":"+r:"")+"@"),_+=yc(o),c!==null&&(_+=":"+c)):t=="file"&&(_+="//"),_+=e.cannotBeABaseURL?u[0]:u.length?"/"+gc(u,"/"):"",f!==null&&(_+="?"+f),d!==null&&(_+="#"+d),_},setHref:function(e){var t=this.parse(e);if(t)throw Am(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Zo(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+yc(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Kn(e)+":",Nm)},getUsername:function(){return this.username},setUsername:function(e){var t=qo(Kn(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=Nr(t[i],km)}},getPassword:function(){return this.password},setPassword:function(e){var t=qo(Kn(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=Nr(t[i],km)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?yc(e):yc(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Pm)},getHostname:function(){var e=this.host;return e===null?"":yc(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Mm)},getPort:function(){var e=this.port;return e===null?"":Kn(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Kn(e))==""?this.port=null:this.parse(e,Lm))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+gc(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Qo))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Kn(e))==""?this.query=null:(ji(e,0)=="?"&&(e=vc(e,1)),this.query="",this.parse(e,ks)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Kn(e))!=""?(ji(e,0)=="#"&&(e=vc(e,1)),this.fragment="",this.parse(e,Jn)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Zo=function(e){var t=b5(this,pi),i=w5(arguments.length,1)>1?arguments[1]:void 0,r=k5(t,new Um(e,!1,i));Tm||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},pi=Zo.prototype,Wi=function(e,t){return{get:function(){return Ku(this)[e]()},set:t&&function(i){return Ku(this)[t](i)},configurable:!0,enumerable:!0}};if(Tm&&(Hi(pi,"href",Wi("serialize","setHref")),Hi(pi,"origin",Wi("getOrigin")),Hi(pi,"protocol",Wi("getProtocol","setProtocol")),Hi(pi,"username",Wi("getUsername","setUsername")),Hi(pi,"password",Wi("getPassword","setPassword")),Hi(pi,"host",Wi("getHost","setHost")),Hi(pi,"hostname",Wi("getHostname","setHostname")),Hi(pi,"port",Wi("getPort","setPort")),Hi(pi,"pathname",Wi("getPathname","setPathname")),Hi(pi,"search",Wi("getSearch","setSearch")),Hi(pi,"searchParams",Wi("getSearchParams")),Hi(pi,"hash",Wi("getHash","setHash"))),Gu(pi,"toJSON",function(){return Ku(this).serialize()},{enumerable:!0}),Gu(pi,"toString",function(){return Ku(this).serialize()},{enumerable:!0}),_c){var QS=_c.createObjectURL,ZS=_c.revokeObjectURL;QS&&Gu(Zo,"createObjectURL",MS(QS,_c)),ZS&&Gu(Zo,"revokeObjectURL",MS(ZS,_c))}C5(Zo,"URL"),S5({global:!0,constructor:!0,forced:!I5,sham:!Tm},{URL:Zo});var $S=typeof ArrayBuffer<"u"&&typeof DataView<"u",Y5=Ir,q5=vs,X5=RangeError,eI=function(e){if(e===void 0)return 0;var t=Y5(e),i=q5(t);if(t!==i)throw X5("Wrong length or index");return i},Q5=Array,Z5=Math.abs,Yn=Math.pow,$5=Math.floor,e6=Math.log,t6=Math.LN2,i6={pack:function(e,t,i){var r,o,c,u=Q5(i),f=8*i-t-1,d=(1<<f)-1,_=d>>1,E=t===23?Yn(2,-24)-Yn(2,-77):0,S=e<0||e===0&&1/e<0?1:0,R=0;for((e=Z5(e))!=e||e===1/0?(o=e!=e?1:0,r=d):(r=$5(e6(e)/t6),e*(c=Yn(2,-r))<1&&(r--,c*=2),(e+=r+_>=1?E/c:E*Yn(2,1-_))*c>=2&&(r++,c/=2),r+_>=d?(o=0,r=d):r+_>=1?(o=(e*c-1)*Yn(2,t),r+=_):(o=e*Yn(2,_-1)*Yn(2,t),r=0));t>=8;)u[R++]=255&o,o/=256,t-=8;for(r=r<<t|o,f+=t;f>0;)u[R++]=255&r,r/=256,f-=8;return u[--R]|=128*S,u},unpack:function(e,t){var i,r=e.length,o=8*r-t-1,c=(1<<o)-1,u=c>>1,f=o-7,d=r-1,_=e[d--],E=127&_;for(_>>=7;f>0;)E=256*E+e[d--],f-=8;for(i=E&(1<<-f)-1,E>>=-f,f+=t;f>0;)i=256*i+e[d--],f-=8;if(E===0)E=1-u;else{if(E===c)return i?NaN:_?-1/0:1/0;i+=Yn(2,t),E-=u}return(_?-1:1)*i*Yn(2,E-t)}},n6=at,tI=pu,r6=gn,iI=function(e){for(var t=n6(this),i=r6(t),r=arguments.length,o=tI(r>1?arguments[1]:void 0,i),c=r>2?arguments[2]:void 0,u=c===void 0?i:tI(c,i);u>o;)t[o++]=e;return t},$u=X,Fm=T,Bm=Mt,s6=$S,nI=Za,rI=zn,o6=Es,sI=qT,Hm=h,ed=sc,a6=Ir,c6=vs,td=eI,oI=i6,l6=Tu,aI=Do,u6=$a.f,d6=iI,h6=rm,cI=No,jm=hi,p6=nI.PROPER,lI=nI.CONFIGURABLE,$o="ArrayBuffer",id="DataView",ea="prototype",uI="Wrong index",dI=jm.getterFor($o),Tc=jm.getterFor(id),hI=jm.set,zi=$u[$o],tn=zi,ta=tn&&tn[ea],qn=$u[id],Ns=qn&&qn[ea],pI=Object.prototype,f6=$u.Array,nd=$u.RangeError,m6=Fm(d6),_6=Fm([].reverse),fI=oI.pack,mI=oI.unpack,_I=function(e){return[255&e]},gI=function(e){return[255&e,e>>8&255]},vI=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},yI=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},g6=function(e){return fI(e,23,4)},v6=function(e){return fI(e,52,8)},rd=function(e,t,i){o6(e[ea],t,{configurable:!0,get:function(){return i(this)[t]}})},Dr=function(e,t,i,r){var o=td(i),c=Tc(e);if(o+t>c.byteLength)throw nd(uI);var u=c.bytes,f=o+c.byteOffset,d=h6(u,f,f+t);return r?d:_6(d)},Or=function(e,t,i,r,o,c){var u=td(i),f=Tc(e);if(u+t>f.byteLength)throw nd(uI);for(var d=f.bytes,_=u+f.byteOffset,E=r(+o),S=0;S<t;S++)d[_+S]=E[c?S:t-S-1]};if(s6){var EI=p6&&zi.name!==$o;if(Hm(function(){zi(1)})&&Hm(function(){new zi(-1)})&&!Hm(function(){return new zi,new zi(1.5),new zi(NaN),zi.length!=1||EI&&!lI}))EI&&lI&&rI(zi,"name",$o);else{(tn=function(e){return ed(this,ta),new zi(td(e))})[ea]=ta;for(var Wm,TI=u6(zi),SI=0;TI.length>SI;)(Wm=TI[SI++])in tn||rI(tn,Wm,zi[Wm]);ta.constructor=tn}aI&&l6(Ns)!==pI&&aI(Ns,pI);var sd=new qn(new tn(2)),II=Fm(Ns.setInt8);sd.setInt8(0,2147483648),sd.setInt8(1,2147483649),!sd.getInt8(0)&&sd.getInt8(1)||sI(Ns,{setInt8:function(e,t){II(this,e,t<<24>>24)},setUint8:function(e,t){II(this,e,t<<24>>24)}},{unsafe:!0})}else ta=(tn=function(e){ed(this,ta);var t=td(e);hI(this,{type:$o,bytes:m6(f6(t),0),byteLength:t}),Bm||(this.byteLength=t,this.detached=!1)})[ea],Ns=(qn=function(e,t,i){ed(this,Ns),ed(e,ta);var r=dI(e),o=r.byteLength,c=a6(t);if(c<0||c>o)throw nd("Wrong offset");if(c+(i=i===void 0?o-c:c6(i))>o)throw nd("Wrong length");hI(this,{type:id,buffer:e,byteLength:i,byteOffset:c,bytes:r.bytes}),Bm||(this.buffer=e,this.byteLength=i,this.byteOffset=c)})[ea],Bm&&(rd(tn,"byteLength",dI),rd(qn,"buffer",Tc),rd(qn,"byteLength",Tc),rd(qn,"byteOffset",Tc)),sI(Ns,{getInt8:function(e){return Dr(this,1,e)[0]<<24>>24},getUint8:function(e){return Dr(this,1,e)[0]},getInt16:function(e){var t=Dr(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Dr(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return yI(Dr(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return yI(Dr(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return mI(Dr(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return mI(Dr(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Or(this,1,e,_I,t)},setUint8:function(e,t){Or(this,1,e,_I,t)},setInt16:function(e,t){Or(this,2,e,gI,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Or(this,2,e,gI,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Or(this,4,e,vI,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Or(this,4,e,vI,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Or(this,4,e,g6,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Or(this,8,e,v6,t,arguments.length>2?arguments[2]:void 0)}});cI(tn,$o),cI(qn,id);var od={ArrayBuffer:tn,DataView:qn},y6=Nt,zm=cc,E6=h,bI=Ft,AI=pu,T6=vs,S6=ff,Gm=od.ArrayBuffer,Km=od.DataView,RI=Km.prototype,CI=zm(Gm.prototype.slice),I6=zm(RI.getUint8),b6=zm(RI.setUint8);y6({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:E6(function(){return!new Gm(2).slice(1,void 0).byteLength})},{slice:function(e,t){if(CI&&t===void 0)return CI(bI(this),e);for(var i=bI(this).byteLength,r=AI(e,i),o=AI(t===void 0?i:t,i),c=new(S6(this,Gm))(T6(o-r)),u=new Km(this),f=new Km(c),d=0;r<o;)b6(f,d++,I6(u,r++));return c}});var yi,ia,ad,cd={},wI={get exports(){return cd},set exports(e){cd=e}},A6=$S,Jm=Mt,fi=X,kI=lt,ld=zt,Pr=yt,Ym=br,R6=Co,C6=zn,qm=Vi,w6=Es,k6=Sr,ud=Tu,na=Do,N6=mt,D6=j,NI=hi.enforce,O6=hi.get,dd=fi.Int8Array,Xm=dd&&dd.prototype,DI=fi.Uint8ClampedArray,OI=DI&&DI.prototype,Tn=dd&&ud(dd),nn=Xm&&ud(Xm),P6=Object.prototype,Qm=fi.TypeError,PI=N6("toStringTag"),Zm=D6("TYPED_ARRAY_TAG"),hd="TypedArrayConstructor",Xn=A6&&!!na&&Ym(fi.opera)!=="Opera",MI=!1,Qn={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},$m={BigInt64Array:8,BigUint64Array:8},LI=function(e){var t=ud(e);if(ld(t)){var i=O6(t);return i&&Pr(i,hd)?i[hd]:LI(t)}},xI=function(e){if(!ld(e))return!1;var t=Ym(e);return Pr(Qn,t)||Pr($m,t)};for(yi in Qn)(ad=(ia=fi[yi])&&ia.prototype)?NI(ad)[hd]=ia:Xn=!1;for(yi in $m)(ad=(ia=fi[yi])&&ia.prototype)&&(NI(ad)[hd]=ia);if((!Xn||!kI(Tn)||Tn===Function.prototype)&&(Tn=function(){throw Qm("Incorrect invocation")},Xn))for(yi in Qn)fi[yi]&&na(fi[yi],Tn);if((!Xn||!nn||nn===P6)&&(nn=Tn.prototype,Xn))for(yi in Qn)fi[yi]&&na(fi[yi].prototype,nn);if(Xn&&ud(OI)!==nn&&na(OI,nn),Jm&&!Pr(nn,PI))for(yi in MI=!0,w6(nn,PI,{configurable:!0,get:function(){return ld(this)?this[Zm]:void 0}}),Qn)fi[yi]&&C6(fi[yi],Zm,yi);var Zn={NATIVE_ARRAY_BUFFER_VIEWS:Xn,TYPED_ARRAY_TAG:MI&&Zm,aTypedArray:function(e){if(xI(e))return e;throw Qm("Target is not a typed array")},aTypedArrayConstructor:function(e){if(kI(e)&&(!na||k6(Tn,e)))return e;throw Qm(R6(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,i,r){if(Jm){if(i)for(var o in Qn){var c=fi[o];if(c&&Pr(c.prototype,e))try{delete c.prototype[e]}catch{try{c.prototype[e]=t}catch{}}}nn[e]&&!i||qm(nn,e,i?t:Xn&&Xm[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,i){var r,o;if(Jm){if(na){if(i){for(r in Qn)if((o=fi[r])&&Pr(o,e))try{delete o[e]}catch{}}if(Tn[e]&&!i)return;try{return qm(Tn,e,i?t:Xn&&Tn[e]||t)}catch{}}for(r in Qn)!(o=fi[r])||o[e]&&!i||qm(o,e,t)}},getTypedArrayConstructor:LI,isView:function(e){if(!ld(e))return!1;var t=Ym(e);return t==="DataView"||Pr(Qn,t)||Pr($m,t)},isTypedArray:xI,TypedArray:Tn,TypedArrayPrototype:nn},VI=X,e_=h,M6=ZE,L6=Zn.NATIVE_ARRAY_BUFFER_VIEWS,x6=VI.ArrayBuffer,Ds=VI.Int8Array,UI=!L6||!e_(function(){Ds(1)})||!e_(function(){new Ds(-1)})||!M6(function(e){new Ds,new Ds(null),new Ds(1.5),new Ds(e)},!0)||e_(function(){return new Ds(new x6(2),1,void 0).length!==1}),V6=zt,U6=Math.floor,F6=Number.isInteger||function(e){return!V6(e)&&isFinite(e)&&U6(e)===e},B6=Ir,H6=RangeError,j6=function(e){var t=B6(e);if(t<0)throw H6("The argument can't be less than 0");return t},W6=RangeError,FI=function(e,t){var i=j6(e);if(i%t)throw W6("Wrong offset");return i},z6=br,G6=Yv,K6=TypeError,BI=function(e){var t=G6(e,"number");if(typeof t=="number")throw K6("Can't convert number to bigint");return BigInt(t)},J6=Ar,Y6=Rt,q6=$y,X6=at,Q6=gn,Z6=Pu,$6=hc,eV=Vf,tV=function(e){var t=z6(e);return t=="BigInt64Array"||t=="BigUint64Array"},iV=Zn.aTypedArrayConstructor,nV=BI,HI=function(e){var t,i,r,o,c,u,f,d,_=q6(this),E=X6(e),S=arguments.length,R=S>1?arguments[1]:void 0,k=R!==void 0,U=$6(E);if(U&&!eV(U))for(d=(f=Z6(E,U)).next,E=[];!(u=Y6(d,f)).done;)E.push(u.value);for(k&&S>2&&(R=J6(R,arguments[2])),i=Q6(E),r=new(iV(_))(i),o=tV(r),t=0;i>t;t++)c=k?R(E[t],t):E[t],r[t]=o?nV(c):+c;return r},jI=Nt,WI=X,zI=Rt,rV=Mt,sV=UI,ra=Zn,GI=od,KI=sc,oV=wo,Sc=zn,aV=F6,cV=vs,JI=eI,t_=FI,YI=du,Ic=yt,lV=br,i_=zt,uV=bp,dV=Ya,hV=Sr,pd=Do,pV=$a.f,qI=HI,fV=CT.forEach,mV=Iu,_V=Es,XI=vi,QI=Qa,gV=rT,n_=hi.get,vV=hi.set,yV=hi.enforce,ZI=XI.f,EV=QI.f,TV=Math.round,r_=WI.RangeError,$I=GI.ArrayBuffer,SV=$I.prototype,IV=GI.DataView,fd=ra.NATIVE_ARRAY_BUFFER_VIEWS,e1=ra.TYPED_ARRAY_TAG,t1=ra.TypedArray,bc=ra.TypedArrayPrototype,bV=ra.aTypedArrayConstructor,s_=ra.isTypedArray,md="BYTES_PER_ELEMENT",o_="Wrong length",i1=function(e,t){bV(e);for(var i=0,r=t.length,o=new e(r);r>i;)o[i]=t[i++];return o},_d=function(e,t){_V(e,t,{configurable:!0,get:function(){return n_(this)[t]}})},n1=function(e){var t;return hV(SV,e)||(t=lV(e))=="ArrayBuffer"||t=="SharedArrayBuffer"},r1=function(e,t){return s_(e)&&!uV(t)&&t in e&&aV(+t)&&t>=0},s1=function(e,t){return t=YI(t),r1(e,t)?oV(2,e[t]):EV(e,t)},o1=function(e,t,i){return t=YI(t),!(r1(e,t)&&i_(i)&&Ic(i,"value"))||Ic(i,"get")||Ic(i,"set")||i.configurable||Ic(i,"writable")&&!i.writable||Ic(i,"enumerable")&&!i.enumerable?ZI(e,t,i):(e[t]=i.value,e)};rV?(fd||(QI.f=s1,XI.f=o1,_d(bc,"buffer"),_d(bc,"byteOffset"),_d(bc,"byteLength"),_d(bc,"length")),jI({target:"Object",stat:!0,forced:!fd},{getOwnPropertyDescriptor:s1,defineProperty:o1}),wI.exports=function(e,t,i){var r=e.match(/\d+/)[0]/8,o=e+(i?"Clamped":"")+"Array",c="get"+e,u="set"+e,f=WI[o],d=f,_=d&&d.prototype,E={},S=function(k,U){ZI(k,U,{get:function(){return function(K,se){var le=n_(K);return le.view[c](se*r+le.byteOffset,!0)}(this,U)},set:function(K){return function(se,le,Y){var Re=n_(se);i&&(Y=(Y=TV(Y))<0?0:Y>255?255:255&Y),Re.view[u](le*r+Re.byteOffset,Y,!0)}(this,U,K)},enumerable:!0})};fd?sV&&(d=t(function(k,U,K,se){return KI(k,_),gV(i_(U)?n1(U)?se!==void 0?new f(U,t_(K,r),se):K!==void 0?new f(U,t_(K,r)):new f(U):s_(U)?i1(d,U):zI(qI,d,U):new f(JI(U)),k,d)}),pd&&pd(d,t1),fV(pV(f),function(k){k in d||Sc(d,k,f[k])}),d.prototype=_):(d=t(function(k,U,K,se){KI(k,_);var le,Y,Re,Ne=0,Le=0;if(i_(U)){if(!n1(U))return s_(U)?i1(d,U):zI(qI,d,U);le=U,Le=t_(K,r);var pt=U.byteLength;if(se===void 0){if(pt%r||(Y=pt-Le)<0)throw r_(o_)}else if((Y=cV(se)*r)+Le>pt)throw r_(o_);Re=Y/r}else Re=JI(U),le=new $I(Y=Re*r);for(vV(k,{buffer:le,byteOffset:Le,byteLength:Y,length:Re,view:new IV(le)});Ne<Re;)S(k,Ne++)}),pd&&pd(d,t1),_=d.prototype=dV(bc)),_.constructor!==d&&Sc(_,"constructor",d),yV(_).TypedArrayConstructor=d,e1&&Sc(_,e1,o);var R=d!=f;E[o]=d,jI({global:!0,constructor:!0,forced:R,sham:!fd},E),md in d||Sc(d,md,r),md in _||Sc(_,md,r),mV(o)}):wI.exports=function(){},cd("Uint8",function(e){return function(t,i,r){return e(this,t,i,r)}});var AV=iI,RV=BI,CV=br,wV=Rt,kV=h,NV=Zn.aTypedArray,DV=Zn.exportTypedArrayMethod,OV=T("".slice);DV("fill",function(e){var t=arguments.length;NV(this);var i=OV(CV(this),0,3)==="Big"?RV(e):+e;return wV(AV,this,i,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)},kV(function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),e!==1}));var a1=X,c1=Rt,a_=Zn,PV=gn,MV=FI,LV=at,l1=h,xV=a1.RangeError,c_=a1.Int8Array,u1=c_&&c_.prototype,d1=u1&&u1.set,VV=a_.aTypedArray,UV=a_.exportTypedArrayMethod,l_=!l1(function(){var e=new Uint8ClampedArray(2);return c1(d1,e,{length:1,0:3},1),e[1]!==3}),FV=l_&&a_.NATIVE_ARRAY_BUFFER_VIEWS&&l1(function(){var e=new c_(2);return e.set(1),e.set("2",1),e[0]!==0||e[1]!==2});UV("set",function(e){VV(this);var t=MV(arguments.length>1?arguments[1]:void 0,1),i=LV(e);if(l_)return c1(d1,this,i,t);var r=this.length,o=PV(i),c=0;if(o+t>r)throw xV("Wrong length");for(;c<o;)this[t+c]=i[c++]},!l_||FV);var h1=q.match(/firefox\/(\d+)/i),p1=!!h1&&+h1[1],f1=/MSIE|Trident/.test(q),m1=q.match(/AppleWebKit\/(\d+)\./),_1=!!m1&&+m1[1],BV=cc,u_=h,HV=Zi,jV=om,g1=p1,WV=f1,v1=ue,y1=_1,zV=Zn.aTypedArray,GV=Zn.exportTypedArrayMethod,Ac=X.Uint16Array,sa=Ac&&BV(Ac.prototype.sort),KV=!(!sa||u_(function(){sa(new Ac(2),null)})&&u_(function(){sa(new Ac(2),{})})),E1=!!sa&&!u_(function(){if(v1)return v1<74;if(g1)return g1<67;if(WV)return!0;if(y1)return y1<602;var e,t,i=new Ac(516),r=Array(516);for(e=0;e<516;e++)t=e%4,i[e]=515-e,r[e]=e-2*t+3;for(sa(i,function(o,c){return(o/4|0)-(c/4|0)}),e=0;e<516;e++)if(i[e]!==r[e])return!0});GV("sort",function(e){return e!==void 0&&HV(e),E1?sa(this,e):jV(zV(this),function(t){return function(i,r){return t!==void 0?+t(i,r)||0:r!=r?-1:i!=i?1:i===0&&r===0?1/i>0&&1/r<0?1:-1:i>r}}(e))},!E1||KV);var JV=Nt,gd=uc,YV=h,T1=Tr,S1=lt,qV=ff,I1=iT,XV=Vi,d_=gd&&gd.prototype;if(JV({target:"Promise",proto:!0,real:!0,forced:!!gd&&YV(function(){d_.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=qV(this,T1("Promise")),i=S1(e);return this.then(i?function(r){return I1(t,e()).then(function(){return r})}:e,i?function(r){return I1(t,e()).then(function(){throw r})}:e)}}),S1(gd)){var b1=T1("Promise").prototype.finally;d_.finally!==b1&&XV(d_,"finally",b1,{unsafe:!0})}var QV=Iu,h_="ArrayBuffer",A1=od[h_];Nt({global:!0,constructor:!0,forced:X[h_]!==A1},{ArrayBuffer:A1}),QV(h_);var R1=Co,ZV=TypeError,$V=Nt,C1=T,e8=Zi,t8=at,w1=gn,i8=function(e,t){if(!delete e[t])throw ZV("Cannot delete property "+R1(t)+" of "+R1(e))},k1=ki,p_=h,n8=om,r8=Yf,N1=p1,s8=f1,D1=ue,O1=_1,Mr=[],P1=C1(Mr.sort),o8=C1(Mr.push),a8=p_(function(){Mr.sort(void 0)}),c8=p_(function(){Mr.sort(null)}),l8=r8("sort"),M1=!p_(function(){if(D1)return D1<70;if(!(N1&&N1>3)){if(s8)return!0;if(O1)return O1<603;var e,t,i,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)Mr.push({k:t+r,v:i})}for(Mr.sort(function(c,u){return u.v-c.v}),r=0;r<Mr.length;r++)t=Mr[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});$V({target:"Array",proto:!0,forced:a8||!c8||!l8||!M1},{sort:function(e){e!==void 0&&e8(e);var t=t8(this);if(M1)return e===void 0?P1(t):P1(t,e);var i,r,o=[],c=w1(t);for(r=0;r<c;r++)r in t&&o8(o,t[r]);for(n8(o,function(u){return function(f,d){return d===void 0?-1:f===void 0?1:u!==void 0?+u(f,d)||0:k1(f)>k1(d)?1:-1}}(e)),i=w1(o),r=0;r<i;)t[r]=o[r++];for(;r<c;)i8(t,r++);return t}}),cd("Float32",function(e){return function(t,i,r){return e(this,t,i,r)}});var u8=Nt,d8=IT,h8=T([].reverse),L1=[1,2];u8({target:"Array",proto:!0,forced:String(L1)===String(L1.reverse())},{reverse:function(){return d8(this)&&(this.length=this.length),h8(this)}});var p8=Nt,f8=Rt,f_=T,x1=W,m8=lt,_8=V,g8=sT,Rc=ki,v8=Ja,y8=cT,E8=FT,T8=mt("replace"),S8=TypeError,V1=f_("".indexOf);f_("".replace);var U1=f_("".slice),I8=Math.max,F1=function(e,t,i){return i>e.length?-1:t===""?i:V1(e,t,i)};p8({target:"String",proto:!0},{replaceAll:function(e,t){var i,r,o,c,u,f,d,_,E=x1(this),S=0,R=0,k="";if(!_8(e)){if(g8(e)&&(i=Rc(x1(y8(e))),!~V1(i,"g")))throw S8("`.replaceAll` does not allow non-global regexes");if(r=v8(e,T8))return f8(r,e,E,t)}for(o=Rc(E),c=Rc(e),(u=m8(t))||(t=Rc(t)),f=c.length,d=I8(1,f),S=F1(o,c,0);S!==-1;)_=u?Rc(t(c,S,o)):E8(c,o,S,[],void 0,t),k+=U1(o,R,S)+_,R=S+f,S=F1(o,c,S+d);return R<o.length&&(k+=U1(o,R)),k}}),(0,Zn.exportTypedArrayStaticMethod)("from",HI,UI);let B1=!0,H1=!0;function vd(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function Os(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(u,f){if(u!==t)return o.apply(this,arguments);const d=_=>{const E=i(_);E&&(f.handleEvent?f.handleEvent(E):f(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,d),o.apply(this,[u,d])};const c=r.removeEventListener;r.removeEventListener=function(u,f){if(u!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(f))return c.apply(this,arguments);const d=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[u,d])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function b8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(B1=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function A8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(H1=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function j1(){if(typeof window=="object"){if(B1)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function m_(e,t){H1&&console.warn(e+" is deprecated, please use "+t+" instead.")}function W1(e){return Object.prototype.toString.call(e)==="[object Object]"}function z1(e){return W1(e)?Object.keys(e).reduce(function(t,i){const r=W1(e[i]),o=r?z1(e[i]):e[i],c=r&&!Object.keys(o).length;return o===void 0||c?t:Object.assign(t,{[i]:o})},{}):e}function __(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?__(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(o=>{__(e,e.get(o),i)})}))}function G1(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const c=[];return e.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&c.push(u)}),c.forEach(u=>{e.forEach(f=>{f.type===r&&f.trackId===u.id&&__(e,f,o)})}),o}const K1=j1;function J1(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const r=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const f={};return Object.keys(u).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const _=typeof u[d]=="object"?u[d]:{ideal:u[d]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);const E=function(S,R){return S?S+R.charAt(0).toUpperCase()+R.slice(1):R==="deviceId"?"sourceId":R};if(_.ideal!==void 0){f.optional=f.optional||[];let S={};typeof _.ideal=="number"?(S[E("min",d)]=_.ideal,f.optional.push(S),S={},S[E("max",d)]=_.ideal,f.optional.push(S)):(S[E("",d)]=_.ideal,f.optional.push(S))}_.exact!==void 0&&typeof _.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[E("",d)]=_.exact):["min","max"].forEach(S=>{_[S]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[E(S,d)]=_[S])})}),u.advanced&&(f.optional=(f.optional||[]).concat(u.advanced)),f},o=function(u,f){if(t.version>=61)return f(u);if((u=JSON.parse(JSON.stringify(u)))&&typeof u.audio=="object"){const d=function(_,E,S){E in _&&!(S in _)&&(_[S]=_[E],delete _[E])};d((u=JSON.parse(JSON.stringify(u))).audio,"autoGainControl","googAutoGainControl"),d(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=r(u.audio)}if(u&&typeof u.video=="object"){let d=u.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const _=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||_)){let E;if(delete u.video.facingMode,d.exact==="environment"||d.ideal==="environment"?E=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(E=["front"]),E)return i.mediaDevices.enumerateDevices().then(S=>{let R=(S=S.filter(k=>k.kind==="videoinput")).find(k=>E.some(U=>k.label.toLowerCase().includes(U)));return!R&&S.length&&E.includes("back")&&(R=S[S.length-1]),R&&(u.video.deviceId=d.exact?{exact:R.deviceId}:{ideal:R.deviceId}),u.video=r(u.video),K1("chrome: "+JSON.stringify(u)),f(u)})}u.video=r(u.video)}return K1("chrome: "+JSON.stringify(u)),f(u)},c=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(u,f,d){o(u,_=>{i.webkitGetUserMedia(_,f,E=>{d&&d(c(E))})})}).bind(i),i.mediaDevices.getUserMedia){const u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return o(f,d=>u(d).then(_=>{if(d.audio&&!_.getAudioTracks().length||d.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(c(_))))}}}function Y1(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function q1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===r.track.id):{track:r.track};const c=new Event("track");c.track=r.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[i.stream],this.dispatchEvent(c)}),i.stream.getTracks().forEach(r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===r.id):{track:r};const c=new Event("track");c.track=r,c.receiver=o,c.transceiver={receiver:o},c.streams=[i.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Os(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function X1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=o.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,f){let d=o.apply(this,arguments);return d||(d=t(this,u),this._senders.push(d)),d};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){c.apply(this,arguments);const f=this._senders.indexOf(u);f!==-1&&this._senders.splice(f,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(c=>{const u=this._senders.find(f=>f.track===c);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Q1(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,r,o]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);const c=function(f){const d={};return f.result().forEach(_=>{const E={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(S=>{E[S]=_.stat(S)}),d[E.id]=E}),d},u=function(f){return new Map(Object.keys(f).map(d=>[d,f[d]]))};if(arguments.length>=2){const f=function(d){r(u(c(d)))};return t.apply(this,[f,i])}return new Promise((f,d)=>{t.apply(this,[function(_){f(u(c(_)))},d])}).then(r,o)}}function Z1(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>G1(c,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Os(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>G1(o,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let r,o,c;return this.getSenders().forEach(u=>{u.track===i&&(r?c=!0:r=u)}),this.getReceivers().forEach(u=>(u.track===i&&(o?c=!0:o=u),u.track===i)),c||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function $1(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(f)===-1&&this._shimmedLocalStreams[u.id].push(f):this._shimmedLocalStreams[u.id]=[u,f],f};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(_=>_.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(d=>u.indexOf(d)===-1);this._shimmedLocalStreams[c.id]=[c].concat(f)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const f=this._shimmedLocalStreams[u].indexOf(c);f!==-1&&this._shimmedLocalStreams[u].splice(f,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function eb(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return $1(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(_=>this._reverseStreams[_.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(_=>{if(this.getSenders().find(E=>E.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const _=new e.MediaStream(d.getTracks());this._streams[d.id]=_,this._reverseStreams[_.id]=d,d=_}r.apply(this,[d])};const o=e.RTCPeerConnection.prototype.removeStream;function c(d,_){let E=_.sdp;return Object.keys(d._reverseStreams||[]).forEach(S=>{const R=d._reverseStreams[S],k=d._streams[R.id];E=E.replace(new RegExp(k.id,"g"),R.id)}),new RTCSessionDescription({type:_.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(R=>R===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[_.id];if(S)S.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new e.MediaStream([d]);this._streams[_.id]=R,this._reverseStreams[R.id]=_,this.addStream(R)}return this.getSenders().find(R=>R.track===d)},["createOffer","createAnswer"].forEach(function(d){const _=e.RTCPeerConnection.prototype[d],E={[d](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[R=>{const k=c(this,R);S[0].apply(null,[k])},R=>{S[1]&&S[1].apply(null,R)},arguments[2]]):_.apply(this,arguments).then(R=>c(this,R))}};e.RTCPeerConnection.prototype[d]=E[d]});const u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,_){let E=_.sdp;return Object.keys(d._reverseStreams||[]).forEach(S=>{const R=d._reverseStreams[S],k=d._streams[R.id];E=E.replace(new RegExp(R.id,"g"),k.id)}),new RTCSessionDescription({type:_.type,sdp:E})}(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const d=f.get.apply(this);return d.type===""?d:c(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(S=>d.track===S)&&(_=this._streams[E])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function g_(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]})}function tb(e,t){Os(e,"negotiationneeded",i=>{const r=i.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return i})}var ib=Object.freeze({__proto__:null,shimMediaStream:Y1,shimOnTrack:q1,shimGetSendersWithDtmf:X1,shimGetStats:Q1,shimSenderReceiverGetStats:Z1,shimAddTrackRemoveTrackWithNative:$1,shimAddTrackRemoveTrack:eb,shimPeerConnection:g_,fixNegotiationNeeded:tb,shimGetUserMedia:J1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(r=>{const o=i.video&&i.video.width,c=i.video&&i.video.height,u=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:u||3}},o&&(i.video.mandatory.maxWidth=o),c&&(i.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function nb(e,t){const i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(o,c,u){m_("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(c,u)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const o=function(u,f,d){f in u&&!(d in u)&&(u[d]=u[f],delete u[f])},c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u.audio,"autoGainControl","mozAutoGainControl"),o(u.audio,"noiseSuppression","mozNoiseSuppression")),c(u)},r&&r.prototype.getSettings){const u=r.prototype.getSettings;r.prototype.getSettings=function(){const f=u.apply(this,arguments);return o(f,"mozAutoGainControl","autoGainControl"),o(f,"mozNoiseSuppression","noiseSuppression"),f}}if(r&&r.prototype.applyConstraints){const u=r.prototype.applyConstraints;r.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),o(f,"autoGainControl","mozAutoGainControl"),o(f,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[f])}}}}function rb(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function v_(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const c=e.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=u[o]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,c,u]=arguments;return r.apply(this,[o||null]).then(f=>{if(t.version<53&&!c)try{f.forEach(d=>{d.type=i[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;f.forEach((_,E)=>{f.set(E,Object.assign({},_,{type:i[_.type]||_.type}))})}return f}).then(c,u)}}function sb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ob(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Os(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ab(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){m_("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function cb(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function lb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(r){const{sender:c}=o,u=c.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=i,c.sendEncodings=i,this.setParametersPromises.push(c.setParameters(u).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function ub(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function db(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function hb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var pb=Object.freeze({__proto__:null,shimOnTrack:rb,shimPeerConnection:v_,shimSenderGetStats:sb,shimReceiverGetStats:ob,shimRemoveStream:ab,shimRTCDataChannel:cb,shimAddTransceiver:lb,shimGetParameters:ub,shimCreateOffer:db,shimCreateAnswer:hb,shimGetUserMedia:nb,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}});function fb(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>t.call(this,r,i)),i.getVideoTracks().forEach(r=>t.call(this,r,i))},e.RTCPeerConnection.prototype.addTrack=function(i,...r){return r&&r.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const r=t.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function mb(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,this.dispatchEvent(c)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,i.dispatchEvent(c)})}),t.apply(i,arguments)}}}function _b(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,c=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(d,_){const E=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[E]);return _?(S.then(d,_),Promise.resolve()):S},t.createAnswer=function(d,_){const E=arguments.length>=2?arguments[2]:arguments[0],S=r.apply(this,[E]);return _?(S.then(d,_),Promise.resolve()):S};let f=function(d,_,E){const S=o.apply(this,[d]);return E?(S.then(_,E),Promise.resolve()):S};t.setLocalDescription=f,f=function(d,_,E){const S=c.apply(this,[d]);return E?(S.then(_,E),Promise.resolve()):S},t.setRemoteDescription=f,f=function(d,_,E){const S=u.apply(this,[d]);return E?(S.then(_,E),Promise.resolve()):S},t.addIceCandidate=f}function gb(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=o=>r(vb(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,r,o){t.mediaDevices.getUserMedia(i).then(r,o)}).bind(t))}function vb(e){return e&&e.video!==void 0?Object.assign({},e,{video:z1(e.video)}):e}function yb(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let c=0;c<i.iceServers.length;c++){let u=i.iceServers[c];u.urls===void 0&&u.url?(m_("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,o.push(u)):o.push(i.iceServers[c])}i.iceServers=o}return new t(i,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Eb(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Tb(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Sb(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ib=Object.freeze({__proto__:null,shimLocalStreamsAPI:fb,shimRemoteStreamsAPI:mb,shimCallbacksAPI:_b,shimGetUserMedia:gb,shimConstraints:vb,shimRTCIceServerUrls:yb,shimTrackEventTransceiver:Eb,shimCreateOfferLegacy:Tb,shimAudioContext:Sb}),yd={},R8={get exports(){return yd},set exports(e){yd=e}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(i){const r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){const r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(o=>o.indexOf(r)===0)},t.parseCandidate=function(i){let r;r=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let c=8;c<r.length;c+=2)switch(r[c]){case"raddr":o.relatedAddress=r[c+1];break;case"rport":o.relatedPort=parseInt(r[c+1],10);break;case"tcptype":o.tcpType=r[c+1];break;case"ufrag":o.ufrag=r[c+1],o.usernameFragment=r[c+1];break;default:o[r[c]]===void 0&&(o[r[c]]=r[c+1])}return o},t.writeCandidate=function(i){const r=[];r.push(i.foundation);const o=i.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);const c=i.type;return r.push("typ"),r.push(c),c!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let r=i.substring(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);const o=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(i){const r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const r={};let o;const c=i.substring(i.indexOf(" ")+1).split(";");for(let u=0;u<c.length;u++)o=c[u].trim().split("="),r[o[0].trim()]=o[1];return r},t.writeFmtp=function(i){let r="",o=i.payloadType;if(i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const c=[];Object.keys(i.parameters).forEach(u=>{i.parameters[u]!==void 0?c.push(u+"="+i.parameters[u]):c.push(u)}),r+="a=fmtp:"+o+" "+c.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){const r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",o=i.payloadType;return i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(c=>{r+="a=rtcp-fb:"+o+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){const r=i.indexOf(" "),o={ssrc:parseInt(i.substring(7,r),10)},c=i.indexOf(":",r);return c>-1?(o.attribute=i.substring(r+1,c),o.value=i.substring(c+1)):o.attribute=i.substring(r+1),o},t.parseSsrcGroup=function(i){const r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},t.getMid=function(i){const r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(i){const r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let o="a=setup:"+r+`\r
`;return i.fingerprints.forEach(c=>{o+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),o},t.parseCryptoLine=function(i){const r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){const o=t.matchPrefix(i+r,"a=ice-ufrag:")[0],c=t.matchPrefix(i+r,"a=ice-pwd:")[0];return o&&c?{usernameFragment:o.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(i)[0].split(" ");r.profile=o[2];for(let u=3;u<o.length;u++){const f=o[u],d=t.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(d){const _=t.parseRtpMap(d),E=t.matchPrefix(i,"a=fmtp:"+f+" ");switch(_.parameters=E.length?t.parseFmtp(E[0]):{},_.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),r.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(_.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach(u=>{r.headerExtensions.push(t.parseExtmap(u))});const c=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(u=>{c.forEach(f=>{u.rtcpFeedback.find(d=>d.type===f.type&&d.parameter===f.parameter)||u.rtcpFeedback.push(f)})}),r},t.writeRtpDescription=function(i,r){let o="";o+="m="+i+" ",o+=r.codecs.length>0?"9":"0",o+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=r.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(u=>{o+=t.writeRtpMap(u),o+=t.writeFmtp(u),o+=t.writeRtcpFb(u)});let c=0;return r.codecs.forEach(u=>{u.maxptime>c&&(c=u.maxptime)}),c>0&&(o+="a=maxptime:"+c+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(u=>{o+=t.writeExtmap(u)}),o},t.parseRtpEncodingParameters=function(i){const r=[],o=t.parseRtpParameters(i),c=o.fecMechanisms.indexOf("RED")!==-1,u=o.fecMechanisms.indexOf("ULPFEC")!==-1,f=t.matchPrefix(i,"a=ssrc:").map(R=>t.parseSsrcMedia(R)).filter(R=>R.attribute==="cname"),d=f.length>0&&f[0].ssrc;let _;const E=t.matchPrefix(i,"a=ssrc-group:FID").map(R=>R.substring(17).split(" ").map(k=>parseInt(k,10)));E.length>0&&E[0].length>1&&E[0][0]===d&&(_=E[0][1]),o.codecs.forEach(R=>{if(R.name.toUpperCase()==="RTX"&&R.parameters.apt){let k={ssrc:d,codecPayloadType:parseInt(R.parameters.apt,10)};d&&_&&(k.rtx={ssrc:_}),r.push(k),c&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:d,mechanism:u?"red+ulpfec":"red"},r.push(k))}}),r.length===0&&d&&r.push({ssrc:d});let S=t.matchPrefix(i,"b=");return S.length&&(S=S[0].indexOf("b=TIAS:")===0?parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?1e3*parseInt(S[0].substring(5),10)*.95-16e3:void 0,r.forEach(R=>{R.maxBitrate=S})),r},t.parseRtcpParameters=function(i){const r={},o=t.matchPrefix(i,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const c=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=c.length>0,r.compound=c.length===0;const u=t.matchPrefix(i,"a=rtcp-mux");return r.mux=u.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r;const o=t.matchPrefix(i,"a=msid:");if(o.length===1)return r=o[0].substring(7).split(" "),{stream:r[0],track:r[1]};const c=t.matchPrefix(i,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");return c.length>0?(r=c[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(i){const r=t.parseMLine(i),o=t.matchPrefix(i,"a=max-message-size:");let c;o.length>0&&(c=parseInt(o[0].substring(19),10)),isNaN(c)&&(c=65536);const u=t.matchPrefix(i,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:r.fmt,maxMessageSize:c};const f=t.matchPrefix(i,"a=sctpmap:");if(f.length>0){const d=f[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:c}}},t.writeSctpDescription=function(i,r){let o=[];return o=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,r,o){let c;const u=r!==void 0?r:2;return c=i||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+c+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){const o=t.splitLines(i);for(let c=0;c<o.length;c++)switch(o[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[c].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const r=t.splitLines(i)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(i){const r=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const r=t.splitLines(i);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(R8);var oa=yd,C8=a({__proto__:null,default:oa},[yd]);function Ed(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new t(i),o=oa.parseCandidate(i.candidate);for(const c in o)c in r||Object.defineProperty(r,c,{value:o[c]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Os(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function y_(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Os(e,"icecandidate",t=>{if(t.candidate){const i=oa.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function Td(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:r}=this.getConfiguration();r==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(r){if(!r||!r.sdp)return!1;const o=oa.splitSections(r.sdp);return o.shift(),o.some(c=>{const u=oa.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const r=function(d){const _=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const E=parseInt(_[1],10);return E!=E?-1:E}(arguments[0]),o=function(d){let _=65536;return t.browser==="firefox"&&(_=t.version<57?d===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),_}(r),c=function(d,_){let E=65536;t.browser==="firefox"&&t.version===57&&(E=65535);const S=oa.matchPrefix(d.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substring(19),10):t.browser==="firefox"&&_!==-1&&(E=2147483637),E}(arguments[0],r);let u;u=o===0&&c===0?Number.POSITIVE_INFINITY:o===0||c===0?Math.max(o,c):Math.min(o,c);const f={};Object.defineProperty(f,"maxMessageSize",{get:()=>u}),this._sctp=f}return i.apply(this,arguments)}}function Sd(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,o){const c=r.send;r.send=function(){const u=arguments[0],f=u.length||u.size||u.byteLength;if(r.readyState==="open"&&o.sctp&&f>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return c.apply(r,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=i.apply(this,arguments);return t(r,this),r},Os(e,"datachannel",r=>(t(r.channel,r.target),r))}function E_(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const c=o.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const u=new Event("connectionstatechange",o);c.dispatchEvent(u)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function T_(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return i.apply(this,arguments)}}function Id(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function bd(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>i.apply(this,[o]))})}var w8=Object.freeze({__proto__:null,shimRTCIceCandidate:Ed,shimRTCIceCandidateRelayProtocol:y_,shimMaxMessageSize:Td,shimSendThrowTypeError:Sd,shimConnectionState:E_,removeExtmapAllowMixed:T_,shimAddIceCandidateNullOrEmpty:Id,shimParameterlessSetLocalDescription:bd});(function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=j1,r=function(c){const u={browser:null,version:null};if(c===void 0||!c.navigator||!c.navigator.userAgent)return u.browser="Not a browser.",u;const{navigator:f}=c;if(f.mozGetUserMedia)u.browser="firefox",u.version=vd(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)u.browser="chrome",u.version=vd(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return u.browser="Not a supported browser.",u;u.browser="safari",u.version=vd(f.userAgent,/AppleWebKit\/(\d+)\./,1),u.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return u}(e),o={browserDetails:r,commonShim:w8,extractVersion:vd,disableLog:b8,disableWarnings:A8,sdp:C8};switch(r.browser){case"chrome":if(!ib||!g_||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),o;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),o;i("adapter.js shimming chrome."),o.browserShim=ib,Id(e,r),bd(e),J1(e,r),Y1(e),g_(e,r),q1(e),eb(e,r),X1(e),Q1(e),Z1(e),tb(e,r),Ed(e),y_(e),E_(e),Td(e,r),Sd(e),T_(e,r);break;case"firefox":if(!pb||!v_||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),o;i("adapter.js shimming firefox."),o.browserShim=pb,Id(e,r),bd(e),nb(e,r),v_(e,r),rb(e),ab(e),sb(e),ob(e),cb(e),lb(e),ub(e),db(e),hb(e),Ed(e),E_(e),Td(e,r),Sd(e);break;case"safari":if(!Ib||!t.shimSafari)return i("Safari shim is not included in this adapter release."),o;i("adapter.js shimming safari."),o.browserShim=Ib,Id(e,r),bd(e),yb(e),Tb(e),_b(e),fb(e),mb(e),Eb(e),gb(e),Sb(e),Ed(e),y_(e),Td(e,r),Sd(e),T_(e,r);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var De,k8=Object.create,Cc=Object.defineProperty,N8=Object.defineProperties,bb=Object.getOwnPropertyDescriptor,D8=Object.getOwnPropertyDescriptors,O8=Object.getOwnPropertyNames,Ad=Object.getOwnPropertySymbols,Ab=Object.getPrototypeOf,S_=Object.prototype.hasOwnProperty,Rb=Object.prototype.propertyIsEnumerable,P8=Reflect.get,I_=Math.pow,b_=(e,t,i)=>t in e?Cc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Oe=(e,t)=>{for(var i in t||(t={}))S_.call(t,i)&&b_(e,i,t[i]);if(Ad)for(var i of Ad(t))Rb.call(t,i)&&b_(e,i,t[i]);return e},qe=(e,t)=>N8(e,D8(t)),$n=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),wc=(e,t)=>{for(var i in t)Cc(e,i,{get:t[i],enumerable:!0})},ni=(e,t,i)=>(i=e!=null?k8(Ab(e)):{},((r,o,c,u)=>{if(o&&typeof o=="object"||typeof o=="function")for(let f of O8(o))!S_.call(r,f)&&f!==c&&Cc(r,f,{get:()=>o[f],enumerable:!(u=bb(o,f))||u.enumerable});return r})(!t&&e&&e.__esModule?i:Cc(i,"default",{value:e,enumerable:!0}),e)),Ie=(e,t,i,r)=>{for(var o,c=bb(t,i),u=e.length-1;u>=0;u--)(o=e[u])&&(c=o(t,i,c)||c);return c&&Cc(t,i,c),c},b=(e,t,i)=>(b_(e,typeof t!="symbol"?t+"":t,i),i),rn=(e,t,i)=>P8(Ab(e),i,t),B=(e,t,i)=>new Promise((r,o)=>{var c=d=>{try{f(i.next(d))}catch(_){o(_)}},u=d=>{try{f(i.throw(d))}catch(_){o(_)}},f=d=>d.done?r(d.value):Promise.resolve(d.value).then(c,u);f((i=i.apply(e,t)).next())}),Di=$n((e,t)=>{var i=Object.prototype.hasOwnProperty,r="~";function o(){}function c(_,E,S){this.fn=_,this.context=E,this.once=S||!1}function u(_,E,S,R,k){if(typeof S!="function")throw new TypeError("The listener must be a function");var U=new c(S,R||_,k),K=r?r+E:E;return _._events[K]?_._events[K].fn?_._events[K]=[_._events[K],U]:_._events[K].push(U):(_._events[K]=U,_._eventsCount++),_}function f(_,E){--_._eventsCount==0?_._events=new o:delete _._events[E]}function d(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(r=!1)),d.prototype.eventNames=function(){var _,E,S=[];if(this._eventsCount===0)return S;for(E in _=this._events)i.call(_,E)&&S.push(r?E.slice(1):E);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(_)):S},d.prototype.listeners=function(_){var E=r?r+_:_,S=this._events[E];if(!S)return[];if(S.fn)return[S.fn];for(var R=0,k=S.length,U=new Array(k);R<k;R++)U[R]=S[R].fn;return U},d.prototype.listenerCount=function(_){var E=r?r+_:_,S=this._events[E];return S?S.fn?1:S.length:0},d.prototype.emit=function(_,E,S,R,k,U){var K=r?r+_:_;if(!this._events[K])return!1;var se,le,Y=this._events[K],Re=arguments.length;if(Y.fn){switch(Y.once&&this.removeListener(_,Y.fn,void 0,!0),Re){case 1:return Y.fn.call(Y.context),!0;case 2:return Y.fn.call(Y.context,E),!0;case 3:return Y.fn.call(Y.context,E,S),!0;case 4:return Y.fn.call(Y.context,E,S,R),!0;case 5:return Y.fn.call(Y.context,E,S,R,k),!0;case 6:return Y.fn.call(Y.context,E,S,R,k,U),!0}for(le=1,se=new Array(Re-1);le<Re;le++)se[le-1]=arguments[le];Y.fn.apply(Y.context,se)}else{var Ne,Le=Y.length;for(le=0;le<Le;le++)switch(Y[le].once&&this.removeListener(_,Y[le].fn,void 0,!0),Re){case 1:Y[le].fn.call(Y[le].context);break;case 2:Y[le].fn.call(Y[le].context,E);break;case 3:Y[le].fn.call(Y[le].context,E,S);break;case 4:Y[le].fn.call(Y[le].context,E,S,R);break;default:if(!se)for(Ne=1,se=new Array(Re-1);Ne<Re;Ne++)se[Ne-1]=arguments[Ne];Y[le].fn.apply(Y[le].context,se)}}return!0},d.prototype.on=function(_,E,S){return u(this,_,E,S,!1)},d.prototype.once=function(_,E,S){return u(this,_,E,S,!0)},d.prototype.removeListener=function(_,E,S,R){var k=r?r+_:_;if(!this._events[k])return this;if(!E)return f(this,k),this;var U=this._events[k];if(U.fn)U.fn===E&&(!R||U.once)&&(!S||U.context===S)&&f(this,k);else{for(var K=0,se=[],le=U.length;K<le;K++)(U[K].fn!==E||R&&!U[K].once||S&&U[K].context!==S)&&se.push(U[K]);se.length?this._events[k]=se.length===1?se[0]:se:f(this,k)}return this},d.prototype.removeAllListeners=function(_){var E;return _?(E=r?r+_:_,this._events[E]&&f(this,E)):(this._events=new o,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=r,d.EventEmitter=d,t!==void 0&&(t.exports=d)}),Cb=$n((e,t)=>{var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var o="candidate:%s %d %s %d %s %d typ %s";return o+=r.raddr!=null?" raddr %s rport %d":"%v%v",o+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(o+=" generation %d"),o+=r["network-id"]!=null?" network-id %d":"%v",o+=r["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var o="ssrc:%d";return r.attribute!=null&&(o+=" %s",r.value!=null&&(o+=":%s")),o}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var o="mediaclk:";return o+=r.id!=null?"id=%s %s":"%v%s",o+=r.mediaClockValue!=null?"=%s":"",o+=r.rateNumerator!=null?" rate=%s":"",o+=r.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(r){i[r].forEach(function(o){o.reg||(o.reg=/(.*)/),o.format||(o.format="%s")})})}),M8=$n(e=>{var t=function(u){return String(Number(u))===u?Number(u):u},i=function(u,f,d){var _=u.name&&u.names;u.push&&!f[u.push]?f[u.push]=[]:_&&!f[u.name]&&(f[u.name]={});var E=u.push?{}:_?f[u.name]:f;(function(S,R,k,U){if(U&&!k)R[U]=t(S[1]);else for(var K=0;K<k.length;K+=1)S[K+1]!=null&&(R[k[K]]=t(S[K+1]))})(d.match(u.reg),E,u.names,u.name),u.push&&f[u.push].push(E)},r=Cb(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(u){var f={},d=[],_=f;return u.split(/(\r\n|\r|\n)/).filter(o).forEach(function(E){var S=E[0],R=E.slice(2);S==="m"&&(d.push({rtp:[],fmtp:[]}),_=d[d.length-1]);for(var k=0;k<(r[S]||[]).length;k+=1){var U=r[S][k];if(U.reg.test(R))return i(U,_,R)}}),f.media=d,f};var c=function(u,f){var d=f.split(/=(.+)/,2);return d.length===2?u[d[0]]=t(d[1]):d.length===1&&f.length>1&&(u[d[0]]=void 0),u};e.parseParams=function(u){return u.split(/;\s?/).reduce(c,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(u){return u.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(u){for(var f=[],d=u.split(" ").map(t),_=0;_<d.length;_+=3)f.push({component:d[_],ip:d[_+1],port:d[_+2]});return f},e.parseImageAttributes=function(u){return u.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(c,{})})},e.parseSimulcastStreamList=function(u){return u.split(";").map(function(f){return f.split(",").map(function(d){var _,E=!1;return d[0]!=="~"?_=t(d):(_=t(d.substring(1,d.length)),E=!0),{scid:_,paused:E}})})}}),L8=$n((e,t)=>{var i=Cb(),r=/%[sdv%]/g,o=function(d){var _=1,E=arguments,S=E.length;return d.replace(r,function(R){if(_>=S)return R;var k=E[_];switch(_+=1,R){case"%%":return"%";case"%s":return String(k);case"%d":return Number(k);case"%v":return""}})},c=function(d,_,E){var S=[d+"="+(_.format instanceof Function?_.format(_.push?E:E[_.name]):_.format)];if(_.names)for(var R=0;R<_.names.length;R+=1){var k=_.names[R];_.name?S.push(E[_.name][k]):S.push(E[_.names[R]])}else S.push(E[_.name]);return o.apply(null,S)},u=["v","o","s","i","u","e","p","c","b","t","r","z","a"],f=["i","c","b","a"];t.exports=function(d,_){_=_||{},d.version==null&&(d.version=0),d.name==null&&(d.name=" "),d.media.forEach(function(k){k.payloads==null&&(k.payloads="")});var E=_.outerOrder||u,S=_.innerOrder||f,R=[];return E.forEach(function(k){i[k].forEach(function(U){U.name in d&&d[U.name]!=null?R.push(c(k,U,d)):U.push in d&&d[U.push]!=null&&d[U.push].forEach(function(K){R.push(c(k,U,K))})})}),d.media.forEach(function(k){R.push(c("m",i.m[0],k)),S.forEach(function(U){i[U].forEach(function(K){K.name in k&&k[K.name]!=null?R.push(c(U,K,k)):K.push in k&&k[K.push]!=null&&k[K.push].forEach(function(se){R.push(c(U,K,se))})})})}),R.join(`\r
`)+`\r
`}}),x8=$n(e=>{var t=M8(),i=L8();e.write=i,e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList}),wb=$n((e,t)=>{var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var o="candidate:%s %d %s %d %s %d typ %s";return o+=r.raddr!=null?" raddr %s rport %d":"%v%v",o+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(o+=" generation %d"),o+=r["network-id"]!=null?" network-id %d":"%v",o+=r["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var o="ssrc:%d";return r.attribute!=null&&(o+=" %s",r.value!=null&&(o+=":%s")),o}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var o="mediaclk:";return o+=r.id!=null?"id=%s %s":"%v%s",o+=r.mediaClockValue!=null?"=%s":"",o+=r.rateNumerator!=null?" rate=%s":"",o+=r.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(r){i[r].forEach(function(o){o.reg||(o.reg=/(.*)/),o.format||(o.format="%s")})})}),V8=$n(e=>{var t=function(u){return String(Number(u))===u?Number(u):u},i=function(u,f,d){var _=u.name&&u.names;u.push&&!f[u.push]?f[u.push]=[]:_&&!f[u.name]&&(f[u.name]={});var E=u.push?{}:_?f[u.name]:f;(function(S,R,k,U){if(U&&!k)R[U]=t(S[1]);else for(var K=0;K<k.length;K+=1)S[K+1]!=null&&(R[k[K]]=t(S[K+1]))})(d.match(u.reg),E,u.names,u.name),u.push&&f[u.push].push(E)},r=wb(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(u){var f={},d=[],_=f;return u.split(/(\r\n|\r|\n)/).filter(o).forEach(function(E){var S=E[0],R=E.slice(2);S==="m"&&(d.push({rtp:[],fmtp:[]}),_=d[d.length-1]);for(var k=0;k<(r[S]||[]).length;k+=1){var U=r[S][k];if(U.reg.test(R))return i(U,_,R)}}),f.media=d,f};var c=function(u,f){var d=f.split(/=(.+)/,2);return d.length===2?u[d[0]]=t(d[1]):d.length===1&&f.length>1&&(u[d[0]]=void 0),u};e.parseParams=function(u){return u.split(/;\s?/).reduce(c,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(u){return u.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(u){for(var f=[],d=u.split(" ").map(t),_=0;_<d.length;_+=3)f.push({component:d[_],ip:d[_+1],port:d[_+2]});return f},e.parseImageAttributes=function(u){return u.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(c,{})})},e.parseSimulcastStreamList=function(u){return u.split(";").map(function(f){return f.split(",").map(function(d){var _,E=!1;return d[0]!=="~"?_=t(d):(_=t(d.substring(1,d.length)),E=!0),{scid:_,paused:E}})})}}),U8=$n((e,t)=>{var i=wb(),r=/%[sdv%]/g,o=function(d){var _=1,E=arguments,S=E.length;return d.replace(r,function(R){if(_>=S)return R;var k=E[_];switch(_+=1,R){case"%%":return"%";case"%s":return String(k);case"%d":return Number(k);case"%v":return""}})},c=function(d,_,E){var S=[d+"="+(_.format instanceof Function?_.format(_.push?E:E[_.name]):_.format)];if(_.names)for(var R=0;R<_.names.length;R+=1){var k=_.names[R];_.name?S.push(E[_.name][k]):S.push(E[_.names[R]])}else S.push(E[_.name]);return o.apply(null,S)},u=["v","o","s","i","u","e","p","c","b","t","r","z","a"],f=["i","c","b","a"];t.exports=function(d,_){_=_||{},d.version==null&&(d.version=0),d.name==null&&(d.name=" "),d.media.forEach(function(k){k.payloads==null&&(k.payloads="")});var E=_.outerOrder||u,S=_.innerOrder||f,R=[];return E.forEach(function(k){i[k].forEach(function(U){U.name in d&&d[U.name]!=null?R.push(c(k,U,d)):U.push in d&&d[U.push]!=null&&d[U.push].forEach(function(K){R.push(c(k,U,K))})})}),d.media.forEach(function(k){R.push(c("m",i.m[0],k)),S.forEach(function(U){i[U].forEach(function(K){K.name in k&&k[K.name]!=null?R.push(c(U,K,k)):K.push in k&&k[K.push]!=null&&k[K.push].forEach(function(se){R.push(c(U,K,se))})})})}),R.join(`\r
`)+`\r
`}}),kb=$n(e=>{var t=V8(),i=U8();e.write=i,e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList}),F8=ni(Di()),Nb=((De=Nb||{})[De.INVALID_PARAMETER=4096]="INVALID_PARAMETER",De[De.INVALID_OPERATION=4097]="INVALID_OPERATION",De[De.NOT_SUPPORTED=4098]="NOT_SUPPORTED",De[De.DEVICE_NOT_FOUND=4099]="DEVICE_NOT_FOUND",De[De.INITIALIZE_FAILED=4100]="INITIALIZE_FAILED",De[De.SIGNAL_CHANNEL_SETUP_FAILED=16385]="SIGNAL_CHANNEL_SETUP_FAILED",De[De.SIGNAL_CHANNEL_ERROR=16386]="SIGNAL_CHANNEL_ERROR",De[De.ICE_TRANSPORT_ERROR=16387]="ICE_TRANSPORT_ERROR",De[De.JOIN_ROOM_FAILED=16388]="JOIN_ROOM_FAILED",De[De.CREATE_OFFER_FAILED=16389]="CREATE_OFFER_FAILED",De[De.SIGNAL_CHANNEL_RECONNECTION_FAILED=16390]="SIGNAL_CHANNEL_RECONNECTION_FAILED",De[De.UPLINK_RECONNECTION_FAILED=16391]="UPLINK_RECONNECTION_FAILED",De[De.DOWNLINK_RECONNECTION_FAILED=16392]="DOWNLINK_RECONNECTION_FAILED",De[De.REMOTE_STREAM_NOT_EXIST=16400]="REMOTE_STREAM_NOT_EXIST",De[De.CLIENT_BANNED=16448]="CLIENT_BANNED",De[De.SERVER_TIMEOUT=16449]="SERVER_TIMEOUT",De[De.SUBSCRIPTION_TIMEOUT=16450]="SUBSCRIPTION_TIMEOUT",De[De.PLAY_NOT_ALLOWED=16451]="PLAY_NOT_ALLOWED",De[De.DEVICE_AUTO_RECOVER_FAILED=16452]="DEVICE_AUTO_RECOVER_FAILED",De[De.START_PUBLISH_CDN_FAILED=16453]="START_PUBLISH_CDN_FAILED",De[De.STOP_PUBLISH_CDN_FAILED=16454]="STOP_PUBLISH_CDN_FAILED",De[De.START_MIX_TRANSCODE_FAILED=16455]="START_MIX_TRANSCODE_FAILED",De[De.STOP_MIX_TRANSCODE_FAILED=16456]="STOP_MIX_TRANSCODE_FAILED",De[De.NOT_SUPPORTED_H264=16457]="NOT_SUPPORTED_H264",De[De.SWITCH_ROLE_FAILED=16458]="SWITCH_ROLE_FAILED",De[De.API_CALL_TIMEOUT=16459]="API_CALL_TIMEOUT",De[De.SCHEDULE_FAILED=16460]="SCHEDULE_FAILED",De[De.API_CALL_ABORTED=16461]="API_CALL_ABORTED",De[De.SPC_INITIALIZED_FAILED=16462]="SPC_INITIALIZED_FAILED",De[De.UNKNOWN=65535]="UNKNOWN",De),ge=Nb,B8=class extends Error{constructor(e){let{name:t="RtcError",message:i,code:r=ge.UNKNOWN,extraCode:o=0,constraint:c}=e,u="<".concat(function(d){for(let _ in ge)if(ge[_]===d)return _;return"UNKNOWN"}(r)," 0x").concat(r.toString(16),">"),f="".concat(i).concat(c?" constraint: ".concat(c):"").concat(i!=null&&i.includes(u)?"":" ".concat(u));super(f),b(this,"code"),b(this,"extraCode"),b(this,"message"),b(this,"originMessage"),b(this,"name"),b(this,"constraint"),this.code=r,this.extraCode=o,this.name=t,this.message=f,this.constraint=c,this.originMessage=i}getCode(){return this.code}getExtraCode(){return this.extraCode}toString(){return this.originMessage}},ke=B8,A_=(new Date().getTime(),0),R_=function(){return new Date().getTime()+A_},Db=function(){let e=new Date;return e.setTime(R_()),e.toLocaleString()},Sn={};wc(Sn,{bytes2ms:()=>IU,convertObjectNumberToInt:()=>yg,copyProperties:()=>SU,deepClone:()=>il,deepMerge:()=>Bs,fibonacci:()=>el,formatedTime:()=>PU,getAbilityConfigUrl:()=>yU,getConstructorName:()=>AA,getContainerFromElement:()=>DU,getEnv:()=>TU,getInternalVersion:()=>wU,getLoggerUrl:()=>Zc,getMuteStateFromFlag:()=>tl,getNetworkType:()=>EA,getNumNetworkType:()=>Kd,getReconnectionTimeout:()=>fa,getStringByteLength:()=>vg,getTurnServer:()=>NU,getUint32Version:()=>NA,getValueType:()=>Ei,getViewListFromView:()=>Yd,glog:()=>AU,ipv4ToUint32:()=>Jd,isArray:()=>ri,isAudioWorkletSupported:()=>CU,isBoolean:()=>Pi,isConstructor:()=>_g,isEmpty:()=>CA,isFunction:()=>Tt,isLangChinese:()=>Hr,isMediaStreamTrack:()=>RU,isNumber:()=>Qt,isObject:()=>jr,isOverseaSdkAppId:()=>Gd,isPlainObject:()=>nr,isPortrait:()=>kA,isPromise:()=>mg,isRemoteTrack:()=>ma,isString:()=>_t,isUndefined:()=>re,loadImage:()=>qd,ms2bytes:()=>bU,ms2samples:()=>bA,performanceNow:()=>it,promiseAny:()=>gg,samples2ms:()=>IA,setNetworkType:()=>SA,stringify:()=>rr,stringifyIncludeValue:()=>wA});var Ob={};wc(Ob,{AUDIO_MUTE_BIT:()=>V_,AUDIO_STAT_BIT:()=>Pc,AUX_STAT_BIT:()=>Cd,AUX_STREAM_MSID:()=>jb,BACKEND_ENV:()=>L_,BASE_DOC_URL:()=>Ps,BASE_HOST:()=>D_,CAPABILITIES_KEYS:()=>j_,CLASS_NAME:()=>sU,CLOUD_CONSOLE_URL:()=>j8,DATA_FREEZE_TIMING:()=>F_,DOC_URL:()=>W8,DTLS_STATE_UNKNOWN:()=>xr,ENV_NAME:()=>Ms,EXCHANGE_SDP_TIMEOUT:()=>Yb,INTERVAL:()=>Od,IS_WORKER:()=>Rd,IS_WORKLET:()=>k_,KIBANA_EVENT:()=>er,LOCAL_STREAM_PUBLISH_STATE:()=>qb,LOGGER_CMD_TYPE:()=>Dc,LOGGER_DOMAIN:()=>xb,LOGGER_DOMAIN_OVERSEA:()=>Vb,LOG_LEVEL:()=>Lr,LOG_LEVEL_NAME:()=>aU,MAIN_STREAM_MSID:()=>wd,MICROPHONE_COMMUNICATIONS:()=>oU,MICROPHONE_DEFAULT:()=>Lc,NAME:()=>N,NETWORK_TYPE:()=>O_,NOT_SUPPORTED_H264:()=>Nd,PAUSED_RETRY_COUNT:()=>Xb,PEERCONNECTION_CONNECTING_TIMEOUT:()=>B_,PEER_CONNECTION_STATE:()=>Lt,PEER_LEAVE_REASON:()=>Qb,RAF:()=>H_,RECOVER_CAPTURE_INTERVAL:()=>Vc,REMOTE_STREAM_TYPE_AUX:()=>zb,REMOTE_STREAM_TYPE_MAIN:()=>Wb,RENDER_FREEZE_TIMING:()=>tU,RIC:()=>ca,SCHEDULE_DOMAIN:()=>An,SCHEDULE_TIMEOUT:()=>rU,SDP_SEMANTICS_PLAN_B:()=>kd,SDP_SEMANTICS_UNIFIED_PLAN:()=>Mc,SECOND_HOST:()=>Mb,SIGNAL_PING_PONG_INTERVAL:()=>G8,SIGNAL_PING_TIMEOUT:()=>z8,SIGNAL_RECONNECTION_COUNT:()=>$8,SMALL_STAT_BIT:()=>x_,SPEAKER_DEFAULT:()=>Dd,STORAGE_EXPIRES_TIME:()=>Fb,STREAM_TYPE_BIG:()=>iU,STREAM_TYPE_SMALL:()=>nU,SUBSCRIBE_SMALL_RETRY_COUNT:()=>xc,SYNC_USER_LIST_INTERVAL:()=>eU,Scene:()=>Hb,Switch:()=>Bb,THIRD_HOST:()=>Lb,TIMEOUT:()=>Uc,TRANSPORT_DIRECTION:()=>Xe,TRTC_ERROR_ASSISTANCE:()=>Ub,TRTC_QUALITY_BAD:()=>X8,TRTC_QUALITY_DISCONNECTED:()=>Z8,TRTC_QUALITY_EXCELLENT:()=>J8,TRTC_QUALITY_GOOD:()=>Y8,TRTC_QUALITY_POOR:()=>q8,TRTC_QUALITY_UNKNOWN:()=>K8,TRTC_QUALITY_VERY_BAD:()=>Q8,UPDATE_OFFER_TIMEOUT:()=>Jb,VIDEO_MUTE_BIT:()=>U_,VIDEO_STAT_BIT:()=>Oc,audioProfileMap:()=>P_,getRetryCount:()=>aa,getScriptDir:()=>H8,innerVersion:()=>C_,loggerProxy:()=>N_,screenProfileMap:()=>M_,setLoggerProxy:()=>Nc,setRetryCount:()=>Kb,setVersion:()=>Pb,version:()=>In,videoProfileMap:()=>bn});var C_="4.15.00.1600",In="5.0.0";function Pb(e){In=e;let[t,i,r]=e.split(".").map(o=>parseInt(o,10));C_="".concat(t,".").concat(Math.min(15,i),".").concat(Math.min(15,r),".").concat(i.toString().padStart(2,"0")).concat(r.toString().padStart(2,"0"))}var w_,kc,Oi,Rd=typeof importScripts<"u",k_=typeof registerProcessor<"u",H8=()=>{let e=Rd?self.location.href:document.currentScript.src;return e.substring(0,e.lastIndexOf("/")+1)},N_="",Nc=e=>N_=e,D_="web.sdk.qcloud.com",Mb="web.sdk.tencent.cn",Lb="web.sdk.cloud.tencent.cn",j8="https://console.cloud.tencent.com/trtc",Ps="https://".concat(D_,"/trtc/webrtc/v5/doc"),W8="".concat(Ps,"/zh-cn/"),xb="https://yun.tim.qq.com",Vb="https://apisgp.my-imcloud.com",Ub="trtc_error_assistance",Dc={LOG:"jssdk_log",EVENT:"jssdk_event",KEY_POINT:"jssdk_new_endreport",KV_STAT:"jssdk_key_metrics_report"},Ms={QCLOUD:"qcloud",OLD_CLOUD_LADDER:"trtc",WEBRTC:"webrtc"},Lr=((Oi=Lr||{})[Oi.TRACE=0]="TRACE",Oi[Oi.DEBUG=1]="DEBUG",Oi[Oi.INFO=2]="INFO",Oi[Oi.WARN=3]="WARN",Oi[Oi.ERROR=4]="ERROR",Oi[Oi.NONE=5]="NONE",Oi),z8=18e3,G8=2e3,O_={unknown:0,wifi:1,"3g":2,"2g":3,"4g":4,wired:5,"5g":6},Fb=6048e5,Bb=((kc=Bb||{}).USEAINS="useAINS",kc.ENABLEDEBUG="enableDebug",kc.USEV2="useV2",kc.USEWT="useWt",kc),P_={standard:{sampleRate:48e3,channelCount:1,bitrate:40},"standard-stereo":{sampleRate:48e3,channelCount:2,bitrate:64},high:{sampleRate:48e3,channelCount:1,bitrate:128},"high-stereo":{sampleRate:48e3,channelCount:2,bitrate:192}},bn={"120p":{width:160,height:120,frameRate:15,bitrate:200},"120p_2":{width:160,height:120,frameRate:15,bitrate:100},"180p":{width:320,height:180,frameRate:15,bitrate:350},"180p_2":{width:320,height:180,frameRate:15,bitrate:150},"240p":{width:320,height:240,frameRate:15,bitrate:400},"240p_2":{width:320,height:240,frameRate:15,bitrate:200},"360p":{width:640,height:360,frameRate:15,bitrate:800},"360p_2":{width:640,height:360,frameRate:15,bitrate:400},"480p":{width:640,height:480,frameRate:15,bitrate:900},"480p_2":{width:640,height:480,frameRate:15,bitrate:500},"720p":{width:1280,height:720,frameRate:15,bitrate:1500},"1080p":{width:1920,height:1080,frameRate:15,bitrate:2e3},"1440p":{width:2560,height:1440,frameRate:30,bitrate:4860},"4K":{width:3840,height:2160,frameRate:30,bitrate:9e3}},M_={"480p":{width:640,height:480,frameRate:5,bitrate:900},"480p_2":{width:640,height:480,frameRate:30,bitrate:1e3},"720p":{width:1280,height:720,frameRate:5,bitrate:1200},"720p_2":{width:1280,height:720,frameRate:30,bitrate:3e3},"1080p":{width:1920,height:1080,frameRate:5,bitrate:1600},"1080p_2":{width:1920,height:1080,frameRate:30,bitrate:4e3}},N={CANVAS:"canvas",AUDIO:"audio",VIDEO:"video",SCREEN:"screen",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",SMALL_VIDEO:"smallVideo",FACING_MODE_USER:"user",FACING_MODE_ENVIRONMENT:"environment",MUTE:"mute",UNMUTE:"unmute",ENDED:"ended",PLAYING:"playing",PAUSE:"pause",ERROR:"error",LOADEDDATA:"loadeddata",AUDIO_INPUT:"audioinput",VIDEO_INPUT:"videoinput",DETAIL:"detail",TEXT:"text",MAIN:"main",BACKUP:"backup",BANNED:"banned",KICK:"kick",USER_TIME_OUT:"user_time_out",ROOM_DISBAND:"room_disband",SEI_MESSAGE:"sei-message",ADD:"add",REMOVE:"remove",REPLACE:"replace",TRACK:"track",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",TRANSCEIVER_DIRECTION_SENDONLY:"sendonly",TRANSCEIVER_DIRECTION_RECVONLY:"recvonly",ENTER_PICTURE_IN_PICTURE:"enterpictureinpicture",LEAVE_PICTURE_IN_PICTURE:"leavepictureinpicture"},Xe={INACTIVE:"inactive",SENDONLY:"sendonly",RECVONLY:"recvonly"},L_={OLD_CLOUD_LADDER:"wss://trtc.rtc.qq.com",WEBRTC:"wss://webrtc.qq.com"},Hb=((w_=Hb||{}).LIVE="live",w_.RTC="rtc",w_),Oc=1,x_=2,Cd=4,Pc=8,V_=64,U_=16,wd="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",jb="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",Wb=N.MAIN,zb=N.AUXILIARY,K8=0,J8=1,Y8=2,q8=3,X8=4,Q8=5,Z8=6,xr="unknown",Lt={NEW:"new",CONNECTING:"connecting",FAILED:"failed",CLOSED:"closed",DISCONNECTED:"disconnected",CONNECTED:"connected",COMPLETED:"completed"},Gb=1/0;function Kb(e){Gb=e}function aa(){return Gb}var Ls,$8=30,er={JOIN:"join",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_LOCAL_AUDIO_TRACK:"recover-local-audio-track",RECOVER_LOCAL_VIDEO_TRACK:"recover-local-video-track",RECOVER_SUBSCRIPTION:"recover-subscription",START_MIX_TRANSCODE:"start-mix-transcode",STOP_MIX_TRANSCODE:"stop-mix-transcode",PLAYER_ERROR:"player-error",SCHEDULE:"schedule",LOAD_WORKLET:"load-worklet",VIDEO_FROZEN_COUNT:"videoFrozenCount",GET_USER_MEDIA_RETRY:"getUserMedia-retry"},eU=1e4,Jb=1e4,Yb=1e4,Mc="unified-plan",kd="plan-b",Nd=1028,qb=((Ls=qb||{})[Ls.UNPUBLISH=-1]="UNPUBLISH",Ls[Ls.PUBLISHING=0]="PUBLISHING",Ls[Ls.PUBLISHED=1]="PUBLISHED",Ls),F_=500,tU=1e3,iU=N.BIG,nU=N.SMALL,B_=1e4,An={MAIN:"schedule.cloud-rtc.com",BACKUP:"schedule.rtc.qcloud.com",MAIN_OVERSEA:"schedule.rtc-web.com",BACKUP_OVERSEA:"schedule.rtc-web.io",MAIN_OVERSEA_OLD:"schedule.rtc.tencentcloud.com",BACKUP_OVERSEA_OLD:"schedule-ecdn.rtc.tencentcloud.com"},rU=2e3,sU={TRTC:"TRTC",CLIENT:"Client",LOCAL_STREAM:"LocalStream",REMOTE_STREAM:"RemoteStream",STREAM:"Stream"},Xb=5,Lc="default",Dd=Lc,oU="communications",aU=Object.keys(Lr),Qb=["normal leave","timeout leave","kick","role change"],xc=10,Vc=2e3,ca="ric",H_="raf",Od="interval",Uc="timeout",j_=["width","height","frameRate","facingMode","sampleRate","sampleSize","channelCount","deviceId","min","max"];function Fc(e){let{url:t,body:i,method:r,timeout:o}=e,c=new XMLHttpRequest;return new Promise((u,f)=>{c.onreadystatechange=()=>{if(c.readyState===4)if(c.status>=200&&c.status<300)try{let d=JSON.parse(c.response);u({data:d})}catch{u({data:c.response})}else f({status:c.status,statusText:c.statusText||"request failed!"})},c.timeout=o||5e3,c.open(r||"POST",t,!0),c.send(i)})}function Zb(e){return B(this,null,function*(){let t=it(),i=JSON.stringify(e);try{if(!CompressionStream||i.length<=2800)return i;let r=new Blob([i],{type:"application/json"}).stream().pipeThrough(new CompressionStream("gzip")),o=yield(yield(yield new Response(r)).blob()).arrayBuffer();return Te.debug("compressJSON ".concat(i.length," -> ").concat(o.byteLength," ").concat(it()-t,"ms")),o}catch{return i}})}var Vr=1e8,Ve={AVOID_REPEATED_CALL:"AVOID_REPEATED_CALL",INVALID_PARAMETER_REQUIRED:"INVALID_PARAMETER_REQUIRED",INVALID_PARAMETER_TYPE:"INVALID_PARAMETER_TYPE",INVALID_PARAMETER_EMPTY:"INVALID_PARAMETER_EMPTY",INVALID_PARAMETER_INSTANCE:"INVALID_PARAMETER_INSTANCE",INVALID_PARAMETER_RANGE:"INVALID_PARAMETER_RANGE",INVALID_PARAMETER_MIN:"INVALID_PARAMETER_MIN",INVALID_PARAMETER_MAX:"INVALID_PARAMETER_MAX",INVALID_PARAMETER_STREAMTYPE:"INVALID_PARAMETER_STREAMTYPE",API_CALL_TIMEOUT:"API_CALL_TIMEOUT",SIGNAL_CHANNEL_RECONNECTION_FAILED:"SIGNAL_CHANNEL_RECONNECTION_FAILED",SIGNAL_CHANNEL_SETUP_FAILED:"SIGNAL_CHANNEL_SETUP_FAILED",ERROR_MESSAGE:"ERROR_MESSAGE",EXCHANGE_SDP_TIMEOUT:"EXCHANGE_SDP_TIMEOUT",DOWNLINK_RECONNECTION_FAILED:"DOWNLINK_RECONNECTION_FAILED",EXCHANGE_SDP_FAILED:"EXCHANGE_SDP_FAILED",UPDATE_OFFER_TIMEOUT:"UPDATE_OFFER_TIMEOUT",UPLINK_RECONNECTION_FAILED:"UPLINK_RECONNECTION_FAILED",INVALID_RECORDID:"INVALID_RECORDID",INVALID_PURE_AUDIO:"INVALID_PURE_AUDIO",INVALID_STREAMID:"INVALID_STREAMID",INVALID_USER_DEFINE_RECORDID:"INVALID_USER_DEFINE_RECORDID",INVALID_USER_DEFINE_PUSH_ARGS:"INVALID_USER_DEFINE_PUSH_ARGS",INVALID_PROXY:"INVALID_PROXY",INVALID_JOIN:"INVALID_JOIN",INVALID_ROOMID_STRING:"INVALID_ROOMID_STRING",INVALID_ROOMID_INTEGER:"INVALID_ROOMID_INTEGER",INVALID_SIGNAL_CHANNEL:"INVALID_SIGNAL_CHANNEL",JOIN_ROOM_TIMEOUT:"JOIN_ROOM_TIMEOUT",JOIN_ROOM_FAILED:"JOIN_ROOM_FAILED",REJOIN_ROOM_FAILED:"REJOIN_ROOM_FAILED",INVALID_DESTROY:"INVALID_DESTROY",INVALID_PUBLISH:"INVALID_PUBLISH",INVALID_UNPUBLISH:"INVALID_UNPUBLISH",INVALID_AUDIENCE:"INVALID_AUDIENCE",INVALID_INITIALIZE:"INVALID_INITIALIZE",INVALID_DUPLICATE_PUBLISHING:"INVALID_DUPLICATE_PUBLISHING",INVALID_SUBSCRIBE_UNDEFINED:"INVALID_SUBSCRIBE_UNDEFINED",INVALID_SUBSCRIBE_LOCAL:"INVALID_SUBSCRIBE_LOCAL",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",SUBSCRIBE_FAILED:"SUBSCRIBE_FAILED",INVALID_ROLE:"INVALID_ROLE",INVALID_PARAMETER_SWITCH_ROLE:"INVALID_PARAMETER_SWITCH_ROLE",INVALID_OPERATION_SWITCH_ROLE:"INVALID_OPERATION_SWITCH_ROLE",SWITCH_ROLE_TIMEOUT:"SWITCH_ROLE_TIMEOUT",SWITCH_ROLE_FAILED:"SWITCH_ROLE_FAILED",CLIENT_BANNED:"CLIENT_BANNED",INVALID_OPERATION_START_PUBLISH_CDN:"INVALID_OPERATION_START_PUBLISH_CDN",INVALID_OPERATION_STOP_PUBLISH_CDN:"INVALID_OPERATION_STOP_PUBLISH_CDN",INVALID_STREAM_ID:"INVALID_STREAM_ID",START_PUBLISH_CDN_FAILED:"START_PUBLISH_CDN_FAILED",STOP_PUBLISH_CDN_FAILED:"STOP_PUBLISH_CDN_FAILED",START_MIX_TRANSCODE:"START_MIX_TRANSCODE",STOP_MIX_TRANSCODE:"STOP_MIX_TRANSCODE",INVALID_AUDIO_VOLUME:"INVALID_AUDIO_VOLUME",ENABLE_SMALL_STREAM_PUBLISHED:"ENABLE_SMALL_STREAM_PUBLISHED",DISABLE_SMALL_STREAM_PUBLISHED:"DISABLE_SMALL_STREAM_PUBLISHED",NOT_SUPPORTED_SMALL_STREAM:"NOT_SUPPORTED_SMALL_STREAM",INVALID_SMALL_STREAM_PROFILE:"INVALID_SMALL_STREAM_PROFILE",INVALID_PARAMETER_REMOTE_STREAM:"INVALID_PARAMETER_REMOTE_STREAM",INVALID_OPERATION_CHANGE_SMALL:"INVALID_OPERATION_CHANGE_SMALL",REMOTE_NOT_PUBLISH_SMALL_STREAM:"REMOTE_NOT_PUBLISH_SMALL_STREAM",INVALID_SWITCH_DEVICE:"INVALID_SWITCH_DEVICE",INVALID_SWITCH_DEVICE_PUBLISHING:"INVALID_SWITCH_DEVICE_PUBLISHING",INVALID_REPLACE_TRACK:"INVALID_REPLACE_TRACK",INVALID_INITIALIZE_LOCAL_STREAM:"INVALID_INITIALIZE_LOCAL_STREAM",INVALID_ADD_TRACK_REPETITIVE:"INVALID_ADD_TRACK_REPETITIVE",INVALID_ADD_TRACK_REMOVING:"INVALID_ADD_TRACK_REMOVING",INVALID_ADD_TRACK_PUBLISHING:"INVALID_ADD_TRACK_PUBLISHING",INVALID_STREAM_INITIALIZED:"INVALID_STREAM_INITIALIZED",INVALID_ADD_TRACK_NUMBER:"INVALID_ADD_TRACK_NUMBER",INVALID_REMOVE_AUDIO_TRACK:"INVALID_REMOVE_AUDIO_TRACK",INVALID_REMOVE_AUDIO_ADDING:"INVALID_REMOVE_AUDIO_ADDING",INVALID_REMOVE_AUDIO_ON:"INVALID_REMOVE_AUDIO_ON",INVALID_REMOVE_TRACK_PUBLISHING:"INVALID_REMOVE_TRACK_PUBLISHING",INVALID_REMOVE_TRACK_NOT_TRACK:"INVALID_REMOVE_TRACK_NOT_TRACK",INVALID_REMOVE_TRACK_NUMBER:"INVALID_REMOVE_TRACK_NUMBER",INVALID_REPLACE_TRACK_NO_TRACK:"INVALID_REPLACE_TRACK_NO_TRACK",REPEAT_JOIN:"REPEAT_JOIN",CLIENT_DESTROYED:"CLIENT_DESTROYED",NOT_BUG_PACKAGE:"NOT_BUG_PACKAGE",START_MIX_TRANSCODE_FAILED:"START_MIX_TRANSCODE_FAILED",STOP_MIX_TRANSCODE_FAILED:"STOP_MIX_TRANSCODE_FAILED",MIX_TRANSCODE_NOT_STARTED:"MIX_TRANSCODE_NOT_STARTED",CANNOT_LESS_THAN_ZERO:"CANNOT_LESS_THAN_ZERO",MIX_PARAMS_VIDEO_FRAMERATE:"MIX_PARAMS_VIDEO_FRAMERATE",MIX_PARAMS_VIDEO_GOP:"MIX_PARAMS_VIDEO_GOP",MIX_PARAMS_AUDIO_BITRATE:"MIX_PARAMS_AUDIO_BITRATE",MIX_PARAMS_USER_Z_ORDER:"MIX_PARAMS_USER_Z_ORDER",MIX_PARAMS_NOT_SELF:"MIX_PARAMS_NOT_SELF",MIX_PARAMS_USER_STREAM:"MIX_PARAMS_USER_STREAM",INVALID_PLAY:"INVALID_PLAY",INVALID_ELEMENT_ID:"INVALID_ELEMENT_ID",INVALID_ELEMENT_ID_TYPE:"INVALID_ELEMENT_ID_TYPE",PLAY_FAILED:"PLAY_FAILED",INVALID_USERID:"INVALID_USERID",INVALID_CREATE_STREAM_SOURCE:"INVALID_CREATE_STREAM_SOURCE",INVALID_CREATE_STREAM_SCREEN:"INVALID_CREATE_STREAM_SCREEN",INVALID_CREATE_STREAM_AUDIO:"INVALID_CREATE_STREAM_AUDIO",INVALID_CREATE_STREAM_SCREEN_AUDIO:"INVALID_CREATE_STREAM_SCREEN_AUDIO",NOT_SUPPORTED_HTTP:"NOT_SUPPORTED_HTTP",NOT_SUPPORTED_WEBRTC:"NOT_SUPPORTED_WEBRTC",NOT_SUPPORTED_PROFILE:"NOT_SUPPORTED_PROFILE",NOT_SUPPORTED_MEDIA:"NOT_SUPPORTED_MEDIA",NOT_SUPPORTED_H264ENCODE:"NOT_SUPPORTED_H264ENCODE",NOT_SUPPORTED_H264DECODE:"NOT_SUPPORTED_H264DECODE",NOT_SUPPORTED_TRACK:"NOT_SUPPORTED_TRACK",NOT_SUPPORTED_SWITCH_DEVICE:"NOT_SUPPORTED_SWITCH_DEVICE",NOT_SUPPORTED_CAPTURE:"NOT_SUPPORTED_CAPTURE",NOT_SUPPORTED_AUX:"NOT_SUPPORTED_AUX",MICROPHONE_NOT_FOUND:"MICROPHONE_NOT_FOUND",CAMERA_NOT_FOUND:"CAMERA_NOT_FOUND",SIGNAL_RESPONSE_FAILED:"SIGNAL_RESPONSE_FAILED",CATCH_HANDLER_ERROR:"CATCH_HANDLER_ERROR",API_NOT_EXIST:"API_NOT_EXIST",CONNECTION_CLOSED:"CONNECTION_CLOSED",SUBSCRIBE_ALL_FALSE:"SUBSCRIBE_ALL_FALSE",SEI_NOT_SUPPORT:"SEI_NOT_SUPPORT",SEI_DISABLED:"SEI_DISABLED",SEI_BEFORE_PUBLISH:"SEI_BEFORE_PUBLISH",SEI_NOT_VIDEO:"SEI_NOT_VIDEO",CALL_FREQUENCY_LIMIT:"CALL_FREQUENCY_LIMIT",CONNECTION_ABORTED:"CONNECTION_ABORTED",API_CALL_ABORTED:"API_CALL_ABORTED",DUPLICATE_AUX:"DUPLICATE_AUX"},sn={AVOID_REPEATED_CALL:e=>"previous ".concat(e.name,"() is ongoing, please avoid repeated calls."),INVALID_PARAMETER_REQUIRED(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' is a required param when calling ").concat(r,"(), received: ").concat(o,".")},INVALID_PARAMETER_TYPE(e){let{key:t,rule:i,fnName:r,value:o}=e,c="".concat(t||i.name),u="";return u=Array.isArray(i.type)?i.type.join("|"):i.type,"'".concat(c,"' must be type of ").concat(u," when calling ").concat(r,"(), received type: ").concat(Ei(o),".")},INVALID_PARAMETER_EMPTY(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' cannot be '").concat(o,"' when calling ").concat(r,"().")},INVALID_PARAMETER_INSTANCE(e){let{key:t,rule:i,fnName:r,value:o}=e,c="".concat(t||i.name),u="".concat(i.instanceOf.name||i.instanceOf);return"'".concat(c,"' must be instanceof ").concat(u," when calling ").concat(r,"(), received type: ").concat(Ei(o),".")},INVALID_PARAMETER_RANGE(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' must be one of ").concat(i.values.join("|")," when calling ").concat(r,"(), received: ").concat(o,".")},INVALID_PARAMETER_MIN(e){let{key:t,rule:i,fnName:r,value:o}=e;return"the min value of ".concat(t||i.name," is ").concat(i.min,", received: ").concat(o,".")},INVALID_PARAMETER_MAX(e){let{key:t,rule:i,fnName:r,value:o}=e;return"the max value of ".concat(t||i.name," is ").concat(i.max,", received: ").concat(o,".")},API_CALL_TIMEOUT:e=>"".concat(e.commandDesc||e.command," timeout observed."),SIGNAL_CHANNEL_RECONNECTION_FAILED:"signal channel reconnection failed, please check your network.",SIGNAL_CHANNEL_SETUP_FAILED:e=>"SignalChannel setup failure: (errorCode: ".concat(e.errorCode,", errorMsg: ").concat(e.errorMsg," })."),ERROR_MESSAGE(e){let t="".concat(e.type," failed");return e.message&&(t="".concat(t,": ").concat(e.message,".")),t},EXCHANGE_SDP_TIMEOUT:"exchange sdp timeout.",DOWNLINK_RECONNECTION_FAILED:"downlink reconnection failed, please check your network and re-join room.",EXCHANGE_SDP_FAILED:e=>"exchange sdp failed ".concat(e.errMsg,"."),UPDATE_OFFER_TIMEOUT:"update offer timeout observed.",UPLINK_RECONNECTION_FAILED:"uplink reconnection failed, please check your network and publish again.",INVALID_RECORDID:"recordId must be an integer number.",INVALID_PURE_AUDIO:"pureAudioPushMode must be 1 or 2.",INVALID_STREAMID:"streamId must be a sting literal within 64 bytes, and not be empty.",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty.",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty.",INVALID_PROXY:'proxy server url must start with "wss://".',INVALID_JOIN:"duplicate join() called.",INVALID_ROOMID_STRING:e=>"'".concat(e,"' must be validate string when useStringRoomId is true."),INVALID_ROOMID_INTEGER:e=>"'".concat(e,"' must be an integer between [1, 4294967294] when useStringRoomId is false."),INVALID_SIGNAL_CHANNEL:"SignalChannel is not ready yet.",JOIN_ROOM_TIMEOUT:"join room timeout.",JOIN_ROOM_FAILED(e){let{error:t,code:i}=e;return"Failed to join room - ".concat(t," code: ").concat(i)},REJOIN_ROOM_FAILED:e=>"reJoin room: ".concat(e.roomId," failed, please check your network."),INVALID_DESTROY:"please call leave() before destroy().",INVALID_PUBLISH:"please call join() before publish().",INVALID_UNPUBLISH:"stream has not been published yet.",INVALID_AUDIENCE:"no permission to publish() under live/".concat("audience",', please call switchRole("',"anchor",'") firstly before publish().'),INVALID_INITIALIZE:"cannot publish stream because stream is not initialized, is switching device, or has been closed.",INVALID_DUPLICATE_PUBLISHING:e=>"duplicate ".concat(e," stream publishing, please unpublish your prev ").concat(e," stream and then re-publish."),INVALID_SUBSCRIBE_UNDEFINED:"stream is undefined or null.",INVALID_SUBSCRIBE_LOCAL:"stream cannot be LocalStream.",INVALID_REMOTE_STREAM:"remoteStream does not exist because it has been unpublished by remote peer.",SUBSCRIBE_FAILED(e){let{message:t,userId:i,streamType:r}=e;return"failed to subscribe ".concat(i," ").concat(r," stream, reason: ").concat(t,".")},INVALID_ROLE:"switchRole can only be called in live mode.",INVALID_PARAMETER_SWITCH_ROLE:"role could only be set to a value as ".concat("anchor"," or ","audience","."),INVALID_OPERATION_SWITCH_ROLE:"please call join() before switchRole().",SWITCH_ROLE_TIMEOUT:"switchRole timeout.",SWITCH_ROLE_FAILED:e=>"switchRole failed, errCode: ".concat(e.code," errMsg: ").concat(e.message,"."),CLIENT_BANNED:e=>"client was banned because of ".concat(e.message,"."),INVALID_OPERATION_START_PUBLISH_CDN:"please call startPublishCDNStream() after join room and publish the local stream.",INVALID_OPERATION_STOP_PUBLISH_CDN:"please call startPublishCDNStream() before stopPublishCDNStream().",START_PUBLISH_CDN_FAILED:e=>"startPublishCDNStream failed, errMsg: ".concat(e.message,"."),STOP_PUBLISH_CDN_FAILED:e=>"stopPublishCDNStream failed, errMsg: ".concat(e.message,"."),INVALID_STREAM_ID:e=>"'".concat(e,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores."),START_MIX_TRANSCODE:"please call startMixTranscode() after join().",STOP_MIX_TRANSCODE:"please call stopMixTranscode() after startMixTranscode().",INVALID_AUDIO_VOLUME:"interval must be a number.",ENABLE_SMALL_STREAM_PUBLISHED:"Cannot enable small stream after localStream published.",DISABLE_SMALL_STREAM_PUBLISHED:"Cannot disable small stream after localStream published.",NOT_SUPPORTED_SMALL_STREAM:"your browser does not support opening small stream.",INVALID_SMALL_STREAM_PROFILE:"small stream profile is invalid.",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream is invalid.",INVALID_OPERATION_CHANGE_SMALL:"cannot switch to the small stream without subscribing to the video of remoteStream.",REMOTE_NOT_PUBLISH_SMALL_STREAM:"remote peer does not publish small stream.",INVALID_SWITCH_DEVICE:"cannot switch device on current stream.",INVALID_SWITCH_DEVICE_PUBLISHING:"cannot switch device when publishing localStream.",INVALID_REPLACE_TRACK:"cannot replace track when publishing localStream.",INVALID_INITIALIZE_LOCAL_STREAM:"local stream has not initialized yet.",INVALID_ADD_TRACK_REPETITIVE:"previous addTrack is ongoing, please avoid repetitive execution.",INVALID_ADD_TRACK_REMOVING:"cannot add track when a track is removing.",INVALID_ADD_TRACK_PUBLISHING:"cannot add track when publishing localStream.",INVALID_STREAM_INITIALIZED:"your local stream haven't been initialized yet.",INVALID_ADD_TRACK_NUMBER:"a Stream has at most one audio track and one video track.",INVALID_REMOVE_AUDIO_TRACK:"remove audio track is not supported on your browser.",INVALID_REMOVE_AUDIO_ADDING:"cannot remove track when a track is adding.",INVALID_REMOVE_AUDIO_ON:"previous removeTrack is ongoing, please avoid repetitive execution.",INVALID_REMOVE_TRACK_PUBLISHING:"cannot remove track when publishing localStream.",INVALID_REMOVE_TRACK_NOT_TRACK:"localStream has not this track.",INVALID_REMOVE_TRACK_NUMBER:"remove the only video track is not supported, please use replaceTrack or muteVideo.",INVALID_REPLACE_TRACK_NO_TRACK:e=>"cannot replace ".concat(e.kind," track because stream has not ").concat(e.kind," track"),NOT_BUG_PACKAGE:"You need to buy packages, refer to tencent console.",START_MIX_TRANSCODE_FAILED:e=>"startMixTranscode failed, errMsg: ".concat(e.message,"."),STOP_MIX_TRANSCODE_FAILED:e=>"stopMixTranscode failed, errMsg: ".concat(e.message,"."),MIX_TRANSCODE_NOT_STARTED:"mixTranscode has not been started.",CANNOT_LESS_THAN_ZERO(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' cannot be less than 0 when calling ").concat(r,"().")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_USER_Z_ORDER:e=>"'".concat(e,"' is required and must be between 1 and 15."),MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_PLAY:"duplicate play() call observed, please stop() firstly.",INVALID_ELEMENT_ID:e=>{let{key:t,fnName:i}=e;return"'".concat(t,"' is not found in the document object when calling ").concat(i,"().")},INVALID_ELEMENT_ID_TYPE:e=>{let{key:t,fnName:i,type:r}=e;return"the element corresponding to '".concat(t,"' must be instanceof HTMLElement when calling ").concat(i,"(), received: ").concat(r,".")},PLAY_FAILED:e=>"".concat(e.media," play failedbrowser exception: ").concat(e.error.toString()),INVALID_USERID:"userId cannot be all spaces.",INVALID_CREATE_STREAM_SOURCE:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSource, but can not be mixed with audio/video and audioSource/videoSource.",INVALID_CREATE_STREAM_SCREEN:"screen/video cannot be both true.",INVALID_CREATE_STREAM_AUDIO:"audio/screenAudio cannot be both true.",INVALID_CREATE_STREAM_SCREEN_AUDIO:"when screen is true, screenAudio can be configured.",NOT_SUPPORTED_HTTP:"http protocol does not support the ability to capture microphone, camera and screen. please use https to deploy your page.",NOT_SUPPORTED_WEBRTC:"your browser or environment does not support full WebRTC capabilities.",NOT_SUPPORTED_PROFILE:"your browser does not support setVideoProfile.",NOT_SUPPORTED_MEDIA:"your browser or environment does not support navigator.mediaDevices.",NOT_SUPPORTED_H264ENCODE:"your device does not support H.264 encoding.",NOT_SUPPORTED_H264DECODE:"your device does not support H.264 decoding.",NOT_SUPPORTED_TRACK:e=>"".concat(e,"Track is not supported on your browser."),NOT_SUPPORTED_SWITCH_DEVICE:"switchDevice is not supported on your browser.",NOT_SUPPORTED_CAPTURE:"Your browser or environment does not support screen sharing, please check whether the browser version.",MICROPHONE_NOT_FOUND:"no microphone detected, please check your microphone.",CAMERA_NOT_FOUND:"no camera detected, please check your camera.",SIGNAL_RESPONSE_FAILED:e=>"".concat(e.signalResponse," failed, response code is ").concat(e.code," , errMsg: ").concat(e.message,"."),CATCH_HANDLER_ERROR(e){let{name:t,event:i}=e;return"an error was caught on ".concat(t,".on('").concat(i,"', handler), please check your code on 'handler'.")},API_NOT_EXIST(e){let{name:t}=e;return"experimental api ".concat(t," does not exist.")},REPEAT_JOIN:e=>"[".concat(e,"] is calling client.join api or has already joined room, please avoid repeated join."),CONNECTION_CLOSED:"remoteStream has been unsubscribed or unpublished by remote user.",SUBSCRIBE_ALL_FALSE:"cannot subscribe when both audio & video are false, use client.unsubscribe() instead",CLIENT_DESTROYED(e){let{funName:t}=e;return"failed to call ".concat(t,"() because client was destroyed.")},SEI_NOT_SUPPORT:e=>"not support to sendSEIMessage".concat(e===!1?" without using h264 codec":""),SEI_DISABLED:"SEI is disabled",SEI_BEFORE_PUBLISH:"please call sendSEIMessage() after publish() success",SEI_NOT_VIDEO:"cannot send sei when localStream has not video.",CALL_FREQUENCY_LIMIT:e=>{let{isSize:t,name:i,timesInSecond:r,maxSizeInSecond:o}=e;return"api ".concat(i," call ").concat(t?"size":"times"," is over ").concat(t?"".concat(o," bytes"):r," in a second.")},CONNECTION_ABORTED:e=>"connection aborted due to: ".concat(e),API_CALL_ABORTED(e){let t;return t=e.message.includes("REMOTE_STREAM_NOT_EXIST")?"Subscribe ".concat(e.userId," ").concat(e.streamType," stream aborted, reason: remote user ").concat(e.userId," unpublished stream."):"API aborted, reason: ".concat(e.message),t},DUPLICATE_AUX:"only one auxiliary stream can be published in a room.",NOT_SUPPORTED_AUX:"publish auxiliary stream is not supported on your browser.",INVALID_PARAMETER_STREAMTYPE:e=>"'streamType' is required when 'userId' is not '*', calling ".concat(e,"()")},$b={};wc($b,{ANDROID_VERSION:()=>G_,CHROME_MAJOR_VERSION:()=>ha,CHROME_VERSION:()=>cg,EDGE_VERSION:()=>J_,EDG_MAJOR_VERSION:()=>nA,EDG_VERSION:()=>Y_,FIREFOX_MAJOR_VERSION:()=>iA,FIREFOX_VERSION:()=>K_,HUAWEI_VERSION:()=>rg,IE_VERSION:()=>hU,IOS_MAIN_VERSION:()=>lg,IOS_VERSION:()=>Ur,IPADQQB_VERSION:()=>ig,IS_ANDROID:()=>Gi,IS_ANDROID_WEBVIEW:()=>lA,IS_ANY_SAFARI:()=>qc,IS_CHROME:()=>zd,IS_CHROME_OS:()=>sA,IS_CHROMIUM_BASE:()=>Yc,IS_EDG:()=>jc,IS_EDGE:()=>Hc,IS_ELECTRON:()=>aA,IS_FIREFOX:()=>Ct,IS_HEADLESS_CHROME:()=>cA,IS_HUAWEI:()=>fU,IS_HUAWEIBROWSER:()=>jd,IS_IE:()=>rA,IS_IE8:()=>dU,IS_IOS:()=>tr,IS_IOS_13_OR_14:()=>dA,IS_IOS_15_1:()=>uA,IS_IPAD:()=>Bc,IS_IPADQQB:()=>Fd,IS_IPAD_PRO:()=>z_,IS_IPHONE:()=>la,IS_IPOD:()=>tA,IS_LINUX:()=>Bd,IS_LOCAL:()=>Vs,IS_MAC:()=>xs,IS_MACQQB:()=>Ud,IS_MIBROWSER:()=>Hd,IS_MQQB:()=>zc,IS_NATIVE_ANDROID:()=>uU,IS_OLD_ANDROID:()=>lU,IS_OPPOBROWSER:()=>Kc,IS_SAFARI:()=>ir,IS_SAFARI_15_1:()=>mU,IS_SAMSUNGBROWSER:()=>Wd,IS_SOGOU:()=>Md,IS_SOGOUM:()=>Pd,IS_TBS:()=>Rn,IS_UCBROWSER:()=>oA,IS_VIVOBROWSER:()=>Jc,IS_WECHAT:()=>xd,IS_WIN:()=>ua,IS_WQQB:()=>Vd,IS_WX:()=>pU,IS_X5MQQB:()=>Wc,IS_XWEB:()=>Ld,MACQQB_VERSION:()=>tg,MI_VERSION:()=>ng,MQQB_VERSION:()=>Gc,OPPO_VERSION:()=>og,SAFARI_VERSION:()=>Xc,SAMSUNG_VERSION:()=>sg,SOGOUM_VERSION:()=>q_,SOGOU_VERSION:()=>X_,TBS_VERSION:()=>Q_,USER_AGENT:()=>on,VIVO_VERSION:()=>ag,WECHAT_VERSION:()=>$_,WQQB_VERSION:()=>eg,XWEB_VERSION:()=>Z_,browserInfo:()=>Fr,getBrowserInfo:()=>hA,getChromeMajorVersion:()=>da,getOSName:()=>dg,getOSString:()=>hg,getOSType:()=>_U,getTerminalType:()=>fA,getUserAgentData:()=>ug,isLocalStorageEnabled:()=>Us});var on=typeof navigator>"u"?"":navigator.userAgent,We=e=>new RegExp(e,"i").test(on),Bt=e=>{if(We(e)){let t=new RegExp("".concat(e,"\\/([\\d.]+)")),i=on.match(t);if(i&&i[1])return i[1]}return""},W_=e=>{if(We(e)){let t=new RegExp("".concat(e,"\\/(\\d+)")),i=on.match(t);if(i&&i[1])return parseFloat(i[1])}return NaN},eA=/AppleWebKit\/([\d.]+)/i.exec(on),cU=eA?parseFloat(eA[1]):NaN,Bc=We("iPad"),z_=typeof navigator<"u"&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&We("Macintosh"),la=We("iPhone")&&!Bc,tA=We("iPod"),tr=la||Bc||tA||z_,Gi=We("Android"),G_=function(){if(Gi){let e=on.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(e){let t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);if(t&&i)return parseFloat("".concat(e[1],".").concat(e[2]));if(t)return t}}return NaN}(),lU=Gi&&We("webkit")&&G_<2.3,uU=Gi&&G_<5&&cU<537,Ct=We("Firefox"),K_=Bt("Firefox"),iA=W_("Firefox"),Hc=We("Edge"),J_=Bt("Edge"),jc=We("Edg"),Y_=Bt("Edg"),nA=W_("Edg"),Pd=We("SogouMobileBrowser"),q_=Bt("SogouMobileBrowser"),Md=We("MetaSr\\s"),X_=Bt("MetaSr\\s"),Rn=We("TBS"),Q_=Bt("TBS"),Ld=We("XWEB"),Z_=Bt("XWEB"),dU=We("MSIE\\s8\\.0"),rA=We("MSIE\\/\\d+"),hU=function(){if(rA){let e=/MSIE\s(\d+)\.\d/.exec(on),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(on)&&/rv:11.0/.test(on)&&(t=11),t}return NaN}(),xd=We("(micromessenger|webbrowser)"),$_=Bt("MicroMessenger"),Wc=!Rn&&We("MQQBrowser")&&We("COVC"),zc=!Rn&&We("MQQBrowser")&&!We("COVC"),Gc=zc||Wc?Bt("MQQBrowser"):"",Vd=!Rn&&We(" QQBrowser"),eg=Bt(" QQBrowser"),Ud=!Rn&&We("QQBrowserLite"),tg=Bt("QQBrowserLite"),Fd=!Rn&&We("MQBHD"),ig=Bt("MQBHD"),ua=We("Windows"),xs=!tr&&We("MAC OS X"),Bd=!Gi&&We("Linux"),sA=We("CrOS"),pU=We("MicroMessenger"),oA=We("UCBrowser"),aA=We("Electron"),Hd=We("MiuiBrowser"),ng=Bt("MiuiBrowser"),jd=We("HuaweiBrowser"),fU=We("Huawei"),rg=Bt("HuaweiBrowser"),Wd=We("SamsungBrowser"),sg=Bt("SamsungBrowser"),Kc=We("HeyTapBrowser"),og=Bt("HeyTapBrowser"),Jc=We("VivoBrowser"),ag=Bt("VivoBrowser"),da=()=>W_("Chrome"),Yc=We("Chrome"),zd=!Hc&&!Md&&!Pd&&!Rn&&!Ld&&!jc&&!Vd&&!Hd&&!jd&&!Wd&&!Kc&&!Jc&&Yc,cA=We("HeadlessChrome"),ha=da(),cg=Bt("Chrome"),ir=!Yc&&!zc&&!Wc&&!Ud&&!Fd&&We("Safari"),qc=ir||tr,Xc=Bt("Version"),lA=/Android.*(wv|.0.0.0)/.test(on),Ur=(()=>{if(z_)return Xc;if(tr){let e=on.match(/OS (\d+)_(\d+)/i);if(e&&e[1]){let t=e[1];return e[2]&&(t+=".".concat(e[2])),t}}return""})(),lg=Number(Ur.split(".")[0]),mU=Xc==="15.1",uA=Ur==="15.1",dA=(()=>{let e=Number(Ur.split(".")[0]);return e===14||e===13})(),Vs=typeof location<"u"&&(location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"),Us=(()=>{let e;return()=>{if(re(e))try{e=!!window.localStorage}catch{e=!1}return e}})(),Fr=hA();function hA(){let e=new Map([[Ct,["Firefox",K_]],[jc,["Edg",Y_]],[zd,["Chrome",cg]],[ir,["Safari",Xc]],[Rn,["TBS",Q_]],[Ld,["XWEB",Z_]],[xd&&la,["WeChat",$_]],[Vd,["QQ(Win)",eg]],[zc,["QQ(Mobile)",Gc]],[Wc,["QQ(Mobile X5)",Gc]],[Ud,["QQ(Mac)",tg]],[Fd,["QQ(iPad)",ig]],[Hd,["MI",ng]],[jd,["HW",rg]],[Wd,["Samsung",sg]],[Kc,["OPPO",og]],[Jc,["VIVO",ag]],[Hc,["EDGE",J_]],[Pd,["SogouMobile",q_]],[Md,["Sogou",X_]]]),t="unknown",i="unknown";return e.has(!0)&&([t,i]=e.get(!0)),{name:t,version:i}}var an=null;function ug(){return B(this,null,function*(){if(an)return an;if(!navigator.userAgentData||!Tt(navigator.userAgentData.getHighEntropyValues))return null;try{return an=yield navigator.userAgentData.getHighEntropyValues(["architecture","bitness","model","platformVersion","fullVersionList"])}catch{return null}})}var pA=new Map([[Gi,"Android"],[tr,"iOS"],[ua,"Windows"],[xs,"MacOS"],[Bd,"Linux"],[sA,"ChromeOS"]]),dg=function(){return pA.get(!0)?pA.get(!0):an?an.platform:"unknown"},hg=()=>{let e=dg();return e+="/".concat(Fr.name,"/").concat(ir?Fr.version:Fr.version.split(".")[0]),an!=null&&an.platformVersion&&(e+="/".concat(an.platformVersion)),an!=null&&an.architecture&&(e+="/".concat(an.architecture)),e};function fA(){return Gi?4:la?2:Bc?3:xs?12:ua?5:Bd?13:1}function _U(){return Gi?"Android":la?"iPhone":Bc?"iPad":xs?"Mac":ua?"Windows":Bd?"Linux":"unknown"}var mA=(e,t)=>t?"".concat(Ps,"/").concat(e,"/").concat(t):"".concat(Ps,"/").concat(e,"/index.html"),gU=()=>{if(window.TRTC_ERROR_INFO&&window.TRTC_ERROR_LINK)return{TRTC_ERROR_INFO:window.TRTC_ERROR_INFO,TRTC_ERROR_LINK:window.TRTC_ERROR_LINK};let e=localStorage.getItem(Ub);if(e){e=JSON.parse(e);let t=document.createElement("script");t.type="text/javascript",t.text=e.message,document.body.appendChild(t);let i=window.TRTC_ERROR_INFO,r=window.TRTC_ERROR_LINK;return document.body.removeChild(t),{TRTC_ERROR_INFO:i,TRTC_ERROR_LINK:r}}return{}};function je(e){let{key:t,data:i,link:r,addDocLink:o=!0}=e,c="",u="",f="";Tt(sn[t])?c=sn[t](i):_t(sn[t])&&(c=sn[t]);let{TRTC_ERROR_INFO:d,TRTC_ERROR_LINK:_}=gU();r?f="".concat(r.className,".html#").concat(r.fnName):_&&_[t]&&(Tt(_[t])?f=_[t](i):_t(_[t])&&(f=_[t]));let E=c;return Hr()&&(d&&d[t]&&(Tt(d[t])?u=d[t](i):_t(d[t])&&(u=d[t])),u&&(E=o?"".concat(u,`
: `).concat(mA("zh-cn",f),`

`):"".concat(u,`

`),E+=c)),o&&(E+=` 
Refer to: `.concat(mA("en",f),`
`)),E}var Be,Qc=function(e){let{retryFunction:t,settings:i,onError:r,onRetrying:o,onRetryFailed:c,onRetrySuccess:u,context:f}=e;return function(){for(var d=arguments.length,_=new Array(d),E=0;E<d;E++)_[E]=arguments[E];let{retries:S=5,timeout:R=1e3}=i,k=0,U=-1,K=0,se=(le,Y)=>B(this,null,function*(){let Re=f||this;try{let Ne=yield t.apply(Re,_);k>0&&u&&u.call(this,k),k=0,le(Ne)}catch(Ne){let Le=()=>{clearTimeout(U),k=0,K=2,Y(Ne)},pt=()=>{K!==2&&k<(Tt(S)?S():S)?(k++,K=1,Tt(o)&&o.call(this,k,Le),U=window.setTimeout(()=>{U=-1,se(le,Y)},Tt(R)?R(k):R)):(Le(),Tt(c)&&c.call(this,Ne))};Tt(r)?r.call(this,{error:Ne,retry:pt,reject:Y,retryFuncArgs:_,retriedCount:k}):pt()}});return new Promise(se)}},pe=new(ni(Di(),1)).default,_A=((Be=_A||{}).ROOM_DESTROY="1",Be.JOIN_START="21",Be.JOIN_SCHEDULE_SUCCESS="22",Be.JOIN_SIGNAL_CONNECTION_START="23",Be.JOIN_SIGNAL_CONNECTION_END="24",Be.JOIN_SEND_CMD="25",Be.JOIN_RECEIVED_CMD_RES="26",Be.JOIN_SUCCESS="27",Be.JOIN_FAILED="28",Be.LEAVE_START="51",Be.LEAVE_SEND_CMD="52",Be.LEAVE_SUCCESS="53",Be.PUBLISH_START="61",Be.SEND_FIRST_VIDEO_FRAME="62",Be.PUBLISH_FAILED="63",Be.SUBSCRIBE_START="81",Be.SUBSCRIBE_SUCCESS="82",Be.SUBSCRIBE_FAILED="84",Be.UNSUBSCRIBE_SUCCESS="83",Be.LOCAL_TRACK_CAPTURE_START="101",Be.LOCAL_TRACK_CAPTURE_SUCCESS="102",Be.LOCAL_TRACK_CAPTURE_FAILED="103",Be.LOCAL_TRACK_PUBLISHED="104",Be.LOCAL_TRACK_UNPUBLISHED="105",Be.LOCAL_TRACK_REPLACED="106",Be.SWITCH_DEVICE_SUCCESS="107",Be.TRACK_MUTED="108",Be.TRACK_UNMUTED="109",Be.REMOTE_TRACK_SUBSCRIBED="110",Be.REMOTE_TRACK_UNSUBSCRIBED="111",Be.PLAY_TRACK_START="151",Be.PLAYER_STATE_CHANGED="152",Be.VIDEO_LOADED_DATA="153",Be.AUTOPLAY_DIALOG_CLICK_CONFIRM="154",Be.SIGNAL_CONNECTION_STATE_CHANGED="201",Be.PEER_CONNECTION_STATE_CHANGED="202",Be.SINGLE_CONNECTION_STAT="203",Be.SPC_RECONNECTED="204",Be.HEARTBEAT_REPORT="251",Be.RECEIVED_PUBLISHED_USER_LIST="252",Be.REMOTE_PUBLISH_STATE_CHANGED="253",Be.AUDIO_LEVEL_INTERVAL="260",Be.NETWORK_QUALITY="261",Be),Ht=new class{constructor(){this._roomIdMap=new Map,typeof registerProcessor>"u"&&(this._configs={sdkAppId:"",userId:"",version:In,env:Ms.QCLOUD,browserVersion:Fr.name+Fr.version,ua:navigator.userAgent})}setConfig(e){let{sdkAppId:t,env:i,userId:r,roomId:o}=e;t!==this._configs.sdkAppId&&(this._configs.sdkAppId=String(t)),this._configs.env=i,this._configs.userId=r,this._roomIdMap.set(r,String(o))}logSuccessEvent(e){Vs||!Te.isAbleToUpload||this._configs.env===Ms.QCLOUD&&this.uploadEventToKibana(qe(Oe({},e),{result:"success"}))}logFailedEvent(e){if(Vs||!Te.isAbleToUpload)return;let{eventType:t,code:i,error:r,userId:o}=e,c={roomId:this._roomIdMap.get(o||this._configs.userId),userId:o,eventType:t,result:"failed",code:i||(r==null?void 0:r.extraCode)||(r==null?void 0:r.code)||ge.UNKNOWN};this._configs.env===Ms.QCLOUD&&this.uploadEventToKibana(qe(Oe({},c),{error:r}))}uploadEventToKibana(e){let t="stat-".concat(e.eventType,"-").concat(e.result);(e.eventType==="delta-join"||e.eventType==="delta-leave"||e.eventType==="delta-publish")&&(t="".concat(e.eventType,":").concat(e.delta)),this.uploadEvent({log:t,userId:e.userId}),e.result==="failed"&&(t="stat-".concat(e.eventType,"-").concat(e.result,"-").concat(e.code),this.uploadEvent({log:t,userId:e.userId,error:e.error}))}uploadEvent(e){let{log:t,userId:i,error:r}=e,o={timestamp:Db(),sdkAppId:this._configs.sdkAppId,userId:i||this._configs.userId,version:In,log:t};r&&(o.errorInfo=r.message),this.sendRequest(Zc(this._configs.sdkAppId,Dc.LOG),o)}sendRequest(e,t){Te.isAbleToUpload?Fc({url:e,body:JSON.stringify(t)}).catch(()=>{}):setTimeout(()=>{this.sendRequest(e,t)},1e3)}},pg=null,fg=!0;function Br(e){Pi(e)&&e!==fg&&(fg=e,Te.info("setIsNeedToSchedule ".concat(e)))}function vU(e){return B(this,arguments,function(t){let{userId:i,sdkAppId:r,useStringRoomId:o,roomId:c,userSig:u,version:f,frameWorkType:d}=t;return function*(){if(!fg&&pg)return{isCached:!0,result:pg};let _={delta:0,count:[1,1],msg:[],detail:[]};try{let E=new FormData;E.append("userId",String(i)),E.append("sdkAppId",String(r)),E.append("isStrGroupId",String(o)),E.append("groupId",String(c)),E.append("sdkVersion",f),E.append("userSig",String(u)),d&&E.append("frameWorkType",String(d));let S=it(),R=yield function(U,K,se){return new Promise((le,Y)=>{let Re=null;gg([yA(Ne=>K.count[0]=Ne+1,Ne=>{let{error:Le,retry:pt,retriedCount:gt,retryFuncArgs:Zr}=Ne;K.msg[0]=Le.message,Re||(gt>=2&&(Zr[0]=pa(se,N.MAIN,!0)),pt())})(pa(se,N.MAIN),U,{get timeout(){return 1e3*el(2+K.count[0])}}),yA(Ne=>K.count[1]=Ne+1,Ne=>{let{error:Le,retry:pt,retriedCount:gt,retryFuncArgs:Zr}=Ne;K.msg[1]=Le.message,Re||(gt>=2&&(Zr[0]=pa(se,N.BACKUP,!0)),pt())})(pa(se,N.BACKUP),U,{get timeout(){return 1e3*el(2+K.count[1])}})]).then(Ne=>{Re=Ne,le(Re)}).catch(Y)})}(E,_,r);R.config&&(R.config.loggerDomain&&Nc(R.config.loggerDomain),Pi(R.config.scheduleCache)&&Br(!R.config.scheduleCache)),_.delta=it()-S;let k=function(U,K,se){let le=performance.getEntriesByType("resource"),Y=pa(U,N.MAIN),Re=pa(U,N.BACKUP),Ne={totalCost:0,local:0,dns:0,tcp:0,tls:0,request:0,response:0};for(let Le of le)if(Le.startTime>=se&&(Le.name===Y||Le.name===Re)&&Le.transferSize>0){let pt=Le.name===Y?N.MAIN:N.BACKUP,gt=Math.round(Le.duration),Zr=Math.round(Le.domainLookupStart-Le.startTime),ci=Math.round(Le.domainLookupEnd-Le.domainLookupStart),Ah=Math.round(Le.requestStart-Le.secureConnectionStart),Dn=Math.round(Le.secureConnectionStart-Le.connectStart),fC=Math.round(Le.responseStart-Le.requestStart),mC=Math.round(Le.responseEnd-Le.responseStart),WF=[Zr,ci,Ah,Dn,fC,mC];Ht.uploadEvent({log:"stat-schedule-net:".concat(gt,"(").concat(WF.join("->"),") ").concat(pt),userId:K}),Ne=qe(Oe({},Ne),{totalCost:gt,local:Zr,dns:ci,tcp:Dn,tls:Ah,request:fC,response:mC});break}return Ne}(Number(r),i,S);return pg=R,{isCached:!1,result:R,detailCost:k}}catch(E){let S=ri(E)?E[0]:E,R=Qt(S.code)?S.code:0,k="schedule failed".concat(S.message?": ".concat(S.message):""),U=new ke({code:ge.SCHEDULE_FAILED,extraCode:R,message:je({key:Ve.JOIN_ROOM_FAILED,data:{error:k,code:R}})});throw Te.error(k,R),U}}()})}document&&document.head.insertAdjacentHTML("beforeend",Object.values(An).map(e=>'<link rel="dns-prefetch" href="https://'.concat(e,'">')).join(`\r
`)),pe.on("28",()=>Br(!0)),pe.on("63",()=>Br(!0)),pe.on("84",()=>Br(!0)),pe.on("201",e=>{e.state==="RECONNECTING"&&Br(!0)}),pe.on("202",e=>{e.state==="RECONNECTING"&&Br(!0)});var Fs={main:"",backup:""};function gA(e){ri(e)?(Fs.main=e[0],Fs.backup=e[1]):Fs.main=e}function pa(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:N.MAIN,i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return"https://".concat(Fs[t]||vA(e,t,i),"/api/v1/config")}function yU(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:N.MAIN;return"https://".concat(Fs[t]||vA(e,t),"/api/v1/trtcAutoConf")}function vA(e){let t,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:N.MAIN,r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return Gd(e)?i===N.MAIN?An.MAIN_OVERSEA:An.BACKUP_OVERSEA:(t=Gd(e)?r?i===N.MAIN?An.MAIN_OVERSEA_OLD:An.BACKUP_OVERSEA_OLD:i===N.MAIN?An.MAIN_OVERSEA:An.BACKUP_OVERSEA:i===N.MAIN?An.MAIN:An.BACKUP,t)}function EU(e,t,i){return new Promise((r,o)=>{Fc({url:e,body:t,timeout:i.timeout}).then(c=>{c.data.code===0?r(c.data.data):o({code:c.data.code,message:c.data.msg})}).catch(o)})}var yA=(e,t)=>Qc({retryFunction:EU,settings:{retries:3,timeout:0},onError:t,onRetrying:e}),TU=function(){return new URLSearchParams(location.search).get("trtc_env")||""},Gd=e=>Number(e)<14e8,Zc=function(e,t){let i;i=N_||(Gd(e)?Vb:xb);let r=Math.floor(Math.random()*I_(2,31));return"".concat(i,"/v5/AVQualityReportSvc/C2S?random=").concat(r,"&sdkappid=").concat(e,"&cmdtype=").concat(t)},$c="unknown";function EA(){if($c!=="unknown")return $c;let{userAgent:e,connection:t}=navigator,i=(e.match(/NetType\/\S+/)||[])[0]||"";i=i.toLowerCase().replace("nettype/",""),i==="3gnet"&&(i="3g");let r=t&&t.type&&t.type.toLowerCase(),o=t&&t.effectiveType&&t.effectiveType.toLowerCase();return o==="slow-2"&&(o="2g"),r&&($c=TA(r,o)),$c}function TA(e,t){if(O_[e])return e;switch(e){case"cellular":case"wimax":return t||"unknown";case"ethernet":return"wired";default:return"unknown"}}function SA(e){$c=TA(e)}function Kd(){return O_[EA()]}function SU(e,t){for(let i of Reflect.ownKeys(t))if(i!=="constructor"&&i!=="prototype"&&i!=="name"){let r=Object.getOwnPropertyDescriptor(t,i)||"";Object.defineProperty(e,i,r)}return e}function IU(e){return IA(e/4,arguments.length>1&&arguments[1]!==void 0?arguments[1]:48e3)}function IA(e){return 1e3*e/(arguments.length>1&&arguments[1]!==void 0?arguments[1]:48e3)}function bU(e){return 4*bA(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:48e3)}function bA(e){return e*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:48e3)/1e3}var AU=typeof window<"u"&&typeof window.glog=="function"?window.glog:()=>{},Hr=()=>{let e=navigator.language;return e=e.substring(0,2),e==="zh"},nr=function(e){if(!e||typeof e!="object"||Object.prototype.toString.call(e)!="[object Object]")return!1;let t=Object.getPrototypeOf(e);if(t===null)return!0;let i=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Function.prototype.toString.call(i)===Function.prototype.toString.call(Object)};function el(e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return e<=1?t:el(e-1,t,(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)+t)}function fa(e){return e>8?3e4:1e3*el(e)}function Ei(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}var Tt=e=>typeof e=="function",re=e=>e===void 0,_t=e=>typeof e=="string",Qt=e=>typeof e=="number",Pi=e=>typeof e=="boolean",jr=e=>Ei(e)==="object",ri=e=>Ei(e)==="array",RU=e=>Ei(e)==="MediaStreamTrack".toLowerCase(),ma=e=>e.isRemote,mg=e=>Ei(e)==="promise",_g=e=>Tt(e)&&e.prototype.constructor===e,AA=e=>_g(e)?e.prototype.constructor.name:"",CU=typeof AudioWorkletNode<"u";function gg(e){return new Promise((t,i)=>{let r=[];e.forEach(o=>{o.then(t).catch(c=>{r.push(c),r.length===e.length&&i(r)})})})}function it(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}var RA=e=>+e<10?"0".concat(e):e,wU=e=>{let t=e.match(/^\d+\.\d+\.\d+/)[0];if(!t)return e;let i=t.split("."),r=RA(i[1])+RA(i[2]);return i[1]-15>0&&(i[1]="15"),i[2]-15>0&&(i[2]="15"),"".concat(i.join("."),".").concat(r)},kU=Object.prototype.hasOwnProperty;function CA(e){if(e==null)return!0;if(typeof e=="boolean")return!1;if(typeof e=="number")return e===0;if(typeof e=="string"||typeof e=="function"||Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(nr(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return e.size===0;case"[object Object]":for(let t in e)if(kU.call(e,t))return!1;return!0}return!1}function tl(e,t){return{userId:t,hasAudio:!!(e&Pc),hasVideo:!!(e&Oc),hasAuxiliary:!!(e&Cd),hasSmall:!!(e&x_),audioMuted:!!(e&V_),videoMuted:!!(e&U_),audioAvailable:!(!(e&Pc)||e&V_),videoAvailable:!(!(e&Oc)||e&U_)}}function NU(e){let t={urls:"turn:".concat(e.url)};return!re(e.username)&&!re(e.credential)&&(t.username=e.username,t.credential=e.credential,t.credentialType="password",re(e.credentialType)||(t.credentialType=e.credentialType)),t}function Jd(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!_t(e))return 0;let i=e.split(".");return t?(Number(i[0])<<24|Number(i[1])<<16|Number(i[2])<<8|Number(i[3]))>>>0:(Number(i[3])<<24|Number(i[2])<<16|Number(i[1])<<8|Number(i[0]))>>>0}var Bs=function(e,t,i,r){if(!jr(e)||!jr(t))return 0;let o,c=0,u=Object.keys(t);for(let f=0,d=u.length;f<d;f++)if(o=u[f],!(re(t[o])||i&&i.includes(o)))if(jr(e[o])&&jr(t[o]))c+=Bs(e[o],t[o],i,r);else{if(r&&r.includes(t[o]))continue;e[o]!==t[o]&&(e[o]=il(t[o]),c+=1)}return c};function il(e){if(ri(e)){let t=[];return e.forEach((i,r)=>{t[r]=il(i)}),t}if(jr(e)){let t={};return Object.keys(e).forEach(i=>{t[i]=il(e[i])}),t}return e}var Yd=e=>{let t=[];if(ri(e))t=[...e];else if(_t(e)){let i=document.getElementById(e);i&&t.push(i)}else e&&t.push(e);return t},DU=e=>_t(e)?document.getElementById(e):e,OU=new Intl.DateTimeFormat("zh-CN",{dateStyle:"short",timeStyle:"medium"}),PU=()=>OU.format(new Date);function rr(e,t){let{keysToInclude:i,keysToExclude:r}=t;try{if(ri(e))return"[".concat(e.map(f=>rr(f,{keysToInclude:i,keysToExclude:r})).join(","),"]");if(!nr(e)||!ri(i)&&!ri(r))return JSON.stringify(e);let o={},c=new Set(i),u=new Set(r);return Object.keys(e).forEach(f=>{(u.size===0&&c.has(f)||c.size===0&&!u.has(f))&&(o[f]=nr(e[f])||ri(e[f])?JSON.parse(rr(e[f],{keysToExclude:r,keysToInclude:i})):e[f])}),JSON.stringify(o)}catch{return"{}"}}function wA(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=[];return Object.keys(e).forEach(r=>{t===e[r]&&i.push(r)}),rr(e,{keysToInclude:i})}function vg(e){return e.replace(/[\u4e00-\u9fa5]/g,"aa").length}var kA=()=>{var e,t,i,r;return(e=window.screen)!=null&&e.orientation?!((r=(i=(t=window.screen)==null?void 0:t.orientation)==null?void 0:i.type)==null||!r.includes("portrait")):window.orientation===0||window.orientation===180},qd=e=>B(void 0,null,function*(){return new Promise((t,i)=>{let r;if(_t(e))r=new Image,r.crossOrigin="anonymous",r.src=e;else if(r=e,r.complete)return void t(r);r.onload=()=>t(r),r.onerror=i})}),NA=e=>{let t=e.split(".");return+t[0]<<24|+t[1]<<16|+t[2]<<8|+t[3]},yg=e=>(Object.keys(e).forEach(t=>{Qt(e[t])&&(t.startsWith("uint")||t.startsWith("int"))?e[t]=Math.floor(e[t]):(nr(e[t])||ri(e[t]))&&yg(e[t])}),e),MU=Object.prototype.hasOwnProperty;function LU(e){if(e==null)return!0;if(typeof e=="boolean")return!1;if(typeof e=="number")return e===0;if(typeof e=="string"||typeof e=="function"||Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(function(t){if(!t||typeof t!="object"||Object.prototype.toString.call(t)!="[object Object]")return!1;let i=Object.getPrototypeOf(t);if(i===null)return!0;let r=Object.prototype.hasOwnProperty.call(i,"constructor")&&i.constructor;return typeof r=="function"&&r instanceof r&&Function.prototype.toString.call(r)===Function.prototype.toString.call(Object)}(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return e.size===0;case"[object Object]":for(let t in e)if(MU.call(e,t))return!1;return!0}return!1}var xU=class{constructor(e){b(this,"userId"),b(this,"remoteUserId"),b(this,"id"),b(this,"sdkAppId"),b(this,"type"),b(this,"isLocal"),this.id=e.id,this.userId=e.userId,this.sdkAppId=e.sdkAppId,this.remoteUserId=e.remoteUserId,this.isLocal=typeof e.isLocal!="boolean"||e.isLocal,this.type=this.isLocal?"":e.type}createChild(e){return Object.setPrototypeOf(e,this)}setUserId(e){this.userId=e}setSdkAppId(e){this.sdkAppId=e}log(e,t){let i=this.isLocal?this.userId:this.remoteUserId;t.unshift("[".concat(this.isLocal?"":"").concat(this.type&&this.type!=="main"?"*":"").concat(this.id).concat(i?"|".concat(i):"","]")),Te.log(e,t,this.userId===void 0||LU(this.userId),this.userId,this.sdkAppId)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(2,t)}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(1,t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(3,t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(4,t)}},oe=_A,VU=!(tr||Gi||cA),Te=new class{constructor(){b(this,"_isEnableUploadLog",!0),b(this,"_localJoinedUser",new Map),b(this,"_queue",[]),b(this,"_timeoutId",-1),b(this,"_logLevel",1),b(this,"_logLevelToUpload",2),!Rd&&!k_&&(this.checkURLParam(),this.installEvents())}get isAbleToUpload(){return this._isEnableUploadLog&&this._timeoutId!==-1}installEvents(){pe.on(oe.JOIN_SCHEDULE_SUCCESS,e=>{let{schedule:t}=e;var i;(i=t==null?void 0:t.config)!=null&&i.logLevelToUpload&&Lr[t.config.logLevelToUpload]&&(this._logLevelToUpload=t.config.logLevelToUpload)}),pe.on(oe.JOIN_SUCCESS,e=>{let{room:t}=e;this.addJoinedUser({userId:t.userId,sdkAppId:t.sdkAppId}),this.startUpload()}),pe.once(oe.JOIN_FAILED,()=>{this.startUpload()}),pe.on(oe.LEAVE_SUCCESS,e=>{let{room:t}=e;this.deleteJoinedUser(t.userId)})}startUpload(){this._timeoutId===-1&&this.uploadInterval()}addJoinedUser(e){this._localJoinedUser.set(e.userId,e),this.startUpload()}deleteJoinedUser(e){this._localJoinedUser.delete(e)}uploadInterval(){this.upload().catch(()=>{}),this._timeoutId=window.setTimeout(()=>this.uploadInterval(),2e3)}getLogsToUpload(){let e={map:new Map,splicedQueue:[]};if(this._queue[0].forAllJoinedClients&&this._localJoinedUser.size===0)return e;let t=0;for(;t<this._queue.length&&t!==50;t++){let i=this._queue[t];if(i.forAllJoinedClients)this._localJoinedUser.forEach(r=>{let{userId:o,sdkAppId:c}=r;e.map.has(o)?e.map.get(o).logs.push(i):e.map.set(o,{userId:o,sdkAppId:c,logs:[i]})});else if(_t(i.userId)&&Qt(i.sdkAppId)){let{userId:r,sdkAppId:o}=i;e.map.has(r)?e.map.get(r).logs.push(i):e.map.set(r,{userId:r,sdkAppId:o,logs:[i]})}}return e.map.size>0&&(e.splicedQueue=this._queue.splice(0,t)),e}upload(){return B(this,null,function*(){if(this._queue.length===0||!this._isEnableUploadLog)return;let{map:e,splicedQueue:t}=this.getLogsToUpload();if(e.size===0)return;try{let r=[...e.values()];for(let o=0;o<r.length;o++){let{userId:c,sdkAppId:u,logs:f}=r[o];yield this.uploadLogWithRetry(JSON.stringify({timestamp:Db(),sdkAppId:String(u),userId:c,version:In,log:f.map(d=>d.log).join(`
`)}),u),f.forEach(d=>d.uploaded=!0)}}catch{}let i=t.filter(r=>!r.uploaded);i.length>0&&(this._queue=i.concat(this._queue))})}uploadLogWithRetry(e,t){return Qc({retryFunction:()=>Fc({url:Zc(t,Dc.LOG),body:e,timeout:5e3}),settings:{retries:3,timeout:1e3},onError:i=>{let{retry:r}=i;r()}})()}getPrefix(e){let t=new Date;t.setTime(R_());let i=String(t.getMilliseconds());return"padStart"in String.prototype&&(i=i.toString().padStart(3,"0")),"[".concat(t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(i,"] <").concat(Lr[e],">")}getLogLevel(){return this._logLevel}setLogLevel(e){re(Lr[e])||(this._logLevel!==e&&this.info("setLogLevel",e),this._logLevel=e)}enableUploadLog(){this._isEnableUploadLog=!0}disableUploadLog(){this.warn("disableUploadLog"),this._isEnableUploadLog=!1}logChunkToString(e){if(_t(e))return e;try{return e instanceof Error?e.toString():JSON.stringify(e)}catch{return""}}log(e,t){let i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;var c;if(t.unshift(this.getPrefix(e)),this._isEnableUploadLog&&e>=this._logLevelToUpload&&this._queue.push({log:t.reduce((f,d)=>"".concat(f," ").concat(this.logChunkToString(d)).trim(),""),level:e,userId:r,sdkAppId:o,forAllJoinedClients:i}),e<this._logLevel)return;let u=((c=Lr[e])==null?void 0:c.toLowerCase())||"info";VU?console[u]("%cTRTC%c%s","padding: 1px 4px;border-radius: 3px;color: #fff;background: #1E88E5;","display: inline",...t):console[u](...t)}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(1,t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(2,t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(3,t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(4,t)}createLogger(e){return new xU(e)}checkURLParam(){let e=new URLSearchParams(location.search).get("logLevelToUpload"),t=e?Number(e):-1;Lr[t]&&(this._logLevelToUpload=t)}},DA=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return(e=="x"?t:3&t|8).toString(16)})},_a=new class{constructor(){b(this,"_prefix","TRTC"),b(this,"_queue",new Map),this.checkStorage()}getRealKey(e){return"".concat(this._prefix,"_").concat(e)}checkStorage(){Us()&&(setInterval(this.doFlush.bind(this),2e4),Object.keys(localStorage).filter(e=>{if(e.startsWith(this._prefix)){let t=localStorage.getItem(e);if(!t)return!1;let i=JSON.parse(t);if(i&&i.expiresIn<Date.now())return!0}return!1}).forEach(e=>localStorage.removeItem(e)))}doFlush(){if(Us())try{for(let[e,t]of this._queue)localStorage.setItem(e,JSON.stringify(t))}catch(e){Te.warn(e)}}getItem(e){if(!Us())return null;try{let t=localStorage.getItem(this.getRealKey(e));if(!t)return null;let i=JSON.parse(t);return i&&i.expiresIn>=Date.now()?i.value:null}catch(t){Te.warn(t)}}setItem(e,t){if(Us())try{let i={expiresIn:Date.now()+Fb,value:t};this._queue.set(this.getRealKey(e),i)}catch(i){Te.warn(i)}}deleteItem(e){if(!Us())return!1;try{return e=this.getRealKey(e),this._queue.delete(e),localStorage.removeItem(e),!0}catch(t){return Te.warn(t),!1}}clear(){if(Us())try{localStorage.clear()}catch(e){Te.warn(e)}}},nl={};wc(nl,{HTTPS_API:()=>jU,IS_GET_CAPABILITIES_SUPPORTED:()=>BA,IS_GET_SETTINGS_SUPPORTED:()=>ga,IS_SEI_SUPPORTED:()=>sl,IS_SPC_SUPPORTED:()=>eh,basis:()=>GU,checkSystemRequirementsInternal:()=>bg,decodeSupportStatus:()=>Ig,encodeSupportStatus:()=>Sg,getBrowserInfo:()=>FU,getDisplayResolution:()=>LA,isAddTransceiverSupported:()=>sr,isBrowserSupported:()=>Eg,isGetReceiversSupported:()=>Zd,isGetSendersSupported:()=>$d,isGetTransceiversSupported:()=>Wr,isGetUserMediaSupported:()=>xA,isMediaDevicesSupported:()=>Tg,isMediaSessionSupported:()=>jA,isMediaStreamTrackProcessorSupported:()=>BU,isReplaceTrackSupported:()=>FA,isScreenCaptureApiAvailable:()=>Xd,isSelectedCandidatePair:()=>rl,isSetParametersSupported:()=>Ag,isSmallStreamAPISupported:()=>UA,isSmallStreamSupported:()=>Qd,isStopTransceiverSupported:()=>zU,isTRTCSupported:()=>HU,isUnifiedPlanDefault:()=>WU,isUsedInHttpProtocol:()=>Hs,isWebAudioSupported:()=>VA,isWebCodecSupported:()=>HA,isWebCodecsSupported:()=>PA,isWebRTCSupported:()=>Rg,isWebTransportSupported:()=>WA});var OA=ni(x8(),1),$e={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isWebCodecsSupported:!1,isMediaDevicesSupported:!1,isScreenShareSupported:!1,isSmallStreamSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}},UU=new Map([[Ct,["Firefox",K_]],[jc,["Edg",Y_]],[zd,["Chrome",cg]],[ir,["Safari",Xc]],[Rn,["TBS",Q_]],[Ld,["XWEB",Z_]],[xd&&la,["WeChat",$_]],[Vd,["QQ(Win)",eg]],[zc,["QQ(Mobile)",Gc]],[Wc,["QQ(Mobile X5)",Gc]],[Ud,["QQ(Mac)",tg]],[Fd,["QQ(iPad)",ig]],[Hd,["MI",ng]],[jd,["HW",rg]],[Wd,["Samsung",sg]],[Kc,["OPPO",og]],[Jc,["VIVO",ag]],[Hc,["EDGE",J_]],[Pd,["SogouMobile",q_]],[Md,["Sogou",X_]]]);function FU(){let e=UU.get(!0);return{browserName:e?e[0]:"unknown",browserVersion:e?e[1]:"unknown"}}var Eg=function(){return!(oA||Hc||jc&&nA<80||Ct&&iA<56)},PA=function(){return["VideoDecoder","VideoEncoder","AudioEncoder","AudioDecoder","MediaStreamTrackGenerator"].every(e=>e in window)},Tg=function(){if(!navigator.mediaDevices)return Hs()||Te.error(sn.NOT_SUPPORTED_MEDIA),!1;let e=["getUserMedia","enumerateDevices"];return e.filter(t=>t in navigator.mediaDevices).length===e.length},MA=!1;function Hs(){return location.protocol==="http:"&&!Vs&&(MA||Te.error(je({key:Ve.NOT_SUPPORTED_HTTP})),MA=!0,!0)}var BU=function(){return(window==null?void 0:window.OffscreenCanvas)&&(window==null?void 0:window.MediaStreamTrackProcessor)&&(window==null?void 0:window.MediaStreamTrackGenerator)},Sg=function(){return B(this,null,function*(){if($e.detail.isH264EncodeSupported&&$e.detail.isVp8EncodeSupported)return{isH264EncodeSupported:$e.detail.isH264EncodeSupported,isVp8EncodeSupported:$e.detail.isVp8EncodeSupported};let e,t=!1,i=!1;try{let r=new RTCPeerConnection,o=document.createElement(N.CANVAS);o.getContext("2d");let c=o.captureStream(0);return r.addTrack(c.getVideoTracks()[0],c),e=yield r.createOffer(),e.sdp.toLowerCase().indexOf("h264")!==-1&&(t=!0),e.sdp.toLowerCase().indexOf("vp8")!==-1&&(i=!0),r.close(),$e.detail.isH264EncodeSupported=t,$e.detail.isVp8EncodeSupported=i,{isH264EncodeSupported:$e.detail.isH264EncodeSupported,isVp8EncodeSupported:$e.detail.isVp8EncodeSupported}}catch{return{isH264EncodeSupported:!1,isVp8EncodeSupported:!1}}})},Ig=function(){return B(this,null,function*(){if($e.detail.isH264DecodeSupported&&$e.detail.isVp8DecodeSupported)return{isH264DecodeSupported:$e.detail.isH264DecodeSupported,isVp8DecodeSupported:$e.detail.isVp8DecodeSupported};let e,t=!1,i=!1;try{let r=new RTCPeerConnection;return e=yield r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}),e.sdp.toLowerCase().indexOf("h264")!==-1&&(t=!0),e.sdp.toLowerCase().indexOf("vp8")!==-1&&(i=!0),r.close(),{isH264DecodeSupported:t,isVp8DecodeSupported:i}}catch{return{isH264DecodeSupported:!1,isVp8DecodeSupported:!1}}})},bg=function(){return B(this,null,function*(){if($e.result&&$e.detail.isH264EncodeSupported&&$e.detail.isVp8EncodeSupported&&$e.detail.isH264DecodeSupported&&$e.detail.isVp8DecodeSupported)return $e;let e=Eg(),t=Rg(),i=PA(),r=Tg(),{isH264EncodeSupported:o,isVp8EncodeSupported:c}=yield Sg(),{isH264DecodeSupported:u,isVp8DecodeSupported:f}=yield Ig();if(!o||!c){let d=yield Sg();Te.warn("detect encode again h264:".concat(o," vp8:").concat(c," result: ").concat(JSON.stringify(d))),o=d.isH264EncodeSupported,c=d.isVp8EncodeSupported}if(o&&u&&(Kc||Jc||lA)&&!Rn&&da()<79){let{encode:d,decode:_}=yield function(){return B(this,null,function*(){return new Promise(E=>B(this,null,function*(){let S={encode:!1,decode:!1},R=()=>{};try{Te.warn("start detect h264 supported by encoding and decoding canvas stream");let k=document.createElement("canvas"),U=k.getContext("2d");k.width=640,k.height=480;let K=setInterval(()=>{U.fillText("test",Math.floor(640*Math.random()),Math.floor(480*Math.random()))},33),se=-1,le=-1;R=()=>{clearInterval(se),clearInterval(K),clearTimeout(le),Re.close(),Ne.close(),Y.getTracks().forEach(ci=>ci.stop())},le=setTimeout(()=>{R(),E(S)},3e3);let Y=k.captureStream(),Re=new RTCPeerConnection({}),Ne=new RTCPeerConnection({offerToReceiveAudio:!0,offerToReceiveVideo:!0});Re.addEventListener("icecandidate",ci=>Ne.addIceCandidate(ci.candidate)),Ne.addEventListener("icecandidate",ci=>Re.addIceCandidate(ci.candidate)),Re.addTrack(Y.getVideoTracks()[0],Y);let Le=yield Re.createOffer();yield Re.setLocalDescription(Le),yield Ne.setRemoteDescription(Le);let pt=yield Ne.createAnswer(),gt=OA.default.parse(pt.sdp),Zr=gt.media[0].rtp.findIndex(ci=>ci.codec==="H264");gt.media[0].rtp=[gt.media[0].rtp[Zr]],gt.media[0].fmtp=gt.media[0].fmtp.filter(ci=>ci.payload===gt.media[0].rtp[0].payload),gt.media[0].rtcpFb&&(gt.media[0].rtcpFb=gt.media[0].rtcpFb.filter(ci=>ci.payload===gt.media[0].rtp[0].payload)),pt.sdp=OA.default.write(gt),yield Ne.setLocalDescription(pt),yield Re.setRemoteDescription(pt),se=setInterval(()=>B(this,null,function*(){S.encode&&S.decode&&(R(),E(S));let ci=yield Re.getStats(),Ah=yield Ne.getStats();S.encode||ci.forEach(Dn=>{Dn.type==="outbound-rtp"&&Dn.mediaType===N.VIDEO&&Dn.framesEncoded>0&&(S.encode=!0)}),S.decode||Ah.forEach(Dn=>{Dn.type==="inbound-rtp"&&Dn.mediaType===N.VIDEO&&Dn.framesDecoded>0&&(S.decode=!0)})}),500)}catch(k){R(),Te.warn(k),E(S)}}))})}();o=d,u=_}return $e.result=e&&t&&r&&(o||c)&&(u||f),$e.detail.isBrowserSupported=e,$e.detail.isWebRTCSupported=t,$e.detail.isWebCodecsSupported=i,$e.detail.isMediaDevicesSupported=r,$e.detail.isScreenShareSupported=Xd(),$e.detail.isSmallStreamSupported=Qd(),$e.detail.isH264EncodeSupported=o,$e.detail.isVp8EncodeSupported=c,$e.detail.isH264DecodeSupported=u,$e.detail.isVp8DecodeSupported=f,$e.result||Te.error("".concat(navigator.userAgent," ").concat(wA($e.detail,!1))),_a.setItem(zA,{ua:navigator.userAgent,checkResult:$e}),$e})},HU=function(){return $e.result},Xd=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},jU=(e,t,i)=>{location.protocol==="http:"&&!Vs&&(e[t]=()=>{throw new ke({code:ge.INVALID_OPERATION,message:sn.NOT_SUPPORTED_HTTP})})},rl=function(e){return!(e.type!=="candidate-pair"||!e.nominated||e.state!=="in-progress"&&e.state!=="succeeded")&&!(Pi(e.selected)&&!e.selected)};function LA(){let e="";if(screen.width){let t=screen.width?screen.width*window.devicePixelRatio:"",i=screen.height?screen.height*window.devicePixelRatio:"";e+="".concat(t," * ").concat(i)}return e}function xA(){return navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function VA(){let e={isSupported:!1},t=["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"];for(let i=0;i<t.length;i++)if(t[i]in window){e.isSupported=!0;break}return e.isSupported}function UA(){return"captureStream"in HTMLCanvasElement.prototype}function Qd(){return!(xd||tr||ha&&ha<63)&&!(!Eg()||!UA())}var WU=function(){if(re(window.RTCRtpTransceiver)||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=null,t=!1;try{e=new RTCPeerConnection({sdpSemantics:Mc}),e.addTransceiver(N.AUDIO),t=!0}catch{}return e==null||e.close(),t};function Zd(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype}function $d(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype}function Wr(){return"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype}function sr(){return lg!==11&&"RTCPeerConnection"in window&&"addTransceiver"in window.RTCPeerConnection.prototype}var eh=!(!sr()||Yc&&ha<74);function zU(){return"RTCRtpTransceiver"in window&&"stop"in window.RTCRtpTransceiver.prototype}function FA(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype}function Ag(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&$d()}var ga=window.MediaStreamTrack&&"getSettings"in MediaStreamTrack.prototype,BA=window.MediaStreamTrack&&"getCapabilities"in MediaStreamTrack.prototype,sl="RTCRtpSender"in window&&"createEncodedStreams"in window.RTCRtpSender.prototype&&da()>=86,Rg=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter(e=>e in window).length>0};function HA(){let e={AudioDecoder:!1,AudioEncoder:!1,VideoDecoder:!1,VideoEncoder:!1,ImageDecoder:!1};return re(window.AudioDecoder)||(e.AudioDecoder=!0),re(window.AudioEncoder)||(e.AudioEncoder=!0),re(window.VideoDecoder)||(e.VideoDecoder=!0),re(window.VideoEncoder)||(e.VideoEncoder=!0),re(window.ImageDecoder)||(e.ImageDecoder=!0),e}function jA(){return"mediaSession"in navigator&&!re(navigator.mediaSession.setActionHandler)}function WA(){return!re(window.WebTransport)}function GU(){let e={browser:"".concat(Fr.name,"/").concat(Fr.version),os:dg(),displayResolution:LA(),isScreenShareSupported:Xd(),isWebRTCSupported:Rg(),isGetUserMediaSupported:xA(),isWebAudioSupported:VA(),isWebSocketsSupported:"WebSocket"in window&&window.WebSocket.CLOSING===2,isWebCodecSupported:HA(),isMediaSessionSupported:jA(),isWebTransportSupported:WA()};return navigator.userAgent.includes("miniProgram")&&(e.browser="mini/".concat(e.browser)),e}var zA="checkResult";(function(){Hs();let e=_a.getItem(zA);e&&e.ua===navigator.userAgent&&($e=e.checkResult),bg()})();var KU=ni(Di(),1),GA=Symbol("instance"),th=Symbol("cacheResult"),Cg=class{constructor(e,t,i){this.oldState=e,this.newState=t,this.action=i,this.aborted=!1}abort(e){this.aborted=!0,al.call(e,this.oldState,new Error("action '".concat(this.action,"' aborted")))}toString(){return"".concat(this.action,"ing")}},wg=class extends Error{constructor(e,t,i){super(t),this.state=e,this.message=t,this.cause=i}},ol=new Map;function si(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(r,o,c)=>{let u=i.action||o;if(!i.context){let d=ol.get(r)||[];ol.has(r)||ol.set(r,d),d.push({from:e,to:t,action:u})}let f=c.value;c.value=function(){let d=this;for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];if(i.context&&(d=Ze.get(typeof i.context=="function"?i.context.call(this,...E):i.context)),d.state===t)return i.sync?d[th]:Promise.resolve(d[th]);d.state instanceof Cg&&d.state.action==i.abortAction&&d.state.abort(d);let R=null;Array.isArray(e)?e.length==0?d.state instanceof Cg&&d.state.abort(d):(typeof d.state!="string"||!e.includes(d.state))&&(R=new wg(d._state,"".concat(d.name," ").concat(u," to ").concat(t," failed: current state ").concat(d._state," not from ").concat(e.join("|")))):e!==d.state&&(R=new wg(d._state,"".concat(d.name," ").concat(u," to ").concat(t," failed: current state ").concat(d._state," not from ").concat(e)));let k=Y=>{if(i.fail&&i.fail.call(this,Y),i.sync){if(i.ignoreError)return Y;throw Y}return i.ignoreError?Promise.resolve(Y):Promise.reject(Y)};if(R)return k(R);let U=d.state,K=new Cg(U,t,u);al.call(d,K);let se=Y=>{var Re;return d[th]=Y,K.aborted||(al.call(d,t),(Re=i.success)===null||Re===void 0||Re.call(this,d[th])),Y},le=Y=>{let Re=Y instanceof Error?Y.message:String(Y);return al.call(d,U,Y),k(new wg(d._state,"action '".concat(u,"' failed :").concat(Re),Y instanceof Error?Y:new Error(Re)))};try{let Y=f.apply(this,E);return function(Re){return typeof Re=="object"&&Re&&"then"in Re}(Y)?Y.then(se).catch(le):i.sync?se(Y):Promise.resolve(se(Y))}catch(Y){return le(Y)}}}}var JU=typeof window<"u"&&window.__AFSM__?(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))}:typeof importScripts<"u"?(e,t)=>{postMessage({type:e,payload:t})}:()=>{};function al(e,t){let i=this._state;this._state=e;let r=e.toString();e&&this.emit(r,i),this.emit(Ze.STATECHANGED,e,i,t),this.updateDevTools({value:e,old:i,err:t instanceof Error?t.message:String(t)})}var Ze=class extends KU.default{constructor(e,t,i){super(),this.name=e,this.groupName=t,this._state=Ze.INIT,e||(e=Date.now().toString(36)),i?Object.setPrototypeOf(this,i):i=Object.getPrototypeOf(this),t||(this.groupName=this.constructor.name);let r=i[GA];r?this.name=r.name+"-"+r.count++:i[GA]={name:this.name,count:0},this.updateDevTools({diagram:this.stateDiagram})}get stateDiagram(){let e=Object.getPrototypeOf(this),t=ol.get(e)||[],i=new Set,r=[],o=[],c=new Set,u=Object.getPrototypeOf(e);ol.has(u)&&(u.stateDiagram.forEach(d=>i.add(d)),u.allStates.forEach(d=>c.add(d))),t.forEach(d=>{let{from:_,to:E,action:S}=d;typeof _=="string"?r.push({from:_,to:E,action:S}):_.length?_.forEach(R=>{r.push({from:R,to:E,action:S})}):o.push({to:E,action:S})}),r.forEach(d=>{let{from:_,to:E,action:S}=d;c.add(_),c.add(E),c.add(S+"ing"),i.add("".concat(_," --> ").concat(S,"ing : ").concat(S)),i.add("".concat(S,"ing --> ").concat(E," : ").concat(S," ")),i.add("".concat(S,"ing --> ").concat(_," : ").concat(S," "))}),o.forEach(d=>{let{to:_,action:E}=d;i.add("".concat(E,"ing --> ").concat(_," : ").concat(E," ")),c.forEach(S=>{S!==_&&i.add("".concat(S," --> ").concat(E,"ing : ").concat(E))})});let f=[...i];return Object.defineProperties(e,{stateDiagram:{value:f},allStates:{value:c}}),f}static get(e){let t;return typeof e=="string"?(t=Ze.instances.get(e),t||Ze.instances.set(e,t=new Ze(e,void 0,Object.create(Ze.prototype)))):(t=Ze.instances2.get(e),t||Ze.instances2.set(e,t=new Ze(e.constructor.name,void 0,Object.create(Ze.prototype)))),t}static getState(e){var t;return(t=Ze.get(e))===null||t===void 0?void 0:t.state}updateDevTools(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};JU(Ze.UPDATEAFSM,Object.assign({name:this.name,group:this.groupName},e))}get state(){return this._state}set state(e){al.call(this,e)}};Ze.STATECHANGED="stateChanged",Ze.UPDATEAFSM="updateAFSM",Ze.INIT="[*]",Ze.ON="on",Ze.OFF="off",Ze.instances=new Map,Ze.instances2=new WeakMap;var KA=(window==null?void 0:window.requestIdleCallback)||function(e){let t=Date.now();return setTimeout(()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})},1e3)},YU=(window==null?void 0:window.cancelIdleCallback)||function(e){clearTimeout(e)},qU=(window==null?void 0:window.cancelAnimationFrame)||(window==null?void 0:window.mozCancelAnimationFrame),kg=class{static generateTaskID(){return this.currentTaskID++}static run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Uc,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;i=Oe(e===Od?{delay:2e3,count:0,backgroundTask:!0}:e===ca?{delay:1e4,count:0}:e===H_?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0},i),jr(t)&&(i=Oe(Oe({},i),t)),Tt(e)&&(t=e,e=Uc);let r=Oe({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,ricID:null,taskName:e,callback:t},i);return this.taskMap.set(r.taskID,r),this[e](r),r.taskID}static interval(e){return e.intervalID=setInterval(()=>{e.callback(),e.loopCount+=1,this.isBreakLoop(e)},e.delay)}static intervalInWorker(e){e.delay=(1e3/e.fps).toFixed(2);let t=new Worker(URL.createObjectURL(new Blob([`
        let timerID = null;
        self.onmessage = function (e) {
          if (e.data === 'start') {
            timerID = setInterval(() => {
              self.postMessage('tick');
            }, `.concat(e.delay,`);
          } else if (e.data === 'stop') {
            clearInterval(timerID);
          }
        };
      `)],{type:"application/javascript"})));t.onmessage=i=>{i.data==="tick"&&(e.callback(),e.loopCount+=1,this.isBreakLoop(e)&&t.postMessage("stop"))},e.worker=t,t.postMessage("start")}static timeout(e){let t=()=>{if(e.callback(),e.loopCount+=1,!this.isBreakLoop(e))return e.timeoutID=setTimeout(t,e.delay)};return e.timeoutID=setTimeout(t,e.delay)}static ric(e){let t,i=it(),r=()=>{if(t=it()-i,t>=e.delay&&(i=it()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),!this.isBreakLoop(e))return e.ricID=KA(r,{timeout:e.delay})};return e.ricID=KA(r,{timeout:e.delay})}static raf(e){e.delay=(1e3/e.fps).toFixed(2);let t,i=it(),r=()=>document.hidden&&e.backgroundTask?(t=it()-i,i=it(),e.callback(),e.loopCount+=1,this.isBreakLoop(e)?void 0:e.timeoutID=setTimeout(r,e.delay-Math.floor(t%e.delay))):(t=it()-i,t>=e.delay&&(i=it()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),this.isBreakLoop(e)?void 0:e.rafID=requestAnimationFrame(r));if(e.rafID=requestAnimationFrame(r),e.backgroundTask){let o=()=>{if(document.hidden){let c=it()-i;c>=e.delay?r():e.timeoutID=setTimeout(r,e.delay-c)}};document.addEventListener("visibilitychange",o),e.onVisibilitychange=o,document.hidden&&o()}return e.taskID}static hasTask(e){return this.taskMap.has(e)}static clearTask(e){if(!this.taskMap.has(e))return!0;let{intervalID:t,timeoutID:i,rafID:r,ricID:o,onVisibilitychange:c,worker:u}=this.taskMap.get(e);return u&&u.terminate(),t&&clearInterval(t),i&&clearTimeout(i),r&&qU(r),o&&YU(o),c&&document.removeEventListener("visibilitychange",c),this.taskMap.delete(e),!0}static isBreakLoop(e){return!this.taskMap.has(e.taskID)||e.count!==0&&e.loopCount>=e.count&&(this.clearTask(e.taskID),!0)}};kg.taskMap=new Map,kg.currentTaskID=1;var Dt=kg,Cn={LOADED_DATA:N.LOADEDDATA,MEDIA_TRACK_CHANGED:"media-track-changed",PLAYER_STATE_CHANGED:"player-state-changed"},Ng={};wc(Ng,{create:()=>wn,remove:()=>Ti});var cl=new WeakMap;function wn(e,t){cl.has(e)||cl.set(e,[]);let i=cl.get(e),r={add:(o,c)=>("addEventListener"in t?(i.push(t.removeEventListener.bind(t,o,c)),t.addEventListener(o,c)):(i.push(t.off.bind(t,o,c)),t.on(o,c)),r)};return r}function Ti(e){let t=cl.get(e);t&&(t.forEach(i=>i()),cl.delete(e))}var ll=class extends Ze{constructor(e,t){super(e.id,"".concat(t,"-player")),this.kind=t,b(this,"id"),b(this,"element",null),b(this,"track"),b(this,"url"),b(this,"attr"),b(this,"muted"),b(this,"_log"),b(this,"_pausedRetryCount"),b(this,"_isElementPlayingFired",!1),b(this,"_interval"),this.id=e.id,this._log=e.log,this.track=e.track,this.muted=e.muted,this._pausedRetryCount=Xb,this._state="STOPPED",this.bindTrackEvents(),this._log.info("create ".concat(t,"-player ").concat(this.id))}get isPlaying(){return this._state==="PLAYING"}get isStopped(){return this._state==="STOPPED"}setAttr(e){this.attr=e}setUrl(e){this.track&&(this.unbindTrackEvents(),this.element&&(this.element.srcObject=null),this.track=null),e!==this.url&&(this.url=e,e!==null&&this.element&&(this.element.crossOrigin="anonymous",this.element.src=e))}play(){return B(this,null,function*(){if(!this.isPlaying)try{this.bindAutoPlayEvent(),yield this.element.play()}catch(e){let t=je({key:Ve.PLAY_FAILED,data:{media:this.kind,error:e}});if(this.track&&!this.track.muted&&this._log.warn(e),t.includes("NotAllowedError"))throw new ke({code:ge.PLAY_NOT_ALLOWED,message:t})}})}stop(){this.unbindEvents(),this._isElementPlayingFired=!1,this.element&&(this.element.remove(),this.element.srcObject=null,this.element=null),this.handleStopped(N.ENDED),this._interval>0&&Dt.clearTask(this._interval)}pause(){var e;this.isPlaying&&((e=this.element)==null||e.pause())}resume(){return this.isPlaying?Promise.resolve():uA?this.replay():this.play().catch(()=>{})}setMuted(e){this.element&&(this.element.muted=e),this.muted=e}replay(){return this.stop(),this.play().catch(()=>{})}bindElementEvents(){if(this.element){let e=this.handleElementEvent.bind(this);return wn(this.element,this.element).add(N.PLAYING,e).add(N.ENDED,e).add(N.PAUSE,e).add(N.ERROR,e).add(N.LOADEDDATA,e)}}bindTrackEvents(){if(this.track){let e=this.handleTrackEvent.bind(this);Ng==null||Ng.create(this.track,this.track).add(N.ENDED,e).add(N.MUTE,e).add(N.UNMUTE,e),this.track.readyState===N.ENDED&&this.handleTrackEvent({type:N.ENDED}),this.track.muted&&this.handleTrackEvent({type:N.MUTE})}}bindAutoPlayEvent(){pe.on(oe.AUTOPLAY_DIALOG_CLICK_CONFIRM,this.resume,this)}unbindTrackEvents(){this.track&&Ti(this.track)}unbindEvents(){this.element&&Ti(this.element),this.unbindTrackEvents(),pe.off(oe.AUTOPLAY_DIALOG_CLICK_CONFIRM,this.resume,this)}handleElementEvent(e){switch(e.type){case N.PLAYING:this._isElementPlayingFired=!0,this._log.info("".concat(this.kind," player is playing")),this.handlePlaying(N.PLAYING),this._interval&&(Dt.clearTask(this._interval),this._interval=-1);break;case N.ENDED:this._log.info("".concat(this.kind," player is ended")),this.handleStopped(N.ENDED);break;case N.PAUSE:this._log.info("".concat(this.kind," player is paused")),this.handlePaused(N.PAUSE),tr&&(this._interval=Dt.run(Uc,()=>{this.element&&this._state==="PAUSED"&&this.resume()},{delay:3e3}));break;case N.ERROR:if(this.element&&this.element.error){let{code:t,message:i}=this.element.error;this._log.error("".concat(this.kind," player error observed. code: ").concat(t," message: ").concat(i," userAgent: ").concat(navigator.userAgent)),Ht.uploadEvent({log:"stat-".concat(this.kind,"-").concat(er.PLAYER_ERROR,"-").concat(t,"-").concat(navigator.userAgent),error:this.element.error})}break;case N.LOADEDDATA:this.kind===N.VIDEO&&this.emit(Cn.LOADED_DATA)}}handleTrackEvent(e){switch(e.type){case N.ENDED:this._log.info("".concat(this.kind," track is ended")),this.handleStopped(N.ENDED);break;case N.MUTE:this._log.info("".concat(this.kind," track is unable to provide media output")),this.handlePaused(N.MUTE);break;case N.UNMUTE:this._log.info("".concat(this.kind," track is able to provide media output")),this._isElementPlayingFired&&this.handlePlaying(N.UNMUTE)}}handlePlaying(e){this.emit(Cn.PLAYER_STATE_CHANGED,{type:this.kind,state:"PLAYING",reason:e})}handlePaused(e){this.emit(Cn.PLAYER_STATE_CHANGED,{type:this.kind,state:"PAUSED",reason:e})}handleStopped(e){this.emit(Cn.PLAYER_STATE_CHANGED,{type:this.kind,state:"STOPPED",reason:e})}getElement(){return this.element}};Ie([si([],"PLAYING",{sync:!0})],ll.prototype,"handlePlaying"),Ie([si("PLAYING","PAUSED",{ignoreError:!0,sync:!0})],ll.prototype,"handlePaused"),Ie([si([],"STOPPED",{sync:!0})],ll.prototype,"handleStopped");var or="trtc_autoplay",Dg="".concat(or,"_mask"),va="".concat(or,"_wrapper"),JA="".concat(or,"_header"),Og="".concat(or,"_content"),ih="".concat(or,"_action_wrapper"),Pg="".concat(or,"_question"),Mg="".concat(or,"_collapse"),nh="".concat(or,"_action_confirm"),YA="".concat(or,"_detail"),qA="#2473E8",Lg="dialog",XU="".concat(Lg,"-show"),QU="".concat(Lg,"-1"),ZU="".concat(Lg,"-2"),XA=!1,QA=()=>!!document.querySelector(".".concat(va)),ZA="".concat(Ps,"/").concat(Hr()?"zh-cn":"en","/tutorial-21-advanced-auto-play-policy.html"),$A="<br><a href='".concat(ZA,"' target='_blank'>").concat(Hr()?"":"Any other solution?","</a>"),$U="".concat(Hr()?"".concat($A):"Autoplay Policy: Before user interacts with the web page (clicking, touching), page will not be allowed to play media with sound. This Dialog is used to help users resume playback. ".concat($A)),e7=class{constructor(){if(b(this,"content",""),b(this,"_dialogNode",null),b(this,"_bodyPosition",""),b(this,"_showDetail",!1),b(this,"_isCollapseClicked",!1),b(this,"_isQuestionClicked",!1),Hr()||(this.content='Media playback failed. Click the "Resume" to resume playback.'),!XA){let e=document.createElement("style");e.innerHTML=".".concat(Dg,"{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.5);z-index:1500;}.").concat(Dg," div:not(.").concat(ih,"){display:block !important;}.").concat(va,"{padding:14px;background:#fff;border-radius:3px;box-shadow:0px 3px 15px #434343;border:1px solid #d1cfcf;max-width:500px;}.").concat(va," a{color:").concat(qA,";}.").concat(JA,"{overflow:hidden;text-overflow:ellipsis;font-size:16px;font-weight:600;}.").concat(Og,"{margin:8px 0;}.").concat(ih,"{width:100%;display:flex !important;align-items:center;justify-content:right;float:right;}.").concat(Mg,"{margin-right:auto;cursor:pointer}.").concat(Pg,"{height:100%;line-height:16px;cursor:pointer;}.").concat(nh,"{margin-left:8px;color:#fff;background:").concat(qA,";padding:4px 12px;outline:none;border:1px solid;border-radius:3px;font-weight:bold;}.").concat(nh,":hover{opacity:0.9;}.").concat(Mg,",.").concat(nh,",.").concat(Og,",.").concat(Pg,"{font-size:14px;}@media screen and (max-width:750px){.").concat(va,"{width:80vw;}}"),document.head.appendChild(e),XA=!0}this.addDiaLog()}createDiaLog(){let e=document.createElement("template");e.innerHTML='<div class="'.concat(Dg,`"><div class='`).concat(va,"'><div class='").concat(JA,"'>").concat(location.host,"</div><div class='").concat(Og,"'>").concat(this.content,"</div><div class='").concat(YA,`' style="visibility:hidden;width:100%;height:0;font-size:12px;color:gray;">`).concat($U,"</div><div class='").concat(ih,"'></div></div></div>").trim();let t=document.createElement("button");t.className=nh,t.innerText=Hr()?"":"Resume",t.onclick=this.onConfirm.bind(this);let i=document.createElement("div");i.className=Pg,i.innerHTML=`<?xml version="1.0" encoding="UTF-8"?>
    <svg class="icon" width="18" height="18" p-id="2030" t="1639646523624" version="1.1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
    <path d="m464 784.35c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z" p-id="2031"/>
    <path d="m512 960c-247.04 0-448-200.96-448-448s200.96-448 448-448 448 200.96 448 448-200.96 448-448 448zm0-831.71c-211.58 0-383.71 172.13-383.71 383.71 0 211.55 172.13 383.71 383.71 383.71 211.55 0 383.71-172.16 383.71-383.71 0-211.58-172.16-383.71-383.71-383.71z" p-id="2032"/>
    <path d="m512 673.7c-17.665 0-32.001-14.336-32.001-31.999v-54.112c0-52.353 40-92.352 75.328-127.65 25.887-25.92 52.672-52.672 52.672-74.017 0-53.343-43.072-96.735-95.999-96.735-53.823 0-95.999 41.536-95.999 94.559 0 17.665-14.336 31.999-32.001 31.999s-32.001-14.336-32.001-31.999c0-87.424 71.775-158.56 160-158.56s160 72.095 160 160.74c0 47.904-36.32 84.192-71.424 119.3-27.84 27.776-56.576 56.512-56.576 82.336v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="2033"/>
    </svg>
    `,i.onclick=this.onQuestionClick.bind(this);let r=document.createElement("div");r.className=Mg,r.innerText="".concat(Hr()?" >":"Detail >"),r.onclick=this.onCollapseClick.bind(this);let o=e.content.firstChild,c=o.querySelector(".".concat(ih));return c.appendChild(r),c.appendChild(i),c.appendChild(t),o}addDiaLog(){QA()||(this._dialogNode=this.createDiaLog(),document.body.appendChild(this._dialogNode),this._dialogNode.onclick=this.onConfirm.bind(this),this._dialogNode.querySelector(".".concat(va)).onclick=e=>e.stopPropagation(),this._bodyPosition=document.body.style.position,document.body.style.position="fixed",Te.info("show autoplay dialog"),Ht.uploadEvent({log:XU}))}deleteDiaLog(){this._dialogNode&&(document.body.removeChild(this._dialogNode),document.body.style.position=this._bodyPosition,this._dialogNode=null)}onConfirm(){Te.warn("confirm clicked, try resume stream"),pe.emit(oe.AUTOPLAY_DIALOG_CLICK_CONFIRM),this.deleteDiaLog()}onCollapseClick(){let e=this._dialogNode.querySelector(".".concat(YA));e.style.visibility="".concat(this._showDetail?"hidden":"visible"),e.style.height="".concat(this._showDetail?0:"fit-content"),this._showDetail=!this._showDetail,this._isCollapseClicked||Ht.uploadEvent({log:QU}),this._isCollapseClicked=!0}onQuestionClick(){window.open(ZA,"_blank"),this._isQuestionClicked||Ht.uploadEvent({log:ZU}),this._isQuestionClicked=!0}},js=class extends ll{constructor(e){super(e,N.VIDEO),b(this,"viewMirror",!1),b(this,"objectFit"),b(this,"container"),b(this,"canvas"),this.container=e.container,this.canvas=e.canvas,re(e.viewMirror)||(this.viewMirror=e.viewMirror),re(e.objectFit)||(this.objectFit=e.objectFit),this.initializeElement()}initializeElement(){var e;let t=document.createElement(N.VIDEO);this.track&&(t.srcObject=new MediaStream([this.track])),t.muted=!0,t.setAttribute("id","video_".concat(this.id)),t.setAttribute("style",this.styleAttribute),this.canvas&&this.canvas.setAttribute("style",this.styleAttribute),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),this.element=t,(e=this.container)==null||e.appendChild(this.elementToRender),this.bindElementEvents()}get styleAttribute(){let e="width: 100%; height: 100%; object-fit: ".concat(this.objectFit,";background-color: black;");return this.viewMirror&&(e+="transform: scaleX(-1);"),e}setContainer(e){var t;this.container=e,this.track&&this.elementToRender&&((t=this.container)==null||t.appendChild(this.elementToRender))}bindElementEvents(){let e=super.bindElementEvents();this.handleElementEvent=this.handleElementEvent.bind(this),e&&e.add(N.ENTER_PICTURE_IN_PICTURE,this.handleElementEvent).add(N.LEAVE_PICTURE_IN_PICTURE,this.handleElementEvent)}handleElementEvent(e){var t;super.handleElementEvent(e);let i=e.type;if(i===N.PAUSE&&(this.container&&document.getElementById(this.container.id)||this._log.warn("".concat(this.kind," player has been remove, element ID: ").concat((t=this.container)==null?void 0:t.id)),this._pausedRetryCount>0&&!QA()&&(this._log.info("".concat(this.kind," player auto resume when paused")),this.resume(),this._pausedRetryCount--)),this.viewMirror&&this.element){let r=this.element.style.transform;i===N.ENTER_PICTURE_IN_PICTURE?this.element.style.transform=r.replace("scaleX(-1)",""):i===N.LEAVE_PICTURE_IN_PICTURE&&!r.includes("scaleX")&&(this.element.style.transform="".concat(r," scaleX(-1)"))}}setCanvas(e){var t,i;this.canvas!==e&&((t=this.canvas)==null||t.remove(),e==null||e.setAttribute("style",this.styleAttribute),this.canvas=e,e&&((i=this.container)==null||i.appendChild(e)))}setAttr(e){let t=Object.assign({autoplay:"autoplay",playsinline:"playsinline",muted:!0},e);t.style=Object.assign({width:"100%",height:"100%"},t.style),super.setAttr(t)}get mirror(){return this.viewMirror}setRect(e,t){this.elementToRender&&(this.elementToRender.style.width="".concat(e,"px"),this.elementToRender.style.height="".concat(t,"px"))}setViewMirror(e){this.elementToRender&&(this.elementToRender.style.transform=e?"scaleX(-1)":""),this.viewMirror=e}setObjectFit(e){this.elementToRender&&(this.elementToRender.style.objectFit="".concat(e)),this.objectFit=e}stop(){var e;super.stop(),(e=this.canvas)==null||e.remove()}play(){return this.element?this.elementToRender&&this.elementToRender.parentElement!==this.container&&this.container&&this.container.append(this.elementToRender):this.initializeElement(),super.play()}get elementToRender(){return this.canvas||this.element}setTrack(e){e!==this.track&&(this.unbindTrackEvents(),this.track=e,this.emit(Cn.MEDIA_TRACK_CHANGED,e),e!==null&&(this.bindTrackEvents(),this.element&&(this.element.srcObject=new MediaStream([e]),this.element.remove()),this.elementToRender&&this.elementToRender.parentElement!==this.container&&this.container&&this.container.append(this.elementToRender)))}getVideoFrame(){if(this.canvas)return this.canvas.toDataURL("image/png");if(!this.element)return"";let e=document.createElement("canvas");return e.width=this.element.videoWidth,e.height=this.element.videoHeight,e.getContext("2d").drawImage(this.element,0,0),e.toDataURL("image/png")}getElement(){return this.element}};function rh(e,t){return B(this,null,function*(){if(!e.audioWorklet)return Promise.reject("audioWorklet is not supported");try{yield e.audioWorklet.addModule(t),Te.info("worklet addModule success")}catch(i){throw Te.info("worklet addModule catch error. ".concat(i.message)),i}})}typeof window<"u"&&(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext);var Ws=new window.AudioContext({sampleRate:48e3}),sh=()=>{Ws.state==="suspended"?(Ws.resume(),document.addEventListener("click",sh)):Ws.state==="interrupted"?Ws.resume():document.removeEventListener("click",sh)};document.addEventListener("click",sh),Ws.onstatechange=()=>{Te.info("context state: ".concat(Ws.state)),sh()};var cn,Qe,xg,zr=e=>Ws,eR=class{constructor(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];this.countMap=new Map,this.distributionMap=new Map,this.log=Te.createLogger({id:"kv"}),e&&(pe.on("102",t=>{let{track:i,cost:r}=t;this.addSuccessEvent({key:i.kind===N.AUDIO?Vg.START_MICROPHONE:Ug.START_CAMERA,cost:r})}),pe.on("103",t=>{let{track:i,error:r}=t;this.addFailedEvent({key:i.kind===N.AUDIO?Vg.START_MICROPHONE:Ug.START_CAMERA,error:r})}))}getReportData(){let e={msg_sdk_basic_info:{uint32_sdk_version:NA(this.version||In),uint32_terminal_type:15,bytes_device_name:"",bytes_os_version:"",uint32_framework:30,uint32_network_type:0},stats_count:[...this.countMap.entries()].map(t=>{let[i,r]=t;return{uint32_key:i,uint32_count:r}}),stats_distribution:[...this.distributionMap.entries()].map(t=>{let[i,r]=t;return{uint32_key:i,distribution_items:[...r.entries()].map(o=>{let[c,u]=o;return{uint32_item_key:c,uint32_item_value:u}})}})};return this.countMap.clear(),this.distributionMap.clear(),e}clear(){this.countMap.clear(),this.distributionMap.clear()}isEnumKey(e){let t=+String(e).slice(-3);return t>=700&&t<799}isErrorCodeKey(e){let t=+String(e).slice(-3);return t>=600&&t<699}isCountKey(e){let t=+String(e).slice(-3);return t>=0&&t<599}isNumberKey(e){let t=+String(e).slice(-3);return t>=800&&t<899}addCount(e){let{key:t,useUV:i=!1}=e;this.isCountKey(t)?i&&this.countMap.has(t)||this.countMap.set(t,(this.countMap.get(t)||0)+1):this.log.debug("".concat(t," is not count key, last 3 number should be 0~599"))}addEnum(e){let{key:t,value:i,useUV:r=!0}=e;var o;if(!this.isEnumKey(t))return this.log.debug("".concat(t," is not enum key, last 3 number should be 700~799"));if(r&&this.countMap.has(t))return;this.countMap.set(t,(this.countMap.get(t)||0)+1);let c=((o=this.distributionMap)==null?void 0:o.get(t))||new Map;c.set(i,(c.get(i)||0)+1),this.distributionMap.set(t,c)}addNumber(e){let{key:t,value:i,split:r=100,useUV:o=!1}=e;var c;if(!this.isNumberKey(t))return this.log.debug("".concat(t," is not number key, last 3 number should be 800~899"));if(o&&this.countMap.has(t))return;this.countMap.set(t,(this.countMap.get(t)||0)+1);let u=((c=this.distributionMap)==null?void 0:c.get(t))||new Map,f=0;if(Qt(r))f=Math.floor(i/r);else for(let d=r.length-1;d>0;d--)if(i>r[d]){f=d;break}u.set(f,(u.get(f)||0)+1),this.distributionMap.set(t,u)}addSuccessEvent(e){let{key:t,cost:i,timeKey:r,split:o}=e;if(t&&(this.addEnum({key:t,value:1,useUV:!1}),i)){let c=+String(t).slice(-3);c<800&&c>=700?this.addNumber({key:r||t+100,value:i,split:o}):r||this.log.debug("time stat ignored, ".concat(t))}}addFailedEvent(e){let{key:t,error:i}=e;if(!t)return;let r=ge.UNKNOWN;Qt(i)?r=i:(!re(i.extraCode)||!re(i.code))&&(r=i.extraCode||i.code),this.addEnum({key:t,value:0,useUV:!1}),this.addEnum({key:t,value:r,useUV:!1})}},tR=((Qe=tR||{})[Qe.enterRoom=500700]="enterRoom",Qe[Qe.exitRoom=500701]="exitRoom",Qe[Qe.switchRole=500702]="switchRole",Qe[Qe.destroy=500703]="destroy",Qe[Qe.startLocalAudio=500704]="startLocalAudio",Qe[Qe.updateLocalAudio=500705]="updateLocalAudio",Qe[Qe.stopLocalAudio=500706]="stopLocalAudio",Qe[Qe.startLocalVideo=500707]="startLocalVideo",Qe[Qe.updateLocalVideo=500708]="updateLocalVideo",Qe[Qe.stopLocalVideo=500709]="stopLocalVideo",Qe[Qe.startScreenShare=500710]="startScreenShare",Qe[Qe.updateScreenShare=500711]="updateScreenShare",Qe[Qe.stopScreenShare=500712]="stopScreenShare",Qe[Qe.startRemoteVideo=500713]="startRemoteVideo",Qe[Qe.updateRemoteVideo=500714]="updateRemoteVideo",Qe[Qe.stopRemoteVideo=500715]="stopRemoteVideo",Qe[Qe.muteRemoteAudio=500716]="muteRemoteAudio",Qe[Qe.setRemoteAudioVolume=500717]="setRemoteAudioVolume",Qe),iR=((cn=iR||{})[cn.AudioMixer=550700]="AudioMixer",cn[cn.AIDenoiser=551700]="AIDenoiser",cn[cn.VirtualBackground=570700]="VirtualBackground",cn[cn.Beauty=571700]="Beauty",cn[cn.Watermark=572700]="Watermark",cn),nR=(e=>(e[e.AudioMixer=550701]="AudioMixer",e[e.AIDenoiser=551701]="AIDenoiser",e[e.VirtualBackground=570701]="VirtualBackground",e[e.Beauty=571701]="Beauty",e[e.Watermark=572701]="Watermark",e))(nR||{}),rR=(e=>(e[e.AudioMixer=550702]="AudioMixer",e[e.AIDenoiser=551702]="AIDenoiser",e[e.VirtualBackground=570702]="VirtualBackground",e[e.Beauty=571702]="Beauty",e[e.Watermark=572702]="Watermark",e))(rR||{}),Vg=(e=>(e[e.START_MICROPHONE=501700]="START_MICROPHONE",e[e.MICROPHONE_CAHNNELS=501701]="MICROPHONE_CAHNNELS",e[e.MICROPHONE_SAMPLERATE=501702]="MICROPHONE_SAMPLERATE",e))(Vg||{}),Ug=((xg=Ug||{})[xg.START_CAMERA=511700]="START_CAMERA",xg),t7=new eR(!0),ul=new eR(!1),et=t7,ya=class{constructor(){this.pre=new Set,this.next=new Set,this.connectedNodes=new Set}setContext(e){this.context=e,this.node&&e.addMixWeight()}removeContext(){var e;this.node&&((e=this.context)==null||e.reduceMixWeight()),delete this.context}setNode(e){var t;if(!this.node)try{(t=this.context)==null||t.addMixWeight(),this.node=e,this.preNodeReconnect(),this.reconnect(),et.addSuccessEvent({key:502701})}catch(i){Te.error(i),et.addFailedEvent({key:502701,error:i})}}deleteNode(){var e;if(this.node)try{this._disconnect(),delete this.node,(e=this.context)==null||e.reduceMixWeight(),this.preNodeReconnect(),et.addSuccessEvent({key:502702})}catch(t){Te.error(t),et.addFailedEvent({key:502702,error:t})}}preNodeReconnect(){this.pre.forEach(e=>{e.node?e.reconnect():e.preNodeReconnect()})}connectNext(e){this.next.forEach(t=>e._connect(t.node)||t.connectNext(e))}_connect(e){return!(!this.node||!e)&&(this.node.connect(e),this.connectedNodes.add(e),!0)}_disconnect(){this.connectedNodes.forEach(e=>{var t;return(t=this.node)==null?void 0:t.disconnect(e)}),this.connectedNodes.clear()}reconnect(){this._disconnect(),this.connectNext(this)}pipeTo(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.forEach(r=>{this.next.add(r),r.pre.add(this)}),this}},i7=class extends ya{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:256;super(),this.fftSize=e,this.dataArray=new Uint8Array(0)}setNode(e){e.fftSize=this.fftSize,this.dataArray=new Uint8Array(e.frequencyBinCount),super.setNode(e)}getByteTimeDomainData(){var e;return(e=this.node)==null||e.getByteTimeDomainData(this.dataArray),this.dataArray}get level(){var e;return(e=this.node)==null||e.getByteTimeDomainData(this.dataArray),Math.max(...this.dataArray)/128-1}get timeDomainPathData(){let e=this.getByteTimeDomainData(),t=0,i=0,r="M".concat(t,",").concat(i);for(let o=0;o<e.length;o++)i=e[o]/128*100/2,r+="L".concat(t,",").concat(i),t+=1;return r}},sR=class{constructor(){this.source=new ya,this.gain=new ya,this.destination=new ya}get volume(){var e;return((e=this.gain.node)==null?void 0:e.gain.value)||1}setVolume(e){e!==1?(this.gain.node||this.gain.setNode(this.source.node.context.createGain()),this.gain.node.gain.value=e):this.gain.node&&this.gain.deleteNode()}replaceSource(e){this.source.deleteNode(),this.source.setNode(function(t){let i=aR.get(t);if(i)return i;let r=zr();if(t instanceof HTMLAudioElement)i=r.createMediaElementSource(t);else{if(!(t instanceof MediaStreamTrack))return t;i=r.createMediaStreamSource(new MediaStream([t]))}return aR.set(t,i),i}(e))}get track(){var e;return(e=this.stream)==null?void 0:e.getAudioTracks()[0]}get stream(){var e;return(e=this.destination.node)==null?void 0:e.stream}},oR=class extends sR{constructor(e){super(),this.context=e,this.denoiser=new ya,this.source.pipeTo(this.denoiser.pipeTo(this.gain.pipeTo(this.destination)))}connect(){this.context.inputs.has(this)||(this.destination.setNode(this.context.destination),this.source.setContext(this.context),this.denoiser.setContext(this.context),this.gain.setContext(this.context),this.context.inputs.add(this))}disconnect(){!this.context.inputs.has(this)||(this.destination.deleteNode(),this.source.removeContext(),this.denoiser.removeContext(),this.gain.removeContext(),this.context.inputs.delete(this))}remove(){this.gain.deleteNode(),this.denoiser.deleteNode(),this.source.deleteNode(),this.disconnect()}setVolume(e){e!==1?(this.gain.node||this.gain.setNode(this.context.audioContext.createGain()),this.gain.node.gain.value=e):this.gain.node&&this.gain.deleteNode()}},n7=class{constructor(){this.audioContext=zr(),this.destination=this.audioContext.createMediaStreamDestination(),this.inputs=new Set,this.mixWeight=0,this.destination.channelCount=1}addMixWeight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this.mixWeight+=e,this.mixWeight-1==e+1>>1&&this.mixOnChange()}reduceMixWeight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this.addMixWeight(-e)}close(){this.inputs.forEach(e=>e.remove())}get mixTrack(){return this.destination.stream.getAudioTracks()[0]}},aR=new WeakMap,Ea=class{constructor(e){b(this,"_volume",0),b(this,"_log"),b(this,"_scriptProcessorNode",null),b(this,"_audioWorkletNode",null),b(this,"_interval",200),b(this,"ready",this.preload());let{log:t}=e;this._log=t,pe.on(oe.AUDIO_LEVEL_INTERVAL,this.handleAudioLevelInterval,this)}get node(){return this._audioWorkletNode||this._scriptProcessorNode}preload(){return Ea.workletReady||(Ea.workletReady=rh(Ea.audioContext,URL.createObjectURL(new Blob(['class VolumeMeter extends AudioWorkletProcessor{constructor(){super(),this.volume=0,this.intervalTime=200,this.tick=this.intervalTime,this.isStop=!1,this.port.onmessage=t=>{let{data:e}=t;switch(e.name){case"setIntervalTime":this.intervalTime=e.intervalTime;break;case"stop":this.isStop=!0}}}process(t){let e=t[0];if(this.isStop)return!1;if(e.length>0){let i=e[0],s=0;for(let l=0;l<i.length;++l)s=Math.max(Math.abs(i[l]),s);this.volume=s,this.tick-=i.length,this.tick<0&&(this.tick+=this.intervalTime/1e3*sampleRate,this.port.postMessage({volume:this.volume}))}return!0}}registerProcessor("volume-meter",VolumeMeter);'],{type:"application/javascript"})))),Ea.workletReady.then(()=>this.initAudioWorklet()).catch(()=>this.initScriptProcessor())}initAudioWorklet(){if(!this._audioWorkletNode)try{this._audioWorkletNode=new AudioWorkletNode(Ea.audioContext,"volume-meter"),this._audioWorkletNode.port.onmessage=e=>{this._volume=e.data.volume||0},this.handleAudioLevelInterval({interval:this._interval})}catch(e){Ht.logFailedEvent({userId:this._log.userId,eventType:er.LOAD_WORKLET,error:e}),this.initScriptProcessor()}}initScriptProcessor(){if(!this._scriptProcessorNode)try{this._scriptProcessorNode=zr().createScriptProcessor(2048,1,1),this._scriptProcessorNode.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),i=0;for(let r=0;r<t.length;++r)i+=t[r]*t[r];this._volume=Math.sqrt(i/t.length)||0}}catch(e){this._log.error("volumeMeter init script processor error: ".concat(e))}}destroy(){this._scriptProcessorNode&&(this._scriptProcessorNode.onaudioprocess=null),this._audioWorkletNode&&(this._audioWorkletNode.port.postMessage({name:"stop"}),this._audioWorkletNode.port.onmessage=null),this._audioWorkletNode=null,this._scriptProcessorNode=null,pe.off(oe.AUDIO_LEVEL_INTERVAL,this.handleAudioLevelInterval,this)}getInternalAudioLevel(){return this._volume}getCalculatedVolume(){return parseFloat(this._volume.toFixed(2))}handleAudioLevelInterval(e){var t;let{interval:i}=e;this._interval=i,(t=this._audioWorkletNode)==null||t.port.postMessage({name:"setIntervalTime",intervalTime:i})}},Fg=Ea;b(Fg,"audioContext",zr()),b(Fg,"workletReady");var r7=class extends ya{constructor(e){super(),b(this,"_volumeMeter"),this._volumeMeter=new Fg(e)}deleteNode(){this._volumeMeter.destroy(),super.deleteNode()}init(){return B(this,null,function*(){yield this._volumeMeter.preload(),this.setNode(this._volumeMeter.node)})}getCalculatedVolume(){return this._volumeMeter.getCalculatedVolume()}getInternalAudioLevel(){return this._volumeMeter.getInternalAudioLevel()}},s7=ni(Di(),1),cR=e=>t=>t.deviceId===e,Bg=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Input";b(this,"kind"),b(this,"type"),b(this,"devices",[]),this.kind=e,this.type=t}update(e,t){let i=e.filter(r=>r.kind==="".concat(this.kind).concat(this.type.toLocaleLowerCase()));this.devices.length===1&&dl(this.devices[0])||t&&(i.forEach(r=>{if(r.deviceId&&!this.devices.find(cR(r.deviceId))){let o="".concat(this.kind).concat(this.type,"Added");Te.warn("".concat(o,": ").concat(JSON.stringify(r))),t.emit(o,r)}}),this.devices.forEach(r=>{if(r.deviceId&&!i.find(cR(r.deviceId))){let o="".concat(this.kind).concat(this.type,"Removed");Te.warn("".concat(o,": ").concat(JSON.stringify(r))),t.emit(o,r)}})),this.devices=i}hasDevice(e){return!!this.devices.find(t=>t.deviceId===e)}},o7=class extends s7.EventEmitter{constructor(){super(),b(this,"audioInputs",new Bg(N.AUDIO)),b(this,"videoInputs",new Bg(N.VIDEO)),b(this,"audioOutputs",new Bg(N.AUDIO,"Output")),this.init(),navigator.mediaDevices&&(navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",()=>this.update()),"ondevicechange"in navigator.mediaDevices||Dt.run(Od,()=>{this.update()},{delay:1e4}))}init(){Hg().then(e=>{this.audioInputs.update(e),this.videoInputs.update(e),this.audioOutputs.update(e)})}update(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function*(){let i=yield Hg(t);return e.audioInputs.update(i,e),e.videoInputs.update(i,e),e.audioOutputs.update(i,e),e}()})}},oi=k_||Rd?null:new o7;function dl(e){return e.deviceId===e.groupId&&e.groupId===""}function Hg(){return B(this,arguments,function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function*(){if(Hs()||!Tg())return[];let t=yield navigator.mediaDevices.enumerateDevices();if(e!==0){let i={audio:!1,video:!1};if(t.forEach(r=>{dl(r)&&(r.kind===N.AUDIO_INPUT?i.audio=!0:r.kind===N.VIDEO_INPUT&&(i.video=!0))}),e===2&&(i.audio=!1),e===1&&(i.video=!1),i.audio||i.video){let r;try{r=yield navigator.mediaDevices.getUserMedia(i)}catch(o){Te.debug("capture before getDevices failed: ",o)}t=yield navigator.mediaDevices.enumerateDevices(),r==null||r.getTracks().forEach(o=>o.stop())}}return t.map((i,r)=>{let o={kind:i.kind,deviceId:i.deviceId,groupId:i.groupId,label:i.label||"".concat(i.kind,"_").concat(r)};return i.deviceId.length>0&&jg.add("".concat(i.deviceId,"_").concat(i.kind)),i.getCapabilities&&(o.getCapabilities=()=>i.getCapabilities()),o})}()})}function ar(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return oi.update(e?1:0).then(t=>t.audioInputs.devices)}function Gr(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return oi.update(e?2:0).then(t=>t.videoInputs.devices)}var lR=!1;function Ta(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return B(this,null,function*(){return oi.update(e?1:0).then(t=>t.audioOutputs.devices)})}var jg=new Set;function uR(e,t){return B(this,null,function*(){let i=(yield ar()).find(r=>r.deviceId===Lc);return(i==null?void 0:i.groupId)===e&&i.label===t})}var a7=class extends sR{constructor(e){super(),this.log=e,b(this,"volumeMeter"),b(this,"analyser",new i7),this.volumeMeter=new r7({log:this.log})}destory(){this.gain.deleteNode(),this.volumeMeter.deleteNode(),this.analyser.deleteNode(),this.source.deleteNode(),this.destination.deleteNode()}},Wg=class extends ll{constructor(e){super(e,N.AUDIO),b(this,"_outputDeviceId"),b(this,"_volume",1),b(this,"_destination",zr().createMediaStreamDestination()),b(this,"pipeline"),b(this,"volumeMeterMode","worklet"),this.pipeline=new a7(this._log)}getMediaStream(){return this.pipeline.stream||(this.track?new MediaStream([this.track]):null)}initializeElement(){if((Ur==="15.2"||Ur==="15.3"||Ur==="15.4")&&this.muted)return void this._log.info("audioElement is muted.");let e=new Audio;e.setAttribute("autoplay","autoplay"),e.srcObject=this.getMediaStream(),e.muted=this.muted,this.element=e,this.bindElementEvents()}play(){return B(this,null,function*(){if(this.track)return this.pipeline.source.node||this.pipeline.replaceSource(this.track),this.element||this.initializeElement(),this._outputDeviceId&&(yield this.setSinkId(this._outputDeviceId)),this.volumeMeterMode==="worklet"?this.pipeline.volumeMeter.init():this.volumeMeterMode==="analyser"&&this.pipeline.analyser.setNode(zr().createAnalyser()),this.setVolume(this._volume),function(){B(this,null,function*(){try{lR||(lR=!0,Te.info("speakers:".concat((yield Ta()).map(e=>" ".concat(e.deviceId.slice(0,8),": ").concat(e.label)))))}catch{}})}(),rn(Wg.prototype,this,"play").call(this)})}stop(){this.pipeline.destory(),super.stop()}setSinkId(e){return B(this,null,function*(){var t,i;this._outputDeviceId!==e&&(this._outputDeviceId=e),this.element&&this.element.sinkId!==e&&(yield(i=(t=this.element).setSinkId)==null?void 0:i.call(t,e))})}get useDestination(){return!!this.pipeline.stream}setLoop(e){!this.element||(this.element.loop=e)}getAudioLevel(){return this.pipeline.volumeMeter.getCalculatedVolume()}getInternalAudioLevel(){return this.pipeline.volumeMeter.getInternalAudioLevel()}},c7=class extends Wg{constructor(e){super(e),this.pipeline.source.pipeTo(this.pipeline.volumeMeter,this.pipeline.destination)}setTrack(e){this.track!==e&&(this.unbindTrackEvents(),this.track=e,this.emit(Cn.MEDIA_TRACK_CHANGED,e),e?(this.bindTrackEvents(),this.pipeline.replaceSource(e),!this.useDestination&&this.element&&(this.element.srcObject=new MediaStream([e]))):this.pipeline.source.deleteNode())}setSourceNode(e){!e||this.pipeline.source.node===e||(this.pipeline.replaceSource(e),e instanceof MediaStreamAudioSourceNode?this.pipeline.destination.setNode(this._destination):this.pipeline.destination.deleteNode(),this.element&&(this.element.srcObject=this.getMediaStream(),this.element.play().catch(()=>{}),this.setVolume(this._volume)))}setVolume(e){this._volume=e,this.element&&(this.element.volume=e)}},l7=class extends Wg{constructor(e){super(e),b(this,"_sourceElement"),this.pipeline.source.pipeTo(this.pipeline.gain.pipeTo(this.pipeline.volumeMeter,this.pipeline.destination))}setTrack(e){this.track!==e&&(this.unbindTrackEvents(),this.track=e,this.emit(Cn.MEDIA_TRACK_CHANGED,e),e?(this.bindTrackEvents(),this._sourceElement?this._sourceElement.srcObject=new MediaStream([e]):!this.useDestination&&this.element&&(this.element.srcObject=new MediaStream([e])),this.pipeline.replaceSource(e)):this.pipeline.source.deleteNode())}setVolume(e){this._volume=e,this.useDestination?(this.pipeline.setVolume(e),this._log.info("set pipeline volume: ".concat(e))):e<=1?(this.element?this._log.info("set element volume: ".concat(e)):this._log.info("set element volume: no element"),this.element&&(this.element.volume=e)):(this._log.info("start set pipeline volume: ".concat(e)),this.pipeline.setVolume(e),this.element&&!this._sourceElement&&(this.pipeline.destination.setNode(this._destination),Ti(this.element),this._sourceElement=this.element,this._sourceElement.muted=!0,this.element=null,this.play()))}stop(){this.pipeline.destory(),this._sourceElement&&(this._sourceElement.srcObject=null,delete this._sourceElement),super.stop()}},zg=class extends Ze{constructor(e){let{userId:t,sdkAppId:i,mediaType:r,room:o,PlayerClass:c=r===1?l7:js}=e;var u;super(),b(this,"id",DA()),b(this,"userId",""),b(this,"isRemote"),b(this,"mediaType"),b(this,"room"),b(this,"user"),b(this,"_log"),b(this,"_inputTrack"),b(this,"_outputTrack"),b(this,"isPlayCalled"),b(this,"container",null),b(this,"player"),b(this,"subVideoPlayerMap"),b(this,"muted",!1),b(this,"abortCtrl"),b(this,"objectFit","cover"),b(this,"mirror"),b(this,"isScreen",!1),b(this,"manager"),b(this,"trackSettings"),this.userId=t||"",this.mediaType=r,this._log=Te.createLogger({id:"".concat(this.kind[0],"t"),userId:(u=o||this.room)==null?void 0:u.userId,remoteUserId:this instanceof Jr?void 0:this.userId,sdkAppId:i,type:this.mediaType===2?"auxiliary":"main",isLocal:this instanceof Jr}),this.player=new c({id:this.userId||this.id,track:null,muted:!1,container:null,log:this.log}),this.player.on(Cn.PLAYER_STATE_CHANGED,f=>{pe.emit(oe.PLAYER_STATE_CHANGED,Oe({track:this},f)),this.emit("player-state-changed",f)}),this.kind===N.VIDEO&&(this.player.on(Cn.LOADED_DATA,()=>{pe.emit(oe.VIDEO_LOADED_DATA,{track:this})}),this.player.on(Cn.MEDIA_TRACK_CHANGED,f=>{var d;(d=this.subVideoPlayerMap)==null||d.forEach(_=>_.setTrack(f))}))}get log(){return this._log||Te}get kind(){return this.mediaType===1?N.AUDIO:N.VIDEO}get strMediaType(){return this.mediaType===4?N.VIDEO:this.mediaType===2?N.SCREEN:N.AUDIO}get streamType(){return 2&this.mediaType?"auxiliary":"main"}play(e,t){return B(this,null,function*(){let i=ri(e)?e[0]:e;if(this.isPlayCalled)return this.log.info("play update options: ".concat(JSON.stringify(t))),t&&!re(t.muted)&&this.setPlayerMute(t.muted),t&&!re(t.objectFit)&&(this.objectFit=t.objectFit),void(this.player instanceof js&&(this.player.setObjectFit(this.objectFit),this.container!==i&&i&&(this.container=i,this.player.setContainer(i)),ri(e)&&e.length>=1&&(yield this.playSubContainer(e.slice(1),t))));if(t&&!re(t.muted)?this.setPlayerMute(t.muted):(!this.isRemote||this.kind===N.VIDEO)&&this.setPlayerMute(!0),t&&!re(t.objectFit)&&(this.objectFit=t.objectFit),this.player instanceof js&&this.player.setObjectFit(this.objectFit),this.isPlayCalled=!0,i&&(this.container=i,this.player instanceof js&&this.player.setContainer(i)),pe.emit(oe.PLAY_TRACK_START,{track:this}),this._outputTrack){this._log.info("play with options: ".concat(JSON.stringify(t)));try{this.player.setTrack(this.playerMediaTrack),yield this.player.play(),ri(e)&&e.length>1&&(yield this.playSubContainer(e.slice(1),t))}catch(r){throw this.handleAutoPlayFailed(),this.emit("error",r),r}}else this.log.info("play has not mediaTrack, abort")})}setMirror(e,t){if(this.isScreen||this.kind!==N.VIDEO||re(e)||e===this.mirror)return;this.mirror=e;let i=this.player;t&&(i=t);let r=this.manager;if(Pi(this.mirror))return i.setViewMirror(this.mirror),void(r&&(r.mirror=!1));switch(this.mirror){case"view":r&&(r.mirror=!1),i.setViewMirror(!0);break;case"publish":r&&(r.mirror=!0),i.setViewMirror(!0);break;case"both":r&&(r.mirror=!0),i.setViewMirror(!1)}}playSubContainer(e,t){return B(this,null,function*(){if(!this._outputTrack||this.kind===N.AUDIO)return;this.subVideoPlayerMap||(this.subVideoPlayerMap=new Map),this.subVideoPlayerMap.forEach((r,o)=>{var c;e.find(u=>o===u)||(r.stop(),(c=this.subVideoPlayerMap)==null||c.delete(o))});for(let[r,o]of e.entries()){let c=this.subVideoPlayerMap.get(o);c?t&&(re(t.objectFit)||c.setObjectFit(t.objectFit)):this.subVideoPlayerMap.set(o,new js({id:this.userId||this.id,track:this.playerMediaTrack,container:o,muted:this.player.muted,objectFit:this.objectFit,log:this.log.createChild({id:"vp-sub".concat(r+1)})}))}let i=[...this.subVideoPlayerMap.values()];for(let r of i)r.setViewMirror(this.player.mirror),yield r.play()})}setAudioOutput(e){return this.player.setSinkId(e)}setAudioVolume(e){this.player.setVolume(e)}getAudioLevel(){return this.player.getAudioLevel()||0}getInternalAudioLevel(){var e;return((e=this.player)==null?void 0:e.getInternalAudioLevel())||0}stop(){!this.isPlayCalled||(this.isPlayCalled=!1,this.player&&(this.log.info("stop ".concat(this.kind," player")),this.player.stop()),this.subVideoPlayerMap&&this.subVideoPlayerMap.size>0&&this.subVideoPlayerMap.forEach(e=>{e.stop()}),this.container=null)}resume(){return B(this,null,function*(){var e;!this.isPlayCalled||(yield(e=this.player)==null?void 0:e.resume())})}close(){this.log.info("close"),this.isPlayCalled&&this.stop()}setMute(e){this.muted=e,this._inputTrack&&(this._inputTrack.enabled=!e),this._outputTrack&&(this._outputTrack.enabled=!e),this.emit(e?"mute":"unmute",this),pe.emit(e?oe.TRACK_MUTED:oe.TRACK_UNMUTED,{track:this})}setPlayerMute(e){this.player.setMuted(e)}get mediaTrack(){return this._inputTrack||null}get outMediaTrack(){return this._outputTrack||null}get playerMediaTrack(){return this.outMediaTrack}setInputMediaStreamTrack(e){var t;let i=this._inputTrack;if(e!==i)return this._inputTrack=e,this.trackSettings=(t=e.getSettings)==null?void 0:t.call(e),e.enabled=!this.muted,this.emit("input-media-track-changed",e||null,i||null),this.manager?this.manager.changeInput(this):this.setOutputMediaStreamTrack(e)}setOutputMediaStreamTrack(e){var t;e!==this._outputTrack&&(this.isRemote?this.log.debug("setOutputMediaStreamTrack",e.label):this.log.info("setOutputMediaStreamTrack",(t=e.getSettings)==null?void 0:t.call(e).deviceId,e.label),this._outputTrack=e,this.updatePlayingState(!!e),this.emit("output-media-track-changed",e))}setMediaType(e){this.mediaType=e}updatePlayingState(e){if(this.isPlayCalled){if(e){if(this.player.setTrack(this.playerMediaTrack),this.player.isStopped)return this.player.play().catch(()=>this.handleAutoPlayFailed()),void this.log.info("playing state updated, play ".concat(this.kind))}else if(!this.player.isStopped)return this.player.stop(),void this.log.info("playing state updated, stop ".concat(this.kind))}this.log.debug("updatePlayingState abort ".concat(this.isPlayCalled," ").concat(e," ").concat(this.player.isStopped))}handleAutoPlayFailed(){if(this.room&&this.room.enableAutoPlayDialog)new e7;else{let e=()=>{this.resume().then(()=>{document.removeEventListener("click",e,!0),document.removeEventListener("touchstart",e,!0)})};document.addEventListener("click",e,!0),document.addEventListener("touchstart",e,!0)}}getVideoFrame(){return this.player instanceof js?this.player.getVideoFrame():""}};Ie([si([],Ze.INIT,{sync:!0})],zg.prototype,"close");var u7=Object.prototype.hasOwnProperty,Kr=function(e){if(e==null)return!0;if(typeof e=="boolean")return!1;if(typeof e=="number")return e===0;if(typeof e=="string"||typeof e=="function"||Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(nr(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return e.size===0;case"[object Object]":for(let t in e)if(u7.call(e,t))return!1;return!0}return!1},d7=Qc({retryFunction:function(e){return B(this,null,function*(){let t=function(c){return{audio:h7(c),video:p7(c)}}(e);Te.info("getUserMedia with constraints: ".concat(JSON.stringify(t)));let i=[],r=[],o=["label","deviceId"];t.audio&&(i=yield ar(),Te.info("microphones: ".concat(rr(i,{keysToInclude:o})))),t.video&&(r=yield Gr(),Te.info("cameras: ".concat(rr(r,{keysToInclude:o}))));try{let c=yield navigator.mediaDevices.getUserMedia(t);return BA&&c.getTracks().forEach(u=>{Te.info("".concat(u.kind," capabilities: ").concat(rr(u.getCapabilities(),{keysToInclude:j_})))}),c}catch(c){let{message:u}=c;throw c.name==="NotFoundError"&&(e.video&&r&&r.length===0&&(u=je({key:Ve.CAMERA_NOT_FOUND})),e.audio&&i&&i.length===0&&(u=je({key:Ve.MICROPHONE_NOT_FOUND}))),new ke({code:ge.INITIALIZE_FAILED,name:c.name,message:u,constraint:c.constraint})}})},settings:{retries:3,timeout:500},onError:e=>{let{error:t,retry:i,reject:r,retryFuncArgs:o,retriedCount:c}=e,u=c+1;t.name==="NotReadableError"||t.name==="OverconstrainedError"?(u===1?o[0].video&&(o[0].maxResolution=!1,o[0].frameRate&&(o[0].frameRate=o[0].frameRate>10?10:5)):u===2?o[0].useDeviceIdOnly=!0:u===3&&!o[0].useExactDeviceId&&(o[0].useTrueAsConstraint=!0),i()):r(t),o[0].microphoneId&&dR(o[0].microphoneId,!1),o[0].cameraId&&dR(o[0].cameraId,!0)},onRetrying:e=>{Te.warn("getUserMedia NotReadableError observed, retrying [".concat(e,"/3]"))},onRetryFailed:e=>{Ht.logFailedEvent({eventType:er.GET_USER_MEDIA_RETRY,error:e})},onRetrySuccess:e=>{Ht.logSuccessEvent({eventType:er.GET_USER_MEDIA_RETRY}),Ht.uploadEvent({log:"stat-".concat(er.GET_USER_MEDIA_RETRY,"-success-").concat(e)})}});function dR(e,t){return B(this,null,function*(){let i=(t?yield Gr():yield ar()).find(r=>r.deviceId===e);i&&Tt(i.getCapabilities)&&Te.warn(rr(i.getCapabilities(),{keysToInclude:j_}))})}function h7(e){if(!e.audio)return!1;if(e.useTrueAsConstraint)return!0;let t={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:e.sampleRate};return!Kr(e.microphoneId)&&(t.deviceId=e.useExactDeviceId?{exact:e.microphoneId}:e.microphoneId,e.useDeviceIdOnly)?t:(Qt(e.channelCount)&&(t.channelCount=e.channelCount),Pi(e.echoCancellation)&&!e.echoCancellation&&(t.echoCancellation=!1),Pi(e.noiseSuppression)&&!e.noiseSuppression&&(t.noiseSuppression=!1),Pi(e.autoGainControl)&&!e.autoGainControl&&(t.autoGainControl=!1),!!Kr(t)||t)}function p7(e){if(!e.video)return!1;if(e.useTrueAsConstraint)return!0;let{maxResolution:t=!0}=e,i={};return e.cameraId?i.deviceId=e.useExactDeviceId?{exact:e.cameraId}:e.cameraId:e.facingMode&&(i.facingMode=e.facingMode),e.useDeviceIdOnly&&!Kr(i)?i:(e.width&&(i.width={ideal:e.width},t&&!Ct&&(i.width.max=e.width)),e.height&&(i.height={ideal:e.height},t&&!Ct&&(i.height.max=e.height)),Ct&&xs&&e.width&&e.height&&e.width*e.height<101376&&(i.width=e.width,i.height=e.height),e.frameRate&&(i.frameRate=e.frameRate),!!Kr(i)||i)}var f7=d7;function hR(e){return St((t,i)=>function(){for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return B(this,null,function*(){return yield e.apply(this,o),t.apply(this,o)})})}function pR(e){return St((t,i)=>function(){for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return B(this,null,function*(){return e.call(this,t.apply(this,o))})})}function St(e){return function(t,i,r){return r.value=e(r.value,i),r}}var m7=(()=>{let e=!1,t=document.visibilityState;return()=>{document.visibilityState!==t&&Te.info("visibility change: ".concat(document.visibilityState)),!e&&(document.addEventListener("visibilitychange",()=>{Te.info("visibility change: ".concat(document.visibilityState)),t=document.visibilityState}),e=!0)}})(),_7=0,fR=class{constructor(){this.log=Te.createLogger({id:"fq".concat(++_7)}),this.isRunning=!1,this.queue=[]}get length(){return this.queue.length}get lastQueueItem(){return this.length===0?null:this.queue[this.length-1]}push(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];var i,r;let o=Oe({},e),c=new Promise((u,f)=>{o.resolve=u,o.reject=f});return o.promise=c,t?this.length<=1?this.queue.push(o):(r=(i=this.lastQueueItem)==null?void 0:i.promise)==null||r.then(o.resolve,o.reject):this.queue.push(o),this.log.debug("push ".concat(this.length)),this.isRunning||this.callNext(),c}shift(){let e=this.queue.shift();return this.log.debug("shift ".concat(this.length)),e}callNext(){if(this.isRunning||this.length===0)return;this.log.debug("callNext ",this.length);let{fn:e,args:t,context:i,resolve:r,reject:o}=this.queue[0];this.isRunning=!0,e.apply(i,t).then(r,o).finally(()=>{this.isRunning=!1,this.shift(),this.callNext()})}},hl=new WeakMap,oh=new WeakMap;function Sa(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return function(t,i,r){let o=r.value;return r.value=function(){let c=hl.get(this)||new fR;for(var u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];return hl.set(this,c),c.push({fn:o,args:f,context:this},e)},r}}function mR(e){return function(t,i,r){let o=r.value;return r.value=function(){var c,u,f;let d=[];for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];return(u=(c=hl.get(this))==null?void 0:c.queue)==null||u.forEach(R=>d.push(R)),(f=oh.get(this))==null||f.forEach(R=>R==null?void 0:R.queue.forEach(k=>d.push(k))),d.forEach(R=>{R.reject(new ke({code:ge.API_CALL_ABORTED,message:e}))}),hl.delete(this),oh.delete(this),o.apply(this,E)},r}}function ah(e){return function(t,i,r){let o=r.value,c=u=>e(...u);return r.value=function(){for(var u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];let _=oh.get(this)||new Map,E=_.get(c(f))||new fR;return _.set(c(f),E),oh.set(this,_),E.push({fn:o,args:f,context:this})},r}}var Jr=class extends zg{constructor(e,t){super({mediaType:e,PlayerClass:t}),b(this,"isRemote",!1),b(this,"deviceId"),b(this,"groupId",""),b(this,"label",""),b(this,"_isRecapturing",!1),b(this,"_lastRecaptureTime",0),b(this,"_onMuteTimeoutId",-1),b(this,"profile"),this.onTrackMuted=this.onTrackMuted.bind(this),this.onTrackUnmuted=this.onTrackUnmuted.bind(this),this.onTrackEnded=this.onTrackEnded.bind(this)}get isPublished(){return this.state==="publish"}installTrackEvent(e){wn(e,e).add(N.MUTE,this.onTrackMuted).add(N.UNMUTE,this.onTrackUnmuted).add(N.ENDED,this.onTrackEnded),e.muted&&this.onTrackMuted(),e.readyState===N.ENDED&&this.onTrackEnded()}uninstallTrackEvent(e){Ti(e)}setStateToCapture(){}capture(e){return B(this,null,function*(){var t;try{let i,r=it();pe.emit(oe.LOCAL_TRACK_CAPTURE_START,{track:this}),e.customSource?(i=new MediaStream,i.addTrack(e.customSource)):((t=this.mediaTrack)==null||t.stop(),i=yield f7(e));let o=i.getTracks()[0];return yield this.setInputMediaStreamTrack(o),e.customSource||(this.updateDeviceIdInUse(),this.listenDeviceChange()),pe.emit(oe.LOCAL_TRACK_CAPTURE_SUCCESS,{track:this,cost:it()-r}),i}catch(i){throw pe.emit(oe.LOCAL_TRACK_CAPTURE_FAILED,{track:this,error:i}),this.log.error("getUserMedia error observed ".concat(i)),i}})}setInputMediaStreamTrack(e){this.state===Ze.INIT&&this.setStateToCapture(),this._inputTrack&&this.uninstallTrackEvent(this._inputTrack);let t=super.setInputMediaStreamTrack(e);return this.installTrackEvent(e),t}setOutputMediaStreamTrack(e){var t;return super.setOutputMediaStreamTrack(e),(t=this.room)==null?void 0:t.replaceTrack(this)}publish(e,t){return this.room=e,this.emit("4",{mediaType:this.strMediaType,state:"starting",prevState:"stopped"}),this.userId=e.userId,this._log.setUserId(e.userId),this._log.setSdkAppId(e.sdkAppId),t}unpublish(){this.room&&this.room.localTracks.delete(this),pe.emit(oe.LOCAL_TRACK_UNPUBLISHED,{track:this})}updateDeviceIdInUse(){return B(this,null,function*(){if(this.mediaTrack&&ga){let{deviceId:e,groupId:t}=this.mediaTrack.getSettings(),{label:i}=this.mediaTrack;(yield function(r){return B(this,arguments,function(o){let{newDeviceId:c,oldDeviceId:u,oldGroupId:f,oldLabel:d,kind:_}=o;return function*(){return c===u&&(_!==N.AUDIO||c!==Lc||(yield uR(f,d)))}()})}({newDeviceId:e,oldDeviceId:this.deviceId,oldGroupId:this.groupId,oldLabel:this.label,kind:this.kind}))||(this.deviceId=e,this.label=i,t&&(this.groupId=t),Hg().then(r=>{let o=r.find(c=>c.deviceId===e);o&&this.emit("2",o)}))}})}setProfile(e){this.log.info("setProfile",e),Object.assign(this.profile,e)}isNeedToRecapture(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!(!this.deviceId||!this.mediaTrack||this.kind===N.AUDIO&&!function(t){if(t instanceof CanvasCaptureMediaStreamTrack||!(t instanceof MediaStreamTrack))return!1;let i=t.label.toLocaleLowerCase();if(i.includes("mic")||i.includes(""))return!0;let r="".concat(((t==null?void 0:t.getSettings())||{}).deviceId,"_").concat(N.AUDIO_INPUT);return!!jg.has(r)}(this.mediaTrack)||this.kind===N.VIDEO&&!function(t){if(t instanceof CanvasCaptureMediaStreamTrack||!(t instanceof MediaStreamTrack))return!1;let i=t.label.toLocaleLowerCase();if(i.includes("camera")||i.includes("webcam"))return!0;let r="".concat(((t==null?void 0:t.getSettings())||{}).deviceId,"_").concat(N.VIDEO_INPUT);return!!jg.has(r)}(this.mediaTrack)||this._isRecapturing||e&&xs&&ir)}onTrackMuted(){if(m7(),this.isNeedToRecapture(!0)){if(Date.now()-this._lastRecaptureTime<Vc)return void setTimeout(()=>this.onTrackMuted(),Vc);this._onMuteTimeoutId=setTimeout(()=>B(this,null,function*(){var e;if((e=this.mediaTrack)!=null&&e.muted){if((tr||Gi)&&document.visibilityState!=="visible")return;this.recapture(yield this.getRecoverCaptureDeviceId())}}),5e3)}}onTrackUnmuted(){this._onMuteTimeoutId>0&&clearTimeout(this._onMuteTimeoutId)}onTrackEnded(){return B(this,null,function*(){if(this.isNeedToRecapture()){if(Date.now()-this._lastRecaptureTime<Vc)return void setTimeout(()=>this.onTrackEnded(),Vc);this.recapture(yield this.getRecoverCaptureDeviceId())}})}recapture(e){return B(this,null,function*(){var t;if(this._isRecapturing||!this._inputTrack)return;this.log.warn("recapture trying"),(t=this._inputTrack)==null||t.stop(),this._isRecapturing=!0,this._lastRecaptureTime=Date.now();let i={useExactDeviceId:!0};if(e==="user"||e==="environment")i.facingMode=e;else{let r;(this.kind==="audio"?yield ar():yield Gr()).find(o=>o.deviceId===e)&&(r=e),i.deviceId=r}return this.capture(i).then(()=>{this._isRecapturing=!1,this.log.warn("recapture success"),this.emit("1",{deviceId:this.deviceId})}).catch(r=>{this._isRecapturing=!1,this.log.warn("recapture failed ".concat(r.message)),this.emit("5",r)})})}getRecoverCaptureDeviceId(){return B(this,null,function*(){let e=this instanceof Mi;if(e&&this.facingMode)return this.facingMode;let{deviceId:t}=this;if(t){let i=(pl.get(t)||0)+1;if(pl.set(t,i),i>=3){let r=e?(yield Gr()).find(o=>!pl.has(o.deviceId)):(yield ar()).find(o=>!pl.has(o.deviceId));r&&(this.log.warn("".concat(t," capture fail ").concat(i," times, change new ").concat(r.deviceId)),t=r.deviceId)}}return t})}close(){var e;super.close(),this._inputTrack&&(this._inputTrack.stop(),this.uninstallTrackEvent(this._inputTrack)),(e=this.manager)==null||e.removeInput(this)}};Ie([si(Ze.INIT,"capture",{ignoreError:!0,sync:!0})],Jr.prototype,"setStateToCapture"),Ie([Sa()],Jr.prototype,"capture"),Ie([si("capture","publish",{ignoreError:!0,success(){this.room.localTracks.add(this),pe.emit(oe.LOCAL_TRACK_PUBLISHED,{track:this}),this.emit("4",{mediaType:this.strMediaType,state:"started",prevState:"starting"})},fail(e){let t="error",i=e.cause;i.message.includes("timeout")?t="timeout":i.code===ge.API_CALL_ABORTED&&(t="api-call"),this.emit("4",{mediaType:this.strMediaType,state:"stopped",prevState:"starting",reason:t,error:i})}})],Jr.prototype,"publish"),Ie([St(e=>function(){return B(this,null,function*(){let t=this.state==="publish"?"started":"starting";e.call(this),this.emit("4",{mediaType:this.strMediaType,state:"stopped",prevState:t,reason:"api-call"})})}),si([],"capture",{sync:!0})],Jr.prototype,"unpublish");var pl=new Map;pe.on(oe.SWITCH_DEVICE_SUCCESS,e=>{e.track.deviceId&&pl.delete(e.track.deviceId)});var cr=class extends Jr{constructor(e){super(1,c7),b(this,"mediaType",1),b(this,"volume",0),b(this,"profile",{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,sampleRate:48e3,channelCount:1,bitrate:40}),b(this,"playerMuted",!0),b(this,"pipeline"),this.manager=e,this.pipeline=new oR(e),this.handleMicrophoneAdded=this.handleMicrophoneAdded.bind(this),this.handleMicrophoneRemoved=this.handleMicrophoneRemoved.bind(this)}getAudioLevel(){let e=(this.volume||super.getAudioLevel())*this.captureVolume;return e>1?1:e}get playerMediaTrack(){return this.mediaTrack}setInputMediaStreamTrack(e){return B(this,null,function*(){yield rn(cr.prototype,this,"setInputMediaStreamTrack").call(this,e);let t=this.trackSettings||{};et.addEnum({key:501701,value:t.channelCount||0,useUV:!1}),et.addEnum({key:501702,value:t.sampleRate||0,useUV:!1}),et.addEnum({key:502700,value:0});let{sampleRate:i,channelCount:r}=t;this._log.info("local audio track input ".concat(JSON.stringify({sampleRate:i,channelCount:r}))),this.pipeline.replaceSource(e),this.updatePlayingState(!!e)})}capture(e){let{deviceId:t,customSource:i,useExactDeviceId:r=!1}=e;return super.capture({video:!1,audio:!0,microphoneId:t,echoCancellation:this.profile.echoCancellation,autoGainControl:this.profile.autoGainControl,noiseSuppression:this.profile.noiseSuppression,sampleRate:this.profile.sampleRate,channelCount:this.profile.channelCount,useExactDeviceId:r,customSource:i})}switchDevice(e){return B(this,null,function*(){if(this.mediaTrack){if(this.deviceId===e&&(e!==Lc||(yield uR(this.groupId,this.label))))return;try{this.log.info("switchDevice audio to: ".concat(e)),this.mediaTrack&&this.mediaTrack.stop(),yield this.capture({deviceId:e,useExactDeviceId:!0}),this.room&&(yield this.room.replaceTrack(this)),pe.emit(oe.SWITCH_DEVICE_SUCCESS,{track:this}),this.log.info("switch microphone success")}catch(t){throw this.log.error("switch microphone failed ".concat(t)),this.deviceId&&this.recapture(this.deviceId),t}}})}listenDeviceChange(){oi&&!oi.listeners("audioInputRemoved").includes(this.handleMicrophoneRemoved)&&oi.on("audioInputRemoved",this.handleMicrophoneRemoved,this)}handleMicrophoneRemoved(e){return B(this,null,function*(){if(e.deviceId===this.deviceId){this.log.warn("current microphone is lost: ".concat(JSON.stringify(e)));let t=yield ar();t[0]?this.recapture(t[0].deviceId):oi.on("audioInputAdded",this.handleMicrophoneAdded,this)}})}handleMicrophoneAdded(e){this.log.warn("microphone added: ".concat(JSON.stringify(e))),this.recapture(e.deviceId)}update3A(e){return B(this,arguments,function(t){var i=this;let{echoCancellation:r,noiseSuppression:o,autoGainControl:c}=t;return function*(){let u=!1;!re(r)&&r!==i.profile.echoCancellation&&(i.profile.echoCancellation=r,u=!0),!re(o)&&o!==i.profile.noiseSuppression&&(i.profile.noiseSuppression=o,u=!0),!re(c)&&c!==i.profile.autoGainControl&&(i.profile.autoGainControl=c,u=!0),u&&i.deviceId&&(yield i.recapture(i.deviceId))}()})}get captureVolume(){return this.pipeline.volume}setCaptureVolume(e){this.pipeline.setVolume(e/100),this.pipeline.gain.node&&et.addEnum({key:502700,value:2}),this.resetPlayerSource()}enableTrackANS(e){if(!this._inputTrack)return;let t=this._inputTrack.getConstraints();return t.noiseSuppression=e,this._inputTrack.applyConstraints(t).catch(i=>this._log.warn("".concat(e?"enable":"disable"," ANS failed "),i))}addDenoiser(e){var t;ha<=92&&((t=this.trackSettings)==null?void 0:t.sampleRate)!==48e3?this._log.warn("denoiser only support sampleRate 48000 before chrome 93"):(et.addEnum({key:502700,value:1}),this.pipeline.denoiser.setNode(e),this.resetPlayerSource(),this.enableTrackANS(!1))}removeDenoiser(e){this.pipeline.denoiser.node===e&&(this.pipeline.denoiser.deleteNode(),this.resetPlayerSource(),this.enableTrackANS(!0))}resetPlayerSource(){this.player.setSourceNode(this.pipeline.gain.node||this.pipeline.denoiser.node||this.pipeline.source.node)}close(){this.pipeline.remove(),oi.off("audioInputAdded",this.handleMicrophoneAdded,this),oi.off("audioInputRemoved",this.handleMicrophoneRemoved,this),super.close()}recapture(e){return B(this,null,function*(){try{yield rn(cr.prototype,this,"recapture").call(this,e)}catch(t){let i=(yield ar()).find(r=>r.deviceId!==e);if(!i)throw t;yield rn(cr.prototype,this,"recapture").call(this,i.deviceId)}})}},Mi=class extends Jr{constructor(e){super(arguments.length>1&&arguments[1]!==void 0?arguments[1]:4,js),b(this,"profile",{width:640,height:480,frameRate:15,bitrate:500}),b(this,"states",{bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0}),b(this,"small"),b(this,"isNeedToSetBandwidth"),b(this,"muteImage"),b(this,"manager"),this.manager=e;let t=()=>{this.isAllowed2k4k(this.profile)?this.room&&this.settings.height>=1440&&this.state==="publish"&&this.room.sendAbilityStatus({"2k4k":1}):(this.log.warn("Resolution is reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386"),this.setProfile(qe(Oe({},this.profile),{width:1920,height:1080})),this.applyProfile())};this.on("input-media-track-changed",t),this.on("publish",t),this.handleCameraAdded=this.handleCameraAdded.bind(this),this.handleCameraRemoved=this.handleCameraRemoved.bind(this)}get facingMode(){if(ga&&this.mediaTrack)return this.mediaTrack.getSettings().facingMode}setMute(e){return B(this,null,function*(){var t,i,r;if(_t(e)){if(this.muteImage===e)return;yield(t=this.manager)==null?void 0:t.deleteWatermark("mute"),yield(i=this.manager)==null?void 0:i.setWatermark({x:0,y:0,width:this.settings.width,height:this.settings.height,type:"mute",zIndex:999,imageUrl:e}),this.muteImage=e,rn(Mi.prototype,this,"setMute").call(this,!1)}else yield(r=this.manager)==null?void 0:r.deleteWatermark("mute"),this.muteImage=void 0,rn(Mi.prototype,this,"setMute").call(this,e)})}capture(e){let{deviceId:t,facingMode:i,useExactDeviceId:r=!1,customSource:o}=e;return super.capture({audio:!1,video:!0,facingMode:i||this.facingMode,cameraId:t,width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate,useExactDeviceId:r,customSource:o})}setProfile(e){let t=Oe({},e),i=t.width>t.height;t.width*t.height<=19200&&Gi&&Yc&&(this.log.warn("resolution is ".concat(t.width,"*").concat(t.height,", fallback to 240*180")),t.width=i?240:180,t.height=i?180:240,t.bitrate=Math.max(t.bitrate,150)),t.width*t.height>921600&&dA&&(t.width=i?1280:720,t.height=i?720:1280,this.log.warn("reset to 1280 * 720 on iOS 13~14")),t.bitrate&&(this.isNeedToSetBandwidth=t.bitrate!==this.profile.bitrate),this.isAllowed2k4k(this.profile)?super.setProfile(t):(this.log.warn("Resolution is reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386"),super.setProfile(qe(Oe({},this.profile),{width:1920,height:1080})))}applyProfile(){var e;if(!this.mediaTrack)return;let t=this.settings;return t.height!==this.profile.height||t.width!==this.profile.width||t.frameRate!==this.profile.frameRate?(e=this.mediaTrack)==null?void 0:e.applyConstraints({width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate}).then(()=>{if(this.manager&&this.manager.changeInput(this),this.room&&this.settings.height>=1440&&this.state==="publish"&&this.room.sendAbilityStatus({"2k4k":1}),this.isNeedToSetBandwidth&&this.room&&this.room.setBandWidth)return this.isNeedToSetBandwidth=!1,this.room.setBandWidth({bandwidth:this.profile.bitrate,type:N.VIDEO,videoType:N.BIG})}):void 0}get settings(){let e={width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate};return ga&&this.mediaTrack&&Object.assign(e,this.mediaTrack.getSettings()),e}get scaleResolutionDownBy(){let{settings:e}=this;return e.width===this.profile.width&&e.height===this.profile.height?1:kA()&&this.profile.width>this.profile.height&&e.height>e.width?Math.max(e.width/this.profile.height,e.height/this.profile.width,1):Math.max(e.width/this.profile.width,e.height/this.profile.height,1)}isAllowed2k4k(e){var t;return!(this.room&&this.room.scheduleResult&&!this.isScreen&&!(e.height*e.width<3686400))||((t=this.room.scheduleResult.trtcAutoConf)==null?void 0:t["2k4k"])===1}isNeedToSwitchDevice(e){return!(!this.mediaTrack||this.deviceId===e||this.facingMode===e)}switchDevice(e){return B(this,null,function*(){try{if(!this.isNeedToSwitchDevice(e))return;let t={useExactDeviceId:!0};e==="user"||e==="environment"?t.facingMode=e:t.deviceId=e,this.mediaTrack.stop(),yield this.capture(t),pe.emit(oe.SWITCH_DEVICE_SUCCESS,{track:this}),this.log.info("switch camera success")}catch(t){throw this.log.error("switch camera failed ".concat(t)),this.deviceId&&this.recapture(this.deviceId),t}})}listenDeviceChange(){oi&&!oi.listeners("videoInputRemoved").includes(this.handleCameraRemoved)&&oi.on("videoInputRemoved",this.handleCameraRemoved,this)}handleCameraRemoved(e){return B(this,null,function*(){if(e.deviceId===this.deviceId){this.log.warn("current camera is lost: ".concat(JSON.stringify(e)));let t=yield Gr();t[0]?this.recapture(t[0].deviceId):oi.on("videoInputAdded",this.handleCameraAdded,this)}})}handleCameraAdded(e){return B(this,null,function*(){this.log.warn("camera added: ".concat(JSON.stringify(e))),this.recapture(e.deviceId)})}play(e,t){return B(this,null,function*(){return re(this.mirror)&&!this.isScreen&&this.setMirror("view"),rn(Mi.prototype,this,"play").call(this,e,t)})}close(){oi.off("videoInputAdded",this.handleCameraAdded,this),oi.off("videoInputRemoved",this.handleCameraRemoved,this),super.close()}recapture(e){return B(this,null,function*(){try{yield rn(Mi.prototype,this,"recapture").call(this,e)}catch(t){let i=(yield Gr()).find(r=>r.deviceId!==e);if(!i)throw t;yield rn(Mi.prototype,this,"recapture").call(this,i.deviceId)}})}},_R=DA();if(navigator.mediaDevices&&"setCaptureHandleConfig"in navigator.mediaDevices)try{navigator.mediaDevices.setCaptureHandleConfig({handle:_R,exposeOrigin:!0,permittedOrigins:["*"]})}catch{}var Gg,g7=function(e){return B(this,null,function*(){let t=null,i=function(c){let u={preferCurrentTab:c.preferDisplaySurface==="current-tab",systemAudio:"include",selfBrowserSurface:"include",surfaceSwitching:"include"},f={width:ir?{max:c.width}:{ideal:c.width,max:c.width},height:ir?{max:c.height}:{ideal:c.height,max:c.height},frameRate:c.frameRate,displaySurface:c.preferDisplaySurface||"monitor"};if(u.video=f,c.systemAudio){let{echoCancellation:d=!0,noiseSuppression:_=!1,autoGainControl:E=!1}=c;u.audio={echoCancellation:d,noiseSuppression:_,autoGainControl:E,sampleRate:48e3}}return u}(e);Te.info("getDisplayMedia with constraints: ".concat(JSON.stringify(i)));let r=yield navigator.mediaDevices.getDisplayMedia(i);e.systemAudio&&r.getAudioTracks().length===0&&(zd&&ha<74||ir||Ct)&&Te.warn("Your browser not support capture system audio");let o=r.getVideoTracks()[0];if(o){if(e.frameRate)try{yield o.applyConstraints({frameRate:{min:e.frameRate,ideal:e.frameRate},width:e.width,height:e.height})}catch(c){Te.warn("screen applyConstraints failed: ".concat(c))}e.captureElement&&(yield function(c,u){return B(this,null,function*(){var f;if("CropTarget"in window&&"fromElement"in CropTarget&&Tt(c.cropTo))try{if(((f=c.getCaptureHandle())==null?void 0:f.handle)!==_R)return;let d=yield CropTarget.fromElement(u);yield c.cropTo(d)}catch(d){Te.warn("cropTo target failed ".concat(d))}})}(o,e.captureElement))}if(e.audio){let c=function(u){let f={echoCancellation:u.echoCancellation,autoGainControl:u.autoGainControl,noiseSuppression:u.noiseSuppression,sampleRate:u.sampleRate,channelCount:u.channelCount};return re(u.microphoneId)||(f.deviceId=u.microphoneId),{audio:f,video:!1}}(e);Te.info("getUserMedia with constraints: ".concat(JSON.stringify(c))),t=yield navigator.mediaDevices.getUserMedia(c),r.addTrack(t.getAudioTracks()[0])}return r})},zs=class extends Mi{constructor(e){super(e,2),b(this,"profile",{width:1920,height:1080,frameRate:5,bitrate:1600}),b(this,"objectFit","contain"),b(this,"isScreen",!0),this._log.id="s-".concat(this._log.id)}capture(e){return B(this,arguments,function(t){var i=this;let{systemAudio:r=!1,autoGainControl:o,echoCancellation:c,noiseSuppression:u,audioTrack:f,videoTrack:d,captureElement:_,preferDisplaySurface:E}=t;return function*(){try{let S;return d||f?(S=new MediaStream,d&&S.addTrack(d),f&&S.addTrack(f)):S=yield g7({audio:!1,systemAudio:r,width:i.profile.width,height:i.profile.height,frameRate:i.profile.frameRate,autoGainControl:o,echoCancellation:c,noiseSuppression:u,captureElement:_,preferDisplaySurface:E}),yield i.setInputMediaStreamTrack(S.getVideoTracks()[0]),S}catch(S){throw i.log.error("getDisplayMedia error observed ".concat(S)),S instanceof ke?S:new ke({code:ge.INITIALIZE_FAILED,name:S.name,message:S.message})}}()})}switchDevice(e){return B(this,null,function*(){throw new Error("Method not implemented.")})}},fl=class extends cr{constructor(e){super(e),this._log.id="s-".concat(this._log.id)}},v7=class extends n7{constructor(e){super(),this.room=e,b(this,"_localAudioTrack"),b(this,"_localScreenAudioTrack"),b(this,"log",Te.createLogger({id:"am"})),b(this,"denoiser"),e&&(this.log.setUserId(e.userId),this.log.setSdkAppId(e.sdkAppId))}get _localAudioPipline(){var e;return(e=this._localAudioTrack)==null?void 0:e.pipeline}dump(e){var t,i;if(!this._localAudioTrack)return;let r=[],o=[];(t=this._localAudioPipline)!=null&&t.source.node&&(r.push(this._localAudioPipline.source.node),o.push("mic")),(i=this._localAudioPipline)!=null&&i.denoiser.node&&(r.push(this._localAudioPipline.denoiser.node),o.push("mic-processed")),this.mixWeight>1&&(r.push(this.audioContext.createMediaStreamSource(this._localAudioPipline.stream)),o.push("mix")),this.log.info("dump audio track ".concat(o,", duration: ").concat(e));let c=new AbortController,u=[],f=setTimeout(()=>{this.log.info('dump audio track complete please input "download()" to download.'),c.abort("timeout")},1e3*e),d=()=>{for(let E=0;E<o.length;E++){let S=URL.createObjectURL(new Blob(u[E])),R=document.createElement("a");R.href=S,R.download="".concat(o[E],".pcm"),R.style.display="none",document.body.appendChild(R),R.click(),URL.revokeObjectURL(S),R.remove()}clearTimeout(f),c.abort("download")},_=function(E){return B(this,null,function*(){let S=zr();Gg||(Gg=rh(S,URL.createObjectURL(new Blob(["registerProcessor('dumper', class extends AudioWorkletProcessor {process(inputs) {this.port.postMessage(inputs);return true;}});"],{type:"application/javascript"})))),yield Gg;let R=new AudioWorkletNode(S,"dumper",{numberOfInputs:E.length,numberOfOutputs:0});return E.forEach((k,U)=>k.connect(R,0,U)),new ReadableStream({start(k){R.port.onmessage=U=>{k.enqueue(U.data)}},cancel(){E.forEach(k=>k.disconnect(R)),R.port.close()}})})}(r).then(E=>E.pipeTo(new WritableStream({write(S){S.forEach((R,k)=>u[k]=u[k]?u[k].concat(R[0]):[R[0]])}}),c).catch(S=>d));return{then:_.then.bind(_),download:d}}get hasScreenAudioTrack(){return this._localScreenAudioTrack!==null}get hasAudioTrack(){return this._localAudioTrack!==null}changeInput(e){var t;if(e instanceof fl)this._localScreenAudioTrack=e,e.pipeline.connect(),this.mixOnChange();else if(e instanceof cr)this._localAudioTrack=e,this.destination.channelCount=((t=e.trackSettings)==null?void 0:t.channelCount)||1,this.denoiser&&e.addDenoiser(this.denoiser),e.pipeline.connect(),this.mixOnChange();else if(e instanceof Kg)return e.setOutputMediaStreamTrack(e.mediaTrack)}mixOnChange(){var e,t;(e=this._localAudioTrack)==null||e.setOutputMediaStreamTrack(this.mixWeight>1?this.mixTrack:this._localAudioTrack.mediaTrack),(t=this._localScreenAudioTrack)==null||t.setOutputMediaStreamTrack(this.mixWeight>1?this.mixTrack:this._localScreenAudioTrack.mediaTrack)}removeInput(e){e instanceof fl?delete this._localScreenAudioTrack:e instanceof cr&&delete this._localAudioTrack}addDenoiser(e){var t;this.denoiser=e,(t=this._localAudioTrack)==null||t.addDenoiser(e)}removeDenoiser(e){var t;delete this.denoiser,(t=this._localAudioTrack)==null||t.removeDenoiser(e)}destroy(){this.close()}};function gR(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:30,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return St((i,r)=>function(){for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];return new Promise((f,d)=>{let _=setTimeout(()=>{let E=new ke({code:ge.API_CALL_TIMEOUT,message:"checkPendingPromise ".concat(r,"() timeout ").concat(e,"s")});Te.warn(E),t===2?d(E):t===1&&f()},1e3*e);i.apply(this,c).then(f,d).finally(()=>{clearTimeout(_)})})})}var vR=class extends zg{constructor(e,t,i){super({userId:t.userId,sdkAppId:e.sdkAppId,mediaType:i,room:e}),this.room=e,this.user=t,b(this,"tinyId"),b(this,"isRemote",!0),this.tinyId=t.tinyId}setMute(e){this.hasFlag&&super.setMute(e)}setInputMediaStreamTrack(e){super.setInputMediaStreamTrack(e),this.hasFlag&&this.isSubscribed&&this.player.setTrack(this.outMediaTrack)}waitHasMediaTrack(){return new Promise(e=>{this.mediaTrack?e():this.once("input-media-track-changed",e)})}get isSubscribing(){return this.state.toString()==="subscribeing"}get isSubscribed(){return this.state===vR.STATE_SUBSCRIBE}subscribe(e){return e}unsubscribe(){this.player.setTrack(null),this.streamType==="main"&&this.kind==="video"&&this.room.changeType(!1,this.user)}updatePlayingState(e){if(this.isPlayCalled&&this.player.isStopped===e){if(e&&(!this.isSubscribed||!this.hasFlag||!this.outMediaTrack))return void this.log.info("abort play, isSubscribed:".concat(this.isSubscribed," hasFlag:").concat(this.hasFlag," hasTrack:").concat(!!this.outMediaTrack));super.updatePlayingState(e)}}onFlagChanged(){this.updatePlayingState(this.hasFlag)}},Yr=vR;b(Yr,"STATE_SUBSCRIBE","subscribe"),Ie([gR(5,1)],Yr.prototype,"waitHasMediaTrack"),Ie([si(Ze.INIT,Yr.STATE_SUBSCRIBE,{success(){this.log.info("subscribed"),pe.emit(oe.REMOTE_TRACK_SUBSCRIBED,{track:this}),this.updatePlayingState(!0)},ignoreError:!0})],Yr.prototype,"subscribe"),Ie([si(Yr.STATE_SUBSCRIBE,Ze.INIT,{sync:!0,success(){this.log.info("unsubscribed"),this.updatePlayingState(!1),pe.emit(oe.REMOTE_TRACK_UNSUBSCRIBED,{track:this})}})],Yr.prototype,"unsubscribe");var Kg=class extends Yr{constructor(e,t){super(e,t,1),b(this,"volume",0),b(this,"mediaType",1),b(this,"stat",{bytesReceived:0,packetsReceived:0,packetsLost:0,end2EndDelay:0,jitterBufferDelay:0}),this.manager=e.audioManager}getAudioLevel(){let e=this.volume||super.getAudioLevel();return e>1?1:e}get hasFlag(){return this.user.muteState.hasAudio&&!this.user.muteState.audioMuted}isFlagChanged(e){let t=e.hasAudio&&!e.audioMuted;return this.hasFlag||(this.volume=0),this.hasFlag!==t}},ml=class extends Yr{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0?arguments[2]:4),b(this,"mediaType",4),b(this,"source"),b(this,"stat",{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,end2EndDelay:0,jitterBufferDelay:0}),this.manager=e.videoManager}get isBig(){return this.mediaType===4}get isSmall(){return this.mediaType===8}changeType(e){this.room.changeType(e,this.user)}get hasFlag(){return this.user.muteState.hasVideo&&!this.user.muteState.videoMuted}isFlagChanged(e){let t=e.hasVideo&&!e.videoMuted;return this.hasFlag!==t}setMirror(e){e==="publish"||e==="both"||super.setMirror(e)}},yR=class extends ml{constructor(e,t){super(e,t,2),b(this,"mediaType",2),b(this,"objectFit","contain")}get hasFlag(){return this.user.muteState.hasAuxiliary}isFlagChanged(e){let t=e.hasAuxiliary;return this.hasFlag!==t}};function _l(){}var y7=e=>e(),E7=()=>typeof __FASTRX_DEVTOOLS__<"u",T7=1,gl=class extends Function{toString(){return"".concat(this.name,"(").concat(this.args.length?[...this.args].join(", "):"",")")}subscribe(e){let t=new S7(e,this,this.streamId++);return lr.subscribe({id:this.id,end:!1},{nodeId:t.sourceId,streamId:t.id}),this(t),t}},ER=class{constructor(){this.defers=new Set,this.disposed=!1}next(e){}complete(){this.dispose()}error(e){this.dispose()}get bindDispose(){return()=>this.dispose()}dispose(){this.disposed=!0,this.complete=_l,this.error=_l,this.next=_l,this.dispose=_l,this.subscribe=_l,this.doDefer()}subscribe(e){return e instanceof gl?e.subscribe(this):e(this),this}get bindSubscribe(){return e=>this.subscribe(e)}doDefer(){this.defers.forEach(y7),this.defers.clear()}defer(e){this.defers.add(e)}removeDefer(e){this.defers.delete(e)}reset(){this.disposed=!1,delete this.complete,delete this.next,delete this.dispose,delete this.next,delete this.subscribe}resetNext(){delete this.next}resetComplete(){delete this.complete}resetError(){delete this.error}},TR=class extends ER{constructor(e){super(),this.sink=e,e.defer(this.bindDispose)}next(e){this.sink.next(e)}complete(){this.sink.complete()}error(e){this.sink.error(e)}};function ch(e,t,i){if(E7()){let r=Object.defineProperties(Object.setPrototypeOf(e,gl.prototype),{streamId:{value:0,writable:!0,configurable:!0},name:{value:t,writable:!0,configurable:!0},args:{value:i,writable:!0,configurable:!0},id:{value:0,writable:!0,configurable:!0}});lr.create(r);for(let o=0;o<i.length;o++){let c=i[o];typeof c=="function"&&c instanceof gl&&lr.addSource(r,c)}return r}return e}function qr(e,t){window.postMessage({source:"fastrx-devtools-backend",payload:{event:e,payload:t}})}var S7=class extends TR{constructor(e,t,i){super(e),this.source=t,this.id=i,this.sourceId=e.sourceId,this.defer(()=>{lr.defer(this.source,this.id)})}next(e){lr.next(this.source,this.id,e),this.sink.next(e)}complete(){lr.complete(this.source,this.id),this.sink.complete()}error(e){lr.complete(this.source,this.id,e),this.sink.error(e)}},lr={addSource(e,t){qr("addSource",{id:e.id,name:e.toString(),source:{id:t.id,name:t.toString()}})},next(e,t,i){qr("next",{id:e.id,streamId:t,data:i&&i.toString()})},subscribe(e,t){let{id:i,end:r}=e;qr("subscribe",{id:i,end:r,sink:{nodeId:t&&t.nodeId,streamId:t&&t.streamId}})},complete(e,t,i){qr("complete",{id:e.id,streamId:t,err:i?i.toString():null})},defer(e,t){qr("defer",{id:e.id,streamId:t})},pipe(e){qr("pipe",{name:e.toString(),id:e.id,source:{id:e.source.id,name:e.source.toString()}})},update(e){qr("update",{id:e.id,name:e.toString()})},create(e){e.id||(e.id=T7++),qr("create",{name:e.toString(),id:e.id})}},I7=class extends ER{constructor(e){super(),this.source=e,this.sinks=new Set}add(e){e.defer(()=>this.remove(e)),this.sinks.add(e).size===1&&(this.reset(),this.subscribe(this.source))}remove(e){this.sinks.delete(e),this.sinks.size===0&&this.dispose()}next(e){this.sinks.forEach(t=>t.next(e))}complete(){this.sinks.forEach(e=>e.complete()),this.sinks.clear()}error(e){this.sinks.forEach(t=>t.error(e)),this.sinks.clear()}},b7=function(e,t){return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return c=>{if(c instanceof gl){let u=ch(f=>{let d=new e(f,...r);d.sourceId=u.id,d.subscribe(c)},t,arguments);return u.source=c,lr.pipe(u),u}return u=>c(new e(u,...r))}}}(class extends TR{constructor(e,t,i){super(e),this.mapper=t,this.thisArg=i}next(e){super.next(this.mapper.call(this.thisArg,e))}},"map");(function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];i.reduce((o,c)=>c(o),e)})(function(e){return ch(t=>{let i=0,r=setInterval(()=>t.next(i++),e);return t.defer(()=>{clearInterval(r)}),"interval"},"interval",arguments)}(250),b7(()=>performance.now()),function(){return e=>{let t=new I7(e);if(e instanceof gl){let i=ch(r=>{t.add(r)},"share",arguments);return t.sourceId=i.id,i.source=e,lr.pipe(i),i}return ch(t.add.bind(t),"share",arguments)}}());var Ia=new Map;function Gt(e,t){let i=qe(Oe({},t),{timestamp:R_()});Ia.has(e)?Ia.get(e).push(i):Ia.set(e,[i])}pe.on(oe.JOIN_SUCCESS,e=>{let{room:t}=e;Gt(t.userId,{eventId:32788,eventDesc:"join room"})}),pe.on(oe.LEAVE_START,e=>{let{room:t}=e;Gt(t.userId,{eventId:32789,eventDesc:"leave room"})}),pe.on(oe.LOCAL_TRACK_PUBLISHED,e=>{let{track:t}=e;if(t.room){let i=32769;t.mediaType===4?i=32768:t.mediaType===2&&(i=32805),Gt(t.room.userId,{eventId:i,eventDesc:"publish ".concat(t.kind)})}}),pe.on(oe.LOCAL_TRACK_UNPUBLISHED,e=>{let{track:t}=e;if(t.room){let i=32771;t.mediaType===4?i=32770:t.mediaType===2&&(i=32806),Gt(t.room.userId,{eventId:i,eventDesc:"unpublish ".concat(t.kind)})}}),pe.on(oe.TRACK_MUTED,e=>{let{track:t}=e;t.room&&(t.kind===N.AUDIO?Gt(t.room.userId,{eventId:t.isRemote?32785:32772,eventDesc:"mute audio",remoteUserId:t.isRemote?t.userId:void 0}):Gt(t.room.userId,{eventId:t.isRemote?32784:32773,eventDesc:"mute video",remoteUserId:t.isRemote?t.userId:void 0}))}),pe.on(oe.TRACK_UNMUTED,e=>{let{track:t}=e;t.room&&(t.kind===N.AUDIO?Gt(t.room.userId,{eventId:t.isRemote?32787:32774,eventDesc:"unmute audio",remoteUserId:t.isRemote?t.userId:void 0}):Gt(t.room.userId,{eventId:t.isRemote?32786:32775,eventDesc:"unmute video",remoteUserId:t.isRemote?t.userId:void 0}))}),pe.on(oe.REMOTE_TRACK_SUBSCRIBED,e=>{let{track:t}=e;!t.room||(t.mediaType===1&&Gt(t.room.userId,{eventId:32777,eventDesc:"".concat(N.SUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),t.mediaType===4&&Gt(t.room.userId,{eventId:32776,eventDesc:"".concat(N.SUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),t.mediaType===8&&Gt(t.room.userId,{eventId:32803,eventDesc:"".concat(N.SUBSCRIBE," ").concat(N.SMALL_VIDEO),remoteUserId:t.userId}))}),pe.on(oe.REMOTE_TRACK_UNSUBSCRIBED,e=>{let{track:t}=e;!t.room||(t.mediaType===1&&Gt(t.room.userId,{eventId:32779,eventDesc:"".concat(N.UNSUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),t.mediaType===4&&Gt(t.room.userId,{eventId:32778,eventDesc:"".concat(N.UNSUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),t.mediaType===8&&Gt(t.room.userId,{eventId:32804,eventDesc:"".concat(N.UNSUBSCRIBE," ").concat(N.SMALL_VIDEO),remoteUserId:t.userId}))}),pe.on(oe.SWITCH_DEVICE_SUCCESS,e=>{let{track:t}=e;t.room&&Gt(t.room.userId,{eventId:t.kind===N.VIDEO?32780:32781,eventDesc:"switch ".concat(t.kind===N.VIDEO?"camera":"microphone")})}),pe.on(oe.LOCAL_TRACK_REPLACED,e=>{let{track:t}=e;t.room&&Gt(t.room.userId,{eventId:t.kind===N.VIDEO?32782:32783,eventDesc:"replace ".concat(t.kind)})}),pe.on(oe.SIGNAL_CONNECTION_STATE_CHANGED,e=>{let t,i,{room:r,prevState:o,state:c}=e;switch(c){case"CONNECTED":o==="RECONNECTING"?(t=32795,i="signal reconnected"):(t=32791,i="signal connected");break;case"DISCONNECTED":o==="RECONNECTING"?(t=32796,i="signal reconnect fail"):(t=32790,i="signal disconnected");break;case"RECONNECTING":t=32794,i="signal reconnecting"}t&&i&&Gt(r.userId,{eventId:t,eventDesc:i})}),pe.on(oe.PEER_CONNECTION_STATE_CHANGED,e=>{let t,i,{room:r,prevState:o,state:c,remoteUserId:u}=e,f=!!u,d=f?"downlink":"uplink";switch(c){case"CONNECTED":o==="RECONNECTING"?(t=f?32801:32798,i="".concat(d," reconnected")):(t=f?32793:32792,i="".concat(d," connected"));break;case"DISCONNECTED":o==="RECONNECTING"&&(t=f?32802:32799,i="".concat(d," reconnect fail"));break;case"RECONNECTING":t=f?32800:32797,i="".concat(d," reconnecting")}t&&i&&Gt(r.userId,{eventId:t,eventDesc:i,remoteUserId:u})});var A7=ni(Di(),1),R7=class extends A7.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"userId";super(),this.mySelfId=e,this._log=t,this.key=i,b(this,"userMap",new Map),b(this,"remotePublishedUserMap",new Map)}getPublishedUser(e){return this.remotePublishedUserMap.get(e)}addUser(e){let t=e[this.key],{userId:i,tinyId:r,role:o}=e;if(this.userMap.has(t))return;let c={userId:i,tinyId:r,role:o===20?"anchor":"audience"};this.userMap.set(t,c),this.emit("1",c)}deleteUser(e,t){let i=this.userMap.get(e);if(!i)return;let r="peer leave [".concat(e,"]");re(t)||(r+=":".concat(Qb[t])),this._log.info(r);let o=this.remotePublishedUserMap.get(e);if(o){let c=o.muteState;o.flag=0,this.emit("5",o.userId),this.deleteRemotePublishedUser(e),this.emit("6",{prevMuteState:c,muteState:o.muteState,flag:0})}this.userMap.delete(e),this.emit("2",i.userId)}setUserList(e){this.userMap.forEach(t=>{e.findIndex(i=>i[this.key]===t[this.key])<0&&this.deleteUser(t[this.key],0)}),e.forEach(t=>{!this.userMap.has(t[this.key])&&t[this.key]!==this.mySelfId&&this.addUser(t)})}addRemotePublishedUser(e){this.remotePublishedUserMap.has(e[this.key])||this.remotePublishedUserMap.set(e[this.key],e)}deleteRemotePublishedUser(e){!this.remotePublishedUserMap.has(e)||this.remotePublishedUserMap.delete(e)}setRemotePublishedUserList(e){this.remotePublishedUserMap.forEach(t=>{let i=t[this.key];if(e.findIndex(r=>r[this.key]===t[this.key])<0){this._log.info("remote [".concat(i,"] unpublish"));let r=t.muteState;t.flag=0,this.emit("5",t.userId),this.deleteRemotePublishedUser(i),this.emit("6",{prevMuteState:r,muteState:t.muteState,flag:0})}}),e.forEach(t=>{var i;let r=t[this.key];if(r===this.mySelfId)return;let{flag:o,userId:c,tinyId:u}=t,f=tl(o,c),d=(i=this.remotePublishedUserMap.get(r))==null?void 0:i.muteState;if(d){let _=this.remotePublishedUserMap.get(r);_&&_.flag!==o&&(_.flag=o,this._log.info("remote publish updated: ".concat(JSON.stringify(_.muteState))),this.emit("6",{prevMuteState:d,muteState:f,flag:o}))}else this._log.info("remote publish. state: ".concat(JSON.stringify(f))),this.addUser({userId:c,tinyId:u,role:20}),this.emit("3",t),this.emit("6",{prevMuteState:tl(0,c),muteState:f,flag:o})})}clear(){this.userMap.clear(),this.remotePublishedUserMap.clear()}};function SR(e){let{timesInSecond:t,maxSizeInSecond:i,getSize:r}=e;return St((o,c)=>{let u=new Map;return pe.on(oe.ROOM_DESTROY,f=>{let{room:d}=f;return u.delete(d)}),function(){let f=u.get(this);for(var d=arguments.length,_=new Array(d),E=0;E<d;E++)_[E]=arguments[E];if(f||(f={callCountInSecond:0,timestamp:0,totalSizeInSecond:0},u.set(this,f)),f.timestamp===0?f.timestamp=Date.now():Date.now()-f.timestamp>1e3&&(f.timestamp=Date.now(),f.callCountInSecond=0,f.totalSizeInSecond=0),r&&(f.totalSizeInSecond+=r(..._)),f.timestamp!==0&&Date.now()-f.timestamp<1e3&&(f.callCountInSecond>=t||f.totalSizeInSecond>i))throw new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.CALL_FREQUENCY_LIMIT,data:{isTimes:f.callCountInSecond>=t,isSize:f.totalSizeInSecond>i,name:c,timesInSecond:t,maxSizeInSecond:i}})});f.callCountInSecond++,o.call(this,..._)}})}var ie,IR=!0,ur={SCENE_LIVE:"live",SCENE_RTC:"rtc",ROLE_ANCHOR:"anchor",ROLE_AUDIENCE:"audience",STREAM_TYPE_MAIN:"main",STREAM_TYPE_SUB:"sub",AUDIO_PROFILE_STANDARD:"standard",AUDIO_PROFILE_STANDARD_STEREO:"standard-stereo",AUDIO_PROFILE_HIGH:"high",AUDIO_PROFILE_HIGH_STEREO:"high-stereo",QOS_PREFERENCE_SMOOTH:"smooth",QOS_PREFERENCE_CLEAR:"clear"},Ue={INVALID_PARAMETER:5e3,INVALID_OPERATION:5100,ENV_NOT_SUPPORTED:5200,DEVICE_ERROR:5300,SERVER_ERROR:5400,OPERATION_FAILED:5500,OPERATION_ABORT:5998,UNKNOWN_ERROR:5999},lh=((ie=lh||{})[ie.INVALID_PARAMETER=5e3]="INVALID_PARAMETER",ie[ie.INVALID_PARAMETER_REQUIRED=5001]="INVALID_PARAMETER_REQUIRED",ie[ie.INVALID_PARAMETER_TYPE=5002]="INVALID_PARAMETER_TYPE",ie[ie.INVALID_PARAMETER_EMPTY=5003]="INVALID_PARAMETER_EMPTY",ie[ie.INVALID_PARAMETER_INSTANCE=5004]="INVALID_PARAMETER_INSTANCE",ie[ie.INVALID_PARAMETER_RANGE=5005]="INVALID_PARAMETER_RANGE",ie[ie.INVALID_PARAMETER_LESS_THAN_ZERO=5006]="INVALID_PARAMETER_LESS_THAN_ZERO",ie[ie.INVALID_PARAMETER_MIN=5007]="INVALID_PARAMETER_MIN",ie[ie.INVALID_PARAMETER_MAX=5008]="INVALID_PARAMETER_MAX",ie[ie.INVALID_ELEMENT_ID=5009]="INVALID_ELEMENT_ID",ie[ie.INVALID_ELEMENT_ID_TYPE=5010]="INVALID_ELEMENT_ID_TYPE",ie[ie.INVALID_STREAM_ID=5011]="INVALID_STREAM_ID",ie[ie.INVALID_ROOM_ID_STRING=5012]="INVALID_ROOM_ID_STRING",ie[ie.INVALID_ROOM_ID_INTEGER=5013]="INVALID_ROOM_ID_INTEGER",ie[ie.INVALID_STREAM_TYPE=5014]="INVALID_STREAM_TYPE",ie[ie.INVALID_ROOM_ID_REQUIED=5015]="INVALID_ROOM_ID_REQUIED",ie[ie.INVALID_ROOM_ID_INTEGER_STRING=5016]="INVALID_ROOM_ID_INTEGER_STRING",ie[ie.INVALID_BUFFER_EMPTY=5017]="INVALID_BUFFER_EMPTY",ie[ie.INVALID_BUFFER_OVERSIZE=5018]="INVALID_BUFFER_OVERSIZE",ie[ie.INVALID_OPERATION=5100]="INVALID_OPERATION",ie[ie.INVALID_OPERATION_NOT_JOINED=5101]="INVALID_OPERATION_NOT_JOINED",ie[ie.INVALID_OPERATION_REMOTE_USER_NOT_EXIST=5102]="INVALID_OPERATION_REMOTE_USER_NOT_EXIST",ie[ie.INVALID_OPERATION_STREAM_TYPE_NOT_EXIST=5103]="INVALID_OPERATION_STREAM_TYPE_NOT_EXIST",ie[ie.INVALID_OPERATION_REPEAT_CALL=5104]="INVALID_OPERATION_REPEAT_CALL",ie[ie.INVALID_OPERATION_NEED_VIDEO=5105]="INVALID_OPERATION_NEED_VIDEO",ie[ie.INVALID_OPERATION_NEED_AUDIO=5106]="INVALID_OPERATION_NEED_AUDIO",ie[ie.INVALID_ROLE_AUDIENCE=5107]="INVALID_ROLE_AUDIENCE",ie[ie.ENV_NOT_SUPPORTED=5200]="ENV_NOT_SUPPORTED",ie[ie.NOT_SUPPORTED_HTTP=5201]="NOT_SUPPORTED_HTTP",ie[ie.NOT_SUPPORTED_WEBRTC=5202]="NOT_SUPPORTED_WEBRTC",ie[ie.NOT_SUPPORTED_H264_ENCODE=5203]="NOT_SUPPORTED_H264_ENCODE",ie[ie.NOT_SUPPORTED_H264_DECODE=5204]="NOT_SUPPORTED_H264_DECODE",ie[ie.NOT_SUPPORTED_SCREEN_SHARE=5205]="NOT_SUPPORTED_SCREEN_SHARE",ie[ie.NOT_SUPPORTED_SMALL_VIDEO=5206]="NOT_SUPPORTED_SMALL_VIDEO",ie[ie.NOT_SUPPORTED_SEI=5207]="NOT_SUPPORTED_SEI",ie[ie.NOT_SUPPORTED_WEBGL=5208]="NOT_SUPPORTED_WEBGL",ie[ie.NOT_SUPPORTED_CHROME_VERSION=5209]="NOT_SUPPORTED_CHROME_VERSION",ie[ie.DEVICE_ERROR=5300]="DEVICE_ERROR",ie[ie.DEVICE_NOT_FOUND_ERROR=5301]="DEVICE_NOT_FOUND_ERROR",ie[ie.DEVICE_NOT_ALLOWED_ERROR=5302]="DEVICE_NOT_ALLOWED_ERROR",ie[ie.DEVICE_NOT_READABLE_ERROR=5303]="DEVICE_NOT_READABLE_ERROR",ie[ie.DEVICE_OVERCONSTRAINED_ERROR=5304]="DEVICE_OVERCONSTRAINED_ERROR",ie[ie.DEVICE_INVALID_STATE_ERROR=5305]="DEVICE_INVALID_STATE_ERROR",ie[ie.DEVICE_SECURITY_ERROR=5306]="DEVICE_SECURITY_ERROR",ie[ie.DEVICE_ABORT_ERROR=5307]="DEVICE_ABORT_ERROR",ie[ie.CAMERA_RECOVER_FAILED=5308]="CAMERA_RECOVER_FAILED",ie[ie.MICROPHONE_RECOVER_FAILED=5309]="MICROPHONE_RECOVER_FAILED",ie[ie.SERVER_ERROR=5400]="SERVER_ERROR",ie[ie.NEED_TO_BUY=5401]="NEED_TO_BUY",ie[ie.ACCOUNT_NO_MONEY=-100013]="ACCOUNT_NO_MONEY",ie[ie.OPERATION_FAILED=5500]="OPERATION_FAILED",ie[ie.FIREWALL_RESTRICTION=5501]="FIREWALL_RESTRICTION",ie[ie.REJOIN_FAILED=5502]="REJOIN_FAILED",ie[ie.EVENT_HANDLER_ERROR=5503]="EVENT_HANDLER_ERROR",ie[ie.VIDEO_CONTEXT_ERROR=5504]="VIDEO_CONTEXT_ERROR",ie[ie.OPERATION_ABORT=5998]="OPERATION_ABORT",ie[ie.UNKNOWN_ERROR=5999]="UNKNOWN_ERROR",ie),bR=qe(Oe({},sn),{INVALID_PARAMETER(e){let{fnName:t}=e;return"the parameters of the '".concat(t,"' you called does not meet the requirements, please check the API documentation.")},INVALID_PARAMETER_REQUIRED(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' is a required param when calling ").concat(r,"(), received: ").concat(o,".")},INVALID_PARAMETER_TYPE(e){let{key:t,rule:i,fnName:r,value:o}=e,c="".concat(t||i.name),u="";return u=Array.isArray(i.type)?i.type.join("|"):i.type,"'".concat(c,"' must be type of ").concat(u," when calling ").concat(r,"(), received type: ").concat(Ei(o),".")},INVALID_PARAMETER_EMPTY(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' cannot be '").concat(o,"' when calling ").concat(r,"().")},INVALID_PARAMETER_INSTANCE(e){let{key:t,rule:i,fnName:r,value:o}=e,c="".concat(t||i.name),u="".concat(i.instanceOf.name||i.instanceOf);return"'".concat(c,"' must be instanceof ").concat(u," when calling ").concat(r,"(), received type: ").concat(Ei(o),".")},INVALID_PARAMETER_RANGE(e){let{key:t,rule:i,fnName:r,value:o}=e;return"'".concat(t||i.name,"' must be one of ").concat(i.values.join("|")," when calling ").concat(r,"(), received: ").concat(o,".")},INVALID_PARAMETER_LESS_THAN_ZERO(e){let{key:t,rule:i,fnName:r}=e;return"'".concat(t||i.name,"' cannot be less than 0 when calling ").concat(r,"().")},INVALID_PARAMETER_MIN(e){let{key:t,rule:i,value:r}=e;return"the min value of ".concat(t||i.name," is ").concat(i.min,", received: ").concat(r,".")},INVALID_PARAMETER_MAX(e){let{key:t,rule:i,value:r}=e;return"the max value of ".concat(t||i.name," is ").concat(i.max,", received: ").concat(r,".")},INVALID_ELEMENT_ID(e){let{key:t,fnName:i}=e;return"'".concat(t,"' is not found in the document object when calling ").concat(i,"().")},INVALID_ELEMENT_ID_TYPE(e){let{key:t,fnName:i,type:r}=e;return"the element corresponding to '".concat(t,"' must be instanceof HTMLElement when calling ").concat(i,"(), received: ").concat(r,".")},INVALID_STREAM_ID(e){let{key:t}=e;return"'".concat(t,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.")},INVALID_ROOM_ID_STRING(e){let{key:t}=e;return"'".concat(t,"' must be a valid string.")},INVALID_ROOM_ID_INTEGER(e){let{key:t}=e;return"'".concat(t,"' must be an integer between [1, 4294967294].")},INVALID_ROOM_ID_INTEGER_STRING(e){let{key:t}=e;return"'".concat(t,"' must be an integer but go a string, use 'parseInt' to convert it or use 'strRoomId' instead.")},INVALID_ROOM_ID_REQUIED:()=>"at least one of 'roomId'(between [1, 4294967294]) and 'strRoomId'(not empty) is required.",INVALID_STREAM_TYPE:e=>{let{fnName:t}=e;return"'streamType' is required when 'userId' is not '*', calling ".concat(t,"()")},INVALID_IMAGE_URL:"The 'src' param must be filled in when the background type is image.",INVALID_OPERATION(e){let{fnName:t}=e;return"the API '".concat(t,"' you called does not meet the requirements, please check the API documentation.")},INVALID_OPERATION_NOT_JOINED(e){let{fnName:t}=e;return"cannot ".concat(t," because you are not enter room yet.")},INVALID_OPERATION_REMOTE_USER_NOT_EXIST(e){let{fnName:t,value:i}=e;return"cannot ".concat(t," because remote user(userId: ").concat(i.userId,") does not publishing stream.")},INVALID_OPERATION_STREAM_TYPE_NOT_EXIST(e){let{fnName:t,value:i}=e;return"cannot ".concat(t," because remote user(userId: ").concat(i.userId,") does not publishing ").concat(i.streamType," video.")},INVALID_OPERATION_REPEAT_CALL(e){let{fnName:t}=e;return"you are already ".concat(t,"(), cannot repeated call '").concat(t,"'.")},INVALID_OPERATION_NEED_VIDEO(e){let{fnName:t}=e;return"cannot call '".concat(t,"' because the camera is not turned on.")},INVALID_OPERATION_NEED_AUDIO(e){let{fnName:t}=e;return"cannot call '".concat(t,"' because the microphone is not turned on.")},INVALID_BUFFER_EMPTY:e=>{let{key:t}=e;return"the buffer size of paramerter '".concat(t,"' cannot be empty")},INVALID_BUFFER_OVERSIZE:()=>"buffer size is over 1000 Bytes",INVALID_ROLE_AUDIENCE:()=>"role: '".concat("audience","' cannot call this api."),ENV_NOT_SUPPORTED(e){let{fnName:t}=e;return"the current browser does not support the capability of the function '".concat(t,"' you are calling, please check the API documentation.")},NOT_SUPPORTED_WEBRTC:"the current browser does not support WebRTC capability, please check the SDK documentation.",NOT_SUPPORTED_H264_ENCODE:"this browser does not support H264 encode.",NOT_SUPPORTED_H264_DECODE:"this browser does not support H264 decode.",NOT_SUPPORTED_SCREEN_SHARE:"this browser does not support screen share, please check the browser version.",NOT_SUPPORTED_SMALL_VIDEO:"this browser does not support small video, please check the browser version.",NOT_SUPPORTED_SEI:"this browser does not support SEI, please check the browser version.",NOT_SUPPORTED_WEBGL:"this browser does not support WebGL, please check the browser version.",NOT_SUPPORTED_CHROME_VERSION(e){let{fnName:t}=e;return"cannot call ".concat(t," because the browser version is too low, please upgrade to the latest version")},DEVICE_ERROR(e){let{fnName:t,error:i}=e;return"'".concat(t,"' got device exception").concat(i?", error: ".concat(i.toString(),"."):".")},DEVICE_NOT_FOUND_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"NotFoundError, no ".concat(i," detected, please check your device and the configuration on '").concat(t,"'").concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_NOT_ALLOWED_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"NotAllowedError, you have disabled ".concat(i," access, please allow the current application to use the ").concat(i).concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_NOT_READABLE_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"NotReadableError, the ".concat(i," maybe in use by another APP, please check if the device is pre-occupied by another APP.")},DEVICE_OVERCONSTRAINED_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"OverconstrainedError, the device ID is incorrect, please check whether the device ID passed in is correct".concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_INVALID_STATE_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"InvalidStateError, after the user clicks and interacts with the page, turn on the ".concat(i).concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_SECURITY_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"SecurityError, check whether the system security policy restricts the use of the ".concat(i,", and it is recommended to turn on the ").concat(i," after the user interacts with the page").concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_ABORT_ERROR(e){let{fnName:t,deviceType:i=Gs(t),error:r}=e;return"AbortError, an unknown exception in the system makes the device unusable, recommended to change the device or browser and re-check whether the device is normal".concat(r?" error: ".concat(r.toString(),"."):".")},CAMERA_RECOVER_FAILED(e){let{error:t}=e;return"camera recover capture failed ".concat((t==null?void 0:t.name)||"",": ").concat((t==null?void 0:t.originMessage)||(t==null?void 0:t.message))},MICROPHONE_RECOVER_FAILED(e){let{error:t}=e;return"microphone recover capture failed ".concat((t==null?void 0:t.name)||"",": ").concat((t==null?void 0:t.originMessage)||(t==null?void 0:t.message))},OPERATION_FAILED(e){let{fnName:t,error:i}=e;return"'".concat(t,"' failed, reason: ").concat(i==null?void 0:i.toString())},FIREWALL_RESTRICTION:()=>"media connection failure due to firewall restrictions, please try to change your network.",EVENT_HANDLER_ERROR(e){let{eventName:t}=e;return"an error was caught on trtc.on('".concat(t,"', handler), please check your code on 'handler'.")},VIDEO_CONTEXT_ERROR(e){let{reason:t,error:i}=e;return"video context error ".concat(t," ").concat((i==null?void 0:i.name)||""," ").concat((i==null?void 0:i.message)||"")},SERVER_ERROR(e){let{fnName:t,error:i}=e;return"'".concat(t,"' got server error: ").concat(i==null?void 0:i.toString(),", please check the SDK documentation.")},NEED_TO_BUY(e){let{value:t,url:i}=e;return"You need to buy packages for ".concat(t,". Refer to: ").concat(i)},ACCOUNT_NO_MONEY:e=>{let{fnParams:t}=e;return"your TRTC account run out of credit, please recharge.".concat(t.sdkAppId?" SDKAppId: ".concat(t.sdkAppId):"")},OPERATION_ABORT(e){let{fnName:t}=e;return"'".concat(t,"' abort")},UNKNOWN_ERROR(e){let{fnName:t,error:i}=e;return"'".concat(t,"' throw unknown exception").concat(i?", error: ".concat(i.toString(),"."):".")}});function Gs(e){if(!e)return"camera";let t=e.toLowerCase();return t.includes("screen")?"screen share":t.includes("audio")?"microphone":"camera"}var uh=class extends Error{constructor(e){let{code:t,extraCode:i,message:r="",messageParams:o,fnName:c="",originError:u}=e;var f;let d;d=r||function(_){let E,{code:S,params:R,enableDocLink:k=!1}=_,U="",K=lh[S];try{E=bR[K]}catch{E=bR.UNKNOWN_ERROR}return Tt(E)?U=E(R):_t(E)&&(U=E),R.fnName&&!U.includes(R.fnName)&&(U[U.length-1]!=="."&&(U+="."),U+=" thrown from ".concat(R.fnName,"()")),k&&(U+=" doc:"),U}({code:i||t,params:Oe({fnName:c,error:u},o)}),super(d),b(this,"name","RtcError"),b(this,"code"),b(this,"extraCode"),b(this,"functionName"),b(this,"message"),b(this,"handler"),b(this,"originError"),this.name=lh[t],this.code=t,this.extraCode=i,this.functionName=c,this.originError=u,this.message=d,this.extraCode===5302&&((f=this.originError)!=null&&f.message.includes("system"))&&(this.handler=()=>{let _=document.createElement("a");ua?_.href="ms-settings:privacy-".concat({startLocalVideo:"webcam",startLocalAudio:"microphone"}[this.functionName]):xs&&(_.href="x-apple.systempreferences:com.apple.preference.security?Privacy_".concat({startLocalVideo:"Camera",startLocalAudio:"Microphone",startScreenShare:"ScreenCapture"}[this.functionName])),_.href.length>0&&_.click()})}static convertFrom(e,t,i){let r=e;if(e instanceof ke){let{stack:o}=e,c={code:Ue.UNKNOWN_ERROR,fnName:t,originError:e};switch(e.getCode()){case ge.INVALID_PARAMETER:c.code=Ue.INVALID_PARAMETER,c.message=e.message;break;case ge.INVALID_OPERATION:c.code=Ue.INVALID_OPERATION;break;case ge.NOT_SUPPORTED:case ge.NOT_SUPPORTED_H264:c.code=Ue.ENV_NOT_SUPPORTED,e.getCode()===ge.NOT_SUPPORTED_H264&&(c.extraCode=e.message.includes(sn.NOT_SUPPORTED_H264ENCODE)?5203:5204);break;case ge.JOIN_ROOM_FAILED:c.messageParams={fnParams:i};case ge.SERVER_TIMEOUT:case ge.SWITCH_ROLE_FAILED:c.code=Ue.SERVER_ERROR,c.extraCode=e.getExtraCode();break;case ge.API_CALL_ABORTED:c.code=Ue.OPERATION_ABORT;break;case ge.DEVICE_NOT_FOUND:case ge.DEVICE_AUTO_RECOVER_FAILED:case ge.INITIALIZE_FAILED:c.code=5300,e.name&&(c.extraCode=function(u){let f;switch(u){case"NotFoundError":f=5301;break;case"NotAllowedError":f=5302;break;case"NotReadableError":f=5303;break;case"OverconstrainedError":f=5304;break;case"InvalidStateError":f=5305;break;case"SecurityError":f=5306;break;case"AbortError":f=5307;break;default:f=5300}return f}(e.name));break;case ge.UNKNOWN:break;default:c.code=Ue.OPERATION_FAILED}r=new uh(c),o&&(r.stack+=o.substr(o.indexOf(`
`)))}else{if(e instanceof uh)return e;r=new uh({code:Ue.UNKNOWN_ERROR,fnName:t,originError:e})}return r}},xe=uh,AR={type:"object",properties:{cameraId:{type:"string"},useFrontCamera:{type:"boolean"},fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:["string","boolean"],values:[!0,!1,"view","publish","both"]},small:{properties:{width:{type:"number"},height:{type:"number"},frameRate:{type:"number"},bitrate:{type:"number"}}},videoTrack:{instanceOf:MediaStreamTrack}}},RR={type:"object",properties:{systemAudio:{type:"boolean"},fillMode:{type:"string",values:["contain","cover","fill"]},profile:{type:["string","object"],properties:{width:{type:"number"},height:{type:"number"},frameRate:{type:"number"},bitrate:{type:"number"}}},videoTrack:{instanceOf:MediaStreamTrack},audioTrack:{instanceOf:MediaStreamTrack}}},ba={type:["string",HTMLElement,null,"array"],arrayItem:{instanceOf:HTMLElement},validate(e,t,i){if(_t(e)&&!document.getElementById(e))throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5009,fnName:i,messageParams:{key:t}})}},CR={name:"userId",required:!0,type:"string"},wR={type:"object",properties:{microphoneId:{type:"string"},audioTrack:{instanceOf:MediaStreamTrack},captureVolume:{type:"number",min:0},earMonitorVolume:{type:"number",min:0,max:100},profile:{values:[ur.AUDIO_PROFILE_STANDARD,ur.AUDIO_PROFILE_STANDARD_STEREO,ur.AUDIO_PROFILE_HIGH,ur.AUDIO_PROFILE_HIGH_STEREO]},echoCancellation:{type:"boolean"},autoGainControl:{type:"boolean"},noiseSuppression:{type:"boolean"}}};function vl(e,t){if(!e)throw new xe({code:Ue.INVALID_OPERATION,extraCode:5101,fnName:t})}function kR(e,t,i){if(!e)throw new xe({code:Ue.INVALID_OPERATION,extraCode:5102,fnName:t,messageParams:{value:i}})}var C7={create:[{name:"RoomConfig",instanceOf:Function},{name:"CreateConfig",type:"object",properties:{plugins:{type:"array",arrayItem:{instanceOf:Function}}}}],enterRoom:{name:"EnterRoomConfig",type:"object",required:!0,validate(e,t,i){if(this._room.isJoined)throw new xe({code:Ue.INVALID_OPERATION,extraCode:5104,fnName:i});if(e.roomId){if(_t(e.roomId))throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5016,fnName:i,messageParams:{key:t}});if(!(/^[1-9]\d*$/.test(String(e.roomId))&&e.roomId<4294967295))throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5013,fnName:i,messageParams:{key:t}})}else{if(!e.strRoomId)throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5015,fnName:i});if(!/^[A-Za-z\d\s!#$%&()+\-:;<=.>?@[\]^_{}|~,]{1,64}$/.test(e.strRoomId))throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5012,fnName:i,messageParams:{key:t}})}},properties:{sdkAppId:{required:!0,type:"number",allowEmpty:!1},userId:{required:!0,type:"string",allowEmpty:!1},userSig:{required:!0,type:"string",allowEmpty:!1},scene:{type:"string",values:["live","rtc"]},role:{type:"string",values:["audience","anchor"]},roomId:{type:["string","number"]},strRoomId:{type:"string"},proxy:{type:["object","string"],properties:{websocketProxy:{type:"string"},turnServer:{type:["object","array"],properties:{url:{required:!0,type:"string"},username:{type:"string"},credential:{type:"string"},credentialType:{type:"string",values:["password"]}}},loggerProxy:{type:"string"},webtransportProxy:{type:"string"}}},enableAutoPlayDialog:{type:"boolean"},userDefineRecordId:{type:"string"}}},startLocalVideo:{name:"LocalVideoConfig",type:"object",properties:{view:ba,mute:{type:["boolean","string"]},publish:{type:"boolean"},option:AR},validate(e){var t;if(((t=e==null?void 0:e.option)==null||!t.videoTrack)&&Hs())throw new xe({code:Ue.ENV_NOT_SUPPORTED,extraCode:5201})}},updateLocalVideo:{name:"updateLocalVideoConfig",type:"object",required:!0,properties:{view:qe(Oe({},ba),{required:!1}),publish:{type:"boolean"},mute:{type:["boolean","string"]},option:AR}},startLocalAudio:{name:"LocalAudioConfig",type:"object",properties:{publish:{type:"boolean"},option:wR},validate(e){var t;if(((t=e==null?void 0:e.option)==null||!t.audioTrack)&&Hs())throw new xe({code:Ue.ENV_NOT_SUPPORTED,extraCode:5201})}},updateLocalAudio:{name:"updateLocalAudioConfig",type:"object",required:!0,properties:{publish:{type:"boolean"},mute:{type:"boolean"},option:wR}},startScreenShare:{name:"ScreenShareConfig",type:"object",properties:{view:ba,publish:{type:"boolean"},option:RR},validate(e,t,i,r,o){var c;if(((c=e==null?void 0:e.option)==null||!c.videoTrack)&&Hs())throw new xe({code:Ue.ENV_NOT_SUPPORTED,extraCode:5201});if(!Xd())throw new xe({code:Ue.ENV_NOT_SUPPORTED,fnName:i,extraCode:5205})}},updateScreenShare:{name:"updateScreenShareConfig",type:"object",required:!0,properties:{view:ba,publish:{type:"boolean"},option:RR}},muteRemoteAudio:[CR,{name:"mute",required:!0,type:"boolean"}],setRemoteAudioVolume:[CR,{name:"volume",required:!0,type:"number",min:0}],startRemoteVideo:{name:"startRemoteVideoConfig",type:"object",required:!0,properties:{view:ba,userId:{type:"string",required:!0},streamType:{values:["main","sub"],required:!0},option:{type:"object",properties:{fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"}}}},validate(e,t,i){vl(this._room.isJoined,i);let r=this._room.remotePublishedUserMap.get(e.userId);if(kR(!!r,i,e),r&&(e.streamType==="main"&&!r.muteState.videoAvailable||e.streamType==="sub"&&!r.muteState.hasAuxiliary))throw new xe({code:Ue.INVALID_OPERATION,extraCode:5103,fnName:i,messageParams:{value:e}})}},updateRemoteVideo:{name:"updateRemoteVideoConfig",type:"object",required:!0,properties:{view:qe(Oe({},ba),{required:!1}),userId:{type:"string",required:!0},streamType:{values:["main","sub"],required:!0},option:{type:"object",properties:{fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"}}}},validate(e,t,i){vl(this._room.isJoined,i);let r=this._room.remotePublishedUserMap.get(e.userId);if(kR(!!r,i,e),r&&(e.streamType==="main"&&!r.muteState.videoAvailable||e.streamType==="sub"&&!r.muteState.hasAuxiliary))throw new xe({code:Ue.INVALID_OPERATION,extraCode:5103,fnName:i,messageParams:{value:e}})}},stopRemoteVideo:{name:"stopRemoteVideoConfig",type:"object",required:!0,properties:{userId:{type:"string",required:!0},streamType:{values:["main","sub"]}},validate(e,t,i){if(e.userId!=="*"&&re(e.streamType))throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5014,fnName:i})}},switchRole:{name:"role",required:!0,values:["anchor","audience"],validate(e,t,i){vl(this._room.isJoining||this._room.isJoined,i)}},enableAudioVolumeEvaluation:[{name:"interval",type:"number"},{name:"enableInBackground",type:"boolean"}],sendSEIMessage:[{name:"buffer",required:!0,instanceOf:ArrayBuffer,validate(e,t,i,r){if(!sl)throw new xe({code:Ue.ENV_NOT_SUPPORTED,fnName:i,extraCode:5207});if(!this._room.enableSEI)throw new xe({code:Ue.INVALID_OPERATION,messageParams:{key:Ve.SEI_DISABLED}});if(e.byteLength>1e3)throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5018,fnName:i});if(e.byteLength===0)throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5017,messageParams:{key:t},fnName:i});if(vl(this._room.isJoined,i),!this._room.isMainStreamPublished)throw new xe({code:Ue.INVALID_PARAMETER,messageParams:{key:Ve.SEI_BEFORE_PUBLISH}})}},{name:"options",type:"object",properties:{seiPayloadType:{type:"number",values:[5,243]}}}],sendCustomMessage:{name:"message",required:!0,type:"object",properties:{cmdId:{type:"number",required:!0,min:1,max:10},data:{instanceOf:ArrayBuffer,required:!0,validate(e,t,i,r){if(e.byteLength>1e3)throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5018,fnName:i});if(e.byteLength===0)throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5017,fnName:i,messageParams:{key:t}})}}},validate(e,t,i){if(vl(this._room.isJoined,i),this._room.scene==="live"&&this._room.role==="audience")throw new xe({code:Ue.INVALID_OPERATION,extraCode:5107,fnName:i,messageParams:{key:t}})}}},Zt={TRTC:C7},Li=class extends Error{};function w7(e,t){let i=il(e);for(let r=0;r<t.length;r++)Bs(i[r],t[r]);return i}function k7(e){this._resolve=Promise.resolve(e)}function N7(e){this._reject=Promise.reject(e)}var yl=class{constructor(e,t){this.instance=e,this.group=t,this.started=!1,this.ops=[],this.startSame=()=>!0,this.mergeUpdate=w7;let i=yl.instances.get(e);i?i.set(t,this):yl.instances.set(e,new Map([[t,this]]))}static get(e,t){let i=yl.instances.get(e);return i&&i.get(t)||new yl(e,t)}action(e,t,i){let r=u=>{var f;return e===0?this.started=!0:e===3&&(this.started=!1),this.ops.shift(),(f=this.currentOp)==null||f.action(),u},o=u=>{var f,d;throw this.ops.shift(),e===0&&((f=this.currentOp)==null?void 0:f.type)===2&&this.ops.shift().reject(new Li("start failed")),(d=this.currentOp)==null||d.action(),u},c={type:e,action:()=>t(...c.args).then(r,o),args:i,resolve:k7,reject:N7};try{switch(this.state){case 1:if(e===0)throw new Li("already started");break;case 4:if(e===2)throw new Li("not started");break;default:return this.cacheOp(c)}}catch(u){return Promise.reject(u)}return this.ops.push(c),c.promise=t(...c.args).then(r,o)}cacheOp(e){if(this.ops.length===1)switch(this.state){case 0:case 2:if(e.type===0)throw new Li("already start");break;case 3:switch(e.type){case 2:throw new Li("update not allowed when stopping");case 3:return this.currentOp.promise}break;default:throw new Li("unknown state")}else switch(e.type){case 3:if(this.lastOpType===3)return this.lastOp.promise;{let i=new Li("keep stop");if(this.ops.slice(1).forEach(r=>r.reject(i)),this.ops=this.ops.slice(0,1),this.state===3)return this.currentOp.promise}break;case 2:switch(this.lastOpType){case 2:return this.lastOp.args=this.mergeUpdate(this.lastOp.args,e.args),this.lastOp.promise;case 3:throw new Li("update not allowed after stop")}break;case 0:switch(this.lastOpType){case 2:throw new Li("start not allowed after update");case 0:throw new Li("duplicate start");case 3:if(this.startSame(this.currentOp.args,e.args))throw this.ops.pop().reject(new Li("keep start")),new Li("already start")}}e.promise=new Promise((i,r)=>{e._resolve?e._resolve.then(i):e.resolve=i,e._reject?e._reject.catch(r):e.reject=r});let{action:t}=e;return e.action=()=>t().then(e.resolve,e.reject),this.ops.push(e),e.promise}get lastOp(){return this.ops[this.ops.length-1]}get lastOpType(){return this.lastOp.type}get currentOp(){return this.ops[0]}get state(){return this.currentOp?this.currentOp.type:this.started?1:4}},El=yl;El.instances=new WeakMap;var dh=new WeakMap,hh=(e,t)=>{if(t instanceof Li){let{stack:i}=t;t=new xe({code:Ue.OPERATION_ABORT,message:"".concat(e," abort: ").concat(t.message),fnName:e}),i&&(t.stack+=i.substr(i.indexOf(`
`)))}throw t};function Ks(e,t){return St((i,r)=>function(){for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];let f=El.get(this,typeof e=="string"?e:e.call(this,...c));return t&&(f.startSame=t.bind(this)),f.action(0,i.bind(this),c).catch(hh.bind(null,r))})}function Aa(e,t){let{merge:i,debounce:r}=t||{};return St((o,c)=>function(){for(var u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];let _=El.get(this,typeof e=="string"?e:e.call(this,...f));if(i&&(_.mergeUpdate=i.bind(this)),r&&r.isNeedToDebounce.apply(this,f)){let{delay:E,getKey:S}=r;return new Promise((R,k)=>{var U,K;let se=(U=dh.get(this))==null?void 0:U.get(S(...f));if(se){let{timeoutId:Y,resolve:Re}=se;clearTimeout(Y),Re()}let le=setTimeout(()=>{if(_.state===3||_.state===4)return R();_.action(2,o.bind(this),f).catch(hh.bind(null,c)).then(R,k)},E);dh.has(this)?(K=dh.get(this))==null||K.set(S(...f),{timeoutId:le,resolve:R}):dh.set(this,new Map([[S(...f),{timeoutId:le,resolve:R}]]))})}return _.action(2,o.bind(this),f).catch(hh.bind(null,c))})}function Js(e){return St((t,i)=>function(){for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return El.get(this,typeof e=="string"?e:e.call(this,...o)).action(3,t.bind(this),o).catch(hh.bind(null,i))})}var He={ERROR:"error",AUTOPLAY_FAILED:"autoplay-failed",KICKED_OUT:"kicked-out",REMOTE_USER_ENTER:"remote-user-enter",REMOTE_USER_EXIT:"remote-user-exit",REMOTE_AUDIO_AVAILABLE:"remote-audio-available",REMOTE_AUDIO_UNAVAILABLE:"remote-audio-unavailable",REMOTE_VIDEO_AVAILABLE:"remote-video-available",REMOTE_VIDEO_UNAVAILABLE:"remote-video-unavailable",AUDIO_VOLUME:"audio-volume",NETWORK_QUALITY:"network-quality",CONNECTION_STATE_CHANGED:"connection-state-changed",AUDIO_PLAY_STATE_CHANGED:"audio-play-state-changed",VIDEO_PLAY_STATE_CHANGED:"video-play-state-changed",SCREEN_SHARE_STOPPED:"screen-share-stopped",DEVICE_CHANGED:"device-changed",PUBLISH_STATE_CHANGED:"publish-state-changed",TRACK:"track",STATISTICS:"statistics",SEI_MESSAGE:"sei-message",CUSTOM_MESSAGE:"custom-message"};function ph(e){return e==="sub"?"auxiliary":e==="auxiliary"?"sub":"main"}function Ra(e){return e===ur.QOS_PREFERENCE_CLEAR?"detail":e===ur.QOS_PREFERENCE_SMOOTH?"motion":""}var fh=new WeakMap;function mi(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return St((r,o)=>function(){for(var c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];try{Jg.call(this,t,u,o,this._name)}catch(d){return Promise.reject(d)}return r.apply(this,u)})}function NR(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return St((r,o)=>function(){for(var c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];try{Jg.call(this,t,u,o,this._name)}catch(d){throw d}return r.apply(this,u)})}function Jg(e,t,i,r){if(ri(e))for(let o=0;o<e.length;o++)mh.call(this,{rule:e[o],value:t[o],key:e[o].name,fnName:i,className:r});else mh.call(this,{rule:e,value:t[0],key:e.name,fnName:i,className:r})}function mh(e){let{rule:t,value:i,key:r,fnName:o,className:c}=e;function u(_){return{code:Ue.INVALID_PARAMETER,extraCode:_,fnName:o,messageParams:{key:r,rule:t,value:i}}}if(re(i)){if(t.required)throw new xe(u(5001));if(re(t.defaultValue))return void(Tt(t.validate)&&t.validate.call(this,i,r,o,c,this));i=t.defaultValue}if(Array.isArray(t.type)){let _=!1;for(let E=0;E<t.type.length;E++)t.type[E]===null&&i===null&&(_=!0),Tt(t.type[E])&&i instanceof t.type[E]&&(_=!0),_t(t.type[E])&&Ei(i)===t.type[E].toLowerCase()&&(_=!0);if(!_)throw new xe({code:Ue.INVALID_PARAMETER,extraCode:5002,fnName:o,messageParams:{key:r,rule:{type:t.type.map(E=>_g(E)?AA(E):_t(E)?E:Ei(E))},value:i}})}else if(!re(t.type)&&Ei(i)!==t.type)throw new xe(u(5002));if(t.allowEmpty===!1){let _=Qt(i)&&(i===0||Number.isNaN(i)),E=_t(i)&&i.trim()==="";if(_||E)throw new xe(u(5003))}if(t.notLessThanZero&&Qt(i)&&i<0)throw new xe(u(5006));if(!re(t.min)&&Qt(i)&&i<t.min)throw new xe(u(5007));if(!re(t.max)&&Qt(i)&&i>t.max)throw new xe(u(5008));if(_t(t.instanceOf)){if(!i||i._name!==t.instanceOf)throw new xe(u(5004))}else if(Tt(t.instanceOf)&&!(i instanceof t.instanceOf))throw new xe(u(5004));if(Array.isArray(t.values)&&!t.values.includes(i))throw new xe(u(5005));let{properties:f}=t;nr(f)&&jr(i)&&Object.keys(f).forEach(_=>{mh.call(this,{rule:f[_],value:i&&i[_],key:"".concat(_),fnName:o,className:c})});let{arrayItem:d}=t;nr(d)&&ri(i)&&i.forEach((_,E)=>{mh.call(this,{rule:d,value:_,key:"".concat(r,"[").concat(E,"]"),fnName:o,className:c})}),Tt(t.validate)&&t.validate.call(this,i,r,o,c,this)}function It(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{getRemoteId:t=()=>"",replaceArg:i,getKVReportKey:r}=e;return St((o,c)=>function(){for(var u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];function _(R,k,U){if(U&&U.includes(R))return"hided";if(i){let K=i(...f);if(f[K.argIndex]===k)return K.value}if(k===f||R in f)return k;try{return k instanceof HTMLElement?"id: ".concat(k.id," type:").concat(Ei(k)):(JSON.stringify(k),k)}catch{return"type:".concat(Ei(k))}}let E=this._log||Te;f.length>0?E.info("".concat(c,"() ").concat(JSON.stringify(f,(R,k)=>_(R,k,["userSig","privateMapKey"])))):E.info("".concat(c,"()"));let S=r?r(...f):tR[c];try{let R=o.apply(this,f),k=it();return mg(R)?R.then(U=>(E.info("".concat(c,"() success ").concat(t.call(this,...f))),et.addSuccessEvent({key:S,cost:it()-k}),U)).catch(U=>{throw U=xe.convertFrom.call(this,U,c,f.length===1?f[0]:f),E.error("".concat(c,"() failed ").concat(t.call(this,...f)," ").concat(U," params: ").concat(JSON.stringify(f,_))),et.addFailedEvent({key:S,error:U}),U}):(et.addSuccessEvent({key:S}),R)}catch(R){throw R=xe.convertFrom.call(this,R,c),E.error("".concat(c,"() failed ").concat(R," params: ").concat(JSON.stringify(f,_))),et.addFailedEvent({key:S,error:R}),R}})}var Yg=e=>St((t,i)=>function(r,o){return B(this,null,function*(){let c=this._plugins.get(r);if(!c)throw this._log.error("plugin ".concat(String(r)," is not found")),new xe({code:Ue.OPERATION_ABORT,message:"plugin ".concat(String(r)," is not found"),fnName:i});return Jg.call(this,c.getValidateRule(e),[o],i,"TRTC"),t.call(this,c,o)})}),qg=0,D7=class{constructor(e,t){b(this,"player"),b(this,"publisher"),b(this,"mixInput"),this.mixInput=new oR(t),e.url?(this.player=new Audio(e.url),this.player.crossOrigin="anonymous",this.publisher=new Audio(e.url),this.publisher.crossOrigin="anonymous",this.mixInput.replaceSource(this.publisher)):this.mixInput.replaceSource(e.track),e.loop&&(this.loop=e.loop),e.volume&&(this.volume=e.volume),this.mixInput.connect()}reset(){this.seek(0),this.mixInput.connect()}seek(e){!this.player||e<0&&e>this.player.duration||(this.player.currentTime=e,this.publisher.currentTime=e)}play(){var e,t;return(e=this.publisher)==null||e.play(),(t=this.player)==null?void 0:t.play()}pause(){var e,t;(e=this.player)==null||e.pause(),(t=this.publisher)==null||t.pause()}stop(){var e;(e=this.player)==null||e.pause(),this.mixInput.disconnect()}setOperation(e){e==="pause"&&this.pause(),e==="resume"&&(this.pause(),this.play()),e==="stop"&&(this.pause(),this.seek(0))}set volume(e){!this.player||!this.publisher||(this.player.volume=e,this.publisher.volume=e)}set loop(e){!this.player||!this.publisher||(this.player.loop=e,this.publisher.loop=e)}},Tl=class{constructor(e){this.core=e,b(this,"log"),b(this,"mixedMusicMap",new Map),b(this,"cacheMusicMap",new Map),qg+=1,this.log=e.log.createChild({id:"".concat(this.getAlias()).concat(qg)}),this.log.info("[audioMixer] created id=".concat(this.getAlias()).concat(qg)),this.core=e}getName(){return Tl.Name}getAlias(){return"ax"}getGroup(e){return e==null?void 0:e.id}getValidateRule(e){switch(e){case"start":return Tl.startValidateRule;case"update":return Tl.updateValidateRule;case"stop":return Tl.stopValidateRule}}start(e){return B(this,null,function*(){let{room:t}=this.core;this.log.info("add music source, id: ".concat(e.id," url: ").concat(e.url,", track: ").concat(e.track));let{id:i,url:r}=e;if(this.mixedMusicMap.has(i))return;let o=this.cacheMusicMap.get(i);o?e.url?o.reset():(o.mixInput.replaceSource(e.track),o.mixInput.connect()):(o=new D7(e,t.audioManager),this.cacheMusicMap.set(i,o)),yield o.play(),this.mixedMusicMap.set(i,o),this.log.info("start mix audio track ".concat(i," success.")),et.addEnum({key:502700,value:3})})}update(e){return B(this,null,function*(){let{id:t,volume:i,loop:r,operation:o,seekFrom:c}=e;this.log.info("update music source, ".concat(JSON.stringify(e)));let u=this.mixedMusicMap.get(t);u?(re(i)||(u.volume=i),re(r)||(u.loop=r),re(o)||u.setOperation(o),re(c)||u.seek(c)):this.log.warn("update music source failed, music id: ".concat(t," not found."))})}stop(e){return B(this,arguments,function(t){var i=this;let{id:r}=t;return function*(){var o;i.mixedMusicMap.has(r)&&(i.log.info("remove music source, music id: ".concat(r)),(o=i.mixedMusicMap.get(r))==null||o.stop(),i.mixedMusicMap.delete(r)),r==="*"&&i.destroyAllMusic()}()})}destroyAllMusic(){this.log.info("destroy all music source."),this.mixedMusicMap.forEach((e,t)=>this.stop({id:t}))}destroyAllCache(){this.log.info("destroy all music cache."),this.cacheMusicMap.clear()}destroy(){this.log.info("destroy audio mixer plugin."),this.destroyAllMusic(),this.destroyAllCache()}},Sl=Tl;b(Sl,"startValidateRule",{name:"options",required:!0,type:"object",properties:{id:{type:"string",required:!0},url:{type:"string",required:!1},track:{required:!1},loop:{type:"boolean"},volume:{type:"number"}},validate(e,t,i){if(e.url&&e.url!=="*"){let r=e.url.split("?")[0],o=["mp3","ogg","wav","flac"],c=r.split(".").pop(),u=o.indexOf(c)>=0,f=r.startsWith("blob"),d=r.startsWith("data");if(!(u||f||d))throw new xe({code:Ue.INVALID_PARAMETER,message:"start audioMixer plugin: music url is invalid, please check your file format.",fnName:i})}if(!e.url&&!e.track)throw new xe({code:Ue.INVALID_PARAMETER,message:"start audioMixer plugin: param url or track is required.",fnName:i})}}),b(Sl,"updateValidateRule",{name:"options",required:!0,type:"object",properties:{id:{type:"string",required:!0},loop:{type:"boolean"},volume:{type:"number"},seekFrom:{type:"number"},operation:{type:"string",values:["pause","resume","stop"]}}}),b(Sl,"stopValidateRule",{name:"options",type:"object",required:!0,properties:{id:{type:"string",required:!0}}}),b(Sl,"Name","AudioMixer");var O7=e=>(e=Number(e))>0&&e<14e8,Xg=0,Il=class{constructor(e){this.core=e,b(this,"log"),b(this,"workletReady"),b(this,"audioContext",zr()),b(this,"workletNode"),Xg+=1,this.log=e.log.createChild({id:"".concat(this.getAlias()).concat(Xg)}),this.log.info("[audioDenoiser] created id=".concat(this.getAlias()).concat(Xg)),e.assetsPath&&(this.workletReady=rh(this.audioContext,"".concat(e.assetsPath,"/denoiser-wasm.js")),this.workletReady.catch(t=>{this.log.error("Init assets from ".concat(e.assetsPath," failed! Reason: ").concat(t))}))}static startValidateRule(e){return{name:"options",required:!0,type:"object",properties:{sdkAppId:{type:"number",required:!0},userId:{type:"string",required:!0},userSig:{type:"string",required:!0}},validate(t,i,r,o){if(!e.room.audioManager.hasAudioTrack)throw new xe({code:Ue.INVALID_OPERATION,extraCode:5106,fnName:r})}}}getName(){return Il.Name}getAlias(){return"ad"}getGroup(){return"AIDenoiser_".concat(Date.now())}getValidateRule(e){switch(e){case"start":return Il.startValidateRule(this.core);case"update":return Il.updateValidateRule;case"stop":return Il.stopValidateRule}}start(e){return B(this,null,function*(){let{room:t}=this.core;if(this.workletReady||(this.workletReady=rh(this.audioContext,"".concat(e.assetsPath,"/denoiser-wasm.js")),this.workletReady.catch(i=>{this.log.error("Init assets from ".concat(e.assetsPath," failed! Reason: ").concat(i))})),!this.workletNode){let i=String(Date.now()).slice(0,-3),{auth:r,sign:o,status:c,message:u}=yield function(f){return B(this,arguments,function(d){let{sdkAppId:_,userId:E,userSig:S,timestamp:R}=d;return function*(){let k="https://".concat(function(Le){let pt;return pt=O7(Le)?DR.MAIN_OVERSEA:DR.MAIN,pt}(_),"/api/v1/audioAiAuth?sdkAppId=").concat(_,"&userId=").concat(E,"&userSig=").concat(S,"&timestamp=").concat(R),U=yield fetch(k),{data:{errCode:K,errMsg:se,sign:le,status:Y}}=yield U.json();if(Y==="1")return{auth:!0,sign:le,status:Y,message:se};let Re="Init RTCAIDenoiser failed.",Ne="";switch(K){case 1:Ne="Please check your params.";break;case 2:Ne="You need to buy packages. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 3:Ne="Server is invalid. Please contact our engineer. ";break;case 4:Ne="Your packages is not active. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 5:Ne="Your packages is expired. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 6:Ne="Your version is not supported."}return{auth:!1,status:Y,message:se?"".concat(Re," Reason: ").concat(se,". ").concat(Ne):"".concat(Re,", ").concat(Ne)}}()})}(qe(Oe({},e),{timestamp:i}));if(!r)throw this.log.info("RTCAIDenoiser: ".concat(e.userId," auth result: ").concat(r,". Message: ").concat(u)),new xe({code:Ue.INVALID_PARAMETER,message:u});yield this.workletReady,this.workletNode=new AudioWorkletNode(this.audioContext,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1}),this.workletNode.port.postMessage({type:"init",data:{sdkAppId:String(e.sdkAppId),userId:e.userId,timestamp:i,sign:o,status:c}}),this.workletNode.port.onmessage=f=>{let{data:d}=f;d.type==="cost"&&this.log.debug("[RTCAIDenoiser] ".concat(d.value))}}this.workletNode.port.postMessage({type:"enable"}),t.audioManager.addDenoiser(this.workletNode),t.sendAbilityStatus({ai_denoise:1})})}update(){return B(this,null,function*(){})}stop(){return B(this,null,function*(){if(!this.workletNode)return;let{room:e}=this.core;this.workletNode.port.postMessage({type:"disable"}),yield e.audioManager.removeDenoiser(this.workletNode)})}destroy(){}},_h=Il;b(_h,"updateValidateRule",{type:"object"}),b(_h,"stopValidateRule",{type:"object"}),b(_h,"Name","AIDenoiser");var DR={MAIN:"schedule.cloud-rtc.com",MAIN_OVERSEA:"schedule.rtc.tencentcloud.com"},OR=0,Qg=new Set,ai=null;Pb("5.6.1");var P7={RtcError:xe,ErrorCode:Ue,ErrorCodeDictionary:lh},gh=class extends F8.EventEmitter{constructor(e,t){super(),b(this,"_room"),b(this,"_eventListened",new Set),b(this,"_localVideoTrack",null),b(this,"_localAudioTrack",null),b(this,"_localScreenTrack",null),b(this,"_localScreenAudioTrack",null),b(this,"_localVideoConfig",null),b(this,"_localScreenConfig",null),b(this,"_localAudioConfig",null),b(this,"_remoteVideoConfigMap",new Map),b(this,"_remoteAudioConfigMap",new Map),b(this,"_remoteAudioMuteMap",new Map),b(this,"_mediaTrackMap",new WeakMap),b(this,"_log",Te.createLogger({id:"t".concat(++OR)})),b(this,"_plugins",new Map),b(this,"_networkQuality",null),b(this,"_speakerId"),this._room=new e(Oe({logger:this._log,frameWorkType:gh.frameWorkType},t)),this._log.debug(JSON.stringify(t)),Object.defineProperties(this,{dumpAudio:{enumerable:!1,value(i){return this._room.audioManager.dump(i)}}}),t.plugins&&t.plugins.forEach(i=>{this._use(i,t.assetsPath)}),this._use(Sl,t.assetsPath),this._use(_h,t.assetsPath),this._room.on("audio-volume",i=>{!i.find(r=>r.userId==="")&&this._localAudioTrack&&i.push({userId:"",volume:Math.floor(100*this._localAudioTrack.getAudioLevel())}),this.emit(He.AUDIO_VOLUME,{result:i.sort((r,o)=>o.volume-r.volume)})}),this._room.videoManager.on("error",i=>{let{reason:r,error:o}=i;this._log.error(new xe({code:Ue.OPERATION_FAILED,extraCode:5504,messageParams:{reason:r,error:o}}))}),this._listenEvents(),this._initActiveSpeaker(),((i,r)=>{let{emit:o}=i;i.emit=function(){for(var c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];try{return o.apply(i,u)}catch(d){let _=je({key:Ve.CATCH_HANDLER_ERROR,data:{name:r,event:u[0]},addDocLink:!1});return Te.warn("".concat(_,`

`).concat(d.stack)),!1}}})(this,"trtc")}static create(e){}static _create(e,t){var i;IR&&(IR=!1,Te.getLogLevel()!==5&&(console.info("******************************************************************************"),console.info("*   TRTC Web SDK"),console.info("*   API Document: ".concat(Ps,"/en/index.html")),console.info("*   Changelog: ".concat(Ps,"/en/tutorial-01-info-changelog.html")),console.info("*   Report issues: https://github.com/LiteAVSDK/TRTC_Web/issues"),console.info("******************************************************************************")),Te.info("TRTC Web SDK Version:",In),Te.info("UA:",navigator.userAgent),Te.info("URL: ".concat(location.href).concat(((i=self.frameElement)==null?void 0:i.tagName)==="IFRAME"?" in iframe":"")),ug().then(o=>{if(o){let c="UAData: ".concat(o.platform,"/").concat(o.platformVersion);o.architecture&&o.bitness&&(c+=" ".concat(o.architecture,"/").concat(o.bitness)),o.mobile&&(c+=" mobile"),o.model&&(c+=" model: ".concat(o.model)),o.fullVersionList&&(c+=" ".concat(o.fullVersionList.filter(u=>u.brand!=="Not/A)Brand").map(u=>"".concat(u.brand,"/").concat(u.version)).join(","))),Te.info(c)}}));let r=new gh(e,t||{});return Qg.add(r),r}_listenEvents(){wn(this,this._room).add("peer-join",e=>{let{userId:t}=e;this.emit(He.REMOTE_USER_ENTER,{userId:t})}).add("peer-leave",e=>{this.emit(He.REMOTE_USER_EXIT,{userId:e})}).add("banned",e=>{this._exitRoom().then(()=>{this.emit(He.KICKED_OUT,{reason:e.reason})})}).add("error",e=>{this._exitRoom().then(()=>{this.emit(He.ERROR,xe.convertFrom(e))})}).add("signal-connection-state-changed",e=>{this.emit(He.CONNECTION_STATE_CHANGED,e)}).add("network-quality",e=>{this._networkQuality=e,this.emit(He.NETWORK_QUALITY,e)}).add("remote-published",e=>{[e.remoteAudioTrack,e.remoteVideoTrack,e.remoteAuxiliaryTrack].forEach(t=>{wn(t,t).add("player-state-changed",i=>{let r=qe(Oe({},i),{userId:e.userId});t.kind===N.VIDEO&&(r.streamType=ph(t.streamType)),this.emit(t.kind===N.AUDIO?He.AUDIO_PLAY_STATE_CHANGED:He.VIDEO_PLAY_STATE_CHANGED,r)}).add("error",i=>{i.getCode()===ge.PLAY_NOT_ALLOWED&&this.emit(He.AUTOPLAY_FAILED,{userId:t.userId})})})}).add("remote-unpublished",e=>{[e.remoteAudioTrack,e.remoteVideoTrack,e.remoteAuxiliaryTrack].forEach(t=>{Ti(t)})}).add("remote-publish-state-changed",e=>{let{prevMuteState:t,muteState:i}=e,{userId:r}=i,o=t.audioAvailable,c=t.videoAvailable,{audioAvailable:u,videoAvailable:f}=i;u||this._remoteAudioConfigMap.delete(r),f||this._remoteVideoConfigMap.delete("".concat(r,"_","main")),i.hasAuxiliary||this._remoteVideoConfigMap.delete("".concat(r,"_","sub")),o!==u&&(this.emit(u?He.REMOTE_AUDIO_AVAILABLE:He.REMOTE_AUDIO_UNAVAILABLE,{userId:r}),u?this._onAudioAvailable({userId:r}):this._onAudioUnavailable({userId:r,muteState:i})),c!==f&&(this.emit(f?He.REMOTE_VIDEO_AVAILABLE:He.REMOTE_VIDEO_UNAVAILABLE,{userId:r,streamType:"main"}),f?this._onVideoAvailable({userId:r,streamType:"main"}):this._onVideoUnavailable({userId:r,streamType:"main"})),t.hasAuxiliary!==i.hasAuxiliary&&(this.emit(i.hasAuxiliary?He.REMOTE_VIDEO_AVAILABLE:He.REMOTE_VIDEO_UNAVAILABLE,{userId:r,streamType:"sub"}),i.hasAuxiliary?this._onVideoAvailable({userId:r,streamType:"sub"}):this._onVideoUnavailable({userId:r,streamType:"sub"}))}).add("firewall-restriction",()=>{this.emit(He.ERROR,new xe({code:Ue.OPERATION_FAILED,extraCode:5501}))}).add("sei-message",e=>{this.emit(He.SEI_MESSAGE,qe(Oe({},e),{streamType:ph(e.streamType)}))}).add("heartbeat-report",e=>{var t,i,r,o,c,u,f;let d={2:"big",3:"small",7:"sub"},_={rtt:e.msg_up_stream_info.msg_network_status.uint32_rtt||((t=e.msg_down_stream_info[0])==null?void 0:t.msg_network_status.uint32_rtt)||((i=this._networkQuality)==null?void 0:i.uplinkRTT)||((r=this._networkQuality)==null?void 0:r.downlinkRTT)||0,upLoss:((o=this._networkQuality)==null?void 0:o.uplinkLoss)||0,downLoss:((c=this._networkQuality)==null?void 0:c.downlinkLoss)||0,bytesSent:e.bytes_sent||0,bytesReceived:e.bytes_received||0,localStatistics:{audio:{bitrate:(((u=e.msg_up_stream_info.msg_audio_status)==null?void 0:u.uint32_audio_codec_bitrate)||0)/1e3,audioLevel:(((f=e.msg_up_stream_info.msg_audio_status)==null?void 0:f.uint32_audio_level)||0)/Vr},video:e.msg_up_stream_info.msg_video_status.filter(E=>d[E.uint32_video_stream_type]).map(E=>({bitrate:(E.uint32_video_codec_bitrate||0)/1e3,width:E.uint32_video_width,height:E.uint32_video_height,frameRate:E.uint32_video_enc_fps,videoType:d[E.uint32_video_stream_type]}))},remoteStatistics:e.msg_down_stream_info.map(E=>({userId:E.msg_user_info.str_identifier,audio:{bitrate:(E.msg_audio_status.uint32_audio_codec_bitrate||0)/1e3,audioLevel:(E.msg_audio_status.uint32_audio_level||0)/Vr},video:E.msg_video_status.map(S=>({bitrate:(S.uint32_video_codec_bitrate||0)/1e3,width:S.uint32_video_width,height:S.uint32_video_height,frameRate:S.uint32_video_dec_fps,videoType:d[S.uint32_video_stream_type]}))}))};this.emit(He.STATISTICS,_)}).add("custom-message",e=>{this.emit(He.CUSTOM_MESSAGE,e)}),wn(this,oi).add("audioInputAdded",e=>{this.emit(He.DEVICE_CHANGED,{type:"microphone",action:"add",device:e})}).add("audioInputRemoved",e=>{this.emit(He.DEVICE_CHANGED,{type:"microphone",action:"remove",device:e})}).add("videoInputAdded",e=>{this.emit(He.DEVICE_CHANGED,{type:"camera",action:"add",device:e})}).add("videoInputRemoved",e=>{this.emit(He.DEVICE_CHANGED,{type:"camera",action:"remove",device:e})}).add("audioOutputAdded",e=>B(this,null,function*(){if(this.emit(He.DEVICE_CHANGED,{type:"speaker",action:"add",device:e}),ai&&ai.deviceId===Dd){let t=(yield Ta()).find(i=>i.deviceId===Dd);t&&ai.groupId!==t.groupId&&(ai=t,this.emit(He.DEVICE_CHANGED,{type:"speaker",action:"active",device:t}))}})).add("audioOutputRemoved",e=>B(this,null,function*(){this.emit(He.DEVICE_CHANGED,{type:"speaker",action:"remove",device:e});let t=(yield Ta())[0];t&&ai&&(ai.deviceId===e.deviceId||ai.deviceId===Dd&&ai.groupId!==t.groupId)&&(ai=t,this.emit(He.DEVICE_CHANGED,{type:"speaker",action:"active",device:t}))}))}use(e){let t,i;"plugin"in e?(t=e.plugin,i=e.assetsPath):t=e,this._use(t,i||"https://web.sdk.qcloud.com/trtc/webrtc/v5/assets/")}_use(e,t){if(this._plugins.get(e.Name))return void this._log.warn("duplicate install plugin",e.Name);let i=new e(function(r,o,c){return{room:r,assetsPath:c,innerEmitter:pe,constants:Ob,environment:$b,utils:Sn,eventLogger:Ht,log:r.getLogger(),errorModule:o,kvStatManager:et,clearStarted(u,f){let d=u.getAlias(),_=El.instances.get(r);if(_)if(f){let E=_.get(d+f);if(!E)return;E.started=!1}else _.forEach((E,S)=>{S.startsWith(d)&&(E.started=!1)})}}}(this._room,P7,t));this._plugins.set(e.Name,i)}enterRoom(e){return B(this,null,function*(){var t,i;let{scene:r="rtc",enableAutoPlayDialog:o=!0,autoReceiveAudio:c=!0,autoReceiveVideo:u=!1}=e;e.proxy&&(this._room.setProxyServer(e.proxy),!_t(e.proxy)&&e.proxy.turnServer&&((i=(t=this._room).setTurnServer)==null||i.call(t,e.proxy.turnServer,e.proxy.iceTransportPolicy))),this._room.enableAutoPlayDialog=o,this._room.autoReceiveAudio=c,this._room.autoReceiveVideo=u,Pi(e.enableHWEncoder)&&(this._room.enableHWEncoder=e.enableHWEncoder);let f={sdkAppId:e.sdkAppId,userId:e.userId,userSig:e.userSig,privateMapKey:e.privateMapKey||null,role:e.role==="audience"?21:20,roomId:e.roomId||0,strRoomId:e.strRoomId||"",businessInfo:e.businessInfo||null,streamId:null,userDefineRecordId:e.userDefineRecordId||null,frameWorkType:e.frameWorkType,component:e.component,language:e.language};e.strRoomId&&!e.roomId?this._room.useStringRoomId=!0:this._room.useStringRoomId=!1,yield this._room.join(f,r,gh.frameWorkType),this._checkTrackToPublish()})}exitRoom(){return B(this,null,function*(){return yield this._exitRoom()})}switchRole(e,t){return B(this,null,function*(){t!=null&&t.privateMapKey&&(this._room.privateMapKey=t.privateMapKey),yield this._room.switchRole(e),e==="anchor"&&this._checkTrackToPublish()})}destroy(){Ti(this),this.removeAllListeners(),this._room.destroy(),Qg.delete(this),this._localAudioTrack&&this.stopLocalAudio(),this._localVideoTrack&&this.stopLocalVideo(),this._localScreenTrack&&this.stopScreenShare(),this._plugins.forEach(e=>{var t;return(t=e.destroy)==null?void 0:t.call(e)})}startLocalAudio(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{publish:!0};return function*(){if(e._localAudioTrack)return void e._log.warn("local audio is already started");let{publish:i=!0,mute:r,option:o}=t,c=new cr(e._room.audioManager),u={},f={muted:!0};o&&(re(o.microphoneId)?re(o.audioTrack)||(u.customSource=o.audioTrack):u.deviceId=o.microphoneId,o&&Qt(o.captureVolume)&&c.setCaptureVolume(o.captureVolume),re(o.profile)||(_t(o.profile)?P_[o.profile]&&c.setProfile(P_[o.profile]):c.setProfile(o.profile)),Qt(o.earMonitorVolume)&&(f.muted=!(o.earMonitorVolume>0),f.volume=o.earMonitorVolume),re(o.echoCancellation)||(c.profile.echoCancellation=o.echoCancellation),re(o.noiseSuppression)||(c.profile.noiseSuppression=o.noiseSuppression),re(o.autoGainControl)||(c.profile.autoGainControl=o.autoGainControl)),c.on("5",d=>{e.emit(He.ERROR,new xe({code:Ue.DEVICE_ERROR,extraCode:5309,messageParams:{error:d}}))}),c.on("2",d=>{e.emit(He.DEVICE_CHANGED,{type:"microphone",action:"active",device:d})}),c.on("4",d=>{let _;d.error&&(_=xe.convertFrom(d.error)),e.emit(He.PUBLISH_STATE_CHANGED,qe(Oe({},d),{error:_}))}),e._listenOutputTrackChanged(c),e._speakerId&&c.setAudioOutput(e._speakerId),yield c.capture(u),re(r)||c.setMute(r),wn(c,c).add("player-state-changed",d=>{e.emit(He.AUDIO_PLAY_STATE_CHANGED,qe(Oe({},d),{userId:""}))}),i&&e._room.isJoined&&e._room.publish(c).catch(()=>{}),e._localAudioTrack=c,e._localAudioConfig=qe(Oe({},t),{publish:i}),yield e._updateAudioPlayOption({playOption:f,track:c})}()})}updateLocalAudio(e){return B(this,null,function*(){if(!this._localAudioTrack||!this._localAudioConfig)return;let{publish:t,mute:i,option:r}=e,o={};r&&(r.microphoneId?yield this._localAudioTrack.switchDevice(r.microphoneId):re(r.audioTrack)||(yield this._localAudioTrack.setInputMediaStreamTrack(r.audioTrack)),re(r.captureVolume)||this._localAudioTrack.setCaptureVolume(r.captureVolume),re(r.earMonitorVolume)||(o.muted=!(r.earMonitorVolume>0),o.volume=r.earMonitorVolume),yield this._localAudioTrack.update3A(r)),this._room.isJoined&&!re(t)&&(t&&!this._localAudioConfig.publish&&this._room.publish(this._localAudioTrack).catch(()=>{}),this._localAudioConfig.publish&&!t&&this._room.unpublish(this._localAudioTrack).catch(()=>{})),re(i)||this._localAudioTrack.setMute(i),yield this._updateAudioPlayOption({playOption:o,track:this._localAudioTrack,prevConfig:this._localAudioConfig}),Bs(this._localAudioConfig,e)})}stopLocalAudio(){return B(this,null,function*(){!this._localAudioTrack||(this._room.isJoined&&(yield this._room.unpublish(this._localAudioTrack).catch(()=>{})),this._localAudioTrack.stop(),this._localAudioTrack.close(),this._room.audioManager.removeInput(this._localAudioTrack),Ti(this._localAudioTrack),this._localAudioTrack=null,this._localAudioConfig=null)})}startLocalVideo(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{publish:!0,view:null};return function*(){if(e._localVideoTrack)return void e._log.warn("local video is already started");let{view:i,publish:r=!0,mute:o,option:c}=t,u=new Mi(e._room.videoManager),f={},d={};if(c&&(c.cameraId?f.deviceId=c.cameraId:re(c.useFrontCamera)?re(c.videoTrack)||(f.customSource=c.videoTrack):f.facingMode=c.useFrontCamera?N.FACING_MODE_USER:N.FACING_MODE_ENVIRONMENT,re(c.profile)||(_t(c.profile)?bn[c.profile]&&u.setProfile(bn[c.profile]):u.setProfile(c.profile)),re(c.fillMode)||(d.objectFit=c.fillMode),re(c.mirror)||(d.mirror=c.mirror),re(c.small)||(Qd()?_t(c.small)?u.small=bn[c.small]:c.small===!0?u.small=bn["120p"]:u.small=c.small:e._log.warn("small stream is not supported"))),u.on("5",_=>{e.emit(He.ERROR,new xe({code:Ue.DEVICE_ERROR,extraCode:5308,messageParams:{error:_}}))}),u.on("2",_=>{e.emit(He.DEVICE_CHANGED,{type:"camera",action:"active",device:_})}),u.on("4",_=>{let E;_.error&&(E=xe.convertFrom(_.error)),e.emit(He.PUBLISH_STATE_CHANGED,qe(Oe({},_),{error:E}))}),e._listenOutputTrackChanged(u),yield u.capture(f),re(o)||(yield u.setMute(o)),u.mediaTrack)if(c!=null&&c.qosPreference){let _=Ra(c.qosPreference);u.mediaTrack.contentHint=_}else c!=null&&c.videoTrack||(u.mediaTrack.contentHint=Ra(ur.QOS_PREFERENCE_SMOOTH));wn(u,u).add("player-state-changed",_=>{e.emit(He.VIDEO_PLAY_STATE_CHANGED,qe(Oe({},_),{userId:"",streamType:"main"}))}),r&&e._room.isJoined&&e._room.publish(u).catch(()=>{}),e._localVideoTrack=u,e._localVideoConfig=qe(Oe({},t),{view:i,publish:r}),yield e._updateVideoPlayOption({view:i,playOption:d,track:u})}()})}updateLocalVideo(e){return B(this,null,function*(){if(!this._localVideoTrack||!this._localVideoConfig)return;let{view:t,publish:i,mute:r,option:o}=e,c={};if(o){if(re(o.profile)||(_t(o.profile)?bn[o.profile]&&this._localVideoTrack.setProfile(bn[o.profile]):this._localVideoTrack.setProfile(o.profile),(!o.cameraId||!this._localVideoTrack.isNeedToSwitchDevice(o.cameraId))&&re(o.useFrontCamera)&&this._localVideoTrack.applyProfile()),o.cameraId?yield this._localVideoTrack.switchDevice(o.cameraId):re(o.useFrontCamera)?re(o.videoTrack)||(yield this._localVideoTrack.setInputMediaStreamTrack(o.videoTrack)):yield this._localVideoTrack.switchDevice(o.useFrontCamera?N.FACING_MODE_USER:N.FACING_MODE_ENVIRONMENT),re(o.fillMode)||(c.objectFit=o.fillMode),re(o.mirror)||(c.mirror=o.mirror),o.qosPreference&&this._localVideoTrack.mediaTrack){let u=Ra(o.qosPreference);this._localVideoTrack.mediaTrack.contentHint=u}if(o.small){let u=!this._localVideoTrack.small;Qd()?(o.small===!0?this._localVideoTrack.small=bn["120p"]:_t(o.small)?this._localVideoTrack.small=bn[o.small]:this._localVideoTrack.small=o.small,this._room.videoManager.update(),u&&this._room.enableSmall(!0)):this._log.warn("small stream is not supported")}else o.small===!1&&this._localVideoTrack.small&&(delete this._localVideoTrack.small,this._room.videoManager.update(),this._room.enableSmall(!1))}this._room.isJoined&&!re(i)&&(i&&!this._localVideoConfig.publish&&this._room.publish(this._localVideoTrack).catch(()=>{}),this._localVideoConfig.publish&&!i&&this._room.unpublish(this._localVideoTrack).catch(()=>{})),re(r)||(yield this._localVideoTrack.setMute(r)),yield this._updateVideoPlayOption({view:t,playOption:c,track:this._localVideoTrack,prevConfig:this._localVideoConfig}),Bs(this._localVideoConfig,e)})}stopLocalVideo(){return B(this,null,function*(){!this._localVideoTrack||(this._room.isJoined&&(yield this._room.unpublish(this._localVideoTrack).catch(()=>{})),this._localVideoTrack.stop(),this._localVideoTrack.close(),Ti(this._localVideoTrack),this._localVideoTrack=null,this._localVideoConfig=null)})}startScreenShare(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{publish:!0,view:null};return function*(){if(e._localScreenTrack)return void e._log.warn("screen share is already started");let{view:i=null,publish:r=!0,option:o}=t,c=new zs(e._room.videoManager);c.on("4",E=>{let S;E.error&&(S=xe.convertFrom(E.error)),e.emit(He.PUBLISH_STATE_CHANGED,qe(Oe({},E),{error:S}))}),e._listenOutputTrackChanged(c);let u=null,f={},d={};o&&(re(o.profile)||(_t(o.profile)?M_[o.profile]&&c.setProfile(M_[o.profile]):c.setProfile(o.profile)),o.systemAudio&&(f.systemAudio=!0,f.echoCancellation=o.echoCancellation,f.noiseSuppression=o.noiseSuppression,f.autoGainControl=o.autoGainControl),re(o.fillMode)||(d.objectFit=o.fillMode),o.videoTrack&&(f.videoTrack=o.videoTrack),o.audioTrack&&(f.audioTrack=o.audioTrack),o.captureElement&&(f.captureElement=o.captureElement),o.preferDisplaySurface&&(f.preferDisplaySurface=o.preferDisplaySurface));let _=yield c.capture(f);if(o!=null&&o.qosPreference){let E=Ra(o.qosPreference);c.mediaTrack.contentHint=E}else o!=null&&o.videoTrack||(c.mediaTrack.contentHint=Ra(ur.QOS_PREFERENCE_CLEAR));if(c.mediaTrack.addEventListener(N.ENDED,()=>{e._stopScreenShare(),e.emit(He.SCREEN_SHARE_STOPPED)}),_.getAudioTracks()[0]&&(u=new fl(e._room.audioManager),u.setInputMediaStreamTrack(_.getAudioTracks()[0]),e._speakerId&&u.setAudioOutput(e._speakerId)),wn(c,c).add("player-state-changed",E=>{e.emit(He.VIDEO_PLAY_STATE_CHANGED,qe(Oe({},E),{userId:"",streamType:"sub"}))}),r&&e._room.isJoined){let E=[c];u&&E.push(u),e._room.publish(...E).catch(()=>{})}e._localScreenTrack=c,e._localScreenAudioTrack=u,e._localScreenConfig=qe(Oe({},t),{view:i,publish:r}),yield e._updateVideoPlayOption({view:i,playOption:d,track:c})}()})}updateScreenShare(e){return B(this,null,function*(){if(!this._localScreenTrack||!this._localScreenConfig)return;let{view:t,publish:i,option:r}=e,o={};if(r&&(re(r.fillMode)||(o.objectFit=r.fillMode),r.qosPreference)){let c=Ra(r.qosPreference);this._localScreenTrack.mediaTrack.contentHint=c}this._room.isJoined&&!re(i)&&(i&&!this._localScreenConfig.publish&&(this._room.publish(this._localScreenTrack).catch(()=>{}),this._localScreenAudioTrack&&this._room.publish(this._localScreenAudioTrack).catch(()=>{})),this._localScreenConfig.publish&&!i&&(this._room.unpublish(this._localScreenTrack).catch(()=>{}),this._localScreenAudioTrack&&this._room.unpublish(this._localScreenAudioTrack).catch(()=>{}))),yield this._updateVideoPlayOption({view:t,playOption:o,track:this._localScreenTrack,prevConfig:this._localScreenConfig}),Bs(this._localScreenConfig,e)})}stopScreenShare(){return B(this,null,function*(){return yield this._stopScreenShare()})}startRemoteVideo(e){return B(this,null,function*(){let{view:t,userId:i,streamType:r,option:o}=e,c="".concat(i,"_").concat(r);if(this._remoteVideoConfigMap.has(c))return void this._log.warn("remote video has already started. userId:".concat(i,", streamType:").concat(r));let u=this._room.remotePublishedUserMap.get(i);if(!u)return;let f={},d=r==="main"?u.remoteVideoTrack:u.remoteAuxiliaryTrack;this._listenOutputTrackChanged(d),o&&(re(o.fillMode)||(f.objectFit=o.fillMode),re(o.mirror)||(f.mirror=o.mirror),r==="main"&&!re(o.small)&&(u.remoteVideoTrack.setMediaType(o.small?8:4),this._room.changeType(o.small,d.user))),yield this._room.subscribe(d),yield this._updateVideoPlayOption({view:t,playOption:f,track:d}),this._emitTrackEvent(d),this._remoteVideoConfigMap.set(c,{config:e}),o&&!re(o.receiveWhenViewVisible)&&this._observeView({remoteTrack:d,view:t,receiveWhenViewVisible:o.receiveWhenViewVisible,viewRoot:o==null?void 0:o.viewRoot})})}updateRemoteVideo(e){return B(this,null,function*(){var t,i;let{view:r,userId:o,streamType:c,option:u}=e,f="".concat(o,"_").concat(c),d=this._remoteVideoConfigMap.get(f);if(!d||!this._room.remotePublishedUserMap.has(o))return;let _={};u&&(re(u.fillMode)||(_.objectFit=u.fillMode),re(u.mirror)||(_.mirror=u.mirror));let E=null,S=this._room.remotePublishedUserMap.get(o);if(c==="main"&&(S!=null&&S.muteState.hasVideo)&&(E=S.remoteVideoTrack),c==="sub"&&(S!=null&&S.muteState.hasAuxiliary)&&(E=S.remoteAuxiliaryTrack),!E)return;let{config:R}=d;c==="main"&&u&&!re(u.small)&&this._room.changeType(u.small,E.user),yield this._updateVideoPlayOption({view:r,playOption:_,track:E,prevConfig:R}),Bs(R,e);let k=re(u==null?void 0:u.receiveWhenViewVisible)?(t=R.option)==null?void 0:t.receiveWhenViewVisible:u.receiveWhenViewVisible,U=re(r)?R.view:r,K=re(u==null?void 0:u.viewRoot)?(i=R.option)==null?void 0:i.viewRoot:u.viewRoot;this._observeView({remoteTrack:E,view:U,receiveWhenViewVisible:k,viewRoot:K})})}stopRemoteVideo(e){return B(this,null,function*(){return this._stopRemoteVideo(e)})}_stopRemoteVideo(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return B(this,null,function*(){let i=[],r=this._room.remotePublishedUserMap.get(e.userId);if(r){let{muteState:c,remoteVideoTrack:u,remoteAuxiliaryTrack:f}=r;e.streamType==="main"&&(u.stop(),c.hasVideo&&i.push(u)),e.streamType==="sub"&&(f.stop(),c.hasAuxiliary&&i.push(f))}for(let c of i)t&&(yield this._room.unsubscribe(c),this._mediaTrackMap.get(c.outMediaTrack)===c.userId&&this._mediaTrackMap.delete(c.outMediaTrack));let o=this._remoteVideoConfigMap.get("".concat(e.userId,"_").concat(e.streamType));o&&o.observer&&o.observer.disconnect(),this._remoteVideoConfigMap.delete("".concat(e.userId,"_").concat(e.streamType))})}muteRemoteAudio(e,t){return B(this,null,function*(){if(e==="*")if(t)yield this._stopRemoteAudio({userId:e});else{let i=[...this._room.remotePublishedUserMap.values()];for(let r of i)r.muteState.hasAudio&&(yield this._startRemoteAudio({userId:r.userId}))}else t?yield this._stopRemoteAudio({userId:e}):yield this._startRemoteAudio({userId:e});this._remoteAudioMuteMap.set(e,t)})}setRemoteAudioVolume(e,t){if(e==="*"){let i=[...this._room.remotePublishedUserMap.values()];for(let r of i)this._updateAudioPlayOption({playOption:{volume:t},track:r.remoteAudioTrack})}else if(e){let i=this._room.remotePublishedUserMap.get(e);i&&this._updateAudioPlayOption({playOption:{volume:t},track:i.remoteAudioTrack})}}startPlugin(e,t){return B(this,null,function*(){return e.start(t)})}updatePlugin(e,t){return B(this,null,function*(){return e.update(t)})}stopPlugin(e,t){return B(this,null,function*(){return e.stop(t)})}enableAudioVolumeEvaluation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2e3,t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._room.enableAudioVolumeEvaluation(e,t)}on(e,t,i){return this.listeners(e).includes(t)||(super.on(e,t,i),this._eventListened.add(e)),this}off(e,t,i){return e==="*"?(this._eventListened.clear(),this.removeAllListeners()):super.off(e,t,i),this}getAudioTrack(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{userId:"",streamType:"main"};var t,i;let r,o="main";if(_t(e)?r=e:(r=e.userId,e.streamType&&(o=e.streamType)),!r)return o==="sub"?((t=this._localScreenAudioTrack)==null?void 0:t.mediaTrack)||null:((i=this._localAudioTrack)==null?void 0:i.mediaTrack)||null;{let c=this._room.remotePublishedUserMap.get(r);if(c)return c.remoteAudioTrack.mediaTrack}return null}getVideoTrack(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{userId:"",streamType:"main"},{userId:t="",streamType:i="main"}=e;if(t===""){if(i==="main"&&this._localVideoTrack)return this._localVideoTrack.mediaTrack;if(i==="sub"&&this._localScreenTrack)return this._localScreenTrack.mediaTrack}else{let r=this._room.remotePublishedUserMap.get(t);if(r)return i==="main"?r.remoteVideoTrack.mediaTrack:r.remoteAuxiliaryTrack.mediaTrack}return null}getVideoSnapshot(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{userId:t,streamType:i="main"}=e;if(t){let r=this._room.remotePublishedUserMap.get(t);if(i==="main"&&(r!=null&&r.muteState.hasVideo))return r.remoteVideoTrack.getVideoFrame();if(i==="sub"&&(r!=null&&r.muteState.hasAuxiliary))return r.remoteAuxiliaryTrack.getVideoFrame()}else{if(i==="main"&&this._localVideoTrack)return this._localVideoTrack.getVideoFrame();if(i==="sub"&&this._localScreenTrack)return this._localScreenTrack.getVideoFrame()}return""}setCurrentSpeaker(e){var t,i;this._speakerId=e,(t=this._localAudioTrack)==null||t.setAudioOutput(e),(i=this._localScreenAudioTrack)==null||i.setAudioOutput(e),this._room.remotePublishedUserMap.forEach(r=>r.remoteAudioTrack.setAudioOutput(e))}_startRemoteAudio(e){return this._doStartRemoteAudio(e)}_doStartRemoteAudio(e){return B(this,null,function*(){let{userId:t,option:i}=e;if(this._remoteAudioConfigMap.has(t))return void this._log.warn("remote audio has already started. userId:".concat(t));let r=this._room.remotePublishedUserMap.get(t);if(!r)return;let o={};i&&(re(i.volume)||(o.volume=i.volume));let c=r.remoteAudioTrack;this._listenOutputTrackChanged(c),this._speakerId&&c.setAudioOutput(this._speakerId);try{this._remoteAudioConfigMap.set(t,e),yield this._room.subscribe(c),yield this._updateAudioPlayOption({playOption:o,track:c})}catch(u){throw this._remoteAudioConfigMap.delete(t),u}this._emitTrackEvent(c)})}_stopRemoteAudio(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return B(this,null,function*(){let i=this._room.remotePublishedUserMap.get(e.userId);i&&(i.remoteAudioTrack.stop(),i.muteState.hasAudio&&t&&(yield this._room.unsubscribe(i.remoteAudioTrack)),this._mediaTrackMap.get(i.remoteAudioTrack.outMediaTrack)===e.userId&&this._mediaTrackMap.delete(i.remoteAudioTrack.outMediaTrack)),this._remoteAudioConfigMap.delete("".concat(e.userId))})}_updateVideoPlayOption(e){return B(this,arguments,function(t){let{view:i,playOption:r,track:o,prevConfig:c}=t;return function*(){if(o.setMirror(r.mirror),re(i)&&c&&c.view&&!CA(r)){let u=Yd(c.view);u.length>0&&(yield o.play(u,r))}if(!re(i)){let u=Yd(i);u.length>0?yield o.play(u,r):o.stop()}}()})}_updateAudioPlayOption(e){return B(this,arguments,function(t){let{playOption:i={},track:r,prevConfig:o}=t;return function*(){if(!r.isPlayCalled)try{yield r.play(null,i)}catch{}re(i.muted)||r.setPlayerMute(i.muted),re(i.volume)||r.setAudioVolume(i.volume/100)}()})}_listenOutputTrackChanged(e){e.listeners("output-media-track-changed").length===0&&e.on("output-media-track-changed",()=>this._emitTrackEvent(e))}_emitTrackEvent(e){let t=e.isRemote?e.userId:"";e.outMediaTrack&&this._mediaTrackMap.get(e.outMediaTrack)!==t&&(this._mediaTrackMap.set(e.outMediaTrack,t),this.emit(He.TRACK,{userId:t,streamType:ph(e.streamType),track:e.outMediaTrack}))}_checkTrackToPublish(){var e,t,i;let r=[];if((e=this._localAudioConfig)!=null&&e.publish&&this._localAudioTrack&&r.push(this._localAudioTrack),(t=this._localVideoConfig)!=null&&t.publish&&this._localVideoTrack&&r.push(this._localVideoTrack),(i=this._localScreenConfig)!=null&&i.publish&&(this._localScreenTrack&&r.push(this._localScreenTrack),this._localScreenAudioTrack&&r.push(this._localScreenAudioTrack)),r.length!==0)return this._room.publish(...r).catch(()=>{})}_observeView(e){let{remoteTrack:t,view:i,receiveWhenViewVisible:r=!1,viewRoot:o}=e;if(re(i))return;let c=this._remoteVideoConfigMap.get("".concat(t.userId,"_").concat(ph(t.streamType)));if(!c)return;let u=c.observer||void 0;if(i===null||ri(i)&&i.length===0||!r)return u==null||u.disconnect(),void(t.isSubscribed||this._room.subscribe(t).catch(()=>{}));let f=c.visibleViewMap||new Map,d=-1;(!u||u.root!==o)&&(u==null||u.disconnect(),f.clear(),u=new IntersectionObserver(E=>{E.forEach(S=>{f.set(S.target,S.isIntersecting)}),clearTimeout(d),d=window.setTimeout(()=>{[...f.values()].find(S=>S)?t.isSubscribed||this._room.subscribe(t).catch(()=>{}):t.isSubscribed&&this._room.unsubscribe(t).catch(()=>{})},200)},{root:o}));let _=new Set(Yd(i));f.forEach((E,S)=>{_.has(S)||(u.unobserve(S),f.delete(S))}),_.forEach(E=>{f.set(E,!0),u.observe(E)}),u.takeRecords().forEach(E=>{f.set(E.target,E.isIntersecting)}),c.visibleViewMap=f,c.observer=u}_exitRoom(){return B(this,null,function*(){this._room.isJoined&&(yield this._room.leave()),new Set([...this._remoteAudioConfigMap.keys(),...this._remoteAudioMuteMap.keys()]).forEach(e=>{this._stopRemoteAudio({userId:e}).catch()}),[...this._remoteVideoConfigMap.keys()].forEach(e=>{let t=e.includes("main")?"main":"sub",i=e.split("_".concat(t))[0];i&&this._stopRemoteVideo({userId:i,streamType:t}).catch()}),this._remoteVideoConfigMap.clear(),this._remoteAudioConfigMap.clear(),this._remoteAudioMuteMap.clear(),this._room.remotePublishedUserMap.forEach(e=>{Ti(e.remoteAudioTrack),Ti(e.remoteVideoTrack),Ti(e.remoteAuxiliaryTrack)})})}_stopScreenShare(){return B(this,null,function*(){var e;if(this._localScreenTrack){if(this._room.isJoined){let t=[this._localScreenTrack];this._localScreenAudioTrack&&t.push(this._localScreenAudioTrack),yield(e=this._room)==null?void 0:e.unpublish(...t).catch(()=>{})}this._localScreenTrack.stop(),this._localScreenTrack.close(),this._localScreenAudioTrack&&(this._localScreenAudioTrack.stop(),this._localScreenAudioTrack.close(),this._room.audioManager.removeInput(this._localScreenAudioTrack),this._localScreenAudioTrack=null),Ti(this._localScreenTrack),this._localScreenTrack=null,this._localScreenConfig=null}})}_initActiveSpeaker(){return B(this,null,function*(){if(ai&&!dl(ai))this.emit(He.DEVICE_CHANGED,{type:"speaker",action:"active",device:ai});else{let e=yield Ta();if(e[0]&&!dl(e[0]))ai=e[0],this.emit(He.DEVICE_CHANGED,{type:"speaker",action:"active",device:e[0]});else{let t=i=>{let{track:r}=i;r.kind==="audio"&&(!ai||dl(ai))&&(this._initActiveSpeaker(),pe.off("102",this._initActiveSpeaker))};pe.on("102",t)}}})}_onAudioAvailable(e){let{userId:t}=e,i=this._remoteAudioMuteMap.has(t)?this._remoteAudioMuteMap.get(t):this._remoteAudioMuteMap.get("*");(i===!1||this._room.autoReceiveAudio&&!i)&&this._doStartRemoteAudio({userId:t}).catch(()=>{})}_onVideoAvailable(e){let{userId:t,streamType:i}=e;if(!this._room.autoReceiveVideo)return;let r=this._room.remotePublishedUserMap.get(t);if(r){let o=i==="main"?r.remoteVideoTrack:r.remoteAuxiliaryTrack;this._room.subscribe(o).then(()=>{this._emitTrackEvent(o)}).catch(()=>{})}}_onAudioUnavailable(e){let{userId:t,muteState:i}=e;i.hasAudio&&i.audioMuted||this._stopRemoteAudio({userId:t},!1).catch(()=>{})}_onVideoUnavailable(e){let{userId:t,streamType:i}=e;this._stopRemoteVideo({userId:t,streamType:i},!1).catch(()=>{})}sendSEIMessage(e,t){this._room.sendSEI(e,t||{seiPayloadType:243})}sendCustomMessage(e){var t,i;(i=(t=this._room).sendCustomMessage)==null||i.call(t,e)}static setLogLevel(e,t){Te.setLogLevel(e),re(t)||(t?Te.enableUploadLog():Te.disableUploadLog())}static isSupported(){return bg()}static getCameraList(){return Gr(!0)}static getMicrophoneList(){return ar(!0)}static getSpeakerList(){return Ta(!0)}static setCurrentSpeaker(e){return B(this,null,function*(){(yield Ta()).forEach(t=>{t.deviceId===e&&(Qg.forEach(i=>{i.setCurrentSpeaker(e),i.emit(He.DEVICE_CHANGED,{type:"speaker",action:"active",device:t})}),ai=t)})})}static _addKVStat(e){let{type:t,key:i,value:r,base:o,useUV:c,version:u}=e;switch(u&&(ul.version=u),t){case"count":ul.addCount({key:i,useUV:c});break;case"enum":ul.addEnum({key:i,value:r,useUV:c});break;case"number":ul.addNumber({key:i,value:r,split:o})}}},Ke=gh;b(Ke,"_loggerManager",Te),b(Ke,"EVENT",He),b(Ke,"ERROR_CODE",Ue),b(Ke,"TYPE",ur),b(Ke,"frameWorkType",30),Ie([It({replaceArg:e=>({argIndex:0,value:{name:"plugin"in e?e.plugin.Name:e.Name,assetsPath:"assetsPath"in e?e==null?void 0:e.assetsPath:"default"}})})],Ke.prototype,"use"),Ie([mi(Zt.TRTC.enterRoom),Ks("room",(e,t)=>{let[i]=e,[r]=t;return(i.roomId||i.strRoomId)===(r.roomId||r.strRoomId)&&i.userId===r.userId&&i.sdkAppId===r.sdkAppId}),St(e=>function(t){return this._log.setUserId(t.userId),this._log.setSdkAppId(t.sdkAppId),e.call(this,t)}),It()],Ke.prototype,"enterRoom"),Ie([It()],Ke.prototype,"exitRoom"),Ie([mi(Zt.TRTC.switchRole),Aa("room",{merge:(e,t)=>t}),It()],Ke.prototype,"switchRole"),Ie([It()],Ke.prototype,"destroy"),Ie([mi(Zt.TRTC.startLocalAudio),Ks("audio",(e,t)=>{let[i]=e,[r]=t;var o,c;return((o=i==null?void 0:i.option)==null?void 0:o.microphoneId)===((c=r==null?void 0:r.option)==null?void 0:c.microphoneId)}),It()],Ke.prototype,"startLocalAudio"),Ie([mi(Zt.TRTC.updateLocalAudio),Aa("audio",{debounce:{delay:200,getKey:()=>"".concat(OR,"-localAudio"),isNeedToDebounce:e=>{var t;return!re((t=e.option)==null?void 0:t.captureVolume)}}}),It()],Ke.prototype,"updateLocalAudio"),Ie([Js("audio"),It()],Ke.prototype,"stopLocalAudio"),Ie([mi(Zt.TRTC.startLocalVideo),Ks("video",(e,t)=>{let[i]=e,[r]=t;var o,c;return((o=i==null?void 0:i.option)==null?void 0:o.cameraId)===((c=r==null?void 0:r.option)==null?void 0:c.cameraId)}),It()],Ke.prototype,"startLocalVideo"),Ie([mi(Zt.TRTC.updateLocalVideo),Aa("video"),It()],Ke.prototype,"updateLocalVideo"),Ie([Js("video"),It()],Ke.prototype,"stopLocalVideo"),Ie([mi(Zt.TRTC.startScreenShare),Ks("screen",()=>!0),It()],Ke.prototype,"startScreenShare"),Ie([mi(Zt.TRTC.updateScreenShare),Aa("screen"),It()],Ke.prototype,"updateScreenShare"),Ie([It()],Ke.prototype,"stopScreenShare"),Ie([mi(Zt.TRTC.startRemoteVideo),Ks(e=>"v".concat(e.userId).concat(e.streamType),()=>!0),It({getRemoteId:e=>"".concat(e.userId,"_").concat(e.streamType)})],Ke.prototype,"startRemoteVideo"),Ie([mi(Zt.TRTC.updateRemoteVideo),Aa(e=>"v".concat(e.userId).concat(e.streamType)),It({getRemoteId:e=>"".concat(e.userId,"_").concat(e.streamType)})],Ke.prototype,"updateRemoteVideo"),Ie([mi(Zt.TRTC.stopRemoteVideo),St(e=>function(t){return B(this,null,function*(){if(t.userId==="*"){let i=[];return this._room.remotePublishedUserMap.forEach(r=>{this._remoteVideoConfigMap.has("".concat(r.userId,"_","main"))&&i.push(this.stopRemoteVideo({streamType:"main",userId:r.userId}).catch(()=>{})),this._remoteVideoConfigMap.has("".concat(r.userId,"_","sub"))&&i.push(this.stopRemoteVideo({streamType:"sub",userId:r.userId}).catch(()=>{}))}),Promise.all(i)}return e.call(this,t)})}),It({getRemoteId:e=>"".concat(e.userId,"_").concat(e.streamType)})],Ke.prototype,"stopRemoteVideo"),Ie([Js(e=>"v".concat(e.userId).concat(e.streamType))],Ke.prototype,"_stopRemoteVideo"),Ie([mi(...Zt.TRTC.muteRemoteAudio),It({getRemoteId:e=>e})],Ke.prototype,"muteRemoteAudio"),Ie([NR(...Zt.TRTC.setRemoteAudioVolume),function(e,t){return St((i,r)=>function(){for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];var f,d;let _=(f=fh.get(this))==null?void 0:f.get(t(...c));_&&_>0&&clearTimeout(_);let E=window.setTimeout(()=>{i.apply(this,c)},e);fh.has(this)?(d=fh.get(this))==null||d.set(t(...c),E):fh.set(this,new Map([[t(...c),E]]))})}(200,e=>e),It({getRemoteId:e=>e})],Ke.prototype,"setRemoteAudioVolume"),Ie([Yg("start"),Ks((e,t)=>e.getAlias()+e.getGroup(t)),It({replaceArg:e=>({argIndex:0,value:e.getName()}),getKVReportKey:e=>iR[e.getName()]})],Ke.prototype,"startPlugin"),Ie([Yg("update"),Aa((e,t)=>e.getAlias()+e.getGroup(t)),It({replaceArg:e=>({argIndex:0,value:e.getName()}),getKVReportKey:e=>nR[e.getName()]})],Ke.prototype,"updatePlugin"),Ie([Yg("stop"),Js((e,t)=>e.getAlias()+e.getGroup(t)),It({replaceArg:e=>({argIndex:0,value:e.getName()}),getKVReportKey:e=>rR[e.getName()]})],Ke.prototype,"stopPlugin"),Ie([NR(...Zt.TRTC.enableAudioVolumeEvaluation)],Ke.prototype,"enableAudioVolumeEvaluation"),Ie([It()],Ke.prototype,"getVideoSnapshot"),Ie([It()],Ke.prototype,"setCurrentSpeaker"),Ie([Ks(e=>"a".concat(e.userId),()=>!0)],Ke.prototype,"_startRemoteAudio"),Ie([St(e=>function(t){return B(this,null,function*(){return t.userId==="*"?Promise.all([...this._room.remotePublishedUserMap.values()].map(i=>this._stopRemoteAudio(qe(Oe({},t),{userId:i.userId})).catch(()=>{}))):e.call(this,t)})}),Js(e=>"a".concat(e.userId))],Ke.prototype,"_stopRemoteAudio"),Ie([Js("room")],Ke.prototype,"_exitRoom"),Ie([Js("screen")],Ke.prototype,"_stopScreenShare"),Ie([mi(...Zt.TRTC.sendSEIMessage),SR({timesInSecond:30,maxSizeInSecond:8e3,getSize:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[0].byteLength}})],Ke.prototype,"sendSEIMessage"),Ie([mi(Zt.TRTC.sendCustomMessage),SR({timesInSecond:30,maxSizeInSecond:8e3,getSize:e=>e.data.byteLength})],Ke.prototype,"sendCustomMessage"),Ie([mi(Zt.TRTC.create)],Ke,"_create");var vh=Ke,M7=class{constructor(){this._set=new Set,pe.on(oe.LEAVE_SUCCESS,this.delete,this)}add(e){let{room:t,roomId:i}=e;if(t.scene==="rtc")return;let r=this.getKey(t.userId,i||t.roomId,t.sdkAppId,t.useStringRoomId);this._set.add(r)}delete(e){let{room:t,roomId:i}=e;if(t.scene==="rtc")return;let r=this.getKey(t.userId,t.roomId||i,t.sdkAppId,t.useStringRoomId);this._set.delete(r)}getKey(e,t,i,r){return"".concat(i,"_").concat(t,"_").concat(e,"_").concat(r)}isJoined(e){let{userId:t,roomId:i,sdkAppId:r,room:o}=e;return o.scene!=="rtc"&&this._set.has(this.getKey(t,i,r,o.useStringRoomId))}};function L7(){return B(this,null,function*(){let e,t;try{let S=yield ar();e=S&&S.length}catch{}try{let S=yield Gr();t=S&&S.length}catch{}let i={microphone:e,camera:t},{isH264EncodeSupported:r,isVp8EncodeSupported:o,isH264DecodeSupported:c,isVp8DecodeSupported:u}=this.checkSystemResult.detail,f=nl.basis(),d={webRTC:f.isWebRTCSupported,getUserMedia:f.isGetUserMediaSupported,webSocket:f.isWebSocketsSupported,screenShare:f.isScreenShareSupported,webAudio:f.isWebAudioSupported,h264Encode:r,h264Decode:c,vp8Encode:o,vp8Decode:u},_={browser:f.browser,os:f.os,trtc:d,devices:i},E={isWebCodecSupported:f.isWebCodecSupported,isMediaSessionSupported:f.isMediaSessionSupported,isWebTransportSupported:f.isWebTransportSupported};Ht.uploadEvent({log:"trtcstats-".concat(JSON.stringify(_)),userId:this.userId}),this._log.info("TrtcStats-".concat(JSON.stringify(_))),Ht.uploadEvent({log:"trtcadvancedstats-".concat(JSON.stringify(E)),userId:this.userId})})}var x7=ni(Di(),1),PR=Symbol("instance"),Zg=Symbol("cacheResult"),yh=class{constructor(e,t,i){this.oldState=e,this.newState=t,this.action=i,this.aborted=!1}abort(e){this.aborted=!0,Al.call(e,this.oldState,new Error("action '".concat(this.action,"' aborted")))}toString(){return"".concat(this.action,"ing")}},$g=class extends Error{constructor(e,t,i){super(t),this.state=e,this.message=t,this.cause=i}},bl=new Map;function MR(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(r,o,c)=>{let u=i.action||o;if(!i.context){let d=bl.get(r)||[];bl.has(r)||bl.set(r,d),d.push({from:e,to:t,action:u})}let f=c.value;c.value=function(){let d=this;for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];if(i.context&&(d=wt.get(typeof i.context=="function"?i.context.call(this,...E):i.context)),d.state===t)return d[Zg];d.state instanceof yh&&d.state.action==i.abortAction&&d.state.abort(d);let R=null;if(Array.isArray(e)?e.length==0?d.state instanceof yh&&d.state.abort(d):(typeof d.state!="string"||!e.includes(d.state))&&(R=new $g(d._state,"".concat(d.name," ").concat(u," to ").concat(t," failed: current state ").concat(d._state," not in from config"))):e!==d.state&&(R=new $g(d._state,"".concat(d.name," ").concat(u," to ").concat(t," failed: current state ").concat(d._state," not from ").concat(e))),R){if(!i.fail){if(i.ignoreError)return R;throw R}i.fail.call(this,R)}let k=d.state,U=new yh(k,t,u);Al.call(d,U);let K=le=>{var Y;return d[Zg]=le,U.aborted||(Al.call(d,t),(Y=i.success)===null||Y===void 0||Y.call(this,d[Zg])),le},se=le=>{let Y=le instanceof Error?le.message:String(le);if(Al.call(d,k,le),!i.fail){if(i.ignoreError)return le;throw le}i.fail.call(this,new $g(d._state,"action '".concat(u,"' failed :").concat(Y),le instanceof Error?le:new Error(Y)))};try{let le=f.apply(this,E);return function(Y){return typeof Y=="object"&&Y&&"then"in Y}(le)?le.then(K).catch(se):K(le)}catch(le){se(le)}}}}var V7=typeof window<"u"&&window.__AFSM__?(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))}:typeof importScripts<"u"?(e,t)=>{postMessage({type:e,payload:t})}:()=>{};function Al(e,t){let i=this._state;this._state=e;let r=e.toString();e&&this.emit(r,i),this.emit(wt.STATECHANGED,e,i,t),this.updateDevTools({value:e,old:i,err:t instanceof Error?t.message:String(t)})}var wt=class extends x7.default{constructor(e,t,i){super(),this.name=e,this.groupName=t,this._state=wt.INIT,e||(e=Date.now().toString(36)),i?Object.setPrototypeOf(this,i):i=Object.getPrototypeOf(this),t||(this.groupName=this.constructor.name);let r=i[PR];r?this.name=r.name+"-"+r.count++:i[PR]={name:this.name,count:0},this.updateDevTools({diagram:this.stateDiagram})}get stateDiagram(){let e=Object.getPrototypeOf(this),t=bl.get(e)||[],i=new Set,r=[],o=[],c=new Set,u=Object.getPrototypeOf(e);bl.has(u)&&(u.stateDiagram.forEach(d=>i.add(d)),u.allStates.forEach(d=>c.add(d))),t.forEach(d=>{let{from:_,to:E,action:S}=d;typeof _=="string"?r.push({from:_,to:E,action:S}):_.length?_.forEach(R=>{r.push({from:R,to:E,action:S})}):o.push({to:E,action:S})}),r.forEach(d=>{let{from:_,to:E,action:S}=d;c.add(_),c.add(E),c.add(S+"ing"),i.add("".concat(_," --> ").concat(S,"ing : ").concat(S)),i.add("".concat(S,"ing --> ").concat(E," : ").concat(S," ")),i.add("".concat(S,"ing --> ").concat(_," : ").concat(S," "))}),o.forEach(d=>{let{to:_,action:E}=d;i.add("".concat(E,"ing --> ").concat(_," : ").concat(E," ")),c.forEach(S=>{S!==_&&i.add("".concat(S," --> ").concat(E,"ing : ").concat(E))})});let f=[...i];return Object.defineProperties(e,{stateDiagram:{value:f},allStates:{value:c}}),f}static get(e){let t;return typeof e=="string"?(t=wt.instances.get(e),t||wt.instances.set(e,t=new wt(e,void 0,Object.create(wt.prototype)))):(t=wt.instances2.get(e),t||wt.instances2.set(e,t=new wt(e.constructor.name,void 0,Object.create(wt.prototype)))),t}static getState(e){var t;return(t=wt.get(e))===null||t===void 0?void 0:t.state}updateDevTools(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V7(wt.UPDATEAFSM,Object.assign({name:this.name,group:this.groupName},e))}get state(){return this._state}set state(e){Al.call(this,e)}};wt.STATECHANGED="stateChanged",wt.UPDATEAFSM="updateAFSM",wt.INIT="[*]",wt.ON="on",wt.OFF="off",wt.instances=new Map,wt.instances2=new WeakMap;var U7=ni(Di()),LR="1",xR="5",e0="2",Ca="3",F7="5",B7="4",kn={CLIENT_BANNED:9,CHANNEL_SETUP_RESULT:19,CHANNEL_RECONNECT_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:4134,PEER_LEAVE:4135,STREAM_ADDED:16,STREAM_REMOVED:18,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,PUBLISH_RESULT:4098,PUBLISH_STATE_CHANGE_RESULT:4112,UNPUBLISH_RESULT:4100,SUBSCRIBE_RESULT:4102,UNSUBSCRIBE_RESULT:4104,SUBSCRIBE_CHANGE_RESULT:4106,MUTE_RESULT:4108,UPDATE_OFFER_RESULT:4128,START_PUBLISH_TENCENT_CDN_RES:1286,STOP_PUBLISH_TENCENT_CDN_RES:1288,START_PUBLISH_GIVEN_CDN_RES:777,STOP_PUBLISH_GIVEN_CDN_RES:779,START_MIX_TRANSCODE_RES:781,STOP_MIX_TRANSCODE_RES:783,USER_LIST_RES:4137,SWITCH_ROLE_RES:4110,UPDATE_CONSTRAINT_CONFIG_RES:772,REBUILD_PEER_CONNECTION_RES:4150,SPC_PUBLISH_RESULT:4146,SPC_SUBSCRIBE_RESULT:4156,ABILITY_STATUS_REPORT_RESULT:4158,SERVER_FIRST_PACKAGE_RECEIVED:5e3,RECEIVE_CUSTOM_MSG:4140},H7=[kn.UPDATE_REMOTE_MUTE_STAT,kn.UPLINK_NETWORK_STATS,kn.USER_LIST_RES,kn.MUTE_RESULT,kn.SERVER_FIRST_PACKAGE_RECEIVED,kn.RECEIVE_CUSTOM_MSG],Je={CLIENT_BANNED:"client-banned",CHANNEL_SETUP_RESULT:"channel-setup-result",CHANNEL_RECONNECT_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",PUBLISH_RESULT:"publish-result",PUBLISH_STATE_CHANGE_RESULT:"publish-state-change-result",UNPUBLISH_RESULT:"unpublish-result",SUBSCRIBE_RESULT:"subscribe-result",SUBSCRIBE_CHANGE_RESULT:"subscribe-change-result",UNSUBSCRIBE_RESULT:"unsubscribe-result",UPDATE_OFFER_RESULT:"update-offer-result",START_PUBLISH_TENCENT_CDN_RES:"start-publish-tencent-cdn-res",STOP_PUBLISH_TENCENT_CDN_RES:"stop-publish-tencent-cdn-res",START_PUBLISH_GIVEN_CDN_RES:"start-publish-given-cdn-res",STOP_PUBLISH_GIVEN_CDN_RES:"stop-publish-given-cdn-res",START_MIX_TRANSCODE_RES:"start-mix-transcode-res",STOP_MIX_TRANSCODE_RES:"stop-mix-transcode-res",USER_LIST_RES:"user-list-res",SWITCH_ROLE_RES:"switch_role_res",MUTE_RESULT:"mute-result",UPDATE_CONSTRAINT_CONFIG_RES:"update-contraint-config-res",REBUILD_PEER_CONNECTION_RES:"rebuild-pc-res",SPC_PUBLISH_RESULT:"spc-publish-result",SPC_SUBSCRIBE_RESULT:"spc-subscribe-result",ABILITY_STATUS_REPORT_RESULT:"ability-status-report",SERVER_FIRST_PACKAGE_RECEIVED:"first-pkg-received",RECEIVE_CUSTOM_MSG:"receive-custom-msg"},j7="publish_change",W7="join",z7="leave",G7="quality_report",VR="mute_uplink",K7="publish",UR="publish_state_change",t0="unpublish",J7="subscribe",FR="unsubscribe",BR="subscribe_change",Y7="start_publishing",q7="stop_publishing",X7="start_push_user_cdn",Q7="stop_push_user_cdn",Z7="start_mcu_mix",$7="stop_mcu_mix",eF="get_user_list",tF="change_role",HR="update_constraint_config",iF="rebuild_pc",nF="join/v2",rF="publish/v2",sF="subscribe/v3",oF="ability_status_report",aF="reconnect",cF="channel_msg",dr=new WeakMap;function Rl(e){let{settings:t={retries:5,timeout:2e3},onError:i,onRetrying:r,onRetryFailed:o}=e;return function(c,u,f){let d=Qc({retryFunction:f.value,settings:t,onError(_){let{error:E,retry:S,reject:R,retryFuncArgs:k}=_;i&&i.call(this,E,()=>{var U;(U=dr.get(c))!=null&&U.has(u)?S():R(E)},R,k)},onRetrying(_,E){var S;Tt(r)&&r.call(this,_,E),(S=dr.get(c))!=null&&S.has(u)&&(dr.get(c).get(u).stopRetry=E)},onRetryFailed:o});return f.value=function(){let _=dr.get(c);for(var E=arguments.length,S=new Array(E),R=0;R<E;R++)S[R]=arguments[R];return _?_.set(u,{args:S}):dr.set(c,new Map([[u,{args:S}]])),d.apply(this,S).finally(()=>{var k;return(k=dr.get(c))==null?void 0:k.delete(u)})},f}}function Eh(e){let{fnName:t,callback:i,validateArgs:r=!0}=e;return function(o,c,u){let f=u.value;return u.value=function(){for(var d,_,E=arguments.length,S=new Array(E),R=0;R<E;R++)S[R]=arguments[R];if((d=dr.get(o))!=null&&d.has(t)){let{stopRetry:k,args:U}=dr.get(o).get(t),K=!0;if(r){for(let se of U)if(!S.find(le=>le===se)){K=!1;break}}K&&(i&&i.apply(this,S),k&&k(),(_=dr.get(o))==null||_.delete(t))}return f.apply(this,S)},u}}var Th=new Set,jR=class extends U7.default{constructor(e){var t,i;super(),b(this,"room"),b(this,"url"),b(this,"backupUrl"),b(this,"race"),b(this,"destroyed",!1),b(this,"_socketInUse"),b(this,"_socket"),b(this,"_backupSocket"),b(this,"_signalInfo",{tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0}),b(this,"_currentState","DISCONNECTED"),b(this,"_isReconnecting",!1),b(this,"_seq",0),b(this,"_log"),b(this,"_lastMessageTime",-1),b(this,"_connnectStartTime",-1),b(this,"_stopConnectRetry"),b(this,"bytesSent",0),b(this,"bytesReceived",0),b(this,"keepAlive",!1),this.room=e.room,this.race=!!re(e.race)||e.race,(((i=(t=this.room.scheduleResult)==null?void 0:t.config)==null?void 0:i.keepAliveClient)||0)-Th.size>0&&this.room.enableSPC&&(this.keepAlive=!0,Th.add(this)),this.url=e.url,this.backupUrl=e.backupUrl,this._seq=0,this._log=Te.createLogger({id:"ws",userId:this.userId,sdkAppId:this.sdkAppId}),this.onmessage=this.onmessage.bind(this),this.onerror=this.onerror.bind(this),this.onclose=this.onclose.bind(this)}get urlParam(){let e="?sdkAppId=".concat(encodeURIComponent(this.sdkAppId),"&userId=").concat(encodeURIComponent(this.userId),"&userSig=").concat(encodeURIComponent(this.userSig),"&keepAlive=").concat(encodeURIComponent(Number(this.keepAlive)));return this.race?"".concat(e,"&race=1"):e}get _urlWithParam(){return"".concat(this.url).concat(this.race?"/v2/ws":"").concat(this.urlParam)}get _backupUrlWithParam(){return"".concat(this.backupUrl).concat(this.race?"/v2/ws":"").concat(this.urlParam)}get isConnected(){return this._currentState==="CONNECTED"}get isConnecting(){return this._currentState==="CONNECTING"}get sdkAppId(){return this.room.sdkAppId}get userId(){return this.room.userId}get userSig(){return this.room.userSig}get isOnline(){return this._currentState==="CONNECTED"&&Date.now()-this._lastMessageTime<12e3}connect(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1e4;return function*(){if(e.isConnected)return Promise.resolve();e._log.info("connect to [".concat(e.url,", ").concat(e.backupUrl,"]").concat(t?" timeout: ".concat(t):""," keepAlive: ").concat(Number(e.keepAlive))),e.emitConnectionStateChanged("CONNECTING"),e._connnectStartTime=it();let i=[e.connectWS({url:e._urlWithParam,isMain:!0,timeout:t})];e.race&&e._backupUrlWithParam!==e._urlWithParam&&i.push(e.connectWS({url:e._backupUrlWithParam,isMain:!1,timeout:t})),e._socketInUse=yield gg(i),e.unbindAndCloseSocket(e._socketInUse===e._socket?N.BACKUP:N.MAIN),e.emitConnectionStateChanged("CONNECTED")}()})}connectWS(e){let{url:t,timeout:i,isMain:r}=e,o=new WebSocket(t);this.bindSocket(o),r?this._socket=o:this._backupSocket=o;let c=-1;return new Promise((u,f)=>{o.onclose=f,o.onerror=f,o.onopen=()=>u(o),i&&(c=setTimeout(()=>{this.unbindAndCloseSocket(r?N.MAIN:N.BACKUP),f(new ke({code:ge.SIGNAL_CHANNEL_SETUP_FAILED,message:"ws connect timeout"}))},i))}).finally(()=>{o.onclose=null,o.onerror=null,o.onopen=null,clearTimeout(c)})}bindSocket(e){e.addEventListener("close",this.onclose),e.addEventListener("error",this.onerror),e.addEventListener("message",this.onmessage)}unbindSocket(e){e.removeEventListener("close",this.onclose),e.removeEventListener("error",this.onerror),e.removeEventListener("message",this.onmessage)}unbindAndCloseSocket(e){if(e===N.MAIN){if(this._socket){this.unbindSocket(this._socket);try{this._socket.close(1e3)}catch{}this._socket=null}}else if(this._backupSocket){this.unbindSocket(this._backupSocket);try{this._backupSocket.close(1e3)}catch{}this._backupSocket=null}}onclose(e){if(e.target===this._socketInUse&&(this._log.warn("".concat(e.target===this._socket?"main":"backup"," is closed code:").concat(e.code," ").concat(e.reason)),this.emitConnectionStateChanged("DISCONNECTED"),!e.wasClean||e.code!==1e3)){this._socketInUse.onclose=null,this._socketInUse.close(4011);let t=this._socketInUse===this._socket;this.unbindAndCloseSocket(t?N.MAIN:N.BACKUP),this._socketInUse=null,this.reconnect()}}onerror(e){this._log.error("".concat(e.target===this._socket?"main":"backup"," error observed")),e.target===this._socketInUse&&(this.unbindAndCloseSocket(N.MAIN),this.unbindAndCloseSocket(N.BACKUP),this._socketInUse=null,this.reconnect())}onmessage(e){if(!this.isConnected)return;this._lastMessageTime=Date.now(),this.bytesReceived+=vg(e.data);let t=JSON.parse(e.data),{cmd:i,data:r}=t,o=Object.values(kn),c=Object.keys(kn)[o.indexOf(i)],u=Je[c];switch(H7.includes(i)||(this._log.debug("received ".concat(i," msg: ").concat(e.data)),u&&this._log.info("Received event: [ ".concat(u," ]"))),i){case kn.CHANNEL_SETUP_RESULT:if(t.code===0)this._signalInfo.clientIp=r.clientIp,this._signalInfo.signalIp=r.signalInnerIp,r.svrTime&&function(f){A_=f-new Date().getTime();let d=new Date;d.setTime(f),Te.info("baseTime from server: ".concat(d," offset: ").concat(A_))}(r.svrTime),this._log.info("ChannelSetup Success"),et.addSuccessEvent({key:521701,cost:it()-this._connnectStartTime}),this._connnectStartTime=-1,this.emit(LR,{signalInfo:this._signalInfo});else{let f=new ke({code:ge.SIGNAL_CHANNEL_SETUP_FAILED,extraCode:t.code,message:je({key:Ve.SIGNAL_CHANNEL_SETUP_FAILED,data:{errorCode:t.code,errorMsg:t.message}})});this._log.error("".concat(t.code,", ").concat(t.message)),this.close(),et.addFailedEvent({key:521701,error:f}),this.emit(xR,f)}break;case kn.JOIN_ROOM_RESULT:t.code===0&&(this._signalInfo.relayIp=r.relayOuterIp,this._signalInfo.relayInnerIp=r.relayInnerIp,this._signalInfo.relayPort=r.relayPort,this._signalInfo.tinyId=t.tinyId,this._log.info("signalIp:".concat(this._signalInfo.signalIp," clientIp:").concat(this._signalInfo.clientIp," relayIp: ").concat(this._signalInfo.relayIp))),this.emit(u,{data:t});break;default:this.emit(u,{data:t})}}reGetSignalChannelUrl(){return B(this,null,function*(){try{Br(!0),yield this.room.schedule(this.room.roomId);let{mainUrl:e,backupUrl:t}=this.room.getSignalChannelUrl();this.url=e,this.backupUrl=t}catch{}})}reconnect(){return B(this,null,function*(){if(!this._isReconnecting){if(!this.room.isJoined&&this.keepAlive)return void this.close();this._isReconnecting=!0;try{this._log.warn("reconnect"),yield this.connect();let{roomId:e,useStringRoomId:t}=this.room,{relayIp:i,relayInnerIp:r,relayPort:o}=this._signalInfo,{data:c}=yield this.sendWaitForResponse({command:aF,data:{roomId:e,useStringRoomId:t,relayInnerIp:r,relayOuterIp:i,relayPort:o},responseCommand:Je.CHANNEL_RECONNECT_RESULT});c.code===0?(this._log.warn("reconnect success"),this.stopReconnection(),et.addSuccessEvent({key:521702,cost:it()-this._connnectStartTime}),this._connnectStartTime=-1,this.room.syncUserList(),this.room.checkConnectionsToReconnect()):(et.addFailedEvent({key:521702,error:c.code}),this._log.warn("reconnect failed, ".concat(c.code," ").concat(c.message)),this.room.reJoin())}catch(e){this._log.error(e),this.room.reJoin()}}})}send(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.isConnected&&!this.room.isLeft){let i={cmd:e,data:t,userId:this.userId,tinyId:this._signalInfo.tinyId,seq:++this._seq},r=JSON.stringify(i);return this._socketInUse.send(r),this.bytesSent+=vg(r),i.seq}}sendWaitForResponse(e){let{command:t,data:i,timeout:r=5e3,responseCommand:o,commandDesc:c,enableLog:u=!0}=e;return new Promise((f,d)=>{let _=setTimeout(()=>{this.off(o,E);let R=new ke({code:ge.API_CALL_TIMEOUT,message:je({key:Ve.API_CALL_TIMEOUT,data:{commandDesc:c,command:t}})});u&&this._log.warn(R),d(R)},r),E=R=>{R.data.seq===S&&(clearTimeout(_),this.off(o,E),f(R))};this.on(o,E);let S=this.send(t,i)})}sendWaitForResponseWithRetry(e){let{commandDesc:t,command:i,retries:r=0,retryTimeout:o=0}=e;return Qc({retryFunction:this.sendWaitForResponse,onError:c=>{let{retry:u}=c;this.isOnline?u():(this._log.warn("retry ".concat(i," when connected")),this.once(Ca,u))},onRetrying:c=>{this._log.warn("".concat(t||i," timeout observed, retrying [").concat(c,"/").concat(r,"]"))},settings:{retries:r,timeout:o},context:this})(e)}getCurrentState(){return this._currentState}getSignalInfo(){return this._signalInfo}stopReconnection(){this._isReconnecting=!1,this._stopConnectRetry&&this._stopConnectRetry()}close(){this._log.info("closed"),Th.delete(this),this.stopReconnection(),this._signalInfo={tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0},this._socketInUse=null,this.bytesSent=0,this.bytesReceived=0,this._stopConnectRetry&&this._stopConnectRetry(),this.unbindAndCloseSocket(N.MAIN),this.unbindAndCloseSocket(N.BACKUP),this.emitConnectionStateChanged("DISCONNECTED")}destroy(){this.close(),this.destroyed=!0}stopKeepAliveIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3600;if(this.keepAlive){this._log.info("stopKeepAlive in ".concat(e,"s"));let t=setTimeout(()=>{this.keepAlive=!1,this._log.info("close due to not used ".concat(e,"s")),this.close()},1e3*e),i=r=>{r instanceof yh&&r.action==="join"&&(this._log.info("stopKeepAlive clear timeout"),clearTimeout(t),this.room.off(wt.STATECHANGED,i))};this.room.on(wt.STATECHANGED,i)}}emitConnectionStateChanged(e){e!==this._currentState&&(this._log.info("".concat(this._currentState," -> ").concat(e)),this.emit(e0,{prevState:this._currentState,state:e}),this._currentState=e,e==="CONNECTED"?this.emit(Ca):e==="DISCONNECTED"&&this.emit(F7))}};Ie([Rl({settings:{retries:1/0,timeout:2e3},onError(e,t){!this.room.isDestroyed&&!this.destroyed&&t()},onRetrying(e,t){this._log.warn("retrying to connect ".concat(e)),e>=3&&e%3==0&&this.reGetSignalChannelUrl(),t&&(this._stopConnectRetry=t,(this.room.isDestroyed||this.destroyed)&&t())}})],jR.prototype,"connect");var lF=ni(Di()),i0=0,n0=!1,Sh=new Set,WR=!1,Ys=class{constructor(e){b(this,"userId"),b(this,"tinyId"),b(this,"_sdpSemantics"),b(this,"_isUplink"),b(this,"_room"),b(this,"_log"),b(this,"_signalChannel"),b(this,"_isErrorObserved",!1),b(this,"_waitForPeerConnectionConnectedPromise"),b(this,"_waitForPeerConnectionConnectedPromiseReject",null),b(this,"_peerConnection",null),b(this,"_emitter",new lF.default),b(this,"_currentState","DISCONNECTED"),b(this,"_isReconnecting",!1),b(this,"_reconnectionCount",0),b(this,"_reconnectionTimer",-1),b(this,"_isFirstConnection",!0),b(this,"_prevTime",-1),b(this,"_enableSEI"),b(this,"_sei"),b(this,"_localAddress"),b(this,"_remoteAddress"),this.userId=e.userId,this.tinyId=e.tinyId,this._room=e.room,this._sdpSemantics=e.room.sdpSemantics,this._isUplink=e.isUplink,this._log=Te.createLogger({id:"n-mpc",userId:this._room.userId,remoteUserId:this.userId,sdkAppId:this._room.sdkAppId,isLocal:this._isUplink}),this._signalChannel=e.signalChannel,this._enableSEI=e.enableSEI}beforeConnect(){this._prevTime<0&&(this._prevTime=it())}afterConnect(e){return B(this,null,function*(){try{yield e,this._isFirstConnection?(this._isFirstConnection=!1,et.addSuccessEvent({key:521705,cost:Math.min(it()-this._prevTime,3e4)})):this._isReconnecting&&et.addSuccessEvent({key:521706,cost:it()-this._prevTime}),this._prevTime=-1}catch(t){throw this._isFirstConnection?(this._isFirstConnection=!1,et.addFailedEvent({key:521705,error:t})):this._isReconnecting&&this._reconnectionCount>=3&&et.addFailedEvent({key:521706,error:t}),t}})}initialize(){let e={encodedInsertableStreams:this._enableSEI&&sl,iceServers:this._room.getIceServers(),iceTransportPolicy:this._room.getIceTransportPolicy(),sdpSemantics:this._sdpSemantics,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this._peerConnection=new RTCPeerConnection(e),this._peerConnection.onconnectionstatechange=this.onConnectionStateChange.bind(this)}close(e){this._log.info("close connection"),this._emitter.emit("closed",e),this._isReconnecting&&this.stopReconnection(),this.closePeerConnection(),this._sei&&(this._sei.destroy(),this._sei=null),Sh.delete(this)}closePeerConnection(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._peerConnection&&(this._log.info("close pc"),this._peerConnection.onconnectionstatechange=null,this._peerConnection.close(),this._peerConnection=null,e&&this.emitConnectionStateChangedEvent("DISCONNECTED")),this._waitForPeerConnectionConnectedPromiseReject&&this._waitForPeerConnectionConnectedPromiseReject(new ke({code:ge.API_CALL_ABORTED,message:"connection closed"}))}getDTLSTransportState(){if(!this._peerConnection)return xr;let e=null;if(this._isUplink){if(!$d()||this._peerConnection.getSenders().length===0)return xr;e=this._peerConnection.getSenders()[0].transport}else{if(!Zd()||this._peerConnection.getReceivers().length===0)return xr;e=this._peerConnection.getReceivers()[0].transport}return e?e.state:xr}onConnectionStateChange(e){let t=this._peerConnection.iceConnectionState,i=this.getDTLSTransportState();if(this._log.info("connectionState: ".concat(e.target.connectionState,", ICE: ").concat(t,", DTLS: ").concat(i)),e.target.connectionState===Lt.CONNECTING&&this.emitConnectionStateChangedEvent("CONNECTING"),e.target.connectionState===Lt.FAILED||e.target.connectionState===Lt.CLOSED){let r="connection ".concat(e.target.connectionState,". ICE Transport state: ").concat(t,", DTLS Transport state: ").concat(i),o=new ke({message:r,code:ge.ICE_TRANSPORT_ERROR});this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection(),this._isErrorObserved||this._emitter.emit("error",o)}(e.target.connectionState===Lt.CONNECTED||e.target.connectionState===Lt.COMPLETED)&&(this.logSelectedCandidate(),Ht.logSuccessEvent({userId:this._room.userId,eventType:er.ICE_CONNECTION_STATE}),this.emitConnectionStateChangedEvent("CONNECTED"))}emitConnectionStateChangedEvent(e){return e!==this._currentState&&(e==="CONNECTED"?(i0=0,n0=!1,WR=!0,Sh.add(this)):Sh.delete(this),pe.emit(oe.PEER_CONNECTION_STATE_CHANGED,{room:this._room,prevState:this._currentState,state:e,remoteUserId:this._isUplink?void 0:this.userId}),this._emitter.emit("connection-state-changed",{prevState:this._currentState,state:e}),this._currentState=e,!0)}getPeerConnection(){return this._peerConnection}getRoom(){return this._room}getUserId(){return this.userId}getTinyId(){return this.tinyId}logSelectedCandidate(){return B(this,null,function*(){if(!this._peerConnection)return;let e=yield this._peerConnection.getStats();for(let[,t]of e)if(rl(t)){let i=e.get(t.localCandidateId),r=e.get(t.remoteCandidateId);i&&(this._log.info("local candidate: ".concat(i.candidateType," ").concat(i.protocol,":").concat(i.ip||i.address,":").concat(i.port," ").concat(i.networkType||""," ").concat(i.candidateType==="relay"?"relayProtocol:".concat(i.relayProtocol):"")),this._localAddress="".concat(i.ip||i.address,":").concat(i.port)),r&&(this._log.info("remote candidate: ".concat(r.candidateType," ").concat(r.protocol,":").concat(r.ip||r.address,":").concat(r.port)),this._remoteAddress="".concat(r.protocol,":").concat(r.ip||r.address));break}})}getCurrentState(){return this._currentState}waitForPeerConnectionConnected(){return this._waitForPeerConnectionConnectedPromise||(this._waitForPeerConnectionConnectedPromise=new Promise((e,t)=>{if(this._currentState==="CONNECTED")return e();this._waitForPeerConnectionConnectedPromiseReject=t;let i=u=>{u.state==="CONNECTED"&&(clearTimeout(c),o(),e())},r=u=>{let{room:f}=u;f===this._room&&(clearTimeout(c),o(),t(new ke({code:ge.API_CALL_ABORTED,message:je({key:Ve.CONNECTION_ABORTED,data:"leave room"})})))},o=()=>{pe.off(oe.LEAVE_SUCCESS,r,this),this._emitter.off("connection-state-changed",i,this)},c=setTimeout(()=>{o();let u=new ke({code:ge.API_CALL_TIMEOUT,message:"connection timeout"});var f;i0+=1,f=this._signalChannel.isConnected,i0>2&&!n0&&Sh.size===0&&f&&(this._log.warn("firewall restriction"),n0=!0,this._emitter.emit("firewall-restriction")),t(u)},B_);pe.on(oe.LEAVE_SUCCESS,r,this),this._emitter.on("connection-state-changed",i,this)}),this._waitForPeerConnectionConnectedPromise=this._waitForPeerConnectionConnectedPromise.finally(()=>{this._waitForPeerConnectionConnectedPromise=null,this._waitForPeerConnectionConnectedPromiseReject=null})),this._waitForPeerConnectionConnectedPromise}getReconnectionCount(){return this._reconnectionCount}startReconnection(){this._isReconnecting=!0,this.reconnect()}clearReconnectionTimer(){this._reconnectionTimer!==-1&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}stopReconnection(){this._log.info("stop reconnection"),this._isReconnecting=!1,this._reconnectionCount=0,this.clearReconnectionTimer(),this._signalChannel.off(Ca,this.reconnect,this)}beforeReconnect(){if(this._reconnectionTimer!==-1)return this._log.warn("reconnect() is reconnecting, ignore"),-1;if(this._reconnectionCount>=aa()){this._log.warn("SDK has tried reconnect for ".concat(this._reconnectionCount," times, but all failed, please check your network")),this.stopReconnection();let e=new ke({code:this._isUplink?ge.UPLINK_RECONNECTION_FAILED:ge.DOWNLINK_RECONNECTION_FAILED,message:je({key:this._isUplink?Ve.UPLINK_RECONNECTION_FAILED:Ve.DOWNLINK_RECONNECTION_FAILED})});return this.emitConnectionStateChangedEvent("DISCONNECTED"),this._emitter.emit("error",e),-1}return this._signalChannel.isConnected?(this._reconnectionCount+=1,this._log.warn("reconnect() trying [".concat(this._reconnectionCount,"]")),1):(this._log.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this._signalChannel.once(Ca,this.reconnect,this),-1)}on(e,t,i){this._emitter.on(e,t,i)}off(e,t,i){this._emitter.off(e,t,i)}getIsReconnecting(){return this._isReconnecting}get isH264(){var e,t;return!((t=(e=this._peerConnection)==null?void 0:e.remoteDescription)==null||!t.sdp.includes("H264"))}},zR=ni(kb()),Kt=function(e){return zR.default.parse(e)},Xr=function(e){return zR.default.write(e)};function r0(e){return Object.keys(e).filter(t=>e[t])}var GR=class extends Ys{constructor(e){super(qe(Oe({},e),{isUplink:!1})),b(this,"_flag",0),b(this,"role","anchor"),b(this,"remoteAudioTrack"),b(this,"remoteVideoTrack"),b(this,"remoteAuxiliaryTrack"),b(this,"ssrc",{audio:0,video:0,auxiliary:0}),b(this,"_isSDPExchanging",!1),this.flag=e.flag,this.remoteAudioTrack=e.remoteAudioTrack||new Kg(this._room,this),this.remoteVideoTrack=e.remoteVideoTrack||new ml(this._room,this),this.remoteAuxiliaryTrack=e.remoteAuxiliaryTrack||new yR(this._room,this)}get subscribeState(){let e={audio:!1,video:!1,auxiliary:!1,smallVideo:!1};return this.remoteVideoTrack.isSubscribed&&(8&this.remoteVideoTrack.mediaType?e.smallVideo=!0:e.video=!0),this.remoteAudioTrack.isSubscribed&&(e.audio=!0),this.remoteAuxiliaryTrack.isSubscribed&&(e.auxiliary=!0),e}get muteState(){return tl(this.flag,this.userId)}get flag(){return this._flag}set flag(e){var t,i,r;e!==this._flag&&(this._flag=e,(t=this.remoteAudioTrack)==null||t.onFlagChanged(),(i=this.remoteVideoTrack)==null||i.onFlagChanged(),(r=this.remoteAuxiliaryTrack)==null||r.onFlagChanged())}get hasMainStream(){return this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall}get hasAuxStream(){return this.muteState.hasAuxiliary}get isMainStreamSubscribed(){return(this.subscribeState.audio||this.subscribeState.video||this.subscribeState.smallVideo)&&(this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall)}get isAuxStreamSubscribed(){return this.subscribeState.auxiliary&&this.muteState.hasAuxiliary}get isSmallStreamSubscribed(){return this.subscribeState.smallVideo&&this.muteState.hasSmall}get isBigStreamSubscribed(){return this.subscribeState.video&&this.muteState.hasVideo}isStreamUnpublished(e){return e===N.MAIN?!this.muteState.hasAudio&&!this.muteState.hasVideo:!this.muteState.hasAuxiliary}initialize(){super.initialize(),this.installEvents(),this._peerConnection.ontrack=this.onTrack.bind(this)}close(e){super.close(e),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.remoteAudioTrack.close(),this.remoteVideoTrack.close(),this.remoteAuxiliaryTrack.close(),this.uninstallEvents()}installEvents(){}uninstallEvents(){this._emitter.removeAllListeners()}emitConnectionStateChangedEvent(e){var t,i;let r=this._currentState,o=super.emitConnectionStateChangedEvent(e);return o&&r!==e&&((t=this.remoteVideoTrack)==null||t.emit("connection-state-changed",{prevState:r,state:e}),(i=this.remoteAuxiliaryTrack)==null||i.emit("connection-state-changed",{prevState:r,state:e})),o}onTrack(e){let t=e.streams[0],{track:i}=e,r=t.id===wd?N.MAIN:N.AUXILIARY;this._log.debug("ontrack ".concat(r," ").concat(i.kind));let o=N.AUDIO;i.kind===N.VIDEO&&(o=r===N.MAIN?N.VIDEO:N.AUXILIARY);let c=this.remoteAudioTrack;o===N.VIDEO?c=this.remoteVideoTrack:o===N.AUXILIARY&&(c=this.remoteAuxiliaryTrack),c.setInputMediaStreamTrack(i)}addRRTRLine(e){let t=e.split(`\r
`),i=new Map;t.forEach((o,c)=>{/^a=rtcp-fb:/.test(o)&&t[c+1]&&!/^a=rtcp-fb:/.test(t[c+1])&&i.set(c+1,"".concat(o.match(/^a=rtcp-fb:\d+/)[0]," rrtr"))});let r=[...i];for(let o=0;o<r.length;o++){let[c,u]=r[o];t.splice(c+o,0,u)}return t.join(`\r
`)}addSPSDescription(e){let t=Kt(e);return t.media.forEach(i=>{i.type===N.VIDEO&&i.fmtp.forEach(r=>{r.config+=";sps-pps-idr-in-keyframe=1"})}),Xr(t)}removeSDESDescription(e){let t=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"],i=Kt(e);return i.media.forEach(r=>{!r.ext||(r.ext=r.ext.filter(o=>!t.includes(o.uri)))}),Xr(i)}isSubscriptionStateNotChanged(e){return JSON.stringify(e)===JSON.stringify(this.subscribeState)}subscribe(e,t){return B(this,null,function*(){var i,r;try{if((((i=this._peerConnection)==null?void 0:i.connectionState)===Lt.NEW||((r=this._peerConnection)==null?void 0:r.connectionState)===Lt.CONNECTING)&&(yield this.waitForPeerConnectionConnected()),this.isSubscriptionStateNotChanged(e))return void(this._peerConnection||(this.initialize(),yield this.connect(e)));if(this._log.info("subscribe ".concat(t," ").concat(JSON.stringify(e))),this._peerConnection||this._isSDPExchanging){let o="subscribe_change";Object.values(e).find(c=>c===!0)||(o="unsubscribe"),yield this.sendSubscription(o,e)}else this.initialize(),yield this.connect(e)}catch(o){throw this._room.isJoined&&this.isStreamUnpublished(t)?(this._log.warn("".concat(o.message," ").concat(JSON.stringify(this.muteState))),new ke({code:ge.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId," unpublished stream")})):o}})}unsubscribe(e){return B(this,arguments,function(t){var i=this;let{remoteTracks:r,streamType:o}=t;return function*(){if(i._currentState==="CONNECTED"&&(o==="main"&&!i.isMainStreamSubscribed||o==="auxiliary"&&!i.isAuxStreamSubscribed))return void i._log.info("".concat(o," stream already unsubscribed"));let c=Oe({},i.subscribeState);r.forEach(f=>{switch(f.mediaType){case 1:c.audio=!1;break;case 4:c.video=!1;break;case 8:c.smallVideo=!1;break;case 2:c.auxiliary=!1}});let u="subscribe_change";Object.values(c).find(f=>f===!0)||(u="unsubscribe"),i._log.info("".concat(u==="unsubscribe"?u:"subscribe"," ").concat(o," [").concat(r0(c),"]")),yield i.sendSubscription(u,c),u==="unsubscribe"&&(i.closePeerConnection(),i.emitConnectionStateChangedEvent("DISCONNECTED"))}()})}sendSubscription(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscribeState,i={srcTinyId:this.tinyId,srcUserId:this.userId},r=FR,o=Je.UNSUBSCRIBE_RESULT;return e==="subscribe_change"&&(i={audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,srcTinyId:this.tinyId},r=BR,o=Je.SUBSCRIBE_CHANGE_RESULT),this._signalChannel.sendWaitForResponse({command:r,data:i,responseCommand:o,timeout:1e4}).then(c=>{let{data:u}=c;if(u.code!==0){let f=new ke({code:u.code,message:je({key:Ve.ERROR_MESSAGE,data:{type:e,message:u.message}})});throw this._log.error(f),f}})}connect(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.subscribeState;return function*(){try{yield e.exchangeSDP(t),yield e.waitForPeerConnectionConnected()}catch(i){throw e.closePeerConnection(!0),i}}()})}exchangeSDP(e){return B(this,null,function*(){try{this._isSDPExchanging=!0,yield this.createOffer(),this._log.info("createOffer success, sending offer");let{type:t,sdp:i}=this._peerConnection.localDescription,r={type:t,sdp:i,srcUserId:this.userId,srcTinyId:this.tinyId,audio:e.audio,bigVideo:e.video,auxVideo:e.auxiliary,smallVideo:e.smallVideo},o=yield this._signalChannel.sendWaitForResponse({command:J7,commandDesc:"exchange sdp",data:r,responseCommand:Je.SUBSCRIBE_RESULT,timeout:Yb});if(!this._peerConnection){let c=new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.CONNECTION_CLOSED})});throw this._log.warn(c),c}yield this.onSubscribeResult(o),this._isSDPExchanging=!1}catch(t){throw this._isSDPExchanging=!1,t}})}createOffer(){return B(this,null,function*(){let e={voiceActivityDetection:!1};sr()&&this._sdpSemantics===Mc?(this._peerConnection.addTransceiver(N.AUDIO,{direction:Xe.RECVONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:Xe.RECVONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:Xe.RECVONLY})):(e.offerToReceiveAudio=!0,e.offerToReceiveVideo=!0);let t=yield this._peerConnection.createOffer(e);if(t.sdp){let{isH264DecodeSupported:i}=yield Ig();i||(this._log.warn("remove h264 desc from sdp"),t.sdp=function(r){let o=Kt(r);return o.media.forEach(c=>{var u,f;if(c.type===N.VIDEO){let d=new Set;c.rtp.forEach(E=>{let{payload:S,codec:R}=E;return R==="H264"&&d.add(S)}),c.fmtp.forEach(E=>{let{payload:S,config:R}=E,k=R.match(/apt=(\d+)/);k&&k[1]&&d.has(Number(k[1]))&&d.add(S)});let _=E=>{let{payload:S}=E;return!d.has(S)};c.rtp=c.rtp.filter(_),c.rtcpFb=(u=c.rtcpFb)==null?void 0:u.filter(_),c.fmtp=c.fmtp.filter(_),c.payloads=(f=c.payloads)==null?void 0:f.split(" ").filter(E=>!d.has(Number(E))).join(" ")}}),Xr(o)}(t.sdp)),t.sdp=this.addRRTRLine(t.sdp),t.sdp=this.addSPSDescription(t.sdp),t.sdp=function(r){let o=Kt(r);return o.media.forEach(c=>{c.type===N.AUDIO&&c.fmtp.forEach(u=>{u.config+=";sprop-stereo=1;stereo=1"})}),Xr(o)}(t.sdp),this._sdpSemantics===Mc&&(t.sdp=this.removeSDESDescription(t.sdp))}yield this._peerConnection.setLocalDescription(t)})}onSubscribeResult(e){return B(this,null,function*(){let{code:t,message:i=""}=e&&e.data||{},{type:r,sdp:o}=e&&e.data&&e.data.data||{};if(t===Nd)throw new ke({code:ge.NOT_SUPPORTED_H264,message:je({key:Ve.NOT_SUPPORTED_H264DECODE})});try{if(t!==0)throw new ke({code:t,message:je({key:Ve.EXCHANGE_SDP_FAILED,data:{errMsg:i}})});this._log.debug("accept remote answer: ".concat(o)),yield this._peerConnection.setRemoteDescription({type:r,sdp:o}),this._sei&&(this._sei.handleEncodedStreams(),this._sei.onSEIMessage=c=>{this._emitter.emit("sei-message",qe(Oe({},c),{userId:this.userId}))}),this.updateSSRC(o)}catch(c){throw this._log.error(c),c}})}updateSSRC(e){try{Kt(e).media.forEach(t=>{if(t.ssrcs)if(t.type===N.AUDIO){let i=t.ssrcs.find(r=>{var o;return(o=r.value)==null?void 0:o.includes(wd)});i&&(this.ssrc.audio=Number(i.id))}else{let i=t.ssrcs.find(o=>{var c;return(c=o.value)==null?void 0:c.includes(wd)}),r=t.ssrcs.find(o=>{var c;return(c=o.value)==null?void 0:c.includes(jb)});i&&(this.ssrc.video=Number(i.id)),r&&(this.ssrc.auxiliary=Number(r.id))}})}catch{}}getMainStreamVideoTrackId(){return this.remoteVideoTrack&&this.remoteVideoTrack.mediaTrack?this.remoteVideoTrack.mediaTrack.id:""}getAuxStreamVideoTrackId(){return this.remoteAuxiliaryTrack&&this.remoteAuxiliaryTrack.mediaTrack?this.remoteAuxiliaryTrack.mediaTrack.id:""}reconnect(){return B(this,null,function*(){if(!(rn(GR.prototype,this,"beforeReconnect").call(this)<0))try{this.closePeerConnection(),this.initialize(),yield this.connect(),this.stopReconnection(),this._log.warn("reconnect() success")}catch{let t=fa(this._reconnectionCount);this._log.warn("reconnect() timeout, try again after ".concat(t/1e3,"s")),this._reconnectionTimer=setTimeout(()=>{this.clearReconnectionTimer(),this.reconnect()},t)}})}getIsReconnecting(){return this._isReconnecting}clearReconnectionTimer(){this._reconnectionTimer!==-1&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}getCurrentState(){return this._currentState}setDelay(e){let{audioDelay:t,videoDelay:i}=e;this.remoteAudioTrack.stat.end2EndDelay=t,this.remoteVideoTrack.stat.end2EndDelay=i}},s0=GR;Ie([St(e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return new Promise((o,c)=>{let u=f=>{this._emitter.off("closed",u),c(new ke({code:ge.API_CALL_ABORTED,message:je({key:Ve.CONNECTION_ABORTED,data:f})}))};this._emitter.on("closed",u),e.apply(this,i).then(o,c).finally(()=>{this._emitter.off("closed",u)})})})],s0.prototype,"subscribe"),Ie([pR(Ys.prototype.afterConnect),hR(Ys.prototype.beforeConnect)],s0.prototype,"connect");var KR=s0,JR={voiceActivityDetection:!1},YR=class extends Ys{constructor(e){super(qe(Oe({},e),{isUplink:!0})),b(this,"localMainAudioTrack",null),b(this,"localMainVideoTrack",null),b(this,"localAuxAudioTrack",null),b(this,"localAuxVideoTrack",null),b(this,"ssrc",{audio:0,video:0,small:0,auxiliary:0}),b(this,"_isPublishingAux",!1),b(this,"_publishingLocalAudioTrack"),b(this,"_publishingLocalVideoTrack"),b(this,"_mediaSettings",{videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0}),b(this,"flag",0)}get isMainStreamPublished(){return!(!this.localMainAudioTrack&&!this.localMainVideoTrack)}get isAuxStreamPublished(){return!(!this.localAuxVideoTrack&&!this.localAuxAudioTrack)}get publishState(){var e,t,i,r;let o={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this._peerConnection){let c=this._peerConnection.getSenders();c&&(Wr()?(o.audio=!((e=c[0])==null||!e.track),o.bigVideo=!((t=c[1])==null||!t.track),o.smallVideo=!((i=c[2])==null||!i.track),o.auxVideo=!((r=c[3])==null||!r.track)):c.forEach(u=>{u.track&&(u.track.kind===N.AUDIO?o.audio=!0:(o.bigVideo=!0,this._room.videoManager.hasSmall&&(o.smallVideo=!0)))}))}return o}initialize(){super.initialize(),this.installEvents()}reset(){this._isReconnecting&&this.stopReconnection(),this.closePeerConnection(),this.uninstallEvents()}close(e){super.close(e),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED")}installEvents(){this._emitter.listeners("connection-state-changed").includes(this.handleConnectionStateChange)||this._emitter.on("connection-state-changed",this.handleConnectionStateChange,this)}uninstallEvents(){this._emitter.off("connection-state-changed",this.handleConnectionStateChange,this)}emitConnectionStateChangedEvent(e,t){var i,r,o;let c=this._currentState,u=super.emitConnectionStateChangedEvent(e);return u&&c!==e&&(t?t.emit("connection-state-changed",{prevState:c,state:e}):((i=this.localMainVideoTrack)==null||i.emit("connection-state-changed",{prevState:c,state:e}),(r=this.localAuxVideoTrack)==null||r.emit("connection-state-changed",{prevState:c,state:e}),(o=this._publishingLocalVideoTrack)==null||o.emit("connection-state-changed",{prevState:c,state:e}))),u}publish(e){return B(this,arguments,function(t){var i=this;let{localAudioTrack:r,localVideoTrack:o,isAuxiliary:c}=t;return function*(){var u;let f;i._peerConnection||i.initialize(),r&&(i._publishingLocalAudioTrack=r),o&&(i._publishingLocalVideoTrack=o),i._isPublishingAux=c,o&&!c&&o.small&&(f=i._room.videoManager.smallTrack),i.sendMediaSettings(),sr()?yield i.publishByTransceiver({localAudioTrack:r,localVideoTrack:o,smallTrack:f,isAuxiliary:c}):yield i.publishByAddTrack({localAudioTrack:r,localVideoTrack:o,smallTrack:f}),i._publishingLocalAudioTrack=null,i._publishingLocalVideoTrack=null,i._isPublishingAux=!1,c?(o&&(i.localAuxVideoTrack=o),r&&(i.localAuxAudioTrack=r)):(o&&(i.localMainVideoTrack=o),r&&(i.localMainAudioTrack=r)),(u=i._sei)==null||u.handleEncodedStreams(),i.installTrackMuteEvents(r,o),i.sendMutedFlag()}()})}publishByTransceiver(e){return B(this,arguments,function(t){var i=this;let{localAudioTrack:r,localVideoTrack:o,smallTrack:c,isAuxiliary:u}=t;return function*(){i._log.info("publish by transceiver");let f=new MediaStream,d=o==null?void 0:o.outMediaTrack,_=r==null?void 0:r.outMediaTrack;_&&f.addTrack(_),d&&f.addTrack(d);let E=i._peerConnection.getTransceivers();if(E.length===0)i._peerConnection.addTransceiver(_||N.AUDIO,{direction:Xe.SENDONLY,streams:[f]}),i._peerConnection.addTransceiver(u?N.VIDEO:d||N.VIDEO,{direction:Xe.SENDONLY,streams:[f]}),i._peerConnection.addTransceiver(c||N.VIDEO,{direction:Xe.SENDONLY,streams:[f]}),i._peerConnection.addTransceiver(u&&d||N.VIDEO,{direction:Xe.SENDONLY,streams:[f]}),yield i.connect();else{let S=[];if(_&&(E[0].sender.track||S.push(0),yield E[0].sender.replaceTrack(_),yield i.setBandwidth({bandwidth:(r==null?void 0:r.profile.bitrate)||40,type:N.AUDIO})),d){let R=u?3:1;yield E[R].sender.replaceTrack(d),yield i.setBandwidth({bandwidth:o.profile.bitrate,type:N.VIDEO,videoType:u?N.AUXILIARY:N.BIG}),S.push(R),c&&(yield E[2].sender.replaceTrack(c),yield i.setBandwidth({bandwidth:o.small.bitrate,type:N.VIDEO,videoType:N.SMALL}),S.push(2))}yield i.setTransceiverDirection(Xe.SENDONLY,S),yield i.doPublishChange(),o==null||o.emit("connection-state-changed",{prevState:"DISCONNECTED",state:"CONNECTING"}),o==null||o.emit("connection-state-changed",{prevState:"CONNECTING",state:"CONNECTED"})}}()})}publishByAddTrack(e){return B(this,arguments,function(t){var i=this;let{localAudioTrack:r,localVideoTrack:o,smallTrack:c}=t;return function*(){i._log.info("publish by addtrack");let u=o==null?void 0:o.outMediaTrack,f=r==null?void 0:r.outMediaTrack;if(i._peerConnection&&i._peerConnection.connectionState!=="new")return r&&f&&(yield i.addTrack(r)),void(u&&(yield i.addTrack(o)));let d=new MediaStream;if(f&&d.addTrack(f),u&&d.addTrack(u),f&&i._peerConnection.addTrack(f,d),u&&(i._peerConnection.addTrack(u,d),c)){let _=new MediaStream;_.addTrack(c),i._peerConnection.addTrack(c,_)}yield i.connect()}()})}enableSmall(e){return B(this,null,function*(){let t=this._peerConnection.getTransceivers();e?this._room.videoManager.smallTrack&&(yield t[2].sender.replaceTrack(this._room.videoManager.smallTrack),yield this.setTransceiverDirection(Xe.SENDONLY,[2])):(yield t[2].sender.replaceTrack(null),yield this.setTransceiverDirection(Xe.INACTIVE,[2])),this.updateMediaSettings(),yield this.doPublishChange()})}installTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(r=>{r&&(r==null||r.on("mute",this.sendMutedFlag,this),r==null||r.on("unmute",this.sendMutedFlag,this))})}uninstallTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(r=>{r&&(r==null||r.off("mute",this.sendMutedFlag,this),r==null||r.off("unmute",this.sendMutedFlag,this))})}unpublish(e){return B(this,arguments,function(t){var i=this;let{localAudioTrack:r,localVideoTrack:o}=t;return function*(){if(!Wr())return r&&r.outMediaTrack&&!o&&i.localMainVideoTrack?(yield i.removeTrack(r),void(i.localMainAudioTrack=null)):o&&o.outMediaTrack&&!r&&i.localMainAudioTrack?(yield i.removeTrack(o),void(i.localMainVideoTrack=null)):(yield i.doUnpublish(),i.uninstallTrackMuteEvents(r,o),void i.emitConnectionStateChangedEvent("DISCONNECTED",o));let c=o&&o===i.localAuxVideoTrack,u=o==null?void 0:o.outMediaTrack,f=i._peerConnection.getSenders(),d=[];r&&(yield f[0].replaceTrack(null),d.push(0),c?i.localAuxAudioTrack=null:i.localMainAudioTrack=null),u&&(c?(yield f[3].replaceTrack(null),i.localAuxVideoTrack=null,i._mediaSettings=qe(Oe({},i._mediaSettings),{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),d.push(3)):(yield f[1].replaceTrack(null),yield f[2].replaceTrack(null),i.localMainVideoTrack=null,i._mediaSettings=qe(Oe({},i._mediaSettings),{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),d.push(1,2))),i.isMainStreamPublished||i.isAuxStreamPublished?(yield i.setTransceiverDirection(Xe.INACTIVE,d),yield i.doPublishChange(!1)):yield i.doUnpublish(),i.uninstallTrackMuteEvents(r,o),o==null||o.emit("connection-state-changed",{prevState:i._currentState,state:"DISCONNECTED"})}()})}doPublishChange(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return B(this,null,function*(){let t={state:this.publishState,constraintConfig:this._mediaSettings},i=yield this._signalChannel.sendWaitForResponse({command:UR,data:t,responseCommand:Je.PUBLISH_STATE_CHANGE_RESULT,enableLog:e});this.checkPublishResultCode(i.data.code,i.data.message)})}doUnpublish(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return this._signalChannel.sendWaitForResponse({command:t0,commandDesc:"unpublish",responseCommand:Je.UNPUBLISH_RESULT,enableLog:e}).catch(t=>{if(t.getCode()===ge.API_CALL_TIMEOUT)return Promise.resolve();throw t})}updateMediaSettings(){let{detail:{isH264EncodeSupported:e,isVp8EncodeSupported:t}}=this._room.checkSystemResult;e?this._mediaSettings.videoCodec="H264":t&&(this._mediaSettings.videoCodec="VP8");let i=this._publishingLocalAudioTrack||this.localMainAudioTrack||this.localAuxAudioTrack,{localMainVideoTrack:r,localAuxVideoTrack:o}=this;if(this._publishingLocalVideoTrack&&(this._isPublishingAux?o=this._publishingLocalVideoTrack:r=this._publishingLocalVideoTrack),ga){if(i&&i.outMediaTrack){let c=i.outMediaTrack.getSettings();this._mediaSettings.audioChannel=c.channelCount||1,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=c.sampleRate||0}if(r&&r.outMediaTrack){let c=r.outMediaTrack.getSettings();this._mediaSettings.videoWidth=c.width||0,this._mediaSettings.videoHeight=c.height||0,this._mediaSettings.videoFps=c.frameRate||0,this._mediaSettings.videoBps=1e3*r.profile.bitrate,r.small&&(this._mediaSettings.smallVideoWidth=r.small.width,this._mediaSettings.smallVideoHeight=r.small.height,this._mediaSettings.smallVideoFps=r.small.frameRate,this._mediaSettings.smallVideoBps=1e3*r.small.bitrate)}if(o&&o.outMediaTrack){let c=o.outMediaTrack.getSettings();this._mediaSettings.auxVideoWidth=c.width||0,this._mediaSettings.auxVideoHeight=c.height||0,this._mediaSettings.auxVideoFps=c.frameRate||0,this._mediaSettings.auxVideoBps=1e3*o.profile.bitrate}}else i&&i.outMediaTrack&&(this._mediaSettings.audioChannel=i.profile.channelCount,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=i.profile.sampleRate),r&&r.outMediaTrack&&(this._mediaSettings.videoWidth=r.profile.width,this._mediaSettings.videoHeight=r.profile.height,this._mediaSettings.videoFps=r.profile.frameRate,this._mediaSettings.videoBps=1e3*r.profile.bitrate);this._log.info("updateMediaSettings: ".concat(JSON.stringify(this._mediaSettings)))}sendMediaSettings(){this.updateMediaSettings(),this._signalChannel.sendWaitForResponse({command:HR,data:this._mediaSettings,responseCommand:Je.UPDATE_CONSTRAINT_CONFIG_RES}).then(e=>{e.data.code!==0&&this._log.warn(e.data.message)}).catch(()=>{})}addTrack(e){return B(this,null,function*(){var t;if(!this._peerConnection)return;let i=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is adding ".concat(e.kind," track to current published local ").concat(i?N.AUXILIARY:N.MAIN," stream")),(t=this._sei)==null||t.handleEncodedStreams(),sr()?yield this.addTrackByTransceiver(e,i):yield this.addTrackBySender(e)})}addTrackByTransceiver(e,t){return B(this,null,function*(){var i;if(!e.mediaTrack)return;let r=this._peerConnection.getTransceivers();if(e.kind===N.AUDIO)yield r[0].sender.replaceTrack(e.outMediaTrack);else{let o=t?3:1;yield r[o].sender.replaceTrack(e.outMediaTrack),o===1&&((i=this.localMainVideoTrack)!=null&&i.small)&&(yield r[2].sender.replaceTrack(this._room.videoManager.smallTrack)),r[o].direction===Xe.INACTIVE&&(yield this.setTransceiverDirection(Xe.SENDONLY,[o]))}this.updateMediaSettings(),yield this.doPublishChange()})}addTrackBySender(e){return B(this,null,function*(){if(!e.outMediaTrack)return;let t=e.outMediaTrack;Wr()&&this._peerConnection.getTransceivers().findIndex(r=>r.direction==="stopped")>=0&&(this._log.warn("transceiver is stopping, negotiate sdp first"),yield this.updateOffer("remove",t));let i=this._peerConnection.getSenders().find(r=>r.track&&r.track.kind===t.kind);if(i&&i.track){this._log.warn("sender already exists, remove sender first");let r=i.track;this.removeSender(i),yield this.updateOffer("remove",r)}if(t&&this._peerConnection.addTrack(t,new MediaStream([t])),t.kind===N.VIDEO&&e instanceof Mi&&e.small){let r=new MediaStream,{smallTrack:o}=this._room.videoManager;r.addTrack(o),this._peerConnection.addTrack(o,r)}yield this.updateOffer("add",t)})}isNeedToResetOfferOrder(){if(this._sdpSemantics===kd||!this._peerConnection||!this._peerConnection.localDescription)return!1;let{sdp:e}=this._peerConnection.localDescription,t=Kt(e);for(let i=0;i<t.media.length;i++)if(Number(t.media[i].mid)===0&&t.media[i].type===N.VIDEO)return!0;return!1}removeSender(e){let t=null;Wr()&&(t=this._peerConnection.getTransceivers().find(i=>i.sender&&i.sender.track===e.track)),this._peerConnection.removeTrack(e),t&&Tt(t.stop)&&(this._log.info("stop transceiver"),t.stop())}removeTrack(e){return B(this,null,function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is removing ".concat(e.kind," track from current published local ").concat(t?N.AUXILIARY:N.MAIN," stream")),sr()?yield this.removeTrackByTransceiver(e,t):yield this.removeTrackBySender(e)})}removeTrackByTransceiver(e,t){return B(this,null,function*(){if(!e.outMediaTrack)return;let i=this._peerConnection.getTransceivers();if(e.kind===N.AUDIO)yield i[0].sender.replaceTrack(null);else{let r=t?3:1;yield i[r].sender.replaceTrack(null),r===1&&e.small&&(yield i[2].sender.replaceTrack(null)),yield this.setTransceiverDirection(Xe.INACTIVE,[r])}this.updateMediaSettings(),yield this.doPublishChange()})}setTransceiverDirection(e,t){return B(this,null,function*(){if(!Ct)return;let i=!1,r=!1;this._log.info("setting transceiver ".concat(t.join(",")," direction to ").concat(e));let o=this._peerConnection.getTransceivers();if(t.forEach(f=>{o[f].direction!==e&&(o[f].direction=e,i=!0)}),i){this._log.info("updating offer");let f=yield this._peerConnection.createOffer();yield this._peerConnection.setLocalDescription(f)}let c=-1,u=this._peerConnection.remoteDescription.sdp.split(`\r
`).map(f=>{if(f.match(new RegExp("a=(".concat(Xe.INACTIVE,"|").concat(Xe.RECVONLY,"|").concat(Xe.SENDONLY,")")))&&c++,t.includes(c)){if(e===Xe.INACTIVE&&f.includes("a=".concat(Xe.RECVONLY)))return r=!0,"a=".concat(e);if(e===Xe.SENDONLY&&f.includes("a=".concat(Xe.INACTIVE)))return r=!0,"a=".concat(Xe.RECVONLY)}return f}).join(`\r
`);r&&(this._log.info("updating answer"),yield this._peerConnection.setRemoteDescription({type:"answer",sdp:u}))})}removeTrackBySender(e){return B(this,null,function*(){if(!e.outMediaTrack)return;if(e.kind===N.VIDEO&&this.isNeedToResetOfferOrder()&&this.localMainAudioTrack)return this.reset(),this.initialize(),void(yield this.publish({localAudioTrack:this.localMainAudioTrack,isAuxiliary:!1}));let t=this._peerConnection.getSenders().find(i=>i.track===e.outMediaTrack);t&&(this.removeSender(t),e.kind===N.VIDEO&&e.small&&this._peerConnection.getSenders().forEach(i=>{i.track&&i.track.kind===N.VIDEO&&this.removeSender(i)})),yield this.updateOffer("remove",e.outMediaTrack)})}replaceTrack(e){return B(this,null,function*(){var t;let i,r=(t=this._peerConnection)==null?void 0:t.getSenders();if(!r||r.length===0||!e.mediaTrack||(i=sr()?e.kind===N.AUDIO?r[0]:r[1]:r.find(c=>c.track&&c.track.kind===e.kind),!i))return;let o=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is replacing ".concat(e.kind," track on ").concat(o?N.AUXILIARY:N.MAIN," stream")),e.kind===N.AUDIO?yield i.replaceTrack(e.outMediaTrack):e.kind===N.VIDEO&&(o?r[3]&&(yield r[3].replaceTrack(e.outMediaTrack)):yield i.replaceTrack(e.outMediaTrack))})}updateOffer(e,t){return B(this,null,function*(){try{let i=yield this._peerConnection.createOffer(JR);Ct&&i.sdp&&(i.sdp=this.setSDPDirection(i.sdp,"sendrecv")),yield this._peerConnection.setLocalDescription(i);let r=this.updateMediaSettings(),o={action:e,trackId:t.id,kind:t.kind===N.VIDEO?"bigVideo":t.kind,type:"offer",sdp:this._peerConnection.localDescription.sdp,constraintConfig:r,state:this.publishState};this._log.info("createOffer success, sending updated offer to remote server"),this._log.debug("updatedOffer: ".concat(o.sdp));let c=yield this._signalChannel.sendWaitForResponse({command:j7,data:o,responseCommand:Je.UPDATE_OFFER_RESULT,timeout:Jb,commandDesc:"update offer"}),{code:u,message:f}=c.data;u!==0&&this.checkPublishResultCode(u,f),yield this.acceptAnswer(c.data.data),i.sdp&&this.updateSSRC(i.sdp)}catch(i){throw this._log.error(i),i}})}setBandwidth(e){return B(this,arguments,function(t){var i=this;let{bandwidth:r,type:o,videoType:c,sdp:u}=t;return function*(){if(!Ag())return u?o===N.VIDEO?i.updateVideoBandwidthRestriction(u,r,c):i.updateAudioBandwidthRestriction(u,r):void 0;let f,d=i._peerConnection.getSenders();if(sr()){let _=0;o===N.VIDEO&&(_=c===N.SMALL?2:c===N.AUXILIARY?3:1),f=d[_]}else f=d.find(_=>_.track&&_.track.kind===o);if(f){let _=f.getParameters();(!_.encodings||_.encodings.length===0)&&(_.encodings=[{}]),_.encodings[0].maxBitrate=1e3*r;try{return yield f.setParameters(_),i._log.info("".concat(c||"").concat(o," bandwidth ").concat(r," kbps")),u}catch(E){if(i._log.info("failed to set bandwidth by setting maxBitrate: ".concat(E)),u)return o===N.VIDEO?i.updateVideoBandwidthRestriction(u,r,c):i.updateAudioBandwidthRestriction(u,r)}}return u}()})}updateVideoBandwidthRestriction(e,t,i){let r="AS";Ct&&(r="TIAS",t*=1e3);let o=0,c=-1;return i===N.SMALL?o=1:i===N.AUXILIARY&&(o=2),e=e.replace(/m=video (.*)\r\nc=IN (.*)\r\n/g,u=>(c+=1,c===o?"".concat(u,"b=").concat(r,":").concat(t,`\r
`):u))}updateAudioBandwidthRestriction(e,t){let i="AS";return Ct&&(i="TIAS",t*=1e3),e=e.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,`m=audio $1\r
c=IN $2\r
b=`.concat(i,":").concat(t,`\r
`))}removeBandwidthRestriction(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}removeVideoOrientation(e){return e.replace(/urn:3gpp:video-orientation/,"")}connect(){return B(this,null,function*(){try{yield this.exchangeSDP(),yield this.waitForPeerConnectionConnected()}catch(e){throw this.closePeerConnection(!0),this.uninstallEvents(),e}})}exchangeSDP(){return B(this,null,function*(){try{yield this.createOffer(),this._log.info("createOffer success, sending offer to remote server"),yield this.doExchangeSDP()}catch(e){throw e}})}createOffer(){return B(this,null,function*(){try{let e=yield this._peerConnection.createOffer(JR);yield this._peerConnection.setLocalDescription(e),e.sdp&&this.updateSSRC(e.sdp)}catch(e){throw e}})}doExchangeSDP(){let e={command:K7,responseCommand:Je.PUBLISH_RESULT,data:{type:this._peerConnection.localDescription.type,sdp:this.removeVideoOrientation(this._peerConnection.localDescription.sdp),screen:this.localMainVideoTrack instanceof zs||this.localAuxVideoTrack instanceof zs,state:this.publishState,constraintConfig:this._mediaSettings},enableLog:!1};return this._log.debug("sending sdp offer: ".concat(e.data.sdp)),this._signalChannel.sendWaitForResponse(e).then(t=>{let{code:i,message:r,data:o}=t.data;return i===0?this.acceptAnswer(o):this.checkPublishResultCode(i,r)})}setSDPDirection(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"all",r=Kt(e);return r.media.forEach(o=>{(i==="all"||o.type===i)&&(o.direction=t)}),Xr(r)}acceptAnswer(e){return B(this,null,function*(){var t,i,r,o,c;try{let u;if(this._publishingLocalAudioTrack||this._publishingLocalVideoTrack||this.isMainStreamPublished){let d=((t=this._publishingLocalVideoTrack)==null?void 0:t.profile.bitrate)||((i=this.localMainVideoTrack)==null?void 0:i.profile.bitrate),_=((r=this._publishingLocalAudioTrack)==null?void 0:r.profile.bitrate)||((o=this.localMainAudioTrack)==null?void 0:o.profile.bitrate);if(d){let E=this._isPublishingAux?N.AUXILIARY:N.BIG;u=yield this.setBandwidth({bandwidth:d,type:N.VIDEO,sdp:u,videoType:E})}_&&(u=yield this.setBandwidth({bandwidth:_,type:N.AUDIO,sdp:u}))}if(u=this.removeVideoOrientation(e.sdp),(c=this._publishingLocalVideoTrack)!=null&&c.small){let{smallStreamConfig:d}=this._room;u=yield this.setBandwidth({bandwidth:this._publishingLocalVideoTrack.small.bitrate||d.bitrate,type:N.VIDEO,videoType:N.SMALL,sdp:u})}let f={type:e.type,sdp:u};yield this._peerConnection.setRemoteDescription(f),this._log.debug("accepted answer: ".concat(u))}catch(u){throw this._log.error("failed to accept remote answer ".concat(u)),u}})}sendMutedFlag(e){var t,i,r;if(e===this.localAuxAudioTrack||e===this.localAuxVideoTrack)return;let o={audio:!((t=this.localMainAudioTrack)==null||!t.muted),bigVideo:!((i=this.localMainVideoTrack)==null||!i.muted),auxVideo:!((r=this.localAuxVideoTrack)==null||!r.muted)};this._log.info("send muted state: ".concat(JSON.stringify(o))),this._signalChannel.send(VR,o)}getIsReconnecting(){return this._isReconnecting}reconnect(){return B(this,null,function*(){if(!(rn(YR.prototype,this,"beforeReconnect").call(this)<0))try{yield this._signalChannel.sendWaitForResponse({command:t0,responseCommand:Je.UNPUBLISH_RESULT,enableLog:!1}),this.closePeerConnection(),this.initialize(),this.isMainStreamPublished&&(yield this.publish({localAudioTrack:this.localMainAudioTrack,localVideoTrack:this.localMainVideoTrack,isAuxiliary:!1})),this.isAuxStreamPublished&&(yield this.publish({localAudioTrack:this.localAuxAudioTrack,localVideoTrack:this.localAuxVideoTrack,isAuxiliary:!0})),this._log.warn("reconnect() uplink reconnect successfully"),this.stopReconnection()}catch{let t=fa(this._reconnectionCount);this._log.warn("reconnect() timeout, try again after ".concat(t/1e3,"s")),this._reconnectionTimer=setTimeout(()=>{this.clearReconnectionTimer(),this.reconnect()},t)}})}handleConnectionStateChange(e){e.state==="CONNECTED"&&(this.localMainVideoTrack||this._publishingLocalVideoTrack&&!this._isPublishingAux)&&pe.emit(oe.SEND_FIRST_VIDEO_FRAME,{room:this._room})}updateSSRC(e){try{Kt(e).media.forEach((t,i)=>{if(t.type===N.AUDIO){let r=t.ssrcs&&t.ssrcs[0];r&&(this.ssrc.audio=Number(r.id))}else{if(this._sdpSemantics===kd&&t.ssrcGroups)return void t.ssrcGroups.forEach((o,c)=>{let u=Number(o.ssrcs.split(" ")[0]);c===0?this.ssrc.video=u:c===1&&(this.ssrc.small=u)});let r=t.ssrcs&&t.ssrcs[0];if(!r)return;switch(i){case 1:this.ssrc.video=Number(r.id);break;case 2:this.ssrc.small=Number(r.id);break;case 3:this.ssrc.auxiliary=Number(r.id)}}})}catch{}}getVideoTrackId(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N.VIDEO;if(this._peerConnection){let t=this._peerConnection.getSenders();if(e===N.AUXILIARY&&t[3]&&t[3].track)return t[3].track.id;if(e===N.VIDEO&&t[1]&&t[1].track)return t[1].track.id}if(this.localMainVideoTrack&&e===N.VIDEO){let t=this.localMainVideoTrack.mediaTrack;if(t)return t.id}if(this.localAuxVideoTrack&&e===N.AUXILIARY){let t=this.localAuxVideoTrack.mediaTrack;if(t)return t.id}return""}getSSRC(){return this.ssrc}checkPublishResultCode(e,t){if(e!==0)throw e===Nd?(this._log.error(sn.NOT_SUPPORTED_H264ENCODE),new ke({code:ge.NOT_SUPPORTED_H264,message:je({key:Ve.NOT_SUPPORTED_H264ENCODE})})):new ke({code:ge.UNKNOWN,message:je({key:Ve.SIGNAL_RESPONSE_FAILED,data:{signalResponse:Je.PUBLISH_RESULT,code:e,message:t}})})}sendSEI(e,t){var i;(i=this._sei)==null||i.push(e,t)}},o0=YR;Ie([St(e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return new Promise((o,c)=>{let u=f=>{this._emitter.off("closed",u),c(new ke({code:ge.API_CALL_ABORTED,message:je({key:Ve.CONNECTION_ABORTED,data:f})}))};this._emitter.on("closed",u),e.apply(this,i).then(o,c).finally(()=>{this._emitter.off("closed",u)})})})],o0.prototype,"publish"),Ie([pR(Ys.prototype.afterConnect),hR(Ys.prototype.beforeConnect)],o0.prototype,"connect");var a0=o0,uF=class{constructor(e,t){this.room=e,b(this,"_log"),b(this,"_prevReportTime"),b(this,"_prevReport",{}),b(this,"_prevEncoderImplementation"),b(this,"_prevQualityLimitationReason"),b(this,"_prevAuxQualityLimitationReason"),b(this,"_prevDecoderImplementationMap",new Map),b(this,"totalBytesSent",0),b(this,"totalBytesReceived",0),b(this,"_spcStats",null),this._log=t,this._prevReportTime=0,this._prevEncoderImplementation="",this._prevQualityLimitationReason="",this._prevAuxQualityLimitationReason=""}get statInterval(){return this._prevReportTime===0?2:(Date.now()-this._prevReportTime)/1e3}getSenderStats(e){return B(this,null,function*(){let t={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},small:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},auxiliary:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},rtt:0},i=e.getPeerConnection(),r=e.getSSRC();if(i)try{if((this._spcStats||(yield i.getStats())).forEach(o=>{var c;if(o.type==="outbound-rtp")if((o.mediaType||o.kind)===N.VIDEO){let u,f;if(o.ssrc===r.video?(u=N.VIDEO,f=e.localMainVideoTrack):o.ssrc===r.small?u=N.SMALL:o.ssrc===r.auxiliary&&(f=e.localAuxVideoTrack,u=N.AUXILIARY),!u)return;t[u].bytesSent=o.bytesSent,t[u].packetsSent=o.packetsSent,t[u].framesEncoded=o.framesEncoded,re(o.keyFramesEncoded)||(t[u].keyFramesEncoded=o.keyFramesEncoded),re(o.nackCount)||(t[u].nackCount=o.nackCount),re(o.pliCount)||(t[u].pliCount=o.pliCount),re(o.retransmittedPacketsSent)||(t[u].retransmittedPacketsSent=o.retransmittedPacketsSent),re(o.totalEncodeTime)||(t[u].totalEncodeTime=o.totalEncodeTime),re(o.totalPacketSendDelay)||(t[u].totalPacketSendDelay=o.totalPacketSendDelay),o.ssrc===r.video?(!re(o.encoderImplementation)&&this._prevEncoderImplementation!==o.encoderImplementation&&(this._log.info("encoderImplementation change to ".concat(o.encoderImplementation)),this._prevEncoderImplementation=o.encoderImplementation),!re(o.qualityLimitationReason)&&o.bytesSent!==0&&this._prevQualityLimitationReason!==o.qualityLimitationReason&&(this._log.info("qualityLimitationReason change to ".concat(o.qualityLimitationReason)),this._prevQualityLimitationReason=o.qualityLimitationReason)):o.ssrc===r.auxiliary&&!re(o.qualityLimitationReason)&&o.bytesSent!==0&&this._prevAuxQualityLimitationReason!==o.qualityLimitationReason&&(this._log.info("aux qualityLimitationReason change to ".concat(o.qualityLimitationReason)),this._prevAuxQualityLimitationReason=o.qualityLimitationReason)}else t.audio.bytesSent=o.bytesSent,t.audio.packetsSent=o.packetsSent;else o.type==="candidate-pair"?rl(o)&&Qt(o.currentRoundTripTime)&&(t.rtt=Math.floor(1e3*o.currentRoundTripTime),this.totalBytesSent=o.bytesSent):o.type==="media-source"&&(o.kind===N.AUDIO?(t.audio.audioLevel=o.audioLevel||0,t.audio.totalAudioEnergy=o.totalAudioEnergy||0):o.kind===N.VIDEO&&(o.trackIdentifier===e.getVideoTrackId(N.VIDEO)?t.video.fpsCapture=o.framesPerSecond:o.trackIdentifier===e.getVideoTrackId(N.AUXILIARY)?t.auxiliary.fpsCapture=o.framesPerSecond:t.small.fpsCapture=o.framesPerSecond));if(!re(o.audioLevel)&&((c=e.localMainAudioTrack)!=null&&c.mediaTrack)&&o.trackIdentifier===e.localMainAudioTrack.mediaTrack.id&&(t.audio.audioLevel=o.audioLevel||0),!re(o.frameWidth)){let u=N.SMALL;o.trackIdentifier===e.getVideoTrackId(N.VIDEO)||o.ssrc===r.video?u=N.VIDEO:(o.trackIdentifier===e.getVideoTrackId(N.AUXILIARY)||o.ssrc===r.auxiliary)&&(u=N.AUXILIARY),t[u].frameWidth=o.frameWidth,t[u].frameHeight=o.frameHeight,t[u].framesSent=o.framesSent}}),e.localMainAudioTrack){let o=e.localMainAudioTrack.getInternalAudioLevel();t.audio.micAudioLevel=o,t.audio.audioLevel===0&&(t.audio.audioLevel=o)}this.totalBytesSent||(this.totalBytesSent+=t.audio.bytesSent+t.video.bytesSent+t.auxiliary.bytesSent)}catch(o){this._log.warn("failed to getStats on sender connection ".concat(o))}return t})}getReceiverStats(e){return B(this,null,function*(){let t={tinyId:e.tinyId,userId:e.userId,rtt:0,hasAudio:!1,hasVideo:!1,hasAuxiliary:!1,isSmallSubscribed:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,p2pDelay:0,totalJitter:0,totalJitterCount:0,audioLevel:0,totalAudioEnergy:0,insertedSamplesForDeceleration:0,removedSamplesForAcceleration:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,fpsDecoded:0},auxiliary:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,fpsDecoded:0}},i=e.getPeerConnection();if(i)try{let{ssrc:r}=e,{muteState:o,subscribeState:c}=e;(this._spcStats||(yield i.getStats())).forEach(u=>{if(u.type==="inbound-rtp")if((u.mediaType||u.kind)===N.AUDIO){if(u.ssrc!==r.audio||!o.hasAudio)return;t.audio.packetsReceived=u.packetsReceived,t.audio.bytesReceived=u.bytesReceived,t.audio.packetsLost=u.packetsLost,u.insertedSamplesForDeceleration&&(t.audio.insertedSamplesForDeceleration=u.insertedSamplesForDeceleration),u.removedSamplesForAcceleration&&(t.audio.removedSamplesForAcceleration=u.removedSamplesForAcceleration);let{remoteAudioTrack:f}=e;f.stat.packetsReceived=u.packetsReceived,f.stat.bytesReceived=u.bytesReceived,f.stat.packetsLost=u.packetsLost,t.audio.p2pDelay=f.stat.end2EndDelay,u.jitterBufferDelay&&(t.audio.totalJitter=u.jitterBufferDelay,t.audio.totalJitterCount=u.jitterBufferEmittedCount),t.hasAudio=!0}else{if(Ct&&u.bytesReceived===0)return;let f;u.ssrc===r.video&&o.hasVideo&&(t.video.packetsReceived=u.packetsReceived,t.video.bytesReceived=u.bytesReceived,t.video.packetsLost=u.packetsLost,t.video.framesReceived=u.framesReceived,t.video.framesDecoded=u.framesDecoded,t.video.fpsDecoded=u.framesPerSecond,t.hasVideo=!0,f=e.remoteVideoTrack,o.hasSmall&&c.smallVideo&&(t.isSmallSubscribed=!0),u.decoderImplementation&&(!this._prevDecoderImplementationMap.has(t.userId)||this._prevDecoderImplementationMap.get(t.userId)!==u.decoderImplementation)&&(this._log.info("".concat(t.userId," decoderImplementation change to ").concat(u.decoderImplementation)),this._prevDecoderImplementationMap.set(t.userId,u.decoderImplementation))),u.ssrc===r.auxiliary&&o.hasAuxiliary&&(t.auxiliary.packetsReceived=u.packetsReceived,t.auxiliary.bytesReceived=u.bytesReceived,t.auxiliary.packetsLost=u.packetsLost,t.auxiliary.framesReceived=u.framesReceived,t.auxiliary.framesDecoded=u.framesDecoded,t.auxiliary.fpsDecoded=u.framesPerSecond,f=e.remoteAuxiliaryTrack,t.hasAuxiliary=!0),f&&(f.stat.packetsReceived=u.packetsReceived,f.stat.bytesReceived=u.bytesReceived,f.stat.packetsLost=u.packetsLost,f.stat.framesReceived=u.framesReceived,f.stat.framesDecoded=u.framesDecoded,u.jitterBufferDelay&&(f.stat.jitterBufferDelay=Math.floor(u.jitterBufferDelay/u.jitterBufferEmittedCount*1e3)))}else u.type==="candidate-pair"&&rl(u)&&Qt(u.currentRoundTripTime)&&(t.rtt=Math.floor(1e3*u.currentRoundTripTime),this.totalBytesReceived=u.bytesReceived);re(u.frameWidth)||((u.trackIdentifier===e.getMainStreamVideoTrackId()||u.ssrc===r.video)&&(t.video.frameWidth=u.frameWidth,t.video.frameHeight=u.frameHeight,e.remoteVideoTrack.stat.frameWidth=u.frameWidth,e.remoteVideoTrack.stat.frameHeight=u.frameHeight),(u.trackIdentifier===e.getAuxStreamVideoTrackId()||u.ssrc===r.auxiliary)&&(t.auxiliary.frameWidth=u.frameWidth,t.auxiliary.frameHeight=u.frameHeight,e.remoteAuxiliaryTrack.stat.frameWidth=u.frameWidth,e.remoteAuxiliaryTrack.stat.frameHeight=u.frameHeight)),!re(u.audioLevel)&&e.muteState.audioAvailable&&e.remoteAudioTrack.mediaTrack&&u.trackIdentifier===e.remoteAudioTrack.mediaTrack.id&&(t.audio.audioLevel=u.audioLevel||0,t.audio.totalAudioEnergy=u.totalAudioEnergy||0)}),t.audio.audioLevel===0&&e.muteState.audioAvailable&&(t.audio.audioLevel=e.remoteAudioTrack.getInternalAudioLevel()||0),this.totalBytesReceived||(this.totalBytesReceived+=t.audio.bytesReceived+t.video.bytesReceived+t.auxiliary.bytesReceived)}catch(r){this._log.warn("failed to getStats on receiver connection ".concat(r))}return t})}getStats(e,t){return B(this,null,function*(){let i={},r=[];if(this.room.singlePC){let o=this.room.singlePC.getPeerConnection();if(!o)return{senderStats:i,receiverStats:r};let c=yield o.getStats(),u=[],f=new Set(["inbound-rtp","outbound-rtp","track","candidate-pair","media-source"]);c.forEach(d=>f.has(d.type)&&u.push(d)),this._spcStats=u}e&&(i=yield this.getSenderStats(e));for(let[o,c]of t){let u=yield this.getReceiverStats(c);r.push(u)}return{senderStats:i,receiverStats:r}})}getDifferenceValue(e,t){if(Kr(e))return t;let i=t-e;return i<0?0:i}prepareReport(e){let{stats:t,report:i,freezeMap:r}=e;if(!Kr(t.senderStats)){let d={uint32_audio_level:t.senderStats.audio.audioLevel*Vr,uint32_audio_energy:1e6*t.senderStats.audio.totalAudioEnergy,uint32_audio_codec_bitrate:t.senderStats.audio.bytesSent};t.senderStats.audio.micAudioLevel&&(d.uint32_mic_audio_level=t.senderStats.audio.micAudioLevel*Vr);let _=[];if(t.senderStats.video.bytesSent){let S={uint32_video_stream_type:2,uint32_video_codec_fps:t.senderStats.video.framesSent,uint32_video_capture_fps:t.senderStats.video.fpsCapture,uint32_video_width:t.senderStats.video.frameWidth,uint32_video_height:t.senderStats.video.frameHeight,uint32_video_codec_bitrate:t.senderStats.video.bytesSent,uint32_video_enc_fps:t.senderStats.video.framesEncoded,uint32_key_frame_count:t.senderStats.video.keyFramesEncoded,uint32_nack_count:t.senderStats.video.nackCount,uint32_pli_count:t.senderStats.video.pliCount,uint32_encode_cost:1e3*(t.senderStats.video.totalEncodeTime||0),uint32_send_packet_cost:1e3*(t.senderStats.video.totalPacketSendDelay||0),uint32_video_arq_packets:t.senderStats.video.retransmittedPacketsSent};_.push(S)}if(t.senderStats.small.bytesSent){let S={uint32_video_stream_type:3,uint32_video_codec_fps:t.senderStats.small.framesSent||0,uint32_video_capture_fps:t.senderStats.small.fpsCapture||0,uint32_video_width:t.senderStats.small.frameWidth||0,uint32_video_height:t.senderStats.small.frameHeight||0,uint32_video_codec_bitrate:t.senderStats.small.bytesSent,uint32_video_enc_fps:t.senderStats.small.framesEncoded||0,uint32_key_frame_count:t.senderStats.small.keyFramesEncoded,uint32_nack_count:t.senderStats.small.nackCount,uint32_pli_count:t.senderStats.small.pliCount,uint32_encode_cost:1e3*(t.senderStats.small.totalEncodeTime||0),uint32_send_packet_cost:1e3*(t.senderStats.small.totalPacketSendDelay||0),uint32_video_arq_packets:t.senderStats.small.retransmittedPacketsSent};_.push(S)}if(t.senderStats.auxiliary.bytesSent){let S={uint32_video_stream_type:7,uint32_video_codec_fps:t.senderStats.auxiliary.framesSent||0,uint32_video_capture_fps:t.senderStats.auxiliary.fpsCapture||0,uint32_video_width:t.senderStats.auxiliary.frameWidth||0,uint32_video_height:t.senderStats.auxiliary.frameHeight||0,uint32_video_codec_bitrate:t.senderStats.auxiliary.bytesSent,uint32_video_enc_fps:t.senderStats.auxiliary.framesEncoded||0,uint32_key_frame_count:t.senderStats.auxiliary.keyFramesEncoded,uint32_nack_count:t.senderStats.auxiliary.nackCount,uint32_pli_count:t.senderStats.auxiliary.pliCount,uint32_encode_cost:1e3*(t.senderStats.auxiliary.totalEncodeTime||0),uint32_send_packet_cost:1e3*(t.senderStats.auxiliary.totalPacketSendDelay||0),uint32_video_arq_packets:t.senderStats.auxiliary.retransmittedPacketsSent};_.push(S)}let E={uint32_bitrate:0,uint32_lost:0,uint32_rtt:t.senderStats.rtt};i.msg_up_stream_info={msg_audio_status:d,msg_video_status:_,msg_network_status:E}}let{statInterval:o}=this;i.msg_down_stream_info=[],t.receiverStats.forEach(d=>{let _={msg_user_info:{str_identifier:d.userId,uint64_tinyid:d.tinyId},msg_network_status:{uint32_rtt:d.rtt,uint32_bitrate:0,uint32_lost:0},msg_audio_status:{},msg_video_status:[]};if(d.hasAudio){let E={uint32_audio_p2p_delay:d.audio.p2pDelay,uint32_audio_cache_ms:d.audio.totalJitter,uint32_audio_cache_ms_count:d.audio.totalJitterCount,uint32_audio_codec_bitrate:d.audio.bytesReceived,uint32_audio_total_bitrate:d.audio.bytesReceived,uint32_audio_level:1e8*d.audio.audioLevel,uint32_audio_energy:1e6*d.audio.totalAudioEnergy,uint32_audio_receive:d.audio.packetsReceived,uint32_audio_origin_lost:d.audio.packetsLost};_.msg_audio_status=E}if(d.hasVideo){let E=r.get("".concat(d.userId,"_").concat(Wb)),S=E?E.duration:0,R={uint32_video_stream_type:d.isSmallSubscribed?3:2,uint32_video_receive_fps:d.video.framesReceived,uint32_video_width:d.video.frameWidth,uint32_video_height:d.video.frameHeight,uint32_video_codec_bitrate:d.video.bytesReceived,uint32_video_receive:d.video.packetsReceived,uint32_video_origin_lost:d.video.packetsLost,uint32_video_block_time:S,uint32_video_dec_fps:d.video.framesDecoded};_.msg_video_status.push(R)}if(d.hasAuxiliary){let E=r.get("".concat(d.userId,"_").concat(zb)),S=E?E.duration:0,R={uint32_video_stream_type:7,uint32_video_receive_fps:d.auxiliary.framesReceived,uint32_video_width:d.auxiliary.frameWidth,uint32_video_height:d.auxiliary.frameHeight,uint32_video_codec_bitrate:d.auxiliary.bytesReceived,uint32_video_receive:d.auxiliary.packetsReceived+d.auxiliary.packetsLost,uint32_video_origin_lost:d.auxiliary.packetsLost,uint32_video_block_time:S,uint32_video_dec_fps:d.auxiliary.framesDecoded};_.msg_video_status.push(R)}i.msg_down_stream_info.push(_)});let c=this._prevReport;if(this._prevReport=JSON.parse(JSON.stringify(i)),i.msg_up_stream_info.msg_audio_status&&c.msg_up_stream_info.msg_audio_status){let d=c.msg_up_stream_info.msg_audio_status,_=i.msg_up_stream_info.msg_audio_status;if(d.uint32_audio_codec_bitrate===0)_.uint32_audio_codec_bitrate=0;else{let E=this.getDifferenceValue(d.uint32_audio_codec_bitrate,_.uint32_audio_codec_bitrate);_.uint32_audio_codec_bitrate=Math.round(8*E/o),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=_.uint32_audio_codec_bitrate}}let u=c.msg_up_stream_info.msg_video_status;i.msg_up_stream_info.msg_video_status.forEach(d=>{let _=u.find(U=>U.uint32_video_stream_type===d.uint32_video_stream_type);if(!_||_.uint32_video_codec_bitrate===0)return d.uint32_video_codec_bitrate=0,d.uint32_video_enc_fps=0,void(d.uint32_video_codec_fps=0);let E=0,S=0,R=0;_&&d.uint32_video_codec_bitrate>=_.uint32_video_codec_bitrate&&(E=_.uint32_video_codec_bitrate,S=_.uint32_video_enc_fps,R=_.uint32_video_codec_fps);let k=this.getDifferenceValue(E,d.uint32_video_codec_bitrate);d.uint32_video_codec_bitrate=Math.round(8*k/o),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=d.uint32_video_codec_bitrate,d.uint32_video_enc_fps=Math.round(this.getDifferenceValue(S,d.uint32_video_enc_fps)/o),d.uint32_video_codec_fps=Math.round(this.getDifferenceValue(R,d.uint32_video_codec_fps)/o),ua&&da()===115&&_.uint32_video_width===0&&_.uint32_video_height===0&&_.uint32_video_codec_fps===0&&(d.uint32_video_codec_fps=d.uint32_video_enc_fps),re(_.uint32_key_frame_count)||(d.uint32_key_frame_count=Math.round(this.getDifferenceValue(_.uint32_key_frame_count,d.uint32_key_frame_count))),re(_.uint32_nack_count)||(d.uint32_nack_count=Math.round(this.getDifferenceValue(_.uint32_nack_count,d.uint32_nack_count))),re(_.uint32_pli_count)||(d.uint32_pli_count=Math.round(this.getDifferenceValue(_.uint32_pli_count,d.uint32_pli_count))),re(_.uint32_video_arq_packets)||(d.uint32_video_arq_packets=Math.round(this.getDifferenceValue(_.uint32_video_arq_packets,d.uint32_video_arq_packets))),re(_.uint32_encode_cost)||(d.uint32_encode_cost=Math.round(this.getDifferenceValue(_.uint32_encode_cost,d.uint32_encode_cost)/o)),re(_.uint32_send_packet_cost)||(d.uint32_send_packet_cost=Math.round(this.getDifferenceValue(_.uint32_send_packet_cost,d.uint32_send_packet_cost)/o))});let f=c.msg_down_stream_info;return i.msg_down_stream_info=i.msg_down_stream_info.filter(d=>f.find(_=>_.msg_user_info.uint64_tinyid===d.msg_user_info.uint64_tinyid)),i.msg_down_stream_info.forEach(d=>{let _=f.find(E=>E.msg_user_info.uint64_tinyid===d.msg_user_info.uint64_tinyid);if(Kr(d.msg_audio_status)||Kr(_.msg_audio_status))d.msg_audio_status={};else{let E=d.msg_audio_status,S=_.msg_audio_status,R=this.getDifferenceValue(S.uint32_audio_cache_ms_count,E.uint32_audio_cache_ms_count);delete E.uint32_audio_cache_ms_count,E.uint32_audio_cache_ms=Math.floor(1e3*this.getDifferenceValue(S.uint32_audio_cache_ms,E.uint32_audio_cache_ms)/R)||0;let k=this.room.remotePublishedUserMap.get(d.msg_user_info.str_identifier);k&&(k.remoteAudioTrack.stat.jitterBufferDelay=E.uint32_audio_cache_ms),E.uint32_audio_origin_lost=this.getDifferenceValue(S.uint32_audio_origin_lost,E.uint32_audio_origin_lost),E.uint32_audio_receive=this.getDifferenceValue(S.uint32_audio_receive,E.uint32_audio_receive),E.uint32_audio_receive+=E.uint32_audio_origin_lost;let U=this.getDifferenceValue(S.uint32_audio_codec_bitrate,E.uint32_audio_codec_bitrate);E.uint32_audio_codec_bitrate=Math.round(8*U/o),E.uint32_audio_total_bitrate=Math.round(8*U/o)}if(d.msg_video_status&&_.msg_video_status){let E=_.msg_video_status;d.msg_video_status=d.msg_video_status.filter(S=>E.find(R=>R.uint32_video_stream_type===S.uint32_video_stream_type)),d.msg_video_status.forEach(S=>{let R=E.find(Ne=>Ne.uint32_video_stream_type===S.uint32_video_stream_type),k=R.uint32_video_receive,U=R.uint32_video_origin_lost,K=R.uint32_video_codec_bitrate,se=R.uint32_video_receive_fps,le=R.uint32_video_dec_fps;S.uint32_video_origin_lost=this.getDifferenceValue(U,S.uint32_video_origin_lost),S.uint32_video_receive=this.getDifferenceValue(k,S.uint32_video_receive)+S.uint32_video_origin_lost;let Y=this.getDifferenceValue(K,S.uint32_video_codec_bitrate);S.uint32_video_codec_bitrate=Math.round(8*Y/o);let Re=this.getDifferenceValue(se,S.uint32_video_receive_fps);S.uint32_video_receive_fps=Math.round(Re/o),S.uint32_video_dec_fps=Math.round(this.getDifferenceValue(le,S.uint32_video_dec_fps)/o)})}}),i}getStatsReport(e){return B(this,arguments,function(t){var i=this;let{uplinkConnection:r,downlinkConnections:o,freezeMap:c}=t;return function*(){let u={msg_up_stream_info:{msg_audio_status:{uint32_audio_format:11,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_level:0,uint32_audio_energy:0},msg_video_status:[],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}},msg_down_stream_info:[{msg_user_info:{str_identifier:"",uint64_tinyid:0},msg_audio_status:{uint32_audio_cache_ms:0,uint32_audio_format:11,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_total_bitrate:0,uint32_audio_level:0,uint32_audio_energy:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_final_lost:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_receive_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_block_time:0,uint32_video_dec_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}}]},f=yield i.getStats(r,o);return JSON.stringify(i._prevReport)==="{}"&&(i._prevReport=JSON.parse(JSON.stringify(u))),i.prepareReport({stats:f,report:u,freezeMap:c}),i._prevReportTime=Date.now(),u}()})}reset(){this._prevReportTime=0,this._prevReport={},this._prevEncoderImplementation="",this._prevQualityLimitationReason="",this._prevDecoderImplementationMap=new Map}},dF=ni(Di()),qR=class extends dF.default{constructor(e){let{signalChannel:t,room:i}=e;super(),b(this,"_room"),b(this,"_signalChannel"),b(this,"_log"),b(this,"_uplinkRTT",0),b(this,"_uplinkLoss",0),b(this,"_downlinkRTT",0),b(this,"_downlinkLoss",0),b(this,"_downlinkPrevStatMap",new Map),b(this,"_downlinkLossAndRTTMap",new Map),b(this,"_interval",-1),b(this,"_uplinkNetworkQuality",0),b(this,"_downlinkNetworkQuality",0),this._room=i,this._signalChannel=t,this._log=Te.createLogger({id:"q",userId:this._room.userId,sdkAppId:this._room.sdkAppId}),this.initialize()}get uplinkNetworkQuality(){return this._uplinkNetworkQuality}set uplinkNetworkQuality(e){e!==this._uplinkNetworkQuality&&this._log.info("uplink ".concat(this.uplinkNetworkQuality," -> ").concat(e,", rtt: ").concat(this._uplinkRTT,", loss: ").concat(this._uplinkLoss)),this._uplinkNetworkQuality=e}get downlinkNetworkQuality(){return this._downlinkNetworkQuality}set downlinkNetworkQuality(e){if(e!==this._downlinkNetworkQuality){let{rtt:t,loss:i}=this.getAverageLossAndRTT([...this._downlinkLossAndRTTMap.values()]);this._log.info("downlink ".concat(this.downlinkNetworkQuality," -> ").concat(e,", rtt: ").concat(t,", loss: ").concat(i))}this._downlinkNetworkQuality=e}initialize(){this._signalChannel.on(Je.UPLINK_NETWORK_STATS,e=>{this.handleUplinkNetworkQuality(e)}),this._signalChannel.on(e0,this.handleSignalConnectionStateChange.bind(this)),this.start()}handleUplinkNetworkQuality(e){var t,i;if(e.data.code!==0)return;let r=e.data.data;if(r.delay&&this.updateDelay(r.delay),!this._room.uplinkConnection)return this.uplinkNetworkQuality=0,this._uplinkLoss=0,void(this._uplinkRTT=0);let o=(i=(t=this._room)==null?void 0:t.uplinkConnection)==null?void 0:i.getPeerConnection();if(o&&this.isPeerConnectionDisconnected(o))return this.uplinkNetworkQuality=6,this._uplinkLoss=0,void(this._uplinkRTT=0);let c=r.expectAudPkg+r.expectVidPkg,u=r.recvAudPkg+r.recvVidPkg,f=c-u;c===0&&u===0||(this._uplinkLoss=f<=0?0:Math.round(f/c*100),this._uplinkRTT=r.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this._uplinkLoss,this._uplinkRTT))}handleDownlinkNetworkQuality(){return B(this,null,function*(){if(this._room.remotePublishedUserMap.size===0)return void(this.downlinkNetworkQuality=0);let e=[...this._room.remotePublishedUserMap.values()],t=e.filter(o=>{var c;return((c=o.getPeerConnection())==null?void 0:c.connectionState)===Lt.CONNECTED});if(e.filter(o=>this.isPeerConnectionDisconnected(o.getPeerConnection())).length===e.length)return void(this.downlinkNetworkQuality=6);for(let o=0;o<t.length;o++){let c=t[o].getPeerConnection();if(!c)return;let{rtt:u,totalPacketsLost:f,totalPacketsReceived:d}=yield this.getStat(c);if(!this._downlinkPrevStatMap.has(c)){this._downlinkPrevStatMap.set(c,{totalPacketsLost:f,totalPacketsReceived:d});continue}let _=0,E=this._downlinkPrevStatMap.get(c),S=f-E.totalPacketsLost,R=d-E.totalPacketsReceived;_=S<=0||R<0?0:Math.round(S/(S+R)*100),this._downlinkPrevStatMap.set(c,{totalPacketsLost:f,totalPacketsReceived:d}),this._downlinkLossAndRTTMap.set(c,{rtt:u,loss:_,userId:t[o].getUserId(),audioDelay:t[o].remoteAudioTrack.stat.end2EndDelay,videoDelay:t[o].remoteVideoTrack.stat.end2EndDelay})}if([...this._downlinkPrevStatMap.keys()].forEach(o=>{this.isPeerConnectionDisconnected(o)&&(this._downlinkPrevStatMap.delete(o),this._downlinkLossAndRTTMap.delete(o))}),this._downlinkLossAndRTTMap.size===0)return;let{rtt:i,loss:r}=this.getAverageLossAndRTT([...this._downlinkLossAndRTTMap.values()]);this._downlinkRTT=i,this._downlinkLoss=r,this.downlinkNetworkQuality=this.getNetworkQuality(r,i)})}getStat(e){return B(this,null,function*(){let t={rtt:0,totalPacketsLost:0,totalPacketsReceived:0};if(!e||!Zd())return t;let i=e.getReceivers();try{for(let r=0;r<i.length;r++)(yield i[r].getStats()).forEach(o=>{o.type==="candidate-pair"&&Qt(o.currentRoundTripTime)&&(t.rtt=Math.round(1e3*o.currentRoundTripTime)),o.type==="inbound-rtp"&&(o.mediaType===N.AUDIO||o.mediaType===N.VIDEO)&&(t.totalPacketsLost+=o.packetsLost,t.totalPacketsReceived+=o.packetsReceived)});return t}catch{return t}})}getAverageLossAndRTT(e){let t={rtt:0,loss:0};return Array.isArray(e)&&e.length>0&&(e.forEach(i=>{t.rtt+=i.rtt,t.loss+=i.loss}),Object.keys(t).forEach(i=>{t[i]=Math.round(t[i]/e.length)})),t}getNetworkQuality(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:0}handleSignalConnectionStateChange(e){e.state==="DISCONNECTED"?(this._uplinkRTT=0,this._uplinkLoss=0,this.uplinkNetworkQuality=6):e.state==="CONNECTED"&&this.uplinkNetworkQuality===6&&(this.uplinkNetworkQuality=5)}handleUplinkConnectionStateChange(e){let{state:t}=e;t==="DISCONNECTED"?(this._uplinkLoss=0,this._uplinkRTT=0,this.uplinkNetworkQuality=6):t==="CONNECTED"&&this.uplinkNetworkQuality===6&&(this.uplinkNetworkQuality=5)}isPeerConnectionDisconnected(e){return!(!e||e.connectionState!==Lt.DISCONNECTED&&e.connectionState!==Lt.FAILED&&e.connectionState!==Lt.CLOSED)}setUplinkConnection(e){this._room.uplinkConnection=e,this._room.uplinkConnection?this._room.uplinkConnection.on("connection-state-changed",this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=0,this._uplinkRTT=0,this._uplinkLoss=0)}start(){this._interval===-1?(this._log.debug("start network quality calculating"),this._interval=Dt.run(ca,()=>{this.handleDownlinkNetworkQuality();let e=[...this._downlinkLossAndRTTMap.values()];pe.emit(oe.NETWORK_QUALITY,{room:this._room,uplink:{rtt:this._uplinkRTT,loss:this._uplinkLoss},downlinks:e}),this.emit(qR.EVENT_NETWORK_QUALITY,{uplinkNetworkQuality:this.uplinkNetworkQuality,downlinkNetworkQuality:this.downlinkNetworkQuality,uplinkRTT:this._uplinkRTT,uplinkLoss:this._uplinkLoss,downlinkRTT:this._downlinkRTT,downlinkLoss:this._downlinkLoss,downlinkInfo:e})},{delay:2e3})):this._log.info("network quality calculating is already started")}stop(){this._log.debug("stopped"),this._interval!==-1&&(Dt.clearTask(this._interval),this._interval=-1),this._downlinkLossAndRTTMap.clear(),this._downlinkPrevStatMap.clear()}updateDelay(e){let{tinyIdToUserIdMap:t}=this._room;e.forEach(i=>{let{srcTinyId:r,videoDelay:o,audioDelay:c}=i,u=t.get(r);if(u){let f=this._room.remotePublishedUserMap.get(u);f==null||f.setDelay({videoDelay:o,audioDelay:c})}})}},c0=qR;b(c0,"EVENT_NETWORK_QUALITY","0");var XR=class{constructor(e){this._signalInfo={tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0},this._eventMap=new Map,this._frameWorkType=e.frameWorkType||30,this._component=e.component||0,this.connectionType=e.connectionType||1,this._language=e.language||0,this._room=e.room,this._keyPrefix="key_point",this._log=Te.createLogger({id:"kpm",userId:this._room.userId,sdkAppId:this._room.sdkAppId}),Object.getOwnPropertyNames(this.__proto__).forEach(t=>{t.startsWith("handle")&&Tt(this[t])&&(this[t]=function(i){let{fn:r,context:o}=i;return function(){try{for(var c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];let d=r.apply(o,u);return mg(d)?d.catch(_=>Te.error("".concat(r.name,"() error observed ").concat(_))):d}catch(d){Te.error("".concat(r.name,"() error observed ").concat(d))}}}({fn:this[t],context:this}))}),this.initData(),this.installEvents(),this._intervalId=Dt.run(ca,this.setStorage.bind(this),{delay:2e4})}get _storageKey(){return"".concat(this._keyPrefix,"_").concat(this._room.userId)}initData(){this._firstPublishedUserList=[],this._networkQuality={totalUplinkRTT:0,totalUplinkLoss:0,count:0,totalDownlinkRTTAndLossMap:new Map},this._basicInfo={string_sdk_version:In,uint32_os_type:15,string_device_name:"",string_http_user_agent:navigator.userAgent,string_os_version:"",uint32_avg_rtt:0,uint32_avg_up_loss:0,uint32_scene:this._room.scene==="live"?1:0,uint32_joining_duration:0,uint32_networkType:0,uint32_framework:this._frameWorkType,uint32_component:this._component,uint32_connection_type:this.connectionType,uint32_caller_coding_language:this._language,string_domain:location.hostname},this._pathJoinRoom={uint64_start_time:0,uint64_send_request_acc_ip_cmd_start_time:0,uint64_send_request_acc_ip_cmd_end_time:0,uint64_send_request_enter_room_cmd_start_time:0,uint64_send_request_enter_room_cmd_end_time:0,uint64_send_first_video_frame_time:0,uint64_recv_userlist_time:0,uint64_end_time:0,int32_send_request_acc_ip_cmd_ret:0,int32_send_request_enter_room_cmd_ret:0,int32_end_ret:0},this._pathLeaveRoom={uint64_start_time:0,uint64_send_request_exit_room_cmd_start_time:0,uint64_send_request_exit_room_cmd_end_time:0,uint64_end_time:0,int32_send_request_exit_room_cmd_ret:0,int32_end_ret:0},this._localStreamStat={totalVideoBitrate:0,totalVideoFPS:0,totalVideoHeight:0,totalVideoWidth:0,totalAudioLevel:0,videoCount:0,audioLevelCount:0,publishStartTime:0,statsToReport:{uint32_audio_capture_db:0,uint32_video_big_capture_fps:0,uint32_video_big_bitrate:0,uint32_video_big_resolution:0}},this._pathMainVideoMap=new Map,this._pathMainAudioMap=new Map,this._pathAuxiliaryMap=new Map,this._remoteStreamStatMap=new Map,ug().then(e=>{this._basicInfo.string_os_version=hg(),this._basicInfo.string_device_name=e&&e.mobile?e.model:this._basicInfo.string_os_version})}addEvent(e,t){return this._eventMap.set(e,t),pe.on(e,t),this}installEvents(){this.handleUnload=this.handleUnload.bind(this),window.addEventListener("unload",this.handleUnload),this._room.once("banned",()=>this.handleLeaveSuccess({room:this._room,roomId:this._room.roomId})),this.addEvent(oe.JOIN_START,this.handleJoinStart).addEvent(oe.JOIN_SCHEDULE_SUCCESS,this.handleJoinScheduleSuccess).addEvent(oe.JOIN_SIGNAL_CONNECTION_START,this.handleSignalConnectionStart).addEvent(oe.JOIN_SIGNAL_CONNECTION_END,this.handleSignalConnectionEnd).addEvent(oe.JOIN_SEND_CMD,this.handleJoinSendCMD).addEvent(oe.JOIN_RECEIVED_CMD_RES,this.handleJoinReceivedCMDResponce).addEvent(oe.JOIN_SUCCESS,this.handleJoinSuccess).addEvent(oe.JOIN_FAILED,this.handleJoinFailed).addEvent(oe.LEAVE_START,this.handleLeaveStart).addEvent(oe.LEAVE_SUCCESS,this.handleLeaveSuccess).addEvent(oe.LEAVE_SEND_CMD,this.handleLeaveSendCMD).addEvent(oe.LOCAL_TRACK_CAPTURE_START,this.handleTrackCaptureStart).addEvent(oe.LOCAL_TRACK_CAPTURE_SUCCESS,this.handleTrackCaptureSuccess).addEvent(oe.LOCAL_TRACK_CAPTURE_FAILED,this.handleTrackCaptureFailed).addEvent(oe.PUBLISH_START,this.handlePublishStart).addEvent(oe.SEND_FIRST_VIDEO_FRAME,this.handleSendFirstVideoFrame).addEvent(oe.SUBSCRIBE_START,this.handleSubscribeStart).addEvent(oe.SUBSCRIBE_SUCCESS,this.handleSubscribed).addEvent(oe.PLAY_TRACK_START,this.handlePlayStart).addEvent(oe.VIDEO_LOADED_DATA,this.handleVideoLoadedData).addEvent(oe.PLAYER_STATE_CHANGED,e=>{let{track:t,state:i,type:r}=e;!ma(t)||!this.hitTest(t.room)||i==="PLAYING"&&(r===N.AUDIO?this.handleAudioPlaying(t):this.handleVideoPlaying(t))}).addEvent(oe.NETWORK_QUALITY,this.handleNetworkQuality).addEvent(oe.HEARTBEAT_REPORT,this.handleHeartbeatStats).addEvent(oe.RECEIVED_PUBLISHED_USER_LIST,this.handleReceivedPublishUserList).addEvent(oe.REMOTE_PUBLISH_STATE_CHANGED,e=>{let{room:t,prevMuteState:i,muteState:r}=e;if(!this.hitTest(t))return;let o=i.hasAudio||i.hasVideo||i.hasSmall,c=i.hasAuxiliary,u=r.hasAudio||r.hasVideo||r.hasSmall,f=r.hasAuxiliary;!o&&u&&this.handleRemoteStreamAdded(r.userId,"main"),!c&&f&&this.handleRemoteStreamAdded(r.userId,"auxiliary")}).addEvent(oe.SINGLE_CONNECTION_STAT,e=>{let{room:t,stat:i}=e;this.hitTest(t)&&(this._pathJoinRoom.int32_ice_cost=i.ice,this._pathJoinRoom.int32_dtls_cost=i.dtls,this._pathJoinRoom.int32_peer_connection_cost=i.peerConnection)})}uninstallEvents(){window.removeEventListener("unload",this.handleUnload),this._eventMap.forEach((e,t)=>pe.off(t,e)),this._eventMap.clear()}destroy(){this.uninstallEvents(),Dt.clearTask(this._intervalId)}handleUnload(){this._room.isJoined&&this.handleLeaveSuccess({room:this._room,roomId:this._room.roomId})}handleJoinStart(e){this.hitTest(e.room)&&(this._pathJoinRoom.uint64_start_time===0&&(this._pathJoinRoom.uint64_start_time=Date.now(),this.checkStorage()),e.params&&(re(e.params.frameWorkType)||(this._frameWorkType=e.params.frameWorkType,this._basicInfo.uint32_framework=this._frameWorkType),re(e.params.component)||(this._component=e.params.component,this._basicInfo.uint32_component=this._component),re(e.params.language)||(this._language=e.params.language,this._basicInfo.uint32_caller_coding_language=this._language)))}handleJoinScheduleSuccess(e){let{room:t,detailCost:i}=e;if(this.hitTest(t)&&i){let{totalCost:r,local:o,dns:c,tcp:u,tls:f,request:d,response:_}=i;this._pathJoinRoom.int32_schedule_cost=r,this._pathJoinRoom.int32_schedule_local=o,this._pathJoinRoom.int32_schedule_dns=c,this._pathJoinRoom.int32_schedule_tcp=u,this._pathJoinRoom.int32_schedule_tls=f,this._pathJoinRoom.int32_schedule_request=d,this._pathJoinRoom.int32_schedule_response=_}}handleSignalConnectionStart(e){let{room:t}=e;this.hitTest(t)&&this._pathJoinRoom.uint64_send_request_acc_ip_cmd_start_time===0&&(this._pathJoinRoom.uint64_send_request_acc_ip_cmd_start_time=Date.now())}handleSignalConnectionEnd(e){let{room:t,error:i}=e;this.hitTest(t)&&this._pathJoinRoom.uint64_send_request_acc_ip_cmd_end_time===0&&(this._pathJoinRoom.uint64_send_request_acc_ip_cmd_end_time=Date.now(),i&&(this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret=i instanceof ke?Number(i.getExtraCode()||i.getCode()):ge.UNKNOWN,this._pathJoinRoom.int32_end_ret=this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret))}handleJoinSendCMD(e){this.hitTest(e.room)&&this._pathJoinRoom.uint64_send_request_enter_room_cmd_start_time===0&&(this._pathJoinRoom.uint64_send_request_enter_room_cmd_start_time=Date.now())}handleJoinReceivedCMDResponce(e){this.hitTest(e.room)&&this._pathJoinRoom.uint64_send_request_enter_room_cmd_end_time===0&&(this._pathJoinRoom.uint64_send_request_enter_room_cmd_end_time=Date.now(),this._pathJoinRoom.int32_send_request_enter_room_cmd_ret=e.code,e.code!==0&&(this._pathJoinRoom.int32_end_ret=this._pathJoinRoom.int32_send_request_enter_room_cmd_ret))}handleJoinSuccess(e){this.hitTest(e.room)&&this._pathJoinRoom.uint64_end_time===0&&(this._pathJoinRoom.uint64_end_time=Date.now(),this._pathJoinRoom.int32_end_ret=0,this._signalInfo=e.room.getSignalInfo())}handleJoinFailed(e){let{room:t,error:i}=e;this.hitTest(t)&&(this._pathJoinRoom.uint64_end_time=Date.now(),this._pathJoinRoom.int32_end_ret===0&&(this._pathJoinRoom.int32_end_ret=i.code||this._pathJoinRoom.int32_send_request_enter_room_cmd_ret||this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret),setTimeout(()=>{this.report()}))}handleReceivedPublishUserList(e){this.hitTest(e.room)&&this._pathJoinRoom.uint64_recv_userlist_time===0&&(this._pathJoinRoom.uint64_recv_userlist_time=Date.now(),this._firstPublishedUserList=e.publishedUserList||[])}handleSendFirstVideoFrame(e){let{room:t}=e;!this.hitTest(t)||this._pathJoinRoom.uint64_send_first_video_frame_time===0&&this._pathJoinRoom.uint64_start_time!==0&&(this._pathJoinRoom.uint64_send_first_video_frame_time=Date.now())}handleLeaveStart(e){this.hitTest(e.room)&&(this._pathLeaveRoom.uint64_start_time=Date.now())}handleLeaveSuccess(e){this.hitTest(e.room)&&this._pathLeaveRoom.uint64_end_time===0&&(this._pathLeaveRoom.uint64_end_time=Date.now(),this._pathJoinRoom.uint64_end_time!==0?this._basicInfo.uint32_joining_duration=this._pathLeaveRoom.uint64_end_time-this._pathJoinRoom.uint64_end_time:this._log.warn("pathJoinRoom endTime is 0"),this.report())}handleLeaveSendCMD(e){this.hitTest(e.room)&&(this._pathLeaveRoom.uint64_send_request_exit_room_cmd_start_time=Date.now(),this._pathLeaveRoom.uint64_send_request_exit_room_cmd_end_time=Date.now())}handleRemoteStreamAdded(e,t){var i;let r="".concat(e,"_").concat(t);if(!this._remoteStreamStatMap.has(r)){let o={userId:e,totalVideoFPS:0,totalVideoBitrate:0,totalAudioLevel:0,totalAudioBitrate:0,totalLoss:0,audioCount:0,audioLevelCount:0,videoCount:0,networkQualityCount:0,streamAddedTime:Date.now(),subscribeStartTime:0,subscribedTime:0,playStreamTime:0,statsToReport:qe(Oe({},hF),{msg_user_info:new l0({userId:e,tinyId:(i=this._room.remotePublishedUserMap.get(e))==null?void 0:i.tinyId,role:20})})};o.statsToReport.uint32_stream_type=t==="main"?2:7,this._remoteStreamStatMap.set(r,o)}}handleSubscribeStart(e){let{room:t,remotePublishedUser:i,streamType:r,subscribeState:o}=e;if(!this.hitTest(t))return;let{userId:c,tinyId:u,role:f}=i,d=new l0({userId:c,tinyId:u,role:f==="anchor"?20:21}),_=Date.now(),E="".concat(c,"_").concat(r),S=this._remoteStreamStatMap.get(E);S&&S.subscribeStartTime===0&&(S.subscribeStartTime=_),r==="main"?(i.muteState.hasVideo&&(o.video||o.smallVideo)&&!this._pathMainVideoMap.has(E)&&this._pathMainVideoMap.set(E,{statsToReport:{msg_user_info:d,uint64_start_enter_time:this._pathJoinRoom.uint64_start_time,uint64_render_first_frame_time:0,uint64_combine_first_frame_time:0},userId:c,sendSubscribeCMDTime:_}),i.muteState.hasAudio&&o.audio&&!this._pathMainAudioMap.has(E)&&this._pathMainAudioMap.set(E,{statsToReport:{msg_user_info:d,uint64_start_enter_time:this._pathJoinRoom.uint64_start_time,uint64_play_first_frame_time:0},userId:c,sendSubscribeCMDTime:_})):i.muteState.hasAuxiliary&&o.auxiliary&&!this._pathAuxiliaryMap.has(E)&&this._pathAuxiliaryMap.set(E,{sendSubscribeCMDTime:_})}handleSubscribed(e){let{room:t,remotePublishedUser:i,streamType:r}=e;if(this.hitTest(t)){let o="".concat(i.userId,"_").concat(r),c=this._remoteStreamStatMap.get(o);c&&c.subscribedTime===0&&(c.subscribedTime=Date.now())}}handlePlayStart(e){let{track:t}=e;if(!ma(t)||!this.hitTest(t.room))return;let i="".concat(t.userId,"_").concat(t.streamType),r=this._remoteStreamStatMap.get(i);(r==null?void 0:r.playStreamTime)===0&&(r.playStreamTime=Date.now())}handleVideoLoadedData(e){let{track:t}=e;if(!ma(t)||!this.hitTest(t.room))return;let i="".concat(t.userId,"_").concat(t.streamType),r=this._pathMainVideoMap.get(i);r&&r.statsToReport.uint64_combine_first_frame_time===0&&(r.statsToReport.uint64_combine_first_frame_time=Date.now())}handleVideoPlaying(e){let t="".concat(e.userId,"_").concat(e.streamType),i=Date.now(),r=this._pathMainVideoMap.get(t),o=this._remoteStreamStatMap.get(t);if(r&&(r.statsToReport.uint64_render_first_frame_time===0&&(r.statsToReport.uint64_render_first_frame_time=i),o)){let{statsToReport:u,playStreamTime:f,subscribedTime:d}=o;u.uint32_video_render_first===0&&f-d<=100&&(u.uint32_video_render_first=i-r.sendSubscribeCMDTime)}let c=this._pathAuxiliaryMap.get(t);if(c&&o){let{statsToReport:u,playStreamTime:f,subscribedTime:d}=o;u.uint32_video_render_first===0&&f-d<=100&&(u.uint32_video_render_first=i-c.sendSubscribeCMDTime)}}handleAudioPlaying(e){let t="".concat(e.userId,"_").concat(e.streamType),i=this._pathMainAudioMap.get(t);i&&i.statsToReport.uint64_play_first_frame_time===0&&(i.statsToReport.uint64_play_first_frame_time=Date.now())}handleNetworkQuality(e){this.hitTest(e.room)&&(this._networkQuality.totalUplinkLoss+=e.uplink.loss,this._networkQuality.totalUplinkRTT+=e.uplink.rtt,this._networkQuality.count++,e.downlinks.forEach(t=>{let{rtt:i,loss:r,userId:o,videoDelay:c,audioDelay:u}=t,f=this._networkQuality.totalDownlinkRTTAndLossMap.get(o);if(f)f.totalRTT+=i,f.totalLoss+=r,c&&(f.totalVideoDelay=(f.totalVideoDelay||0)+c,f.videoDelayCount=(f.videoDelayCount||0)+1),u&&(f.totalAudioDelay=(f.totalAudioDelay||0)+u,f.audioDelayCount=(f.audioDelayCount||0)+1),f.count++;else{let d,_,E,S;c&&(_=c,E=1),u&&(d=u,S=1),this._networkQuality.totalDownlinkRTTAndLossMap.set(o,{totalRTT:i,totalLoss:r,count:1,totalAudioDelay:d,totalVideoDelay:_,audioDelayCount:S,videoDelayCount:E})}}))}handleHeartbeatStats(e){if(this.hitTest(e.room)){let{msg_up_stream_info:t,msg_down_stream_info:i}=e.report;if(t.msg_video_status[0]){let{uint32_video_codec_bitrate:r,uint32_video_enc_fps:o,uint32_video_width:c,uint32_video_height:u}=t.msg_video_status[0];this._localStreamStat.totalVideoBitrate+=r,this._localStreamStat.totalVideoFPS+=o,this._localStreamStat.totalVideoWidth+=c,this._localStreamStat.totalVideoHeight+=u,this._localStreamStat.videoCount++}if(t.msg_audio_status){let{uint32_audio_level:r}=t.msg_audio_status;Math.floor(r/Vr*100)>0&&(this._localStreamStat.totalAudioLevel+=r/Vr,this._localStreamStat.audioLevelCount++)}i.forEach(r=>{let{msg_user_info:o,msg_audio_status:c,msg_video_status:u}=r,f=o.str_identifier,d=this._room.remotePublishedUserMap.get(f);if(u.forEach(_=>{let E=_.uint32_video_stream_type===2,S=_.uint32_video_stream_type===7,R="".concat(f,"_").concat(E?"main":"auxiliary"),k=this._remoteStreamStatMap.get(R);if(k&&(E&&(d!=null&&d.remoteVideoTrack.isSubscribed)||S&&(d!=null&&d.remoteAuxiliaryTrack))){k.totalVideoFPS+=_.uint32_video_receive_fps,k.totalVideoBitrate+=_.uint32_video_codec_bitrate,k.videoCount++,k.statsToReport.uint32_video_width===0&&(k.statsToReport.uint32_video_width=_.uint32_video_width),k.statsToReport.uint32_video_height===0&&(k.statsToReport.uint32_video_height=_.uint32_video_height);let U=E?d.remoteVideoTrack:d.remoteAuxiliaryTrack;U.stat.jitterBufferDelay&&(k.videoJitterBufferDelay=U.stat.jitterBufferDelay),U.stat.framesReceived&&(k.statsToReport.uint32_video_consume_render_rate=Math.floor(U.stat.framesDecoded/U.stat.framesReceived*I_(10,6)))}}),c){let _="".concat(f,"_","main"),E=this._remoteStreamStatMap.get(_);this._remoteStreamStatMap.has(_)&&E&&(d!=null&&d.remoteAudioTrack.isSubscribed)&&(E.totalAudioBitrate+=c.uint32_audio_codec_bitrate,E.audioCount++,d.remoteAudioTrack.stat.jitterBufferDelay&&(E.audioJitterBufferDelay=d.remoteAudioTrack.stat.jitterBufferDelay),Math.floor(c.uint32_audio_level/Vr*100)>0&&(E.totalAudioLevel+=c.uint32_audio_level/Vr,E.audioLevelCount++))}})}}handlePublishStart(e){let{room:t}=e;this.hitTest(t)&&this._localStreamStat.publishStartTime===0&&(this._localStreamStat.publishStartTime=Date.now())}handleTrackCaptureStart(e){let{track:t}=e;t.mediaType===1&&!this._pathJoinRoom.uint64_init_audio_start_time&&(this._pathJoinRoom.uint64_init_audio_start_time=Date.now()),t.mediaType===4&&!this._pathJoinRoom.uint64_init_camera_start_time&&(this._pathJoinRoom.uint64_init_camera_start_time=Date.now())}handleTrackCaptureSuccess(e){let{track:t}=e;t.mediaType===1&&!this._pathJoinRoom.uint64_init_audio_end_time&&(this._pathJoinRoom.int32_init_audio_ret=0,this._pathJoinRoom.uint64_init_audio_end_time=Date.now()),t.mediaType===4&&!this._pathJoinRoom.uint64_init_camera_end_time&&(this._pathJoinRoom.int32_init_camera_ret=0,this._pathJoinRoom.uint64_init_camera_end_time=Date.now())}handleTrackCaptureFailed(e){let{track:t,error:i}=e,r={NotFoundError:1,NotAllowedError:2,NotReadableError:3,OverConstrainedError:4,AbortError:5,InvalidStateError:6,SecurityError:7,TypeError:8}[i.name]||(i instanceof ke?i.getExtraCode()||i.getCode():ge.UNKNOWN);t.mediaType===1&&!this._pathJoinRoom.uint64_init_audio_end_time&&(this._pathJoinRoom.int32_init_audio_ret=r,this._pathJoinRoom.uint64_init_audio_end_time=Date.now()),t.mediaType===4&&!this._pathJoinRoom.uint64_init_camera_end_time&&(this._pathJoinRoom.int32_init_camera_ret=r,this._pathJoinRoom.uint64_init_camera_end_time=Date.now())}hasVideoFlag(e){return this._firstPublishedUserList.findIndex(t=>t.userId===e&&t.flag&Oc)>=0}hasAudioFlag(e){return this._firstPublishedUserList.findIndex(t=>t.userId===e&&t.flag&Pc)>=0}hasAuxFlag(e){return this._firstPublishedUserList.findIndex(t=>t.userId===e&&t.flag&Cd)>=0}hitTest(e){return e===this._room}checkStorage(){return B(this,null,function*(){try{let e=_a.getItem(this._storageKey);e&&(yield this.upload(e),_a.deleteItem(this._storageKey))}catch(e){this._log.warn(e)}})}setStorage(){this.prepareReport();let e=this.getReportData();e.msg_path_enter_room.uint64_start_time!==0&&_a.setItem(this._storageKey,e)}prepareReport(){if(this._networkQuality.count>0&&(this._basicInfo.uint32_avg_rtt=Math.floor(this._networkQuality.totalUplinkRTT/this._networkQuality.count),this._basicInfo.uint32_avg_up_loss=Math.floor(this._networkQuality.totalUplinkLoss/this._networkQuality.count)),this._localStreamStat.videoCount>0){this._localStreamStat.statsToReport.uint32_video_big_capture_fps=Math.floor(this._localStreamStat.totalVideoFPS/this._localStreamStat.videoCount),this._localStreamStat.statsToReport.uint32_video_big_bitrate=Math.floor(this._localStreamStat.totalVideoBitrate/this._localStreamStat.videoCount);let e=Math.floor(this._localStreamStat.totalVideoWidth/this._localStreamStat.videoCount),t=Math.floor(this._localStreamStat.totalVideoHeight/this._localStreamStat.videoCount);this._localStreamStat.statsToReport.uint32_video_big_resolution=e<<16|t}this._localStreamStat.audioLevelCount>0&&(this._localStreamStat.statsToReport.uint32_audio_capture_db=Math.floor(this._localStreamStat.totalAudioLevel/this._localStreamStat.audioLevelCount*100)),this._remoteStreamStatMap.forEach((e,t)=>{let{userId:i}=e,r=this._networkQuality.totalDownlinkRTTAndLossMap.get(i);if(r){let{totalLoss:_,count:E,audioDelayCount:S,videoDelayCount:R,totalAudioDelay:k,totalVideoDelay:U}=r;e.statsToReport.uint32_avg_down_loss=Math.floor(_/E),S&&k&&(e.statsToReport.uint32_audio_network_p2p_delay=Math.floor(k/S),e.audioJitterBufferDelay&&(e.statsToReport.uint32_p2p_delay=Math.floor(e.statsToReport.uint32_audio_network_p2p_delay+e.audioJitterBufferDelay))),R&&U&&(e.statsToReport.uint32_video_network_p2p_delay=Math.floor(U/R))}e.videoCount>0&&(e.statsToReport.uint32_video_avg_fps=Math.floor(e.totalVideoFPS/e.videoCount),e.statsToReport.uint32_video_avg_bitrate=Math.floor(e.totalVideoBitrate/e.videoCount)),e.audioCount>0&&(e.statsToReport.uint32_audio_recv_bitrate=e.statsToReport.uint32_audio_bitrate=Math.floor(e.totalAudioBitrate/e.audioCount)),e.audioLevelCount>0&&(e.statsToReport.uint32_audio_play_db=Math.floor(e.totalAudioLevel/e.audioLevelCount*100));let{callDurationCalculator:o}=this._room;o&&(e.statsToReport.uint32_audio_play_time=o.getDuration(t,N.AUDIO),e.statsToReport.uint32_video_play_time=o.getDuration(t,N.VIDEO)),e.statsToReport.uint32_video_render_first=Math.min(e.statsToReport.uint32_video_render_first,qs);let{badCaseDetector:c}=this._room,{dataFreeze:u,count:f}=c.getDataFreezeDuration(t),{renderFreeze:d}=c.getRenderFreezeDuration(t);e.statsToReport.uint32_video_block_count=f,e.statsToReport.uint32_video_block_time=Math.min(u,e.statsToReport.uint32_video_play_time),e.statsToReport.uint32_video_external_block_time=Math.min(d,e.statsToReport.uint32_video_play_time),c.isBlackStream(t)&&e.statsToReport.uint32_video_avg_fps===0?e.statsToReport.uint32_video_black_screen_subjective=1:e.statsToReport.uint32_video_black_screen_subjective=0,(e.subscribeStartTime===0||e.subscribeStartTime-e.streamAddedTime>100||e.playStreamTime===0)&&(this._pathMainAudioMap.delete(t),this._pathMainVideoMap.delete(t),e.statsToReport.uint32_video_render_first=0)}),this._pathMainAudioMap.forEach((e,t)=>{this.hasAudioFlag(e.userId)?e.statsToReport.uint64_play_first_frame_time-e.statsToReport.uint64_start_enter_time>qs&&(e.statsToReport.uint64_play_first_frame_time=e.statsToReport.uint64_start_enter_time+qs):this._pathMainAudioMap.delete(t)}),this._pathMainVideoMap.forEach((e,t)=>{this.hasVideoFlag(e.userId)?e.statsToReport.uint64_render_first_frame_time-e.statsToReport.uint64_start_enter_time>qs&&(e.statsToReport.uint64_render_first_frame_time=e.statsToReport.uint64_start_enter_time+qs):this._pathMainVideoMap.delete(t)}),this._pathJoinRoom.uint64_end_time-this._pathJoinRoom.uint64_start_time>qs&&(this._pathJoinRoom.uint64_end_time=this._pathJoinRoom.uint64_start_time+qs)}getReportData(){this._basicInfo.uint32_networkType=Kd();let e={uint32_sdk_app_id:Number(this._room.sdkAppId),msg_user_info:new l0({userId:this._room.userId,tinyId:this._room.tinyId,role:this._room.role==="anchor"?20:21}),msg_basic_info:this._basicInfo,uint32_acc_ip:Jd(this._signalInfo.relayIp),uint32_client_ip:Jd(this._signalInfo.clientIp,!1),uint32_acc_port:this._signalInfo.relayPort||0,uint64_timestamp:Date.now(),uint32_seq:Math.floor(Math.random()*I_(2,31)),msg_path_enter_room:this._pathJoinRoom,msg_path_exit_room:this._pathLeaveRoom,msg_path_recv_video:[...this._pathMainVideoMap.values()].map(t=>t.statsToReport),msg_quality_statistics:[...this._remoteStreamStatMap.values()].map(t=>t.statsToReport),str_room_name:String(this._room.roomId||0),msg_path_recv_audio:[...this._pathMainAudioMap.values()].map(t=>t.statsToReport),uint32_info_client_ip:Jd(this._signalInfo.clientIp,!1),error_code:[],msg_local_statistics:this._localStreamStat.statsToReport};return yg(e),e}report(){return B(this,null,function*(){try{this.prepareReport();let e=this.getReportData();yield this.upload(e),_a.deleteItem(this._storageKey),this.initData()}catch(e){this._log.warn(e)}})}upload(e){return B(this,null,function*(){if(Vs&&!aA||e.msg_path_enter_room.uint64_start_time===0||[D_,Mb,Lb].findIndex(u=>u===location.host)>=0)return;let t=Number(this._room.sdkAppId),i=yield Zb(e),r=i instanceof ArrayBuffer,o="".concat(Zc(t,Dc.KEY_POINT),"&gzip=").concat(+r),c=!1;navigator.sendBeacon&&(c=navigator.sendBeacon(o,i)),c||Fc({url:o,body:i}),this.uploadKVStat(et),this.uploadKVStat(ul)})}setConnectionType(e){this.connectionType=e,this._basicInfo.uint32_connection_type=e}uploadKVStat(e){return B(this,null,function*(){let t=e.getReportData();if(t.stats_count.length===0&&t.stats_distribution.length===0)return;t.msg_sdk_basic_info=qe(Oe({},t.msg_sdk_basic_info),{bytes_device_name:this._basicInfo.string_device_name||"",bytes_os_version:this._basicInfo.string_os_version||"",uint32_framework:this._frameWorkType,uint32_network_type:this._basicInfo.uint32_networkType||0}),this._log.debug(t);let i=yield Zb(t),r="".concat(Zc(+this._room.sdkAppId,Dc.KV_STAT),"&gzip=").concat(+(i instanceof ArrayBuffer)),o=!1;navigator.sendBeacon&&(o=navigator.sendBeacon(r,i)),o||Fc({url:r,body:i})})}};Ie([Rl({settings:{timeout:500,retries:3}})],XR.prototype,"upload");var qs=5e3,hF={msg_user_info:null,uint32_video_avg_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_avg_bitrate:0,uint32_video_block_time:0,uint32_video_play_time:0,uint32_audio_block_time:0,uint32_audio_play_time:0,uint32_audio_play_db:0,uint32_avg_down_loss:0,uint32_stream_type:0,uint32_video_render_first:0,uint32_video_block_count:0,uint32_audio_block_count:0,uint32_audio_bitrate:0,uint32_video_black_screen_subjective:0,uint32_audio_recv_bitrate:0,uint32_video_external_block_time:0,uint32_video_consume_render_rate:0},l0=class{constructor(e){this.str_identifier=String(e.userId),this.str_tinyid=String(e.tinyId||0),this.uint32_role=e.role}},pF=XR,Ih=class{constructor(){b(this,"_startTime"),b(this,"_endTime"),this._startTime=0,this._endTime=0,this.start()}start(){this._startTime===0&&(this._startTime=it())}stop(){this._endTime===0&&(this._endTime=it())}getDuration(){return this._endTime===0?it()-this._startTime:this._endTime-this._startTime}get endTime(){return this._endTime}},fF=class{constructor(e){b(this,"_room",null),b(this,"_durationMap"),b(this,"_eventMap",new Map),this._room=e.room,this._durationMap=new Map,this.installEvents()}installEvents(){this._eventMap.set(oe.SUBSCRIBE_SUCCESS,this.handleSubscribed).set(oe.UNSUBSCRIBE_SUCCESS,this.handleStreamStopped).set(oe.REMOTE_PUBLISH_STATE_CHANGED,e=>{let{room:t,prevMuteState:i,muteState:r}=e;var o;let{userId:c}=r;if(!this.hitTest(t))return;i.hasAudio&&!r.hasAudio&&this.stopDurationItem("".concat(c,"_","main"),N.AUDIO),i.hasVideo&&!r.hasVideo&&this.stopDurationItem("".concat(c,"_","main"),N.VIDEO),i.hasAuxiliary&&!r.hasAuxiliary&&this.stopDurationItem("".concat(c,"_","auxiliary"),N.VIDEO);let u=(o=this._room)==null?void 0:o.remotePublishedUserMap.get(c);!u||(!i.hasAudio&&r.hasAudio&&u.remoteAudioTrack.isSubscribed&&this.addDuractionItem(c,N.AUDIO,"main"),!i.hasVideo&&r.hasVideo&&u.remoteVideoTrack.isSubscribed&&this.addDuractionItem(c,N.VIDEO,"main"),!i.hasAuxiliary&&r.hasAuxiliary&&u.remoteAuxiliaryTrack.isSubscribed&&this.addDuractionItem(c,N.VIDEO,"auxiliary"))}),this._eventMap.forEach((e,t)=>pe.on(t,e,this))}uninstallEvents(){this._eventMap.forEach((e,t)=>pe.off(t,e,this)),this._eventMap.clear()}handleSubscribed(e){let{room:t,streamType:i,remotePublishedUser:r}=e;if(!this.hitTest(t))return;let{userId:o}=r,c="".concat(o,"_").concat(i);if(r.muteState.hasAudio&&i==="main")if(r.remoteAudioTrack.isSubscribed){let u=new Ih,f=this._durationMap.get(c);f?this.isRecording(f.audio)||f.audio.push(u):this._durationMap.set(c,{userId:o,type:i,audio:[u],video:[]})}else this.stopDurationItem(c,N.AUDIO);if(r.muteState.hasVideo||r.muteState.hasAuxiliary)if(r.remoteVideoTrack.isSubscribed||r.remoteAuxiliaryTrack.isSubscribed){let u=new Ih,f=this._durationMap.get(c);f?this.isRecording(f.video)||f.video.push(u):this._durationMap.set(c,{userId:o,type:i,audio:[],video:[u]})}else this.stopDurationItem(c,N.VIDEO)}handleStreamStopped(e){let{room:t,streamType:i,remotePublishedUser:r}=e;if(!this.hitTest(t))return;let{userId:o}=r,c="".concat(o,"_").concat(i);this.stopDurationItem(c,N.AUDIO),this.stopDurationItem(c,N.VIDEO)}isRecording(e){return e.findIndex(t=>t.endTime===0)>=0}addDuractionItem(e,t,i){let r="".concat(e,"_").concat(i),o=new Ih,c=this._durationMap.get(r);c?this.isRecording(c[t])||c[t].push(o):this._durationMap.set(r,{userId:e,type:i,audio:t===N.AUDIO?[o]:[],video:t===N.AUDIO?[]:[o]})}stopDurationItem(e,t){if(this._durationMap.has(e)){let i=this._durationMap.get(e)[t].find(r=>r.endTime===0);i&&i.stop()}}hitTest(e){return this._room===e}getDuration(e,t){return this._durationMap.has(e)?this._durationMap.get(e)[t].reduce((i,r)=>i+r.getDuration(),0):0}getDurationMap(){return this._durationMap}reset(){this._durationMap.clear()}destroy(){this._room=null,this.uninstallEvents()}},mF=class{constructor(e){b(this,"_room"),b(this,"_renderFreezeMap",new Map),b(this,"_isVideoPlayingEventFiredMap",new Map),b(this,"_dataFreezeMap",new Map),b(this,"_monitorFreezeData",new Map),b(this,"_eventMap",new Map),this._room=e.room,this.installEvents()}installEvents(){this._eventMap.set(oe.LEAVE_SUCCESS,e=>{let{room:t}=e;this.hitTest(t)&&this.stop()}).set(oe.PLAY_TRACK_START,this.onPlayTrackStart).set(oe.UNSUBSCRIBE_SUCCESS,e=>{let{room:t,streamType:i,remotePublishedUser:r}=e;if(!this.hitTest(t))return;let{userId:o}=r,c="".concat(o,"_").concat(i);this.stopDataFreeze({key:c,userId:o,type:i})}).set(oe.REMOTE_PUBLISH_STATE_CHANGED,e=>{let{room:t,prevMuteState:i,muteState:r}=e;if(!this.hitTest(t))return;let{userId:o}=r;if(i.hasVideo&&!r.hasVideo){let c="main",u="".concat(r.userId,"_").concat(c);this.stopDataFreeze({key:u,userId:o,type:c})}if(i.hasAuxiliary&&!r.hasAuxiliary){let c="auxiliary",u="".concat(r.userId,"_").concat(c);this.stopDataFreeze({key:u,userId:o,type:c})}}).set(oe.PLAYER_STATE_CHANGED,e=>{let{track:t,state:i,reason:r,type:o}=e;if(ma(t)&&this.hitTest(t.room)&&o===N.VIDEO){if(i==="PLAYING"){let c="".concat(t.userId,"_").concat(t.streamType);this._isVideoPlayingEventFiredMap.set(c,!0)}r===N.MUTE?this.onVideoTrackMuted(t):r===N.UNMUTE&&this.onVideoTrackUnmuted(t)}}).set(oe.HEARTBEAT_REPORT,this.onHearBeatReport),this._eventMap.forEach((e,t)=>pe.on(t,e,this))}uninstallEvents(){this._eventMap.forEach((e,t)=>pe.off(t,e,this)),this._eventMap.clear()}stop(){this._renderFreezeMap.clear(),this._dataFreezeMap.clear(),this._isVideoPlayingEventFiredMap.clear()}onVideoTrackMuted(e){if(!e.isSubscribed)return;let{userId:t,streamType:i}=e,r="".concat(t,"_").concat(i),o=this._dataFreezeMap.get(r),c=new Ih;o?o.durationItemList.push(c):this._dataFreezeMap.set(r,{userId:t,type:i,durationItemList:[c],isFreezing(){let u=this.durationItemList[this.durationItemList.length-1];return u&&u.endTime===0}})}onVideoTrackUnmuted(e){if(!e.isSubscribed)return;let{userId:t,streamType:i}=e,r="".concat(t,"_").concat(i);this.stopDataFreeze({key:r,userId:t,type:i})}onHearBeatReport(e){let{room:t,report:i}=e;!this.hitTest(t)||i.msg_down_stream_info.forEach(r=>{let o=this._room.remotePublishedUserMap.get(r.msg_user_info.str_identifier);if(!o)return;let{userId:c,muteState:u}=o;r.msg_video_status.forEach(f=>{f.uint32_video_stream_type===2&&u.hasVideo&&!u.videoMuted&&o.remoteVideoTrack.isSubscribed&&this.handleRenderFreeze({userId:c,fps:f.uint32_video_dec_fps,type:"main"}),f.uint32_video_stream_type===7&&u.hasAuxiliary&&o.remoteAuxiliaryTrack.isSubscribed&&this.handleRenderFreeze({userId:c,fps:f.uint32_video_dec_fps,type:"auxiliary"})})})}stopDataFreeze(e){let{key:t,userId:i,type:r}=e,o=this._dataFreezeMap.get(t);if(!o||!o.isFreezing())return;let c=o.durationItemList[o.durationItemList.length-1];c.stop();let u=c.getDuration();u>F_?this._monitorFreezeData.set(t,{userId:i,type:r,duration:u}):o.durationItemList.pop()}getTotalDuration(e){return e.reduce((t,i)=>{let r=i.getDuration();return t+Math.min(r,5e3)},0)}handleRenderFreeze(e){return B(this,arguments,function(t){var i=this;let{userId:r,fps:o,type:c}=t;return function*(){let u="".concat(r,"_").concat(c),f=i._renderFreezeMap.get(u);if(o<=2){let d=it();f&&!f.isFreeze&&(f.freezeTimeline.push({startTime:d,endTime:0}),f.isFreeze=!0),f||i._renderFreezeMap.set(u,{userId:r,type:c,isFreeze:!0,freezeTimeline:[{startTime:d,endTime:0}],renderFreezeTotal:0})}else if(f&&f.isFreeze){f.isFreeze=!1;let d=f.freezeTimeline.pop();if(d){d.endTime=it();let _=d.endTime-d.startTime;f.freezeTimeline.push(d),f.renderFreezeTotal+=Math.min(5e3,_)}}}()})}onPlayTrackStart(e){let{track:t}=e;if(!ma(t)||!this.hitTest(t.room)||t.kind!==N.VIDEO||t.hasFlag)return;let i="".concat(t.userId,"_").concat(t.streamType);this._isVideoPlayingEventFiredMap.has(i)||this._isVideoPlayingEventFiredMap.set(i,!1)}getDataFreezeDuration(e){let t={dataFreeze:0,count:0},i=this._dataFreezeMap.get(e);if(i){if(i.isFreezing()){let r=i.durationItemList[i.durationItemList.length-1];r.stop(),r.getDuration()<F_&&i.durationItemList.pop()}t.dataFreeze=this.getTotalDuration(i.durationItemList),t.count=i.durationItemList.length}return t}getRenderFreezeDuration(e){let t=this._renderFreezeMap.get(e),i=0,r=0;if(t)if(t.isFreeze){let o=it()-t.freezeTimeline[t.freezeTimeline.length-1].startTime;i=t.renderFreezeTotal+Math.min(o,5e3),r=t.freezeTimeline.length}else i=t.renderFreezeTotal;return{renderFreeze:i,count:r}}getMonitorFreeze(){return this._monitorFreezeData}isBlackStream(e){return!!this._isVideoPlayingEventFiredMap.has(e)&&!this._isVideoPlayingEventFiredMap.get(e)}resetMonitor(){this._monitorFreezeData.clear()}hitTest(e){return e===this._room}destroy(){this.uninstallEvents()}},_F=ni(Di(),1),gF=[-1,-1,1,-1,-1,1,1,1],vF=[0,0,1,0,0,1,1,1],Xs=class extends Ze{constructor(e,t){if(super(),this.context=e,b(this,"name"),b(this,"input"),b(this,"output"),b(this,"texture"),b(this,"image"),b(this,"ctx2d",null),b(this,"fbo"),b(this,"width",0),b(this,"height",0),b(this,"x",0),b(this,"y",0),b(this,"program"),b(this,"vertexShader"),b(this,"fragmentShader"),b(this,"totalFrames",0),b(this,"dropFrames",0),b(this,"matchInputSize",!0),b(this,"texCoordBuffer"),b(this,"positionBuffer"),b(this,"lastInfo",{name:"",timestamp:0,totalFrames:0,x:0,y:0,width:0,height:0,fps:0}),b(this,"cost",0),b(this,"_canvas",null),this.context.on("disconnect",this.close,this),this.name=t.name,this.matchInputSize=t.matchInputSize!==!1,this.width=t.width||e.width,this.height=t.height||e.height,e instanceof Qr){if(e.ctx&&t.create2d){let i=document.createElement("canvas"),r=typeof i.transferControlToOffscreen=="function"?i.transferControlToOffscreen():i;r.width=this.width,r.height=this.height,this.ctx2d=r.getContext("2d"),this.image=r,this._canvas=r}}else try{let i=e.ctx;this.texCoordBuffer=this.createBuffer(vF),this.positionBuffer=this.createBuffer(gF),t.createTexture!==!1&&(this.texture=i.createTexture(),this.useTexture(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.PACK_ALIGNMENT,1),i.pixelStorei(i.UNPACK_ALIGNMENT,1)),t.useFbo&&(this.fbo=i.createFramebuffer(),this.useBufferFrame(),this.useTexture(),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0)),t.useDefaultProgram?this.program=e.defaultProgam:(t.vertexShaderSource||t.fragmentShaderSource)&&(this.vertexShader=t.vertexShaderSource?e.createShader(i.VERTEX_SHADER,t.vertexShaderSource):e.defaultVShader,this.fragmentShader=t.fragmentShaderSource?e.createShader(i.FRAGMENT_SHADER,t.fragmentShaderSource):e.defaultFShader,this.program=e.createProgram(this.vertexShader,this.fragmentShader))}catch(i){this.context.destroy(i)}}createFramebuffer(e){let t=this.context.ctx,i=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),i}connect(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return e.addInput(this,...i),this.output=e,e}addInput(e){this.input=e,this.matchInputSize&&e.width&&e.height&&this.resize(e.width,e.height)}requestFrame(e){let t=Date.now();return!!(this.context instanceof Nn&&this.render(e)||this.context instanceof Qr&&this.render2d(e))&&(this.totalFrames++,this.cost=Date.now()-t,!0)}render2d(e){var t;return!((t=this.input)==null||!t.requestFrame(e))&&this.draw2d(this.input.image,0,0,this.width,this.height)}disconnect(){for(var e,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];(e=this.output)==null||e.removeInput(this,...i),delete this.output}removeInput(e){delete this.input}close(){var e,t;if(this.context.off("disconnect",this.close,this),(e=this.output)==null||e.removeInput(this),delete this.output,(t=this.input)==null||t.disconnect(),this.context instanceof Nn){let i=this.context.ctx;i.deleteBuffer(this.texCoordBuffer),i.deleteBuffer(this.positionBuffer),this.fbo&&i.deleteFramebuffer(this.fbo),this.texture&&i.deleteTexture(this.texture),this.vertexShader&&this.vertexShader!==this.context.defaultVShader&&i.deleteShader(this.vertexShader),this.fragmentShader&&this.fragmentShader!==this.context.defaultFShader&&i.deleteShader(this.fragmentShader),this.program&&this.program!==this.context.defaultProgam&&i.deleteProgram(this.program)}this._canvas&&(this._canvas.width=0,this._canvas.height=0,this.ctx2d=null),this.removeAllListeners()}useTexture(){this.useTextures(this.texture)}useInputTexture(){var e;this.useTextures((e=this.input)==null?void 0:e.texture)}useTextures(){let e=this.context.ctx;for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach((o,c)=>{o&&(e.activeTexture(e.TEXTURE0+c),e.bindTexture(e.TEXTURE_2D,o))})}useProgram(){this.context.ctx.useProgram(this.program)}useBufferFrame(){let e=this.context.ctx;e.bindFramebuffer(e.FRAMEBUFFER,this.fbo||null)}createBuffer(e){let t=this.context.ctx,i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),i}setTexBuffer(e){let t=this.context.ctx;t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}setPosBuffer(e){let t=this.context.ctx;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}changeBufferData(e,t){let i=this.context.ctx;i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW)}setAttributes(){let e=this.context.ctx;for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach((o,c)=>{e.enableVertexAttribArray(c),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0)})}getVertexPoint(e,t){return[e/this.width*2-1,t/this.height*2-1]}layout2texCoords(e){return[...this.getVertexPoint(e.x,e.y),...this.getVertexPoint(e.x+e.width,e.y),...this.getVertexPoint(e.x,e.y+e.height),...this.getVertexPoint(e.x+e.width,e.y+e.height)]}resize(e,t){if(this.width!==e||this.height!==t){if(this.width=e,this.height=t,this._canvas&&(this._canvas.width=e,this._canvas.height=t),this.texture&&this.fbo){this.useTexture();let i=this.context.ctx;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null)}this.output&&this.output.matchInputSize&&this.output.resize(e,t)}}draw(e,t){this.setAttributes(e||this.positionBuffer,t||this.texCoordBuffer);let i=this.context.ctx;i.drawArrays(i.TRIANGLE_STRIP,0,4)}draw2d(e,t,i,r,o){return!(!this.ctx2d||!e)&&(e instanceof ImageData?this.ctx2d.putImageData(e,t,i):this.ctx2d.drawImage(e,t,i,r,o),!0)}getInfo(){var e;let{totalFrames:t,x:i,y:r,width:o,height:c,name:u,cost:f}=this,d=Date.now(),_=(t-this.lastInfo.totalFrames)/((d-this.lastInfo.timestamp)/1e3)|0;return this.lastInfo={totalFrames:t,x:i,y:r,width:o,height:c,timestamp:d,fps:_,name:u,cost:f},Oe({parent:(e=this.input)==null?void 0:e.getInfo()},this.lastInfo)}createTexture(e){let t=this.context.ctx,i=t.createTexture();return this.useTextures(i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i}};Ie([si(Ze.INIT,"connected",{sync:!0})],Xs.prototype,"connect"),Ie([si("connected",Ze.INIT,{ignoreError:!0,sync:!0})],Xs.prototype,"disconnect"),Ie([si([],"closed",{sync:!0})],Xs.prototype,"close");var yF=[0,1,1,1,0,0,1,0],QR=class extends Xs{constructor(e,t){super(e,Object.assign({useDefaultProgram:!0,createTexture:!1,name:"destination"},t)),b(this,"_intervalId",0),b(this,"_sequence",0),b(this,"checkGLError",!1),e instanceof Qr?this.ctx2d=e.ctx:e.available&&(t!=null&&t.mirrorUpAndDown)&&this.setTexBuffer(yF)}start(e){this._intervalId=Dt.run("intervalInWorker",()=>{if(e!==this.context.frameRate&&(Dt.clearTask(this._intervalId),this.start(this.context.frameRate)),this.requestFrame(this._sequence++),this.checkGLError&&this.context instanceof Nn){let t=this.context.ctx.getError();t&&this.context.destroy(new Error("".concat(this.name," req ").concat(this._sequence," render ").concat(this.totalFrames," faild ").concat(t)))}},{fps:this.context.frameRate})}render(e){var t;return!((t=this.input)==null||!t.requestFrame(e))&&(this.useProgram(),this.useBufferFrame(),this.useInputTexture(),this.draw(),!0)}addInput(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];super.addInput(e,...i),this.start(this.context.frameRate)}removeInput(e){super.removeInput(e),Dt.clearTask(this._intervalId)}resize(e,t){super.resize(e,t),this.context.setSize(e,t)}},u0=class extends QR{constructor(e,t){super(e,t),b(this,"_videoTrack"),[this._videoTrack]=e._canvas.captureStream(e.frameRate).getVideoTracks();let i=r=>{var o;let c=()=>{var f;return(f=this._videoTrack)==null?void 0:f.removeEventListener(r,u)},u=()=>{c(),this.context.destroy(new Error("video track ".concat(r)))};this.once("closed",c),(o=this._videoTrack)==null||o.addEventListener(r,u)};e instanceof Nn&&i("mute"),i("ended")}get videoTrack(){return this._videoTrack}close(){var e;super.close(),(e=this._videoTrack)==null||e.stop(),delete this._videoTrack}},EF=class extends u0{render(e){var t;return!((t=this.input)==null||!t.requestFrame(e))}},TF=class extends u0{constructor(e,t){super(e,{name:"smallDestination"}),this.resolution=t}resize(e,t){let i,r=e*t,o=this.resolution.width*this.resolution.height;Te.info("big res: ".concat(e,"*").concat(t," small res: ").concat(this.resolution.width,"*").concat(this.resolution.height," ")),r>o?i=r/o:(Te.warn("Small stream resolution is not smaller than big stream, which is invalid. big: ".concat(e," * ").concat(t," small: ").concat(this.resolution.width," * ").concat(this.resolution.height)),i=r/19200),super.resize(e/Math.sqrt(i),t/Math.sqrt(i))}},ZR=class extends Xs{constructor(e,t,i){super(e,Oe({name:"imageSource"},i)),this.image=t,b(this,"_image"),b(this,"_totalFrames",0),b(this,"_autoResize",!1),this._autoResize=(i==null?void 0:i.autoResize)!==!1}_render(e,t){let{width:i,height:r}=this;if(this.image instanceof HTMLVideoElement){if(Tt(this.image.getVideoPlaybackQuality)&&!qc){let o=this.image.getVideoPlaybackQuality().totalVideoFrames;if(this._totalFrames===o)return!1;this._totalFrames=o,this.dropFrames=this._totalFrames-this.totalFrames}if({videoWidth:i,videoHeight:r}=this.image,!i||!r)return!1;this.image.width=i,this.image.height=r}else if(this.image instanceof HTMLImageElement||this.image instanceof ImageData||this.image instanceof ImageBitmap){if({width:i,height:r}=this.image,this.image!==this._image)this._image=this.image;else if(i===this.width&&r===this.height)return!1}else(this.image instanceof HTMLCanvasElement||this.image instanceof OffscreenCanvas)&&({width:i,height:r}=this.image,this._image=this.image);if(!this._autoResize)return!0;if(this.width===i&&this.height===r&&this.totalFrames){if(t){this.useTexture();let o=this.context.ctx;o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.image)}}else{if(t){this.useTexture();let o=this.context.ctx;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this.image)}this.resize(i,r)}return!0}render(e){return this._render(e,!0)}render2d(e){return this._render(e,!1)}},$R=class extends ZR{constructor(e,t,i){let r=document.createElement("video");r.setAttribute("playsinline","playsinline"),r.setAttribute("muted",""),super(e,r,i),this._videoTrack=t,b(this,"_mediaStream"),this.name="videoTrackSource",this._mediaStream=new MediaStream([t]),this.image.srcObject=this._mediaStream,this.image.play()}replaceTrack(e){var t,i;this._videoTrack!==e&&((t=this._mediaStream)==null||t.removeTrack(this._videoTrack),this._videoTrack=e,(i=this._mediaStream)==null||i.addTrack(this._videoTrack),this.image.play())}close(){var e;super.close(),(e=this._mediaStream)==null||e.removeTrack(this._videoTrack),delete this._mediaStream,this.image.srcObject=null}},eC=class extends Ze{constructor(e){super(),b(this,"frameRate"),b(this,"_canvas"),b(this,"log"),b(this,"hasAlpha",!1),b(this,"name"),this.name=e.name,this.log=e.logger.createChild({id:"vc-".concat(this.name)}),this.frameRate=e.frameRate}set width(e){this._canvas&&(this._canvas.width=e)}get width(){var e;return((e=this._canvas)==null?void 0:e.width)||0}set height(e){this._canvas&&(this._canvas.height=e)}get height(){var e;return((e=this._canvas)==null?void 0:e.height)||0}setSize(e,t){this._canvas&&(this._canvas.width=e,this._canvas.height=t)}createVideoTrackSource(e){return new $R(this,e)}createVideoTrackDestination(e){return new u0(this,e)}createVideoImageSource(e,t){return new ZR(this,e,t)}get available(){return this.state==="created"}disconnect(){this.emit("disconnect")}},SF={alpha:!0,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0,powerPreference:"low-power"},Nn=class extends eC{constructor(){super(...arguments),b(this,"defaultProgam"),b(this,"defaultVShader"),b(this,"defaultFShader"),b(this,"ctx")}create(){if(this._canvas||(this._canvas=document.createElement("canvas")),this.ctx=this._canvas.getContext("webgl2",SF),!this.ctx)throw new Error("webgl2 not supported");this.defaultVShader=this.createShader(this.ctx.VERTEX_SHADER,`
// 
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoord;

void main() {
  gl_Position = a_position;
  v_texCoord = a_texCoord;
}
`),this.defaultFShader=this.createShader(this.ctx.FRAGMENT_SHADER,`
// 
precision mediump float;
varying vec2 v_texCoord;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, v_texCoord);
} `),this.defaultProgam=this.createProgram(this.defaultVShader,this.defaultFShader),this._canvas.addEventListener("webglcontextlost",()=>{this.destroy(new Error("webgl context lost"))}),this.log.info("video context created use webgl")}destroy(e){return this.disconnect(),this.log.info("video context destroy ".concat(e?": ".concat(e):"")),this.ctx&&(this.ctx.deleteShader(this.defaultVShader),this.ctx.deleteShader(this.defaultFShader),this.ctx.deleteProgram(this.defaultProgam),delete this.ctx),e}set width(e){var t;(t=this.ctx)==null||t.viewport(0,0,e,this.height),super.width=e}set height(e){var t;(t=this.ctx)==null||t.viewport(0,0,this.width,e),super.height=e}setSize(e,t){var i;(i=this.ctx)==null||i.viewport(0,0,e,t),super.setSize(e,t)}createShader(e,t){let i=this.ctx,r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}createProgram(e,t){let i=this.ctx,r=i.createProgram();return i.attachShader(r,e),i.attachShader(r,t),i.linkProgram(r),i.getProgramParameter(r,i.LINK_STATUS)||this.log.error(i.getProgramInfoLog(r)),r}};Ie([si(Ze.INIT,"created",{sync:!0})],Nn.prototype,"create"),Ie([si("created",Ze.INIT,{ignoreError:!0,sync:!0,success(e){e&&this.emit("unavailable",e),this.removeAllListeners()}})],Nn.prototype,"destroy");var Qr=class extends eC{constructor(){super(...arguments),b(this,"ctx")}create(e){if(this.hasAlpha=e.alpha,this._canvas=document.createElement("canvas"),this.ctx=this._canvas.getContext("2d",{alpha:e.alpha}),!this.ctx)throw new Error("2d context not supported");this.log.info("video context created use 2d")}destroy(e){this.disconnect(),this.log.info("video context destroy ".concat(e?": ".concat(e):"")),delete this.ctx,this._canvas&&(this._canvas.remove(),this._canvas.width=0,this._canvas.height=0,delete this._canvas),this.removeAllListeners()}};Ie([si(Ze.INIT,"created",{sync:!0})],Qr.prototype,"create"),Ie([si("created",Ze.INIT,{ignoreError:!0,sync:!0})],Qr.prototype,"destroy");var IF=[1,0,0,0,1,1,0,1],bF=class extends Xs{constructor(e){if(super(e,{useDefaultProgram:!0,useFbo:!0,create2d:!0,name:"mirror"}),e instanceof Nn)try{this.setTexBuffer(IF)}catch(t){e.destroy(t)}}draw2d(e,t,i,r,o){if(this.ctx2d){this.ctx2d.save(),this.ctx2d.scale(-1,1),this.ctx2d.translate(-this.width,0);let c=super.draw2d(e,t,i,r,o);return this.ctx2d.restore(),c}return!1}render(e){var t;return!((t=this.input)==null||!t.requestFrame(e))&&(this.useProgram(),this.useBufferFrame(),this.useInputTexture(),this.draw(),!0)}},AF=class{constructor(e,t){this.node=e,this.layout=t,b(this,"positionBuffer")}get x(){return this.layout.x||this.node.x}get y(){return this.layout.y||this.node.y}get width(){return this.layout.width||this.node.width}get height(){return this.layout.height||this.node.height}get right(){return this.x+this.width}get bottom(){return this.y+this.height}},RF=class extends Xs{constructor(e){super(e,{useDefaultProgram:!0,useFbo:!0,name:"mix",create2d:!0}),b(this,"inputs",[])}addInput(e,t){if(this.inputs[t.zIndex])throw new Error("input already exists");let i=new AF(e,t);this.inputs[t.zIndex]=i}resize(e,t){let i=this.inputs.reduce((r,o)=>o?Object.assign(r,{width:Math.max(r.width,o.right),height:Math.max(r.height,o.bottom)}):r,{width:0,height:0});super.resize(i.width,i.height),this.context instanceof Nn&&this.inputs.forEach(r=>{if(r){let o=this.layout2texCoords(r);r.positionBuffer?this.changeBufferData(r.positionBuffer,o):r.positionBuffer=this.createBuffer(o)}})}connect(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return super.connect(e,...i),this.resize(0,0),e}removeInput(e){this.inputs[this.inputs.findIndex(t=>(t==null?void 0:t.node)===e)]=void 0}render(e){let t=this.context.ctx;if(t.clearColor(0,0,0,0),!this.inputs.reduce((i,r)=>(!r||!r.node.requestFrame(e))&&i,!0)&&t){this.useProgram(),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.useBufferFrame();for(let i=0;i<this.inputs.length;i++){let r=this.inputs[i];r&&(r.node.useTexture(),this.draw(r.positionBuffer))}return!0}return!1}render2d(e){if(!this.inputs.reduce((t,i)=>(!i||!i.node.requestFrame(e))&&t,!0)&&this.ctx2d){this.ctx2d.clearRect(0,0,this.width,this.height);for(let t=0;t<this.inputs.length;t++){let i=this.inputs[t];i&&this.draw2d(i.node.image,i.x,i.y,i.width,i.height)}return!0}return!1}getInfo(){let{totalFrames:e,x:t,y:i,width:r,height:o,name:c}=this,u=Date.now(),f=(e-this.lastInfo.totalFrames)/((u-this.lastInfo.timestamp)/1e3)|0;return this.lastInfo={totalFrames:e,x:t,y:i,width:r,height:o,timestamp:u,fps:f,name:c},Oe({parent:this.inputs.filter(d=>d).map(d=>d.node.getInfo())},this.lastInfo)}close(){super.close(),this.inputs.forEach(e=>{var t,i;if(e&&((t=e.node)==null||t.disconnect(),e.positionBuffer&&this.context instanceof Nn))try{(i=this.context.ctx)==null||i.deleteBuffer(e.positionBuffer)}catch{}})}},CF=class extends $R{constructor(e,t){super(e,t.input,{name:"vb",create2d:!1,useDefaultProgram:!1,useFbo:!1,createTexture:!0}),b(this,"ready",!1),b(this,"_bgTexture"),b(this,"_waterMarkTexture"),b(this,"_lastMaskTexture"),b(this,"_lastMaskFbo"),b(this,"_textureValid",!1),b(this,"_selfieTextureValid",!1),b(this,"_selfieSegmentation"),b(this,"wasm"),b(this,"_prePrograme"),b(this,"_segmentationMask"),b(this,"_weixin",!1),this._selfieSegmentation=t.selfieSegmentation,this._selfieSegmentation.onResults=this.onPredict.bind(this),this.init(t).catch(()=>this.context.destroy(new Error("selfie_segmentation init faild")))}init(e){return B(this,null,function*(){let t=e.Wasm,i=this.context.ctx;if(this.wasm=new t.AllIn1(i),this.wasm.blurRadius=e.blurRadius||3,this.wasm.mirror=!!e.mirror,this.wasm.vbMode=e.bg==="blur"?1:e.bg instanceof HTMLImageElement?2:e.bg==="green"?3:0,e.waterMark){let{x:r,y:o,width:c,height:u}=e.waterMark;this.wasm.setWaterMark(r,o,c,u)}if(this.program=this.wasm.init(),this.useProgram(),this.setAttributes(this.positionBuffer,this.texCoordBuffer),i.uniform1i(i.getUniformLocation(this.program,"mask"),1),e.bg instanceof HTMLImageElement&&(i.uniform1i(i.getUniformLocation(this.program,"bg"),2),this._bgTexture=this.createTexture(e.bg)),e.waterMark&&(i.uniform1i(i.getUniformLocation(this.program,"waterMark"),3),this._waterMarkTexture=this.createTexture(e.waterMark.image)),i.uniform1i(i.getUniformLocation(this.program,"lastMask"),4),this._weixin){let r=this.context.createShader(i.FRAGMENT_SHADER,`#version 300 es
precision highp float;
uniform sampler2D u_texture;
uniform sampler2D mask;

in vec2 v_texCoord;
out vec4 outColor;
void main() {
  outColor = vec4(texture(u_texture, v_texCoord).rgb, texture(mask, v_texCoord).a);
}`),o=this.context.createShader(i.VERTEX_SHADER,`#version 300 es
in vec2 a_position;
in vec2 a_texCoord;
out vec2 v_texCoord;
void main() {
  gl_Position = vec4(a_position.x, a_position.y, 0, 1);
  v_texCoord = a_texCoord;
}`);this._prePrograme=this.context.createProgram(o,r),i.useProgram(this._prePrograme),this.setAttributes(this.positionBuffer,this.texCoordBuffer),i.uniform1i(i.getUniformLocation(this._prePrograme,"mask"),1)}this.ready=!0})}onPredict(e){let t=this.context.ctx;this._weixin&&(this._lastMaskTexture||(this._lastMaskTexture=this.createTexture(this.image),this._lastMaskFbo=this.createFramebuffer(this._lastMaskTexture))),this.useProgram(),this._weixin?this.useTexture():this._selfieSegmentation.bindTexture(),t.activeTexture(t.TEXTURE1),this._selfieSegmentation.bindTexture2d(e),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this._bgTexture||null),t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,this._waterMarkTexture||null),this.useBufferFrame(),t.drawArrays(t.TRIANGLE_STRIP,0,4),this._segmentationMask=e,this.totalFrames++}render(e){let t=this.context.ctx;if(typeof this.image.getVideoPlaybackQuality=="function"&&!qc){let c=this.image.getVideoPlaybackQuality().totalVideoFrames;if(this._totalFrames===c)return!1;this._totalFrames=c,this.dropFrames=this._totalFrames-this.totalFrames}let{videoWidth:i,videoHeight:r}=this.image;this.image.width=i,this.image.height=r;let o=!1;if(this.totalFrames)this._weixin?this.useTexture():this._selfieSegmentation.bindTexture(),o=this._selfieTextureValid,this._selfieTextureValid=!0;else{if(!this.program)return!1;this.useTexture(),o=this._textureValid,this._textureValid=!0}return this.width===i&&this.height===r&&o?t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.image):(this.resize(i,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image)),this.ready&&(this._weixin&&(t.useProgram(this._prePrograme),this.useTexture(),this._segmentationMask&&(t.activeTexture(t.TEXTURE1),this._selfieSegmentation.bindTexture2d(this._segmentationMask),t.bindFramebuffer(t.FRAMEBUFFER,this._lastMaskFbo||null)),t.drawArrays(t.TRIANGLE_STRIP,0,4),this._selfieSegmentation.bindTexture(),this._segmentationMask?t.copyTexSubImage2D(t.TEXTURE_2D,0,0,0,0,0,i,r):t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,i,r,0)),this._selfieSegmentation.send(i,r)),this.totalFrames||(t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this._bgTexture||null),t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,this._waterMarkTexture||null),t.drawArrays(t.TRIANGLE_STRIP,0,4)),!1}close(){var e;super.close();let t=this.context.ctx;this._bgTexture&&t.deleteTexture(this._bgTexture),this._waterMarkTexture&&t.deleteTexture(this._waterMarkTexture),this._lastMaskTexture&&t.deleteTexture(this._lastMaskTexture),this._lastMaskFbo&&t.deleteFramebuffer(this._lastMaskFbo),this._prePrograme&&t.deleteProgram(this._prePrograme),(e=this.wasm)==null||e.close()}},wF=class extends _F.EventEmitter{constructor(e){super(),this.room=e,b(this,"videoContext"),b(this,"_glVideoContext"),b(this,"_2dVideoContext"),b(this,"destination"),b(this,"smallVideoContext"),b(this,"smallDestination"),b(this,"smallTrackSource"),b(this,"smallImageSource"),b(this,"_isMirror",!1),b(this,"cameraTrack"),b(this,"cameraNode"),b(this,"mirrorNode"),b(this,"mixNode"),b(this,"screenTrack"),b(this,"screenNode"),b(this,"selfModel",!1),b(this,"blurRadius",3),b(this,"arTrack"),b(this,"Wasm"),b(this,"waterMarkNode"),b(this,"_waterMarkOption"),b(this,"watermarkImageList",[]),b(this,"_isMixScreen",!1),b(this,"_virtualBackground"),b(this,"virtualBackgroundInstance"),b(this,"isUsingArTrack",!1),b(this,"_bgAssetPath"),b(this,"log",Te.createLogger({id:"vm"})),b(this,"_checkId",0),b(this,"_use2d",!1),b(this,"_autoSwitchRenderMode",!0),b(this,"_selfieSegmentation"),e&&(this.log.setUserId(e.userId),this.log.setSdkAppId(e.sdkAppId)),this.smallVideoContext=new Qr({frameRate:15,logger:this.log,name:"s"}),this.enablePrintDetail()}get _hasVirtualBg(){return!!this._virtualBackground}get _hasWaterMark(){return this.watermarkImageList.length>0}get renderMode(){return this._autoSwitchRenderMode?"auto":this._use2d?"2d":"webgl"}set renderMode(e){if(this._autoSwitchRenderMode=e==="auto",this._autoSwitchRenderMode)return;let t=e==="2d";this._use2d!==t&&(this._use2d=t,this.clear(),this.videoContext=this._use2d?this.get2dVideoContext():this.getGlVideoContext(),this.update())}get2dVideoContext(){return this._2dVideoContext?this._2dVideoContext.destroy():this._2dVideoContext=new Qr({frameRate:15,logger:this.log,name:"m"}),this._2dVideoContext.create({alpha:this._hasWaterMark||this._hasVirtualBg}),this.sendCreateResult("videoCtx2d",this._2dVideoContext.ctx?void 0:new Error("create 2d context failed")),this._2dVideoContext}getGlVideoContext(){if(this._glVideoContext){if(this._glVideoContext.available)return this._glVideoContext}else this._glVideoContext=new Nn({frameRate:15,logger:this.log,name:"m"});try{this._glVideoContext.create(),this.sendCreateResult(),this._glVideoContext.on("unavailable",(e,t)=>{this.emit("error",{reason:e,error:t}),this.log.warn("video context unavailable",e,t),this.sendCreateResult("videoCtxGl",t||new Error(e)),this.update()})}catch(e){this.emit("error",{reason:"create",error:e}),this.sendCreateResult("videoCtxGl",e)}return this._glVideoContext}enablePrintDetail(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2e3;this._checkId=Dt.run(Od,()=>{this.destination&&this.log.debug(this.destination.getInfo())},{delay:e})}destroy(){var e,t;(e=this._2dVideoContext)==null||e.destroy(),(t=this._glVideoContext)==null||t.destroy(),this.smallVideoContext.destroy(),Dt.clearTask(this._checkId)}get needAlpha(){return this._hasWaterMark||this._hasVirtualBg}get active(){return(qc||this._isMixScreen||this._isMirror||this._hasWaterMark||this._hasVirtualBg)&&this.checkOrCreateVideoContext()}sendCreateResult(){let e=arguments.length>1?arguments[1]:void 0,t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"videoCtxGl")==="videoCtxGl"?512700:512701;e?et.addFailedEvent({key:t,error:e}):et.addSuccessEvent({key:t})}checkOrCreateVideoContext(){let e=this._use2d;if(this._autoSwitchRenderMode&&(this._use2d=!this._hasVirtualBg),this.videoContext)if(this.videoContext.available){let t=!this.videoContext.hasAlpha&&this.needAlpha;if(this._autoSwitchRenderMode&&e===this._hasVirtualBg)this.clear();else{if(!t||!this._use2d)return!0;this.clear()}}else this.clear(),this._use2d=!0;return this.videoContext=this._use2d?this.get2dVideoContext():this.getGlVideoContext(),this.videoContext.available}get smallTrack(){var e;return(e=this.smallDestination)==null?void 0:e.videoTrack}get hasSmall(){return!!this.smallTrack}get initialTrack(){var e;return(e=this.cameraTrack)==null?void 0:e.mediaTrack}initVirtualBackground(e){return this._selfieSegmentation=e,this._selfieSegmentation.changeModel()}_setMainOutput(e){var t;let i=this.cameraTrack,{small:r,settings:o,player:c}=i;r?(this.smallVideoContext.available||(this.smallVideoContext.create({alpha:!1}),this.smallDestination=new TF(this.smallVideoContext,r)),this.smallVideoContext.frameRate=r.frameRate,this.smallDestination.resolution=r,e?(this.smallTrackSource&&(this.smallTrackSource.close(),delete this.smallTrackSource),this.smallImageSource?this.smallImageSource.image=e:(this.smallImageSource=this.smallVideoContext.createVideoImageSource(e),this.smallImageSource.connect(this.smallDestination))):(this.smallImageSource&&(this.smallImageSource.close(),delete this.smallImageSource),this.smallTrackSource?this.smallTrackSource.replaceTrack(this.initialTrack):(this.smallTrackSource=this.smallVideoContext.createVideoTrackSource(this.initialTrack),this.smallTrackSource.width=o.width,this.smallTrackSource.height=o.height,this.smallTrackSource.connect(this.smallDestination)))):this.smallVideoContext.available&&(this.smallVideoContext.destroy(),delete this.smallDestination,delete this.smallTrackSource,delete this.smallImageSource),qc&&c.setCanvas(e);let u=e&&((t=this.destination)==null?void 0:t.videoTrack)||this.initialTrack;return this.isUsingArTrack&&this.arTrack&&(this.emit("output-track-changed"),u=this.arTrack),this._selfieSegmentation&&e&&(this._selfieSegmentation._glName||this._selfieSegmentation.setCanvas(e)),i.setOutputMediaStreamTrack(u)}update(){return B(this,null,function*(){var e,t;if(!this.cameraTrack||!this.cameraTrack.mediaTrack)return;if(!this.active)return this.cameraNode&&this.clear(),this._setMainOutput();let{settings:i,profile:r}=this.cameraTrack;if(this._use2d||!this._selfieSegmentation?(this.destination||(this.destination=this.videoContext.createVideoTrackDestination({name:"mainDestination"})),this.cameraNode?this.cameraNode.replaceTrack(this.initialTrack):(this.cameraNode=this.videoContext.createVideoTrackSource(this.initialTrack),this.cameraNode.resize(i.width,i.height))):(this.cameraNode&&this.cameraNode.close(),this.destination||(this.destination=new EF(this.videoContext,{name:"mainDestination"})),this.cameraNode=new CF(this.videoContext,{input:this.cameraTrack.mediaTrack,mirror:this._isMirror,bg:this._virtualBackground,selfModel:this.selfModel,waterMark:this._waterMarkOption,useTflite:!0,blurRadius:this.blurRadius,assetPath:this._bgAssetPath,selfieSegmentation:this._selfieSegmentation,Wasm:this.Wasm}),this.cameraNode.connect(this.destination)),this.videoContext.frameRate=r.frameRate,this._use2d){let o=this.cameraNode;o.disconnect(),this._isMirror&&(this.mirrorNode||(this.mirrorNode=new bF(this.videoContext)),o=o.connect(this.mirrorNode),o.disconnect(),this.log.info("start mirror")),this.mixNode&&this.mixNode.close(),delete this.mixNode,(this._isMixScreen||this._hasWaterMark)&&(this.mixNode=new RF(this.videoContext),o.connect(this.mixNode,{zIndex:1}),this._hasWaterMark&&!this.waterMarkNode&&this._waterMarkOption&&(this.waterMarkNode=this.videoContext.createVideoImageSource(this._waterMarkOption.image,{autoResize:!1}),this.waterMarkNode.resize(this._waterMarkOption.width,this._waterMarkOption.height),this.waterMarkNode.x=this._waterMarkOption.x,this.waterMarkNode.y=this._waterMarkOption.y),(e=this.waterMarkNode)==null||e.connect(this.mixNode,{zIndex:2}),this._isMixScreen&&this.screenTrack&&!this.screenNode&&(this.screenNode=this.videoContext.createVideoTrackSource(this.screenTrack.mediaTrack)),(t=this.screenNode)==null||t.connect(this.mixNode,{zIndex:0}),o=this.mixNode,this.log.info("start mix","".concat(this.mixNode.width,"x").concat(this.mixNode.height))),o.connect(this.destination)}return this._setMainOutput(this.videoContext._canvas)})}changeInput(e){if(this.log.info("change input"),e instanceof zs)return this.setScreenTrack(e);if(e instanceof Mi)return this.setCameraTrack(e);if(e instanceof ml){let t=e.mediaTrack;if(lg===17&&+Ur.split(".")[1]<4&&!e.source&&e.player.element){let i=new Qr({frameRate:15,logger:this.log,name:e.userId});i.create({alpha:!1});let r=i.createVideoImageSource(e.player.element);e.source=r;let o=new QR(i);r.connect(o),e.player.setCanvas(i._canvas)}return e.setOutputMediaStreamTrack(t)}}removeInput(e){var t;e instanceof zs?((t=this.screenNode)==null||t.close(),delete this.screenNode,delete this.screenTrack,this.update()):e instanceof Mi?(this.clear(),delete this.cameraTrack,this.smallImageSource&&(this.smallImageSource.close(),delete this.smallImageSource),this.smallTrackSource&&(this.smallTrackSource.close(),delete this.smallTrackSource)):e instanceof ml&&e.source&&e.source.context.destroy()}setCameraTrack(e){return B(this,null,function*(){this.cameraTrack=e,this.update()})}setScreenTrack(e){return this.screenTrack=e,this._isMixScreen&&(this.screenNode?this.screenNode.replaceTrack(e.mediaTrack):this.update()),e.setOutputMediaStreamTrack(e.mediaTrack)}getWatermarkImage(e,t){return B(this,null,function*(){let i=document.createElement("canvas");t&&e&&(i.height=t,i.width=e);let r=i.getContext("2d");if(!r)throw new ke({code:ge.NOT_SUPPORTED,message:"Make image failed because of canvas context is null"});return this.watermarkImageList.sort((o,c)=>o.zIndex-c.zIndex),this.watermarkImageList.forEach(o=>{let{image:c,x:u,y:f,width:d,height:_}=o;r.drawImage(c,u,f,d,_)}),qd(i.toDataURL())})}pushWaterMarkImageList(e){let{type:t}=e;this.watermarkImageList.some(i=>i.imageUrl===e.imageUrl&&i.height===e.height&&i.width===e.width&&i.x===e.x&&i.y===e.y&&i.type===e.type&&i.zIndex===e.zIndex)||((t==="mute"||t==="watermark")&&(this.watermarkImageList=this.watermarkImageList.filter(i=>i.type!==t)),this.watermarkImageList.push(e))}setWatermark(e){return B(this,null,function*(){let t;try{t=yield qd((e==null?void 0:e.imageElement)||e.imageUrl)}catch{throw new ke({code:ge.INVALID_PARAMETER,message:"load image failed, url: ".concat(e.imageUrl)})}let{x:i=0,y:r=0,width:o=t.width,height:c=t.height,type:u="watermark",zIndex:f=2}=e;this.pushWaterMarkImageList({x:i,y:r,width:o,height:c,image:t,zIndex:f,type:u,imageUrl:e.imageUrl}),yield this.freshWatermark(),this.log.info("set watermark",JSON.stringify(this.watermarkImageList))})}deleteWatermark(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"watermark";return B(this,null,function*(){this.watermarkImageList=this.watermarkImageList.filter(t=>t.type!==e),this.log.info("delete watermark",e,JSON.stringify(this.watermarkImageList)),yield this.freshWatermark()})}freshWatermark(){return B(this,null,function*(){var e,t,i;(e=this.waterMarkNode)==null||e.close(),delete this.waterMarkNode,delete this._waterMarkOption;let r=yield this.getWatermarkImage((t=this.cameraTrack)==null?void 0:t.settings.width,(i=this.cameraTrack)==null?void 0:i.settings.height);this._waterMarkOption={x:0,y:0,width:r.width,height:r.height,image:r},this.update()})}setVirtualBackground(e){return B(this,null,function*(){if(e){if(this._use2d&&!this._autoSwitchRenderMode)return Promise.reject(new Error("not support virtual background in 2d mode"));this._bgAssetPath=e.assetPath,e.type==="image"?this._virtualBackground=yield qd(e.imageUrl):(this.blurRadius=e.blurRadius||3,this._virtualBackground=e.type)}else this._virtualBackground=void 0;this.log.info("".concat(this._virtualBackground?"start":"stop"," visual background, ").concat((e==null?void 0:e.type)||"")),this.update()})}get mixScreen(){return this._isMixScreen}set mixScreen(e){var t;this._isMixScreen=e,this._isMixScreen||((t=this.screenNode)==null||t.close(),delete this.screenNode),this.update()}set mirror(e){var t;this._isMirror!==e&&(this._isMirror=e,this._isMirror||((t=this.mirrorNode)==null||t.close(),delete this.mirrorNode),this.update())}get mirror(){return this._isMirror}enableAr(e){this.arTrack=e,this.isUsingArTrack=!0,this.update()}updateAr(){return B(this,null,function*(){var e;(e=this.cameraTrack)==null||!e.mediaTrack||(yield this.virtualBackgroundInstance.ar.updateInputTrack(this.cameraTrack.mediaTrack.clone()))})}disableAr(){var e;this.isUsingArTrack=!1,(e=this.arTrack)==null||e.stop(),this.arTrack=void 0,this.update()}clear(){var e;(e=this.videoContext)==null||e.disconnect(),delete this.destination,delete this.cameraNode,delete this.mirrorNode,delete this.screenNode,delete this.waterMarkNode}},kF=0,NF=class extends Ze{constructor(e){super("room"),this.seq=++kF,this.role="anchor",this.localTracks=new Set,this.enableAutoPlayDialog=!0,this.autoReceiveAudio=!0,this.autoReceiveVideo=!0,this.scheduleResult={domains:null,iceServers:null,iceTransportPolicy:null,trtcAutoConf:null},this._isUsingCachedSchedule=!1,this._log=Te.createLogger({id:"r".concat(this.seq)}),this._joinedTimestamp=0,this.isDestroyed=!1,this.useStringRoomId=!!e.useStringRoomId,Pi(e.autoReceiveAudio)&&(this.autoReceiveAudio=e.autoReceiveAudio),Pi(e.autoReceiveVideo)&&(this.autoReceiveVideo=e.autoReceiveVideo),Pi(e.enableAutoPlayDialog)&&(this.enableAutoPlayDialog=e.enableAutoPlayDialog),this._sdkType=e.sdkType,this.keyPointManager=new pF({room:this,frameWorkType:e.frameWorkType,component:e.component,language:e.language}),this.callDurationCalculator=new fF({room:this}),this.badCaseDetector=new mF({room:this}),this.audioManager=new v7(this),this.videoManager=new wF(this)}get isMainStreamPublished(){for(let e of this.localTracks)if(4&e.mediaType)return!0;return!1}get isAuxStreamPublished(){for(let e of this.localTracks)if(2&e.mediaType)return!0;return!1}get hasAuxStream(){for(let e of this.remotePublishedUserMap.values())if(e.muteState.hasAuxiliary)return!0;return this.isAuxStreamPublished}getLogger(){return this._log}get isJoining(){return this.state.toString()==="joining"}get isJoined(){return this.state==="joined"}get isLeft(){return this.state==="left"}addTrack(e){return B(this,null,function*(){return this.publish(e)})}removeTrack(e){return B(this,null,function*(){return this.unpublish(e)})}replaceTrack(e){return B(this,null,function*(){})}setEncodedDataProcessingListener(e){throw new Error("Method not implemented.")}enableAIVoice(e){throw new Error("Method not implemented.")}setProxyServer(e){if(_t(e))e.startsWith("wss://")?this.proxy_ws=e:e.startsWith("https://")&&(this.proxy_wt=e);else if(nr(e)){let{websocketProxy:t,webtransportProxy:i,loggerProxy:r,scheduleProxy:o,unifiedProxy:c}=e;this.proxy_ws=t,this.proxy_wt=i,this.proxy_unified=c,c?(gA([c,c]),Nc("https://".concat(c))):(r&&Nc(r),o&&gA(o))}pe.once(oe.JOIN_RECEIVED_CMD_RES,()=>this.sendAbilityStatus({sched_domain:Fs.main,sched_back_domain:Fs.backup,signal_domain:this.proxy_ws||this.proxy_wt||""}))}getRemoteAudioStats(){return B(this,null,function*(){let e={};return this.remotePublishedUserMap.forEach(t=>{e[t.userId]=t.remoteAudioTrack.stat}),e})}getTransportStats(){return B(this,null,function*(){var e;let t={rtt:((e=this.quality)==null?void 0:e.uplinkRTT)||0,downlinksRTT:{}};if(this.quality)for(let i of this.quality.downlinkInfo)t.downlinksRTT[i.userId]=i.rtt;return t})}getRemoteVideoStats(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"main";return function*(){let i={};return e.remotePublishedUserMap.forEach(r=>{let o=t==="auxiliary"?r.remoteAuxiliaryTrack:r.remoteVideoTrack;i[r.userId]=o.stat}),i}()})}checkDestroy(){if(this.isDestroyed)throw new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.CLIENT_DESTROYED,data:{funName:"join"}})})}destroy(){if(this.isJoined)throw this._log.warn(sn.INVALID_DESTROY),new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.INVALID_DESTROY})});this._log.info("destroy room"),this.audioManager.destroy(),this.videoManager.destroy(),this.keyPointManager.destroy(),this.callDurationCalculator.destroy(),this.badCaseDetector.destroy(),this.isDestroyed=!0,pe.emit(oe.ROOM_DESTROY,{room:this})}schedule(e,t){return B(this,null,function*(){var i,r;let o=it();try{let{isCached:c,result:u,detailCost:f}=yield vU({userId:this.userId,sdkAppId:this.sdkAppId,roomId:e,useStringRoomId:this.useStringRoomId,version:In,userSig:this.userSig,frameWorkType:t});this._isUsingCachedSchedule=c,this._log.info("schedule cache:".concat(+c," ").concat(rr(u,{keysToExclude:["username","credential"]}))),c&&pe.once(oe.JOIN_RECEIVED_CMD_RES,()=>this.sendAbilityStatus({scheduleCache:1})),this.scheduleResult=Oe(Oe({},this.scheduleResult),u),Qt((i=u.config)==null?void 0:i.retryCount)&&Kb(u.config.retryCount),_t((r=u.config)==null?void 0:r.loggerDomain)&&Nc(u.config.loggerDomain),pe.emit(oe.JOIN_SCHEDULE_SUCCESS,{room:this,schedule:this.scheduleResult,detailCost:f}),et.addSuccessEvent({key:521700,cost:it()-o,split:50})}catch(c){throw et.addFailedEvent({key:521700,error:c}),c}})}},DF=ni(Di()),tC=ni(kb()),OF=e=>{let{serverAbility:t,clientAbility:i,offerSDP:r,enableCustomMessage:o}=e,c=Kt(r),u={extmapAllowMixed:"extmap-allow-mixed",groups:c.groups,icelite:"ice-lite",media:[],msidSemantic:{semantic:"",token:"WMS"},name:"-",origin:{address:"127.0.0.1",username:"-",sessionId:String(Date.now()),sessionVersion:1,netType:"IN",ipVer:4},timing:{start:0,stop:0},version:0},f={candidates:t.candidates.map(d=>({component:1,foundation:"1",generation:0,ip:d.ip,port:d.port,priority:d.priority,transport:d.foundation,type:d.type})),connection:{version:4,ip:"0.0.0.0"},direction:N.TRANSCEIVER_DIRECTION_RECVONLY,ext:t.audio.extensions.map(d=>({value:d.id,uri:d.uri})),fingerprint:{type:t.dtls.hash,hash:t.dtls.fingerprint},fmtp:[{payload:t.audio.codecs[0].payload,config:t.audio.codecs[0].fmtp}],icePwd:t.ice.password,iceUfrag:t.ice.ufrag,mid:"0",payloads:String(t.audio.codecs[0].payload),port:c.media[0].port,protocol:c.media[0].protocol,type:N.AUDIO,setup:t.dtls.setup,rtcpFb:t.audio.codecs[0].rtcpfb.map(d=>({payload:t.audio.codecs[0].payload,type:d.id,subtype:d.params[0]})),rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",rtp:[{payload:t.audio.codecs[0].payload,codec:t.audio.codecs[0].codec,rate:t.audio.codecs[0].rate,encoding:t.audio.codecs[0].channels}]};return u.media.push(f),[1,2,3].forEach(d=>{u.media.push(iC({mid:d,serverAbility:t,clientAbility:i,parsedOffer:c}))}),o&&u.media.push(c.media.find(d=>d.mid==="dc")),Xr(u)},iC=e=>{let{mid:t,serverAbility:i,clientAbility:r,parsedOffer:o,useAllCodec:c=!1}=e,u={candidates:i.candidates.map(f=>({component:1,foundation:"1",generation:0,ip:f.ip,port:f.port,priority:f.priority,transport:f.foundation,type:f.type})),connection:{version:4,ip:"0.0.0.0"},direction:N.TRANSCEIVER_DIRECTION_RECVONLY,ext:i.video.extensions.map(f=>({value:f.id,uri:f.uri})),fingerprint:{type:i.dtls.hash,hash:i.dtls.fingerprint},fmtp:[],icePwd:i.ice.password,iceUfrag:i.ice.ufrag,mid:String(t),payloads:"",port:o.media[0].port,protocol:o.media[0].protocol,type:N.VIDEO,setup:i.dtls.setup,rtcpFb:[],rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",rtp:[]};if(i.video.codecs.length>0)if(c)for(let f=0;f<i.video.codecs.length;f++)bh(u,i.video.codecs[f]);else{let f=i.video.codecs.findIndex(d=>d.codec.toLowerCase()===(i.useVp8?"vp8":"h264"));bh(u,i.video.codecs[f])}else if(c)for(let f=0;f<r.video.codecs.length;f++)bh(u,r.video.codecs[f]);else bh(u,r.video.codecs[0]);return u.payloads=u.payloads.trim(),u},bh=(e,t)=>{e.payloads="".concat(e.payloads," ").concat(t.payload),e.fmtp.push({payload:t.payload,config:t.fmtp}),e.rtcpFb=[...e.rtcpFb||[],...(t.rtcpfb||t.rtcpFb).map(i=>({payload:t.payload,type:i.id,subtype:i.params[0]}))],e.rtp.push({payload:t.payload,codec:t.codec.toUpperCase(),rate:t.rate}),t.rtx&&(e.payloads="".concat(e.payloads," ").concat(t.rtx),e.fmtp.push({payload:t.rtx,config:"apt=".concat(t.payload)}),e.rtp.push({payload:t.rtx,codec:"rtx",rate:t.rate}))},ln,PF=e=>{let t=tC.default.parse(e);return t.media.forEach(i=>{var r;(i.type===N.AUDIO||i.type===N.VIDEO)&&(function(o){if(!o.rtcpFb)return;let c=[];o.rtcpFb.forEach((u,f)=>{var d;c.push(u),o.rtcpFb&&((d=o.rtcpFb[f+1])==null?void 0:d.payload)!==u.payload&&u.type!=="rrtr"&&c.push({payload:u.payload,type:"rrtr"})}),o.rtcpFb=c}(i),function(o){o.type===N.VIDEO&&o.fmtp&&o.fmtp.forEach(c=>{c.config.includes("apt")||(c.config+=";sps-pps-idr-in-keyframe=1")})}(i),function(o){o.type===N.AUDIO&&o.fmtp&&o.fmtp.forEach(c=>{c.config+=";sprop-stereo=1;stereo=1"})}(i),function(o){let c=new Set(["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]);o.ext&&(o.ext=o.ext.filter(u=>!c.has(u.uri)))}(i)),(r=i.payloads)!=null&&r.includes("datachannel")&&t.groups&&i.mid&&(t.groups[0].mids=t.groups[0].mids.replace(i.mid,"dc"),i.mid="dc")}),tC.default.write(t)},nC=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.dataView=e,this.isSEI&&(t?this.addPreventionByte():this.removePreventionByte())}addPreventionByte(){let e=this.seiPayloadStartIndex,t=this.dataView.byteLength-2,i=[],r=0;for(let c=e;c<=t;c++){let u=this.dataView.getInt8(c);switch(u){case 0:case 1:case 2:case 3:r===2&&(i.push(3),r=0),u==0?r++:r=0,i.push(u);break;default:r=0,i.push(u)}}i.push(this.dataView.getInt8(this.dataView.byteLength-1));let o=new DataView(new Uint8Array([...new Uint8Array(this.dataView.buffer).slice(0,e),...i]).buffer);this.dataView=o}removePreventionByte(){let e=this.seiPayloadStartIndex,t=this.dataView.byteLength-1,i=[],r=0;for(let c=e;c<=t;c++)switch(this.dataView.getInt8(c)){case 0:r++,i.push(this.dataView.getInt8(c));break;case 3:r!==2&&i.push(this.dataView.getInt8(c)),r=0;break;default:i.push(this.dataView.getInt8(c)),r=0}let o=new DataView(new Uint8Array([...new Uint8Array(this.dataView.buffer).slice(0,e),...i]).buffer);this.dataView=o}get isSEI(){return this.dataView.getUint8(4)===6}get seiPayloadStartIndex(){let e=6;for(let t=6;t<this.dataView.buffer.byteLength&&(e++,this.dataView.getUint8(t)===255);t++);return e}get seiPayloadType(){return this.isSEI?this.dataView.getUint8(5):null}get seiPayload(){if(!this.isSEI)return null;let e=0,t=6;for(let o=6;o<this.dataView.buffer.byteLength;o++){let c=this.dataView.getUint8(o);if(t++,c!==255){e+=c;break}e+=255}let i=new ArrayBuffer(e),r=new DataView(i);for(let o=0;o<i.byteLength;o++,t++)r.setInt8(o,this.dataView.getInt8(t));return r}},MF=class{constructor(e,t){this._singlePC=e,this._log=t,b(this,"_seiMessageList",[]),b(this,"_smallSeiMessageList",[]),b(this,"_seiPayloadType",243),b(this,"_seiAbortMap",new Map),b(this,"_nonSeiAbortMap",new Map),b(this,"onSEIMessage",null)}isRunning(e){return this._seiAbortMap.has(e)}start(e){let t=e.direction===N.TRANSCEIVER_DIRECTION_SENDONLY,i=(t?e.sender:e.receiver).createEncodedStreams(),r=i.readable,o=i.writable,c=new TransformStream({transform:t?(f,d)=>this.encodeVideoFrame(f,d,e):(f,d)=>this.decodeVideoFrame(f,d,e)}),u=new AbortController;r.pipeThrough(c).pipeTo(o,u).catch(f=>{f!=="destroy"&&this._log.warn(f)}),this._seiAbortMap.set(e,u)}restart(e){this.stop(e),this.start(e)}stop(e){var t;(t=this._seiAbortMap.get(e))==null||t.abort(),this._seiAbortMap.delete(e)}destroy(){this._seiAbortMap.forEach(e=>e.abort("destroy")),this._seiAbortMap.clear(),this._nonSeiAbortMap.forEach(e=>e.abort("destroy")),this._nonSeiAbortMap.clear(),this.onSEIMessage=null}handleEncodedStreams(){try{this._singlePC.getPeerConnection().getTransceivers().forEach((e,t)=>{var i,r;if(e.direction!=="inactive"&&e.mid)if(t<4)t===1||t===2?this.isRunning(e)||this.start(e):this._nonSeiAbortMap.has(e)||this.pipeSenderOrReceiver(e);else{let o=(t-4)%3==1,c=(t-4)%3==2;((r=(i=e.receiver)==null?void 0:i.track)==null?void 0:r.kind)===N.VIDEO&&(o||c)?this.isRunning(e)||this.start(e):this._nonSeiAbortMap.has(e)||this.pipeSenderOrReceiver(e)}})}catch(e){this._log.warn(e)}}pipeSenderOrReceiver(e){let t=e.direction===N.TRANSCEIVER_DIRECTION_SENDONLY?e.sender:e.receiver,{readable:i,writable:r}=t.createEncodedStreams(),o=new AbortController;this._nonSeiAbortMap.set(e,o),i.pipeTo(r,o).catch(()=>{})}push(e,t){var i,r;t&&t.seiPayloadType&&(this._seiPayloadType=t.seiPayloadType),this._seiMessageList.push(e),(r=(i=this._singlePC.getPeerConnection())==null?void 0:i.getSenders()[2])!=null&&r.track&&this._smallSeiMessageList.push(e)}hasSEI(e){let t=new DataView(e);return t.getInt32(0)===1&&t.getInt8(4)===6}isEmptyFrame(e){return e.type==="empty"||e.data.byteLength===0}getNaluCount(e){let t=0,i=0,r=new DataView(e);for(let o=0;o<e.byteLength;o++)switch(r.getUint8(o)){case 0:t++;break;case 1:(t===2||t===3)&&i++,t=0;break;default:t=0}return i}encodeVideoFrame(e,t,i){try{let r=Number(i.mid)===2?this._smallSeiMessageList:this._seiMessageList;if(this._singlePC.isUsingH264&&r.length>0&&!this.isEmptyFrame(e)){let o=9-this.getNaluCount(e.data);if(o<=0)return;let c=r.splice(0,o).reverse().map(this.encodeSEINalu.bind(this)),u=c.reduce((S,R)=>S+R.dataView.byteLength,0),f=new ArrayBuffer(u+e.data.byteLength),d=new DataView(f),_=new DataView(e.data),E=0;for(let S=0;S<c.length;S++)for(let R=0;R<c[S].dataView.byteLength;R++)d.setInt8(E++,c[S].dataView.getInt8(R));for(let S=0;S<e.data.byteLength;S++)d.setInt8(E++,_.getInt8(S));e.data=f,this._log.debug("".concat(c.length," sei sent"))}}catch(r){this._log.warn(r)}t.enqueue(e)}decodeVideoFrame(e,t,i){try{if(this._singlePC.isUsingH264&&!this.isEmptyFrame(e)&&this.hasSEI(e.data)){let r=[],o=new DataView(e.data),c=0,u=-1,f=-1;for(let d=0;d<e.data.byteLength;d++){let _=o.getUint8(d);if(_===0)c++;else if(_===1){if(c===2||c===3){let E=d-c;if(u===-1?u=E:f===-1&&(f=E,r.push(new nC(new DataView(o.buffer.slice(u,f)))),u=E,f=-1),o.getUint8(d+1)!==6){e.data=new DataView(o.buffer.slice(E)).buffer;break}}c=0}else c=0}this._log.debug("".concat(r.length," sei received")),Tt(this.onSEIMessage)&&r.reverse().forEach(d=>{let _=Number(i.mid);this.onSEIMessage({seiPayloadType:d.seiPayloadType,data:d.seiPayload.buffer,mid:_,streamType:(_-4)%3==2?"auxiliary":"main"})})}}catch(r){this._log.warn(r)}t.enqueue(e)}encodeSEINalu(e){let t=e.byteLength,i=parseInt(String(t/255),10),r=t%255,o=[];o.push(0,0,0,1,6,this._seiPayloadType);for(let u=0;u<i;u++)o.push(255);o.push(r);let c=new DataView(e);return o.push(...new Uint8Array(c.buffer)),o.push(128),new nC(new DataView(new Uint8Array(o).buffer),!0)}},Qs=((ln=Qs||{}).TRACK="track",ln.DATA_CHANNEL_MESSAGE="data_channel_msg",ln[ln.CONNECTION_STATE_CHANGED="connection-state-changed"]="CONNECTION_STATE_CHANGED",ln[ln.FIREWALL_RESTRICTION="firewall-restriction"]="FIREWALL_RESTRICTION",ln.RECONNECTED="spc-reconnected",ln.RECONNECT_FAILED="spc-reconnect-failed",ln.ERROR="error",ln.SEI_MESSAGE="sei-message",ln),rC=0,sC=!1,LF=new Set,xF=1,Cl=class extends DF.default{constructor(e){let{signalChannel:t,room:i,enableCustomMessage:r}=e;super(),b(this,"stat",{iceStartTime:0,iceEndTime:0,dtlsStartTime:0,dtlsEndTime:0,peerConnectionStartTime:0,peerConnectionEndTime:0}),b(this,"currentState","DISCONNECTED"),b(this,"_room"),b(this,"_signalChannel"),b(this,"_peerConnection",null),b(this,"_datachannel",null),b(this,"_enableCustomMessage"),b(this,"_log"),b(this,"_downlinkMIDMap",new Map),b(this,"_downlinkMIDUserIDMap",new Map),b(this,"_reconnectionTimer",-1),b(this,"reconnectionCount",0),b(this,"clientAbility"),b(this,"_serverAbility",null),b(this,"addDownlinkQueue",new Set),b(this,"removeDownlinkQueue",new Set),b(this,"_parsedAnswer",null),b(this,"_updateSDPPromise",null),b(this,"_waitForPCConnectedPromise"),b(this,"_waitForPCConnectedPromiseReject",null),b(this,"_isSDPLogged",!1),b(this,"seiCodec",null),this._room=i,this._enableCustomMessage=r,this._signalChannel=t,this._log=Te.createLogger({id:"spc".concat(xF++),userId:this._room.userId,sdkAppId:this._room.sdkAppId}),this._room.enableSEI&&sl&&(this._log.info("create sei codec"),this.seiCodec=new MF(this,this._log),this.seiCodec.onSEIMessage=o=>{this.emit("sei-message",{userId:this._downlinkMIDUserIDMap.get(o.mid),data:o.data,seiPayloadType:o.seiPayloadType,streamType:o.streamType})})}get isH264EncodeSupported(){let e=this._room.checkSystemResult.detail.isH264EncodeSupported;return this._serverAbility&&(e=e&&!!this._serverAbility.video.codecs.find(t=>t.codec.toLowerCase()==="h264")),e}get isVP8EncodeSupported(){let e=this._room.checkSystemResult.detail.isVp8EncodeSupported;return this._serverAbility&&(e=e&&this._serverAbility.useVp8),e}get videoCodec(){var e;return(e=this._serverAbility)!=null&&e.useVp8?"vp8":"h264"}get isUsingH264(){return this.videoCodec==="h264"}get uplinkSSRC(){return this._peerConnection&&this._peerConnection.localDescription?(e=>{let t=Kt(e),i={audioSsrc:0,audioRtxSsrc:0,bigVideoSsrc:0,bigVideoRtxSsrc:0,smallVideoSsrc:0,smallVideoRtxSsrc:0,auxVideoSsrc:0,auxVideoRtxSsrc:0};return t.media.forEach((r,o)=>{var c;if(r.ssrcs&&!re(r.ssrcs[0].id)){let u=Number(r.ssrcs[0].id),f=Number((c=r.ssrcs.filter(d=>d.attribute==="cname")[1])==null?void 0:c.id);switch(o){case 0:i.audioSsrc=u;break;case 1:i.bigVideoSsrc=u,i.bigVideoRtxSsrc=f;break;case 2:i.smallVideoSsrc=u,i.smallVideoRtxSsrc=f;break;case 3:i.auxVideoSsrc=u,i.auxVideoRtxSsrc=f}}}),i})(this._peerConnection.localDescription.sdp):{audioSsrc:0,audioRtxSsrc:0,bigVideoSsrc:0,bigVideoRtxSsrc:0,smallVideoSsrc:0,smallVideoRtxSsrc:0,auxVideoSsrc:0,auxVideoRtxSsrc:0}}get isReconnecting(){return this.currentState==="RECONNECTING"||this._reconnectionTimer>0||this.reconnectionCount>0}get dtlsTransport(){if(!this._peerConnection)return null;let e=this._peerConnection.getSenders();return e.length===0?null:e[0].transport}initialize(){return B(this,null,function*(){let e;try{return this._peerConnection=new RTCPeerConnection({encodedInsertableStreams:this._room.enableSEI&&sl,offerExtmapAllowMixed:!0,iceServers:this._room.getIceServers(),iceTransportPolicy:this._room.getIceTransportPolicy(),sdpSemantics:this._room.sdpSemantics,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"}),this._peerConnection.oniceconnectionstatechange=()=>{if(!this._peerConnection)return;let t=this._peerConnection.iceConnectionState;this._log.debug("ice state: ".concat(t)),t==="checking"&&this.stat.iceStartTime===0?this.stat.iceStartTime=Date.now():t==="connected"&&this.stat.iceEndTime===0&&(this.stat.iceEndTime=Date.now())},this._peerConnection.onconnectionstatechange=this.onConnectionStateChange.bind(this),this._peerConnection.ontrack=t=>this.emit("track",t),this._enableCustomMessage&&(this._datachannel=this._peerConnection.createDataChannel("".concat(this._room.userId,"dc")),this._datachannel.binaryType="arraybuffer",this._datachannel.onopen=()=>{this._log.info("datachannel open")},this._datachannel.onclose=()=>{this._log.warn("datachannel close")},this._datachannel.onmessage=t=>{let i=new UF(t.data);this.emit("data_channel_msg",{data:i})},this._datachannel.onerror=t=>{this._log.warn("datachannel error",t)}),this._peerConnection.addTransceiver(N.AUDIO,{direction:N.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:N.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:N.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:N.TRANSCEIVER_DIRECTION_SENDONLY}),e=yield this._peerConnection.createOffer(),yield this.setOffer(e),this.dtlsTransport&&(this.dtlsTransport.onstatechange=()=>{let{dtlsTransport:t}=this;!t||(this._log.debug("dtls state: ".concat(t.state)),t.state==="connecting"&&this.stat.dtlsStartTime===0?this.stat.dtlsStartTime=Date.now():t.state==="connected"&&this.stat.dtlsEndTime===0&&(this.stat.dtlsEndTime=Date.now()))}),this.clientAbility=((t,i)=>{var r,o;let c=Kt(t),u={ice:{ufrag:"",password:""},dtls:{hash:"",fingerprint:"",setup:""},audio:{codecs:[],extensions:[]},video:{codecs:[],extensions:[]},useDataChannel:i};u.ice.ufrag=String(c.media[0].iceUfrag),u.ice.password=c.media[0].icePwd||"",c.fingerprint&&(u.dtls.hash=c.fingerprint.type,u.dtls.fingerprint=c.fingerprint.hash,u.dtls.setup=c.setup||""),c.media[0].fingerprint&&(u.dtls.hash=c.media[0].fingerprint.type,u.dtls.fingerprint=c.media[0].fingerprint.hash),u.dtls.setup=c.media[0].setup||"";let f=c.media[0],d=c.media[1];f.ext&&(u.audio.extensions=f.ext.map(E=>({id:E.value,uri:E.uri}))),d.ext&&(u.video.extensions=d.ext.map(E=>({id:E.value,uri:E.uri})));let _={codec:f.rtp[0].codec,fmtp:f.fmtp[0].config,payload:f.fmtp[0].payload,rate:f.rtp[0].rate,channel:f.rtp[0].encoding,rtcpFb:[],rtx:0};(r=f.rtcpFb)==null||r.forEach(E=>{let{payload:S,type:R,subtype:k}=E;if(S===_.payload){let U={id:R,params:[]};k&&U.params.push(k),_.rtcpFb.push(U)}}),u.audio.codecs.push(_);for(let E=0;E<d.rtp.length;E++){if(["rtx","red","ulpfec"].includes(d.rtp[E].codec))continue;let S=d.fmtp.filter(R=>R.payload===d.rtp[E].payload)[0];u.video.codecs.push({payload:d.rtp[E].payload,codec:d.rtp[E].codec,fmtp:S?S.config:"",rate:d.rtp[E].rate,rtx:((o=d.rtp[E+1])==null?void 0:o.codec)==="rtx"?d.rtp[E+1].payload:0,rtcpFb:((d==null?void 0:d.rtcpFb)||[]).filter(R=>R.payload===d.rtp[E].payload).map(R=>{let{type:k,subtype:U}=R;return{id:k,params:U?[U]:[]}})})}return u})(e.sdp,this._enableCustomMessage),et.addSuccessEvent({key:521707}),this.clientAbility}catch(t){throw et.addFailedEvent({key:521707,error:t}),this._log.error("initialize failed ".concat(t,` 
offer: `).concat(e==null?void 0:e.sdp)),t}})}connect(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return B(this,null,function*(){var i;try{if(this.currentState==="CONNECTED")return;let r=it(),o={type:"answer",sdp:OF({serverAbility:e,clientAbility:this.clientAbility,offerSDP:this._peerConnection.localDescription.sdp,enableCustomMessage:this._enableCustomMessage})};this._serverAbility=e,yield this.setAnswer(o),yield this.waitForPeerConnectionConnected(),t||et.addSuccessEvent({key:521703,cost:it()-r}),(i=this.seiCodec)==null||i.handleEncodedStreams()}catch(r){let o=r instanceof ke&&r.code===ge.API_CALL_ABORTED;throw o||this._log.error("connect failed: ".concat(r),e),this.reset(),!o&&!this.isReconnecting&&(et.addFailedEvent({key:521703,error:r}),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection()),r}})}reconnect(){return B(this,null,function*(){if(this._reconnectionTimer===-1){if(!this._signalChannel.isConnected)return this._log.warn("reconnect() wait signal channel is connected"),void this._signalChannel.once(Ca,this.reconnect,this);try{this.reconnectionCount++,this._log.warn("reconnect() trying [".concat(this.reconnectionCount,"]")),this.reset();let e=yield this.initialize(),t=yield this._signalChannel.sendWaitForResponse({command:iF,responseCommand:Je.REBUILD_PEER_CONNECTION_RES,data:{ability:e},enableLog:!1});if(t.data.code!==0)throw new ke({code:t.data.code,message:t.data.message});yield this.connect(t.data.data.ability,!0),et.addSuccessEvent({key:521704}),this._log.warn("reconnect() success"),this.stopReconnection(),pe.emit(oe.SPC_RECONNECTED,{room:this._room}),this.emit("spc-reconnected")}catch(e){if(!this.isReconnecting)return;if(e!=null&&e.message.includes("timeout")){let t=fa(this.reconnectionCount);this._log.warn("reconnect() timeout, try again after ".concat(t/1e3,"s")),this._reconnectionTimer=window.setTimeout(()=>{this.clearReconnectionTimer(),this.reconnect()},t)}else this._log.error("reconnect() failed ".concat(e==null?void 0:e.code," ").concat(e)),et.addFailedEvent({key:521704,error:e}),this.reconnectionCount>=aa()&&this._log.warn("SDK has tried reconnect for ".concat(aa()," times, but all failed, please check your network")),this.stopReconnection(),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.emit("error")}}else this._log.warn("reconnect() is reconnecting, ignore current reconnection")})}getPeerConnection(){return this._peerConnection}startReconnection(){return B(this,null,function*(){this._log.warn("start reconnect"),this._updateSDPPromise=null,this.emitConnectionStateChangedEvent("RECONNECTING"),yield this.reconnect()})}stopReconnection(){this.isReconnecting&&(this._log.info("stop reconnect"),this.reconnectionCount=0,this.clearReconnectionTimer(),this._signalChannel.off(Ca,this.reconnect,this))}checkPeerConnectionToReconnect(){var e;!this.isReconnecting&&((e=this._peerConnection)==null?void 0:e.connectionState)===Lt.CLOSED&&this.startReconnection()}clearReconnectionTimer(){this._reconnectionTimer!==-1&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}onConnectionStateChange(e){let t=this._peerConnection.iceConnectionState,i=this.getDTLSTransportState();this._log.info("connectionState: ".concat(e.target.connectionState," ICE: ").concat(t," DTLS: ").concat(i)),e.target.connectionState===Lt.CONNECTING&&(this.stat.peerConnectionStartTime===0&&(this.stat.peerConnectionStartTime=Date.now()),this.emitConnectionStateChangedEvent("CONNECTING")),(e.target.connectionState===Lt.FAILED||e.target.connectionState===Lt.CLOSED)&&(this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection()),(e.target.connectionState===Lt.CONNECTED||e.target.connectionState===Lt.COMPLETED)&&(this.stat.peerConnectionEndTime===0&&(this.stat.peerConnectionEndTime=Date.now()),pe.emit(oe.SINGLE_CONNECTION_STAT,{room:this._room,stat:{ice:this.stat.iceEndTime-this.stat.iceStartTime,dtls:this.stat.dtlsEndTime-this.stat.dtlsStartTime,peerConnection:this.stat.peerConnectionEndTime-this.stat.peerConnectionStartTime}}),this.logSelectedCandidate(),this.emitConnectionStateChangedEvent("CONNECTED"))}getDTLSTransportState(){if(!this._peerConnection)return xr;let e=null;return $d()&&this._peerConnection.getSenders().length!==0?(e=this._peerConnection.getSenders()[0].transport,Zd()&&this._peerConnection.getReceivers().length!==0&&e?e.state:xr):xr}emitConnectionStateChangedEvent(e){e!==this.currentState&&(this.currentState==="RECONNECTING"&&e==="CONNECTING"||(this.emit(Qs.CONNECTION_STATE_CHANGED,{prevState:this.currentState,state:e}),this.currentState=e))}logSelectedCandidate(){return B(this,null,function*(){if(!this._peerConnection)return;let e=yield this._peerConnection.getStats();for(let[t,i]of e)if(rl(i)){let r=e.get(i.localCandidateId),o=e.get(i.remoteCandidateId);r&&(this._log.info("local candidate: ".concat(r.candidateType," ").concat(r.protocol,":").concat(r.ip||r.address,":").concat(r.port," ").concat(r.networkType||""," ").concat(r.candidateType==="relay"?"relayProtocol:".concat(r.relayProtocol):"")),r.networkType&&SA(r.networkType)),o&&this._log.info("remote candidate: ".concat(o.candidateType," ").concat(o.protocol,":").concat(o.ip||o.address,":").concat(o.port));break}})}waitForPeerConnectionConnected(){return this._waitForPCConnectedPromise||(this._waitForPCConnectedPromise=new Promise((e,t)=>{if(this.currentState==="CONNECTED")return e();this._waitForPCConnectedPromiseReject=t;let i=u=>{u.state==="CONNECTED"&&(clearTimeout(c),o(),e())},r=u=>{let{room:f}=u;f===this._room&&(clearTimeout(c),o(),t(new ke({code:ge.API_CALL_ABORTED,message:je({key:Ve.CONNECTION_ABORTED,data:"leave room"})})))},o=()=>{pe.off(oe.LEAVE_SUCCESS,r,this),this.off(Qs.CONNECTION_STATE_CHANGED,i,this)},c=setTimeout(()=>{o();let u=new ke({code:ge.API_CALL_TIMEOUT,message:"connection timeout"});var f;rC+=1,f=this._signalChannel.isConnected,rC>2&&!sC&&LF.size===0&&f&&(this._log.warn("firewall restriction"),sC=!0,this.emit(Qs.FIREWALL_RESTRICTION)),t(u)},B_);pe.on(oe.LEAVE_SUCCESS,r,this),this.on(Qs.CONNECTION_STATE_CHANGED,i,this)}),this._waitForPCConnectedPromise=this._waitForPCConnectedPromise.finally(()=>{this._waitForPCConnectedPromise=null,this._waitForPCConnectedPromiseReject=null})),this._waitForPCConnectedPromise}waitForReconnected(){return this.isReconnecting?new Promise((e,t)=>{this.once("spc-reconnected",e),this.once("error",t)}):Promise.resolve()}addDownlink(e){return B(this,null,function*(){var t;if(this._log.info("addDownlink(".concat(e.userId,") trying")),this.isReconnecting&&(yield this.waitForReconnected()),this._updateSDPPromise&&(yield this._updateSDPPromise),this.updateLocalAndRemoteSDPConfig(e),this.addDownlinkQueue.size===0)try{yield this.updateSDP(),(t=this.seiCodec)==null||t.handleEncodedStreams(),this._log.info("addDownlink(".concat(e.userId,") done"))}catch(i){this._log.error("addDownlink(".concat(e.userId,") failed ").concat(i)),yield this.startReconnection()}})}updateLocalAndRemoteSDPConfig(e){let{ssrc:t,userId:i,tinyId:r}=e;if(!this._peerConnection)return;this._log.info("updateLocalAndRemoteSDPConfig ".concat(i," ").concat(JSON.stringify(t)));let o=this._peerConnection.getTransceivers().filter(S=>S.direction==="inactive").slice(0,3).map(S=>(S.direction=N.TRANSCEIVER_DIRECTION_RECVONLY,Number(S.mid)));this._parsedAnswer||(this._parsedAnswer=Kt(this._peerConnection.remoteDescription.sdp));let c,u,f,d=this._parsedAnswer.media.filter(S=>{var R;return(R=S.ssrcs)==null?void 0:R.find(k=>{var U;return(U=k.value)==null?void 0:U.includes(r)})});if(d.length===3)c=d[0],u=d[1],f=d[2];else if(o.length===3)c=this._parsedAnswer.media.find(S=>Number(S.mid)===Number(o[0])),u=this._parsedAnswer.media.find(S=>Number(S.mid)===Number(o[1])),f=this._parsedAnswer.media.find(S=>Number(S.mid)===Number(o[2]));else if(o.length===0){this._peerConnection.addTransceiver(N.AUDIO,{direction:N.TRANSCEIVER_DIRECTION_RECVONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:N.TRANSCEIVER_DIRECTION_RECVONLY}),this._peerConnection.addTransceiver(N.VIDEO,{direction:N.TRANSCEIVER_DIRECTION_RECVONLY}),c=JSON.parse(JSON.stringify(this._parsedAnswer.media[0]));let S=iC({mid:1,serverAbility:this._serverAbility,clientAbility:this.clientAbility,parsedOffer:Kt(this._peerConnection.localDescription.sdp),useAllCodec:!0});u=JSON.parse(JSON.stringify(S)),f=JSON.parse(JSON.stringify(S)),c.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(c),u.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(u),f.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(f)}c.direction=N.TRANSCEIVER_DIRECTION_SENDONLY;let _="".concat(r,"-").concat(t.audio);c.ssrcs=[{id:t.audio,attribute:"cname",value:"".concat(_)},{id:t.audio,attribute:"msid",value:"".concat(_,"-").concat(N.MAIN," ").concat(_,"-audio")}],u.direction=N.TRANSCEIVER_DIRECTION_SENDONLY,u.ssrcs=[{id:t.video,attribute:"cname",value:"".concat(_)},{id:t.video,attribute:"msid",value:"".concat(_,"-").concat(N.MAIN," ").concat(_,"-bigvideo")},{id:t.videoRtx,attribute:"cname",value:"".concat(_)},{id:t.videoRtx,attribute:"msid",value:"".concat(_,"-").concat(N.MAIN," ").concat(_,"-bigvideo")}],u.ssrcGroups=[{semantics:"FID",ssrcs:"".concat(t.video," ").concat(t.videoRtx)}],f.direction=N.TRANSCEIVER_DIRECTION_SENDONLY;let E="".concat(_,"-aux");f.ssrcs=[{id:t.auxiliary,attribute:"cname",value:E},{id:t.auxiliary,attribute:"msid",value:"".concat(E," ").concat(_,"-aux").concat(N.VIDEO)},{id:t.auxiliaryRtx,attribute:"cname",value:"".concat(E," ").concat(_,"-aux").concat(N.VIDEO)},{id:t.auxiliaryRtx,attribute:"msid",value:"".concat(E," ").concat(_,"-aux").concat(N.VIDEO)}],f.ssrcGroups=[{semantics:"FID",ssrcs:"".concat(t.auxiliary," ").concat(t.auxiliaryRtx)}],this._parsedAnswer.groups&&(this._parsedAnswer.groups[0].mids=this._parsedAnswer.media.map(S=>S.mid).join(" ")),this._downlinkMIDMap.set(i,[c.mid,u.mid,f.mid]),this._downlinkMIDUserIDMap.set(c.mid,i),this._downlinkMIDUserIDMap.set(u.mid,i),this._downlinkMIDUserIDMap.set(f.mid,i)}removeDownlink(e){return B(this,null,function*(){if(!this._downlinkMIDMap.has(e)||!this._peerConnection)return;this._log.info("removeDownlink(".concat(e,") trying")),this.isReconnecting&&(yield this.waitForReconnected()),this._updateSDPPromise&&(yield this._updateSDPPromise);let t=this._downlinkMIDMap.get(e),i=!1;this._peerConnection.getTransceivers().forEach(r=>{t!=null&&t.includes(Number(r.mid))&&(i=!0,r.direction="inactive")}),this._parsedAnswer||(this._parsedAnswer=Kt(this._peerConnection.remoteDescription.sdp)),this._parsedAnswer.media.forEach(r=>{t!=null&&t.includes(Number(r.mid))&&(i=!0,r.direction="inactive",r.ssrcs=[],r.ssrcGroups=[])}),this.removeDownlinkQueue.size===0&&i&&(yield this.updateSDP()),this._downlinkMIDMap.delete(e),t==null||t.forEach(r=>this._downlinkMIDUserIDMap.delete(r)),this._log.info("removeDownlink(".concat(e,") done"))})}setBandwidth(e){return B(this,null,function*(){if(!this._peerConnection)return;let{audio:t,bigVideo:i,smallVideo:r,auxVideo:o}=e;try{if(Ag()){let c=this._peerConnection.getSenders().slice(0,4);for(let f=0;f<c.length;f++){let d,_=c[f];f===0&&t?d=t:f===1&&i?d=i:f===2&&r?d=r:f===3&&o&&(d=o),d&&(yield this.setSenderMaxBitrate(_,d))}let u=!1;i&&c[1].track&&(u=this.setStartBitrate(1,i)),o&&c[3].track&&(u=this.setStartBitrate(3,o)||u),u&&(yield this.updateSDP())}else yield this.setBandwidthBySDP(e);this._log.info("setBandwidth ".concat(JSON.stringify(e)))}catch(c){this._log.error("failed to set bandwidth: ".concat(c))}})}setStartBitrate(e,t){var i,r;return!((i=this._peerConnection)==null||!i.remoteDescription||(this._parsedAnswer||(this._parsedAnswer=Kt(this._peerConnection.remoteDescription.sdp)),(r=this._parsedAnswer.media[e])==null||!r.fmtp[0]))&&(this._parsedAnswer.media[e].fmtp[0].config+=";x-google-start-bitrate=".concat(t>5e3?5e3:t),!0)}setSenderMaxBitrate(e,t){let i=e.getParameters();return(!i.encodings||i.encodings.length===0)&&(i.encodings=[{}]),t==="unlimited"?delete i.encodings[0].maxBitrate:i.encodings[0].maxBitrate=1e3*t,e.setParameters(i)}setBandwidthBySDP(e){let{audio:t,bigVideo:i,smallVideo:r,auxVideo:o}=e;if(!this._peerConnection||!this._peerConnection.localDescription)return;let c=Kt(this._peerConnection.localDescription.sdp);this._parsedAnswer||(this._parsedAnswer=Kt(this._peerConnection.remoteDescription.sdp));let u=Ct?"TIAS":"AS";t&&(c.media[0].bandwidth=[{type:u,limit:Ct?1e3*t:t}],this._parsedAnswer.media[0].bandwidth=[{type:u,limit:Ct?1e3*t:t}]),i&&(c.media[1].bandwidth=[{type:u,limit:Ct?1e3*i:i}],this._parsedAnswer.media[1].bandwidth=[{type:u,limit:Ct?1e3*i:i}]),r&&(c.media[2].bandwidth=[{type:u,limit:Ct?1e3*r:r}],this._parsedAnswer.media[2].bandwidth=[{type:u,limit:Ct?1e3*r:r}]),o&&(c.media[3].bandwidth=[{type:u,limit:Ct?1e3*o:o}],this._parsedAnswer.media[3].bandwidth=[{type:u,limit:Ct?1e3*o:o}]);let f={type:"offer",sdp:Xr(c)};return this.updateSDP({localDescription:f})}setScaleResolutionDownBy(e,t){if(t===1)return;let i=e.getParameters();return(!i.encodings||i.encodings.length===0)&&(i.encodings=[{}]),i.encodings[0].scaleResolutionDownBy=t,e.setParameters(i)}updateSDP(){let{localDescription:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this._parsedAnswer)return Promise.resolve();let t=Xr(this._parsedAnswer);return this._updateSDPPromise=new Promise((i,r)=>B(this,null,function*(){var o,c;try{!e&&this._peerConnection&&(this._log.info("creating offer"),e=yield this._peerConnection.createOffer()),e&&(yield this.setOffer(e)),yield this.setAnswer({type:"answer",sdp:t}),this._updateSDPPromise=null,i()}catch(u){this._log.error(u),!this._isSDPLogged&&this._peerConnection&&(this._log.warn("current offer: ".concat(this.filterSDPDirection((o=this._peerConnection.localDescription)==null?void 0:o.sdp),` 
next offer: `).concat(this.filterSDPDirection(e==null?void 0:e.sdp))),this._log.warn("current answer: ".concat(this.filterSDPDirection((c=this._peerConnection.remoteDescription)==null?void 0:c.sdp),` 
next answer: `).concat(this.filterSDPDirection(t))),this._log.warn("offer: ".concat(e==null?void 0:e.sdp)),this._log.warn("answer: ".concat(t)),this._log.warn("transceivers: ".concat(JSON.stringify(this._peerConnection.getTransceivers().map(f=>{let{mid:d,currentDirection:_,direction:E,stopped:S}=f;return{mid:d,currentDirection:_,direction:E,stopped:S}})))),this._log.warn("parsedAnswer: ".concat(JSON.stringify(this._parsedAnswer))),this._isSDPLogged=!0),this._updateSDPPromise=null,r(u)}})),this._updateSDPPromise}filterSDPDirection(){return Kt(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").media.map(e=>e.direction)}setOffer(e){return this._log.info("setting offer"),this._peerConnection.setLocalDescription({type:"offer",sdp:PF(e.sdp)})}setAnswer(e){return this._log.info("setting answer"),this._room.enableHWEncoder&&e.sdp&&(e.sdp=e.sdp.replaceAll("42e01f","42001f")),this._peerConnection.setRemoteDescription(e)}sendDataChannelMessage(e){var t;(t=this._datachannel)==null||t.send(e)}reset(){var e;(e=this._peerConnection)==null||e.close(),this._waitForPCConnectedPromise=null,this._parsedAnswer=null}close(){this._log.info("close pc"),this.seiCodec&&(this.seiCodec.destroy(),this.seiCodec=null),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED"),this._downlinkMIDMap.clear(),this.stopReconnection(),this.removeAllListeners()}sendSEI(e,t){var i;(i=this.seiCodec)==null||i.push(e,t)}};Ie([mR("reconnect")],Cl.prototype,"startReconnection"),Ie([ah(e=>e.userId)],Cl.prototype,"addDownlink"),Ie([ah(e=>e)],Cl.prototype,"removeDownlink"),Ie([Sa(!0)],Cl.prototype,"updateSDP");var VF=class{constructor(e){b(this,"tag"),b(this,"len"),b(this,"data");let t=new DataView(e);this.tag=t.getUint16(),this.len=t.getUint16(2),this.data=new Uint8Array(e).slice(4,4+this.len).buffer}},UF=class{constructor(e){b(this,"tinyId"),b(this,"data");let t=new DataView(e),i=0,r=[];for(;i<t.byteLength;){let o=t.getUint16(i+2),c=new VF(new Uint8Array(e).slice(i,i+2+2+o).buffer);r.push(c),i+=4+o}r.forEach(o=>{o.tag===1?this.tinyId=new TextDecoder().decode(o.data):o.tag===2&&(this.data=o.data)})}},oC=new Set;function wa(){let e=Math.floor(4294967296*Math.random());return oC.has(e)?wa():(oC.add(e),e)}var FF=ni(Di()),aC=class extends FF.default{constructor(e){super(),b(this,"userId"),b(this,"tinyId"),b(this,"_sdpSemantics"),b(this,"_isUplink"),b(this,"_room"),b(this,"_log"),b(this,"_signalChannel"),b(this,"_currentState","DISCONNECTED"),b(this,"_prevTime",-1),b(this,"_enableSEI"),this.userId=e.userId,this.tinyId=e.tinyId,this._room=e.room,this._sdpSemantics=e.room.sdpSemantics,this._isUplink=e.isUplink,this._log=Te.createLogger({id:"n",userId:this._room.userId,remoteUserId:this._isUplink?void 0:this.userId,sdkAppId:this._room.sdkAppId,isLocal:this._isUplink}),this._signalChannel=e.signalChannel,this._enableSEI=e.enableSEI}get _peerConnection(){var e;return((e=this.singlePC)==null?void 0:e.getPeerConnection())||null}get singlePC(){return this._room.singlePC}close(e){this._log.info("close connection"),this.emit("closed",e)}emitConnectionStateChangedEvent(e){return e!==this._currentState&&(pe.emit(oe.PEER_CONNECTION_STATE_CHANGED,{room:this._room,prevState:this._currentState,state:e,remoteUserId:this._isUplink?void 0:this.userId}),this.emit("connection-state-changed",{prevState:this._currentState,state:e}),this._currentState=e,!0)}getPeerConnection(){return this._peerConnection}getRoom(){return this._room}getUserId(){return this.userId}getTinyId(){return this.tinyId}getCurrentState(){return this._currentState}get isH264(){var e,t;return!((t=(e=this._peerConnection)==null?void 0:e.remoteDescription)==null||!t.sdp.includes("H264"))}},cC=class extends aC{constructor(e){super(qe(Oe({},e),{isUplink:!0})),b(this,"localMainAudioTrack",null),b(this,"localMainVideoTrack",null),b(this,"localAuxAudioTrack",null),b(this,"localAuxVideoTrack",null),b(this,"_isPublishingAux",!1),b(this,"_publishingLocalAudioTrack"),b(this,"_publishingLocalVideoTrack"),b(this,"_mediaSettings",{videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0}),b(this,"_flag",0),b(this,"_checkPublishStateTimeoutId",-1),this.initialize()}get ssrc(){if(!this.singlePC)return{audio:0,video:0,videoRtx:0,small:0,smallRtx:0,auxiliary:0,auxiliaryRtx:0};let{audioSsrc:e,bigVideoSsrc:t,bigVideoRtxSsrc:i,smallVideoSsrc:r,smallVideoRtxSsrc:o,auxVideoSsrc:c,auxVideoRtxSsrc:u}=this.singlePC.uplinkSSRC;return{audio:e||0,video:t||0,videoRtx:i||0,small:r||0,smallRtx:o||0,auxiliary:c||0,auxiliaryRtx:u||0}}get flag(){return this._flag}set flag(e){this._flag!==e&&(this._flag=e,this.checkPublishState())}checkPublishState(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(!e&&this._checkPublishStateTimeoutId>0)return;let{publishState:t,serverPublishState:i}=this,r=Object.keys(t).find(o=>t[o]!==i[o]);if(r){if(!e)return void(this._checkPublishStateTimeoutId=Dt.run(Uc,()=>this.checkPublishState(!0),{delay:1e4,count:1}));this._log.warn("publish state not matched, ".concat(r," local:").concat(t[r]," server:").concat(i[r]," ").concat(hg())),et.addCount({key:521e3})}Dt.clearTask(this._checkPublishStateTimeoutId),this._checkPublishStateTimeoutId=-1}get isMainStreamPublished(){return!(!this.localMainAudioTrack&&!this.localMainVideoTrack)}get isAuxStreamPublished(){return!(!this.localAuxVideoTrack&&!this.localAuxAudioTrack)}get publishState(){var e,t,i,r;let o={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this._peerConnection){let c=this._peerConnection.getSenders();c&&(Wr()?(o.audio=!((e=c[0])==null||!e.track),o.bigVideo=!((t=c[1])==null||!t.track),o.smallVideo=!((i=c[2])==null||!i.track),o.auxVideo=!((r=c[3])==null||!r.track)):c.forEach(u=>{u.track&&(u.track.kind===N.AUDIO?o.audio=!0:(o.bigVideo=!0,this._room.videoManager.hasSmall&&(o.smallVideo=!0)))}))}return o}get serverPublishState(){return{audio:!!(this.flag&Pc),bigVideo:!!(this.flag&Oc),smallVideo:!!(this.flag&x_),auxVideo:!!(this.flag&Cd)}}get muteState(){var e,t,i;return{audio:!((e=this.localMainAudioTrack)==null||!e.muted),bigVideo:!((t=this.localMainVideoTrack)==null||!t.muted),auxVideo:!((i=this.localAuxVideoTrack)==null||!i.muted)}}initialize(){this.installEvents()}reset(){this.uninstallEvents(),this.uninstallTrackMuteEvents(this.localMainAudioTrack,this.localMainVideoTrack,this.localAuxVideoTrack)}close(e){super.close(e),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED")}installEvents(){var e;this.listeners("connection-state-changed").includes(this.handleConnectionStateChange)||this.on("connection-state-changed",this.handleConnectionStateChange,this),this.listeners("spc-reconnected").includes(this.onSinglePCReconnected)||(e=this.singlePC)==null||e.on("spc-reconnected",this.onSinglePCReconnected,this)}uninstallEvents(){var e;this.off("connection-state-changed",this.handleConnectionStateChange,this),(e=this.singlePC)==null||e.off("spc-reconnected",this.onSinglePCReconnected,this)}emitConnectionStateChangedEvent(e,t){var i,r,o;let c=this._currentState,u=super.emitConnectionStateChangedEvent(e);return u&&c!==e&&(t?t.emit("connection-state-changed",{prevState:c,state:e}):((i=this.localMainVideoTrack)==null||i.emit("connection-state-changed",{prevState:c,state:e}),(r=this.localAuxVideoTrack)==null||r.emit("connection-state-changed",{prevState:c,state:e}),(o=this._publishingLocalVideoTrack)==null||o.emit("connection-state-changed",{prevState:c,state:e}))),u}publish(e){return B(this,arguments,function(t){var i=this;let{localAudioTrack:r,localVideoTrack:o,isAuxiliary:c}=t;return function*(){var u,f,d,_,E,S,R;if(!i.singlePC)return;yield i.singlePC.waitForPeerConnectionConnected();let k,{publishState:U,muteState:K}=i;if(r&&(i._publishingLocalAudioTrack=r,U.audio=!0,K.audio=r.muted),o){if(!i.singlePC.isH264EncodeSupported&&!i.singlePC.isVP8EncodeSupported)throw new ke({code:ge.NOT_SUPPORTED_H264,message:je({key:Ve.NOT_SUPPORTED_H264ENCODE})});Gi&&da()===115&&o.profile.width*o.profile.height<=230400&&(i._log.warn("fallback video to 480p"),o.setProfile(bn["480p_2"]),yield o.applyProfile()),i._publishingLocalVideoTrack=o,c?(U.auxVideo=!0,K.auxVideo=o.muted):(U.bigVideo=!0,K.bigVideo=o.muted)}if(i._isPublishingAux=c,o&&!c&&o.small&&(k=i._room.videoManager.smallTrack,U.smallVideo=!0),yield i._signalChannel.sendWaitForResponseWithRetry({command:rF,responseCommand:Je.SPC_PUBLISH_RESULT,data:qe(Oe({},i.singlePC.uplinkSSRC),{state:U,muteState:K}),retries:3}),yield i.publishByTransceiver({localAudioTrack:r,localVideoTrack:o,smallTrack:k,isAuxiliary:c}),(u=i.singlePC.seiCodec)==null||u.handleEncodedStreams(),i._publishingLocalAudioTrack=null,i._publishingLocalVideoTrack=null,i._isPublishingAux=!1,c)o&&(i.localAuxVideoTrack=o),r&&(i.localAuxAudioTrack=r);else{if(o){i.localMainVideoTrack=o;let{scaleResolutionDownBy:se}=o;se>1&&(i._log.warn("setScaleResolutionDownBy main ".concat(se)),yield i.singlePC.setScaleResolutionDownBy(i._peerConnection.getSenders()[1],se))}r&&(i.localMainAudioTrack=r)}yield i.singlePC.setBandwidth({audio:((f=i.localMainAudioTrack)==null?void 0:f.profile.bitrate)||((d=i.localAuxAudioTrack)==null?void 0:d.profile.bitrate),bigVideo:(_=i.localMainVideoTrack)==null?void 0:_.profile.bitrate,smallVideo:(S=(E=i.localMainVideoTrack)==null?void 0:E.small)==null?void 0:S.bitrate,auxVideo:(R=i.localAuxVideoTrack)==null?void 0:R.profile.bitrate}),i.sendMediaSettings(),i.installTrackMuteEvents(r,o)}()})}publishByTransceiver(e){let{localAudioTrack:t,localVideoTrack:i,smallTrack:r,isAuxiliary:o}=e;if(!sr())return;this._log.info("publish by transceiver");let c=i==null?void 0:i.outMediaTrack,u=t==null?void 0:t.outMediaTrack,f=this._peerConnection.getTransceivers(),d=[],_=[];if(u){let S=f[0].sender.replaceTrack(u);_.push(0),d.push(S)}if(c)if(o){let S=f[3].sender.replaceTrack(c);_.push(3),d.push(S)}else{let S=f[1].sender.replaceTrack(c);_.push(1),d.push(S)}if(r){let S=f[2].sender.replaceTrack(r);_.push(2),d.push(S)}let E=this.setTransceiverDirection(Xe.SENDONLY,_);return d.push(E),Promise.all(d)}enableSmall(e){return B(this,null,function*(){if(!this.singlePC)return;let t=this._peerConnection.getTransceivers();e?this._room.videoManager.smallTrack&&(yield t[2].sender.replaceTrack(this._room.videoManager.smallTrack),yield this.setTransceiverDirection(Xe.SENDONLY,[2])):(yield t[2].sender.replaceTrack(null),yield this.setTransceiverDirection(Xe.INACTIVE,[2])),this.updateMediaSettings(),yield this.doPublishChange()})}installTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(r=>{r&&(r==null||r.on("mute",this.sendMutedFlag,this),r==null||r.on("unmute",this.sendMutedFlag,this))})}uninstallTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(r=>{r&&(r==null||r.off("mute",this.sendMutedFlag,this),r==null||r.off("unmute",this.sendMutedFlag,this))})}unpublish(e){return B(this,arguments,function(t){var i=this;let{localAudioTrack:r,localVideoTrack:o}=t;return function*(){let c=o&&o===i.localAuxVideoTrack,u=o==null?void 0:o.outMediaTrack,f=i._peerConnection.getSenders(),d=[];r&&(yield f[0].replaceTrack(null),d.push(0),c?i.localAuxAudioTrack=null:i.localMainAudioTrack=null),u&&(c?(yield f[3].replaceTrack(null),i.localAuxVideoTrack=null,i._mediaSettings=qe(Oe({},i._mediaSettings),{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),d.push(3)):(yield f[1].replaceTrack(null),yield f[2].replaceTrack(null),i.localMainVideoTrack=null,i._mediaSettings=qe(Oe({},i._mediaSettings),{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),d.push(1,2))),i.isMainStreamPublished||i.isAuxStreamPublished?(yield i.setTransceiverDirection(Xe.INACTIVE,d),yield i.doPublishChange(!1)):yield i.doUnpublish(),i.uninstallTrackMuteEvents(r,o),o==null||o.emit("connection-state-changed",{prevState:i._currentState,state:"DISCONNECTED"})}()})}doPublishChange(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return B(this,null,function*(){let t={state:this.publishState,constraintConfig:this._mediaSettings},i=yield this._signalChannel.sendWaitForResponseWithRetry({command:UR,data:t,responseCommand:Je.PUBLISH_STATE_CHANGE_RESULT,enableLog:e,retries:3});this.checkPublishResultCode(i.data.code,i.data.message)})}doUnpublish(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return this._signalChannel.sendWaitForResponse({command:t0,commandDesc:"unpublish",responseCommand:Je.UNPUBLISH_RESULT,enableLog:e}).catch(t=>{if(t.getCode()===ge.API_CALL_TIMEOUT)return Promise.resolve();throw t})}updateMediaSettings(){let{detail:{isH264EncodeSupported:e,isVp8EncodeSupported:t}}=this._room.checkSystemResult;e?this._mediaSettings.videoCodec="H264":t&&(this._mediaSettings.videoCodec="VP8");let i=this._publishingLocalAudioTrack||this.localMainAudioTrack||this.localAuxAudioTrack,{localMainVideoTrack:r,localAuxVideoTrack:o}=this;if(this._publishingLocalVideoTrack&&(this._isPublishingAux?o=this._publishingLocalVideoTrack:r=this._publishingLocalVideoTrack),ga){if(i&&i.outMediaTrack){let c=i.outMediaTrack.getSettings();this._mediaSettings.audioChannel=c.channelCount||1,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=c.sampleRate||0}if(r&&r.outMediaTrack){let c=r.outMediaTrack.getSettings();this._mediaSettings.videoWidth=c.width||0,this._mediaSettings.videoHeight=c.height||0,this._mediaSettings.videoFps=c.frameRate||0,this._mediaSettings.videoBps=1e3*r.profile.bitrate,r.small&&(this._mediaSettings.smallVideoWidth=r.small.width,this._mediaSettings.smallVideoHeight=r.small.height,this._mediaSettings.smallVideoFps=r.small.frameRate,this._mediaSettings.smallVideoBps=1e3*r.small.bitrate)}if(o&&o.outMediaTrack){let c=o.outMediaTrack.getSettings();this._mediaSettings.auxVideoWidth=c.width||0,this._mediaSettings.auxVideoHeight=c.height||0,this._mediaSettings.auxVideoFps=c.frameRate||0,this._mediaSettings.auxVideoBps=1e3*o.profile.bitrate}}else i&&i.outMediaTrack&&(this._mediaSettings.audioChannel=i.profile.channelCount,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=i.profile.sampleRate),r&&r.outMediaTrack&&(this._mediaSettings.videoWidth=r.profile.width,this._mediaSettings.videoHeight=r.profile.height,this._mediaSettings.videoFps=r.profile.frameRate,this._mediaSettings.videoBps=1e3*r.profile.bitrate);this._log.info("updateMediaSettings: ".concat(JSON.stringify(this._mediaSettings)))}sendMediaSettings(){this.updateMediaSettings(),this._signalChannel.sendWaitForResponse({command:HR,data:this._mediaSettings,responseCommand:Je.UPDATE_CONSTRAINT_CONFIG_RES}).then(e=>{e.data.code!==0&&this._log.warn(e.data.message)}).catch(()=>{})}addTrack(e){return B(this,null,function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is adding ".concat(e.kind," track to current published local ").concat(t?N.AUXILIARY:N.MAIN," stream")),Wr()&&(yield this.addTrackByTransceiver(e,t))})}addTrackByTransceiver(e,t){return B(this,null,function*(){var i;if(!e.mediaTrack)return;let r=this._peerConnection.getTransceivers();if(e.kind===N.AUDIO)yield r[0].sender.replaceTrack(e.outMediaTrack);else{let o=t?3:1;yield r[o].sender.replaceTrack(e.outMediaTrack),o===1&&((i=this.localMainVideoTrack)!=null&&i.small)&&(yield r[2].sender.replaceTrack(this._room.videoManager.smallTrack)),r[o].direction===Xe.INACTIVE&&(yield this.setTransceiverDirection(Xe.SENDONLY,[o]))}this.updateMediaSettings(),yield this.doPublishChange()})}removeTrack(e){return B(this,null,function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is removing ".concat(e.kind," track from current published local ").concat(t?N.AUXILIARY:N.MAIN," stream")),Wr()&&(yield this.removeTrackByTransceiver(e,t))})}removeTrackByTransceiver(e,t){return B(this,null,function*(){if(!e.mediaTrack)return;let i=this._peerConnection.getTransceivers();if(e.kind===N.AUDIO)yield i[0].sender.replaceTrack(null);else{let r=t?3:1;yield i[r].sender.replaceTrack(null),r===1&&this._room.videoManager.hasSmall&&(yield i[2].sender.replaceTrack(null)),yield this.setTransceiverDirection(Xe.INACTIVE,[r])}this.updateMediaSettings(),yield this.doPublishChange()})}setTransceiverDirection(e,t){return B(this,null,function*(){if(!Ct)return;let i=!1,r=!1;this._log.info("setting transceiver ".concat(t.join(",")," direction to ").concat(e));let o=this._peerConnection.getTransceivers();if(t.forEach(f=>{o[f].direction!==e&&(o[f].direction=e,i=!0)}),i){this._log.info("updating offer");let f=yield this._peerConnection.createOffer();yield this._peerConnection.setLocalDescription(f)}let c=-1,u=this._peerConnection.remoteDescription.sdp.split(`\r
`).map(f=>{if(f.match(new RegExp("a=(".concat(Xe.INACTIVE,"|").concat(Xe.RECVONLY,"|").concat(Xe.SENDONLY,")")))&&c++,t.includes(c)){if(e===Xe.INACTIVE&&f.includes("a=".concat(Xe.RECVONLY)))return r=!0,"a=".concat(e);if(e===Xe.SENDONLY&&f.includes("a=".concat(Xe.INACTIVE)))return r=!0,"a=".concat(Xe.RECVONLY)}return f}).join(`\r
`);r&&(this._log.info("updating answer"),yield this._peerConnection.setRemoteDescription({type:"answer",sdp:u}))})}replaceTrack(e){return B(this,null,function*(){var t;let i=(t=this._peerConnection)==null?void 0:t.getSenders(),r=e.outMediaTrack||e.mediaTrack;if(!i||i.length===0||!r||i.find(c=>c.track===r))return;let o=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is replacing ".concat(r.kind," track on ").concat(o?N.AUXILIARY:N.MAIN," stream")),r.kind===N.AUDIO&&i[0]&&(yield i[0].replaceTrack(r)),r.kind===N.VIDEO&&(!o&&i[1]&&(yield i[1].replaceTrack(r)),o&&i[3]&&(yield i[3].replaceTrack(r)))})}setBandwidth(e){return B(this,arguments,function(t){var i=this;let{bandwidth:r,type:o,videoType:c}=t;return function*(){if(i.singlePC){let u={};o===N.AUDIO?u.audio=r:c==="big"?u.bigVideo=r:c==="small"?u.smallVideo=r:u.auxVideo=r,yield i.singlePC.setBandwidth(u)}}()})}sendMutedFlag(e){e===this.localAuxAudioTrack||e===this.localAuxVideoTrack||(this._log.info("send muted state: ".concat(JSON.stringify(this.muteState))),this._signalChannel.sendWaitForResponseWithRetry({command:VR,responseCommand:Je.MUTE_RESULT,data:this.muteState,retries:3}).catch(()=>{}))}handleConnectionStateChange(e){e.state==="CONNECTED"&&(this.localMainVideoTrack||this._publishingLocalVideoTrack&&!this._isPublishingAux)&&pe.emit(oe.SEND_FIRST_VIDEO_FRAME,{room:this._room})}getVideoTrackId(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N.VIDEO;if(this._peerConnection){let t=this._peerConnection.getSenders();if(e===N.AUXILIARY&&t[3]&&t[3].track)return t[3].track.id;if(e===N.VIDEO&&t[1]&&t[1].track)return t[1].track.id}if(this.localMainVideoTrack&&e===N.VIDEO){let t=this.localMainVideoTrack.mediaTrack;if(t)return t.id}if(this.localAuxVideoTrack&&e===N.AUXILIARY){let t=this.localAuxVideoTrack.mediaTrack;if(t)return t.id}return""}getSSRC(){return this.ssrc}checkPublishResultCode(e,t){if(e!==0)throw e===Nd?(this._log.error(sn.NOT_SUPPORTED_H264ENCODE),new ke({code:ge.NOT_SUPPORTED_H264,message:je({key:Ve.NOT_SUPPORTED_H264ENCODE})})):new ke({code:ge.UNKNOWN,message:je({key:Ve.SIGNAL_RESPONSE_FAILED,data:{signalResponse:Je.PUBLISH_RESULT,code:e,message:t}})})}onSinglePCReconnected(){return B(this,null,function*(){this.isMainStreamPublished&&(this._log.warn("republish main stream"),yield this.publish({localAudioTrack:this.localMainAudioTrack,localVideoTrack:this.localMainVideoTrack,isAuxiliary:!1})),this.isAuxStreamPublished&&(this._log.warn("republish aux stream"),yield this.publish({localAudioTrack:this.localAuxAudioTrack,localVideoTrack:this.localAuxVideoTrack,isAuxiliary:!0}))})}};function lC(e){return Object.keys(e).filter(t=>e[t])}var d0=class extends aC{constructor(e){super(qe(Oe({},e),{isUplink:!1})),b(this,"_flag",0),b(this,"role","anchor"),b(this,"remoteAudioTrack"),b(this,"remoteVideoTrack"),b(this,"remoteAuxiliaryTrack"),b(this,"ssrc",{audio:0,video:0,videoRtx:0,auxiliary:0,auxiliaryRtx:0}),this.flag=e.flag,this.remoteAudioTrack=new Kg(this._room,this),this.remoteVideoTrack=new ml(this._room,this),this.remoteAuxiliaryTrack=new yR(this._room,this),this.initialize()}get subscribeState(){return{audio:this.remoteAudioTrack.isSubscribed||this.remoteAudioTrack.isSubscribing,video:this.remoteVideoTrack.isBig&&(this.remoteVideoTrack.isSubscribed||this.remoteVideoTrack.isSubscribing),smallVideo:this.remoteVideoTrack.isSmall&&(this.remoteVideoTrack.isSubscribed||this.remoteVideoTrack.isSubscribing),auxiliary:this.remoteAuxiliaryTrack.isSubscribed||this.remoteAuxiliaryTrack.isSubscribing}}get muteState(){return tl(this.flag,this.userId)}get flag(){return this._flag}set flag(e){var t,i,r;e!==this._flag&&(this._flag=e,(t=this.remoteAudioTrack)==null||t.onFlagChanged(),(i=this.remoteVideoTrack)==null||i.onFlagChanged(),(r=this.remoteAuxiliaryTrack)==null||r.onFlagChanged())}get hasMainStream(){return this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall}get hasAuxStream(){return this.muteState.hasAuxiliary}get isMainStreamSubscribed(){return(this.subscribeState.audio||this.subscribeState.video||this.subscribeState.smallVideo)&&(this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall)}get isAuxStreamSubscribed(){return this.subscribeState.auxiliary&&this.muteState.hasAuxiliary}get isSmallStreamSubscribed(){return this.subscribeState.smallVideo&&this.muteState.hasSmall}get isBigStreamSubscribed(){return this.subscribeState.video&&this.muteState.hasVideo}isStreamUnpublished(e){return e===N.MAIN?!this.muteState.hasAudio&&!this.muteState.hasVideo:!this.muteState.hasAuxiliary}initialize(){this.installEvents()}close(e){super.close(e),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.remoteAudioTrack.close(),this.remoteVideoTrack.close(),this.remoteAuxiliaryTrack.close(),this.uninstallEvents(),this.removeDownlink()}installEvents(){!this.singlePC||(this.listeners("track").includes(this.onTrack)||this.singlePC.on("track",this.onTrack,this),this.listeners("spc-reconnected").includes(this.onSinglePCReconnected)||this.singlePC.on("spc-reconnected",this.onSinglePCReconnected,this))}uninstallEvents(){!this.singlePC||(this.singlePC.off("track",this.onTrack,this),this.singlePC.off("spc-reconnected",this.onSinglePCReconnected,this))}emitConnectionStateChangedEvent(e){var t,i;let r=this._currentState,o=super.emitConnectionStateChangedEvent(e);return o&&r!==e&&((t=this.remoteVideoTrack)==null||t.emit("connection-state-changed",{prevState:r,state:e}),(i=this.remoteAuxiliaryTrack)==null||i.emit("connection-state-changed",{prevState:r,state:e})),o}onTrack(e){let t=e.streams[0],{track:i}=e;if(!t.id.includes(this.tinyId))return;let r=t.id.includes("aux")?"auxiliary":"main";this._log.debug("ontrack ".concat(r," ").concat(i.kind));let o=N.AUDIO;i.kind===N.VIDEO&&(o=r===N.MAIN?N.VIDEO:N.AUXILIARY);let c=this.remoteAudioTrack;o===N.VIDEO?c=this.remoteVideoTrack:o===N.AUXILIARY&&(c=this.remoteAuxiliaryTrack),c.setInputMediaStreamTrack(i)}isSubscriptionStateNotChanged(e){return JSON.stringify(e)===JSON.stringify(this.subscribeState)}subscribe(e,t){return B(this,null,function*(){try{if(this.isSubscriptionStateNotChanged(e))return;if(this._log.info("subscribe ".concat(t," ").concat(lC(e))),this.hasSSRC){let i="subscribe_change";Object.values(e).find(r=>r===!0)||(i="unsubscribe"),yield this.sendSubscription(i,e)}else yield this.doSubscribe(e),this.checkTrackEnded(e)}catch(i){throw this._room.isJoined&&this.isStreamUnpublished(t)?(this._log.warn("".concat(i.message," ").concat(JSON.stringify(this.muteState))),new ke({code:ge.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId," unpublished stream")})):i}})}checkTrackEnded(e){var t,i,r;(e.audio&&((t=this.remoteAudioTrack.mediaTrack)==null?void 0:t.readyState)==="ended"||e.video&&((i=this.remoteVideoTrack.mediaTrack)==null?void 0:i.readyState)==="ended"||e.auxiliary&&((r=this.remoteAuxiliaryTrack.mediaTrack)==null?void 0:r.readState)==="ended")&&this.singlePC&&!this.singlePC.isReconnecting&&(this._log.warn("remote track ended start spc reconnect"),this.singlePC.startReconnection())}unsubscribe(e){return B(this,arguments,function(t){var i=this;let{remoteTracks:r,streamType:o}=t;return function*(){var c;if(o==="main"&&!i.isMainStreamSubscribed||o==="auxiliary"&&!i.isAuxStreamSubscribed)return void i._log.info("".concat(o," stream already unsubscribed"));let u=Oe({},i.subscribeState);r.forEach(d=>{switch(d.mediaType){case 1:u.audio=!1;break;case 4:u.video=!1;break;case 8:u.smallVideo=!1;break;case 2:u.auxiliary=!1}});let f="subscribe_change";Object.values(u).find(d=>d===!0)||(f="unsubscribe"),i._log.info("".concat(f==="unsubscribe"?f:"subscribe"," ").concat(o," [").concat(lC(u),"]")),f==="unsubscribe"&&((c=i.singlePC)==null||c.removeDownlinkQueue.add(i.tinyId)),yield i.sendSubscription(f,u),f==="unsubscribe"&&(yield i.removeDownlink())}()})}sendSubscription(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscribeState,i={srcTinyId:this.tinyId,srcUserId:this.userId},r=FR,o=Je.UNSUBSCRIBE_RESULT;return e==="subscribe_change"&&(i={audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,srcTinyId:this.tinyId},r=BR,o=Je.SUBSCRIBE_CHANGE_RESULT),this._signalChannel.sendWaitForResponseWithRetry({command:r,data:i,responseCommand:o,timeout:1e4,retries:3}).then(c=>{let{data:u}=c;if(u.code!==0){let f=new ke({code:u.code,message:je({key:Ve.ERROR_MESSAGE,data:{type:e,message:u.message}})});throw this._log.error(f),f}})}getMainStreamVideoTrackId(){return this.remoteVideoTrack&&this.remoteVideoTrack.mediaTrack?this.remoteVideoTrack.mediaTrack.id:""}getAuxStreamVideoTrackId(){return this.remoteAuxiliaryTrack&&this.remoteAuxiliaryTrack.mediaTrack?this.remoteAuxiliaryTrack.mediaTrack.id:""}setDelay(e){let{audioDelay:t,videoDelay:i}=e;this.remoteAudioTrack.stat.end2EndDelay=t,this.remoteVideoTrack.stat.end2EndDelay=i}onSinglePCReconnected(){(this.ssrc.audio||this.ssrc.video||this.ssrc.auxiliary)&&(this._log.warn("resubscribe ".concat(JSON.stringify(this.subscribeState))),this.doSubscribe(this.subscribeState))}get hasSSRC(){return this.ssrc.audio&&this.ssrc.video&&this.ssrc.auxiliary}doSubscribe(){return B(this,arguments,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.subscribeState,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return function*(){if(e.singlePC){if(e.singlePC.addDownlinkQueue.add(e.tinyId),yield e.singlePC.waitForPeerConnectionConnected(),i||!e.hasSSRC){let r={audioSsrc:wa(),bigVideoSsrc:wa(),bigVideoRtxSsrc:wa(),auxVideoSsrc:wa(),auxVideoRtxSsrc:wa()},{audioSsrc:o,bigVideoSsrc:c,bigVideoRtxSsrc:u,auxVideoSsrc:f,auxVideoRtxSsrc:d}=r;e.ssrc={audio:o,video:c,videoRtx:u,auxiliary:f,auxiliaryRtx:d},e.singlePC.addDownlinkQueue.delete(e.tinyId),yield e.singlePC.addDownlink({userId:e.userId,tinyId:e.tinyId,ssrc:e.ssrc});try{let _=yield e._signalChannel.sendWaitForResponseWithRetry({command:sF,responseCommand:Je.SPC_SUBSCRIBE_RESULT,data:{srcUserId:e.userId,srcTinyId:e.tinyId,audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,customData:!1,ssrc:r},retries:3,retryTimeout:0});if(_.data.code!==0)throw new ke({code:_.data.code,message:_.data.message})}catch(_){throw yield e.removeDownlink(),_}return}e.singlePC.addDownlinkQueue.delete(e.tinyId),yield e.singlePC.addDownlink({userId:e.userId,tinyId:e.tinyId,ssrc:e.ssrc})}}()})}removeDownlink(){return B(this,null,function*(){!this.singlePC||(this.ssrc={audio:0,video:0,videoRtx:0,auxiliary:0,auxiliaryRtx:0},this.singlePC.removeDownlinkQueue.delete(this.tinyId),yield this.singlePC.removeDownlink(this.userId))})}};Ie([Sa(),St(e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return new Promise((o,c)=>{let u=f=>{this.off("closed",u),c(new ke({code:ge.API_CALL_ABORTED,message:je({key:Ve.CONNECTION_ABORTED,data:f})}))};this.on("closed",u),e.apply(this,i).then(o,c).finally(()=>{this.off("closed",u)})})})],d0.prototype,"subscribe"),Ie([Sa()],d0.prototype,"unsubscribe");var BF=d0,HF=ni(Di()),uC=class extends HF.EventEmitter{constructor(e,t){super(),this.room=e,this.signalChannel=t,b(this,"log"),b(this,"cmdIdSeqMap",new Map),b(this,"messageMap",new Map),this.log=Te.createLogger({id:"cmm",userId:e.userId}),this.onReceiveMsg=this.onReceiveMsg.bind(this),t.on(Je.RECEIVE_CUSTOM_MSG,this.onReceiveMsg)}send(e){let{cmdId:t,data:i}=e,r=this.cmdIdSeqMap.get(t)||Math.floor(16383*Math.random()),o={cmdId:t,msg:btoa(String.fromCharCode(...new Uint8Array(i))),ordered:!0,reliable:!0,streamSeq:r};this.cmdIdSeqMap.set(t,r+1),this.signalChannel.send(cF,o)}onReceiveMsg(e){let{data:t}=e.data,i=this.room.tinyIdToUserIdMap.get(t.srcTinyId);if(i){let r={userId:i,cmdId:t.cmdId,seq:t.streamSeq,data:Uint8Array.from(atob(t.msg),o=>o.charCodeAt(0)).buffer};if(t.ordered){let o="".concat(i,"_").concat(r.cmdId),c=this.messageMap.get(o);if(!c||Math.abs(c.lastSeq-r.seq)>uC.SEQ_INTERVAL)this.messageMap.set(o,{lastSeq:r.seq,cachedMessageMap:new Map}),this.emitMessage(r);else if(r.seq>c.lastSeq){if(r.seq===c.lastSeq+1)this.emitMessage(r);else if(!c.cachedMessageMap.has(r.seq)){let u=setTimeout(()=>this.emitMessage(r,!0),5e3);c.cachedMessageMap.set(r.seq,{message:r,timeoutId:u})}}else this.log.debug("drop message ".concat(r.userId,"-").concat(r.cmdId,"-").concat(r.seq))}else this.emit("message",r)}}emitMessage(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];var i;let r=this.messageMap.get("".concat(e.userId,"_").concat(e.cmdId)),o=e;if(r){if(t){let u=[...r.cachedMessageMap.values()].sort((f,d)=>f.message.seq-d.message.seq);u[0]&&(o=u[0].message)}o.seq-r.lastSeq>1&&this.log.debug("msg lost userId: ".concat(o.userId," seq: ").concat(r.lastSeq," -> ").concat(o.seq)),r.lastSeq=o.seq,clearTimeout((i=r.cachedMessageMap.get(o.seq))==null?void 0:i.timeoutId),r.cachedMessageMap.delete(o.seq)}this.emit("message",o);let c=r==null?void 0:r.cachedMessageMap.get(o.seq+1);c&&this.emitMessage(c.message)}},dC=uC;b(dC,"SEQ_INTERVAL",300);var hC,{isString:pC,isUndefined:ka,getNetworkType:jF,isEmpty:wl}=Sn,Zs=class extends NF{constructor(e){super(e),this._heartbeat=-1,this._lastHeartBeatTime=-1,this._joinTimeout=-1,this._firstPublishedList=null,this._joinReject=null,this._isRelayChanged=!1,this._signalChannel=null,this.uplinkConnection=null,this.singlePC=null,this.enableSPC=eh,this._changeBigSmallRecords=new Map,this._networkQuality=null,this._turnServers=[],this._syncUserListInterval=-1,this._smallStreamConfig={bitrate:100,frameRate:15,height:120,width:160},this.enableSEI=!1,this._enableAudioVolumeEvaluation=!1,this._audioVolumeIntervalId=0,this._enableMultiAuxStream=!1,this._pureAudioPushMode=!1,this.enableHWEncoder=!1,this._stats=new uF(this,this._log),this.userManager=new R7(this.userId,this._log),this._version=In,this.sdpSemantics=kd,ka(e.sdpSemantics)?nl.isUnifiedPlanDefault()&&(this.sdpSemantics=Mc):this.sdpSemantics=e.sdpSemantics,this._log.info("sdpSemantics: ".concat(this.sdpSemantics,", netType: ").concat(jF())),e.iceTransportPolicy&&(this._iceTransportPolicy=e.iceTransportPolicy),this._enableMultiAuxStream=!ka(e.enableMultiAuxStream)&&e.enableMultiAuxStream,this.enableSEI=e.enableSEI,!ka(e.enableSPC)&&eh&&(this.enableSPC=e.enableSPC),this.enableHWEncoder=e.enableHWEncoder||!1,this._initBusinessInfo(e)}get isMainStreamPublished(){var e;return!((e=this.uplinkConnection)==null||!e.isMainStreamPublished)}get isMainAudioPublished(){var e;return!((e=this.uplinkConnection)==null||!e.localMainAudioTrack)}get isAuxStreamPublished(){var e;return!((e=this.uplinkConnection)==null||!e.isAuxStreamPublished)}get hasAuxStream(){return[...this.remotePublishedUserMap.values()].findIndex(e=>e.muteState.hasAuxiliary)>=0}get userMap(){return this.userManager.userMap}get remotePublishedUserMap(){return this.userManager.remotePublishedUserMap}get tinyIdToUserIdMap(){return new Map([...this.userMap.values()].map(e=>[e.tinyId,e.userId]))}join(e,t,i){return B(this,null,function*(){return this.userManager.mySelfId=this.userId,this.userManager.on("1",r=>{this.emit("peer-join",r)}),this.userManager.on("2",r=>{this.closeDownLinkConnection(r,"remote user exitRoom"),this.emit("peer-leave",r)}),this.userManager.on("3",this.createDownlinkConnection,this),this.userManager.on("5",this.closeDownLinkConnection,this),this.userManager.on("6",r=>{var o=((c,u)=>{var f={};for(var d in c)S_.call(c,d)&&u.indexOf(d)<0&&(f[d]=c[d]);if(c!=null&&Ad)for(var d of Ad(c))u.indexOf(d)<0&&Rb.call(c,d)&&(f[d]=c[d]);return f})(r,[]);pe.emit(oe.REMOTE_PUBLISH_STATE_CHANGED,Oe({room:this},o)),this.emit("remote-publish-state-changed",Oe({},o))}),this._joinOptions=e,new Promise((r,o)=>B(this,null,function*(){var c,u;this._joinReject=o;try{this.checkDestroy();try{yield Promise.all([this.initialize(),this.initSinglePC()])}catch(f){if(!(f instanceof ke&&f.code===ge.SPC_INITIALIZED_FAILED))return o(f);(c=this._signalChannel)==null||c.destroy(),yield this.initialize()}yield this.doJoin(e,(u=this.singlePC)==null?void 0:u.clientAbility),r(),this._firstPublishedList&&this.onPublishedUserList({data:{userList:this._firstPublishedList}})}catch(f){o(f)}this._joinReject=null}))})}initSinglePC(){return B(this,null,function*(){if(this.enableSPC&&!this.singlePC){this.singlePC=new Cl({signalChannel:this._signalChannel,room:this,enableCustomMessage:!1}),this.singlePC.on("sei-message",e=>this.emit("sei-message",e)),this.singlePC.once("error",()=>this.fallbackToMPC());try{return yield this.singlePC.initialize()}catch(e){throw this.fallbackToMPC(),new ke({code:ge.SPC_INITIALIZED_FAILED,message:e==null?void 0:e.message})}}})}doJoin(e,t){return new Promise((i,r)=>B(this,null,function*(){var o,c,u;e.privateMapKey&&(this.privateMapKey=e.privateMapKey),this._signalChannel.once(xR,_=>{this.clearJoinTimeout(),pe.emit(oe.JOIN_SIGNAL_CONNECTION_END,{room:this,error:_}),r(_)}),Pi((c=(o=this.scheduleResult)==null?void 0:o.config)==null?void 0:c.singlePC)&&eh&&(this.enableSPC=this.scheduleResult.config.singlePC),this.keyPointManager.setConnectionType(this.singlePC?1:2);let f={roomId:String(e.roomId||e.strRoomId),useStringRoomId:this.useStringRoomId,privateMapKey:this.privateMapKey,trtcRole:e.role,trtcScene:this.scene==="live"?2:1,sdpSemantics:this.sdpSemantics,version:this._version,ua:navigator&&navigator.userAgent||"",terminalType:fA(),netType:Kd(),bussinessInfo:this._businessInfo,ability:t,sdkType:this._sdkType,userSig:this.userSig};this._log.debug("join room signal data: ".concat(JSON.stringify(f)));let d=5e3;(u=this.scheduleResult.config)!=null&&u.enterRoomTimeout&&this.scheduleResult.config.enterRoomTimeout>=1&&(d=1e3*this.scheduleResult.config.enterRoomTimeout),this._joinTimeout=window.setTimeout(()=>{r(new ke({code:ge.JOIN_ROOM_FAILED,message:je({key:Ve.JOIN_ROOM_TIMEOUT})}))},d),pe.emit(oe.JOIN_SEND_CMD,{room:this}),this._signalChannel.send(this.singlePC?nF:W7,f),this._signalChannel.once(Je.JOIN_ROOM_RESULT,_=>{this.clearJoinTimeout();let{code:E,message:S,data:R,tinyId:k}=_.data;pe.emit(oe.JOIN_RECEIVED_CMD_RES,{room:this,code:E}),E===0?(this._log.info("Join room success, start heartbeat"),k&&(this.tinyId=k),this.startHeartbeat(),this.syncUserList(),this.startSyncUserListInterval(),this._firstPublishedList=R.publishers,this.singlePC&&this.singlePC.connect(R.ability).catch(()=>{}),i()):(this._log.error("Join room failed result: ".concat(E," error: ").concat(S)),r(new ke({code:ge.JOIN_ROOM_FAILED,extraCode:E,message:je({key:Ve.JOIN_ROOM_FAILED,data:{error:S,code:E}})})))})}))}reJoin(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return B(this,null,function*(){if(this.isJoined)try{this._log.warn("reJoin pending: ".concat(this._joinOptions.roomId));let t,i=[];if(this.singlePC&&(this.singlePC.close(),this.singlePC=null,i.push(this.initSinglePC().then(r=>(t=r,r)))),this._signalChannel&&(this._signalChannel.race=e,this._signalChannel.close(),i.push(this._signalChannel.connect())),yield Promise.all(i),yield this.doJoin(qe(Oe({},this._joinOptions),{role:this.role==="anchor"?20:21,privateMapKey:this.privateMapKey}),t),this._log.warn("reJoin success"),Ht.logSuccessEvent({userId:this.userId,eventType:er.REJOIN}),this.singlePC){let r=o=>{var c;o.state==="CONNECTED"&&((c=this.singlePC)==null||c.off(Qs.CONNECTION_STATE_CHANGED,r),this.uplinkConnection instanceof cC&&this.uplinkConnection.onSinglePCReconnected(),this.remotePublishedUserMap.forEach(u=>{u.installEvents(),u.onSinglePCReconnected()}))};this.singlePC.on(Qs.CONNECTION_STATE_CHANGED,r),this.checkConnectionsToReconnect(),this.uplinkConnection instanceof a0&&!this.uplinkConnection.getIsReconnecting()&&this.uplinkConnection.startReconnection()}}catch(t){this._log.warn("reJoin fail ".concat(t)),this.reset(),Ht.logFailedEvent({userId:this.userId,eventType:er.REJOIN,error:t}),this.emit("error",new ke({code:ge.JOIN_ROOM_FAILED,message:je({key:Ve.REJOIN_ROOM_FAILED,data:{roomId:this._joinOptions.roomId}})}))}else this._log.warn("reJoin abort")})}initialize(){return B(this,null,function*(){let{mainUrl:e,backupUrl:t}=this.getSignalChannelUrl(),i=this._signalChannel||function(o){return[...Th.values()].find(u=>u.room.userId===o&&!u.room.isJoined)||null}(this.userId),r=!!(i&&i.isConnected&&i.keepAlive);return this._log.info("".concat(r?"reuse":"setup"," signal channel")),r?(i.url=e,i.backupUrl=t,i.room=this,this._signalChannel=i):(this._signalChannel=new jR({sdkAppId:this.sdkAppId,userId:this.userId,userSig:this.userSig,url:e,backupUrl:t,race:this.enableSPC&&!this.proxy_ws,room:this}),this._customMessageManager=new dC(this,this._signalChannel),this._customMessageManager.on("message",o=>{this.emit("custom-message",o)})),this._networkQuality||(this._networkQuality=new c0({signalChannel:this._signalChannel,room:this}),this._networkQuality.on(c0.EVENT_NETWORK_QUALITY,o=>{this.emit("network-quality",o)})),wn(this,this._signalChannel).add(e0,o=>{pe.emit(oe.SIGNAL_CONNECTION_STATE_CHANGED,Oe({room:this},o)),this.emit("signal-connection-state-changed",o)}).add(B7,o=>{this.reset(),this.emit("error",o)}).add(Je.PEER_JOIN,o=>{let{srcTinyId:c,userId:u,role:f}=o.data.data;this.userManager.addUser({userId:u,tinyId:c,role:f})}).add(Je.PEER_LEAVE,o=>{let{userId:c,reason:u=0}=o.data.data;this.userManager.deleteUser(c,u)}).add(Je.UPDATE_REMOTE_MUTE_STAT,o=>{this._lastHeartBeatTime>0&&Date.now()-this._lastHeartBeatTime>=1e4&&this.doHeartbeat(),this.onPublishedUserList(o.data)}).add(Je.CLIENT_BANNED,o=>{let c=o.data.data,{reason:u}=c;if(Ht.uploadEvent({log:"stat-banned:".concat(u),userId:this.userId}),u==="user_time_out")return this._log.warn("".concat(u," last heart beat time: ").concat(this._lastHeartBeatTime," interval: ").concat(Date.now()-this._lastHeartBeatTime,", visibility: ").concat(document.visibilityState)),void this.reJoin();this._log[u==="kick"?"error":"info"]("user was banned because of [".concat(u,"]")),this.reset(),this.emit("banned",{reason:u})}),this._signalChannel.once(LR,o=>{this.tinyId=o.signalInfo.tinyId,pe.emit(oe.JOIN_SIGNAL_CONNECTION_END,{room:this})}),pe.emit(oe.JOIN_SIGNAL_CONNECTION_START,{room:this}),yield this._signalChannel.connect(),r&&pe.emit(oe.JOIN_SIGNAL_CONNECTION_END,{room:this}),r})}setSignalChannel(e){this._signalChannel=e,e||Ti(this)}leave(){return B(this,null,function*(){var e;try{yield this.doHeartbeat()}catch{}this._log.info("leave() => leaving room"),pe.emit(oe.LEAVE_SEND_CMD,{room:this}),(e=this._signalChannel)==null||e.send(z7)})}clearNetworkQuality(){this._networkQuality&&(this._networkQuality.stop(),this._networkQuality=null)}closeConnections(){this.remotePublishedUserMap.forEach(e=>{this.closeDownLinkConnection(e.userId,"you exitRoom")})}clearJoinTimeout(){clearTimeout(this._joinTimeout),this._joinTimeout=-1}startHeartbeat(){this._heartbeat===-1&&(this._heartbeat=Dt.run(ca,this.doHeartbeat.bind(this),{delay:2e3}))}stopHeartbeat(){this._heartbeat!==-1&&(this._log.info("stopHeartbeat"),Dt.clearTask(this._heartbeat),this._heartbeat=-1,this._lastHeartBeatTime=-1)}doHeartbeat(){return B(this,null,function*(){var e;let t=this.badCaseDetector.getMonitorFreeze(),i=yield this._stats.getStatsReport({uplinkConnection:this.uplinkConnection,downlinkConnections:this.remotePublishedUserMap,freezeMap:t});if(this.badCaseDetector.resetMonitor(),(e=this._signalChannel)==null||!e.isConnected)return;let r=this._signalChannel.isConnected?function(u){if(Ia.has(u)){let f=Ia.get(u).map(d=>({uint32_event_id:d.eventId,uint64_date:d.timestamp,str_userid:d.remoteUserId,str_event_json:d.eventDesc}));return Ia.delete(u),f}return[]}(this.userId):[],o=Oe({str_sdk_version:C_,uint64_datetime:new Date().getTime(),msg_user_info:{str_identifier:this.userId,uint64_tinyid:this.tinyId},msg_device_info:{uint32_terminal_type:15,str_device_name:navigator.platform,str_os_version:"",uint32_net_type:Kd()},msg_event_msg:r,str_acc_ip:this.getSignalInfo().relayIp,str_client_ip:this.getSignalInfo().clientIp},i);pe.emit(oe.HEARTBEAT_REPORT,{room:this,report:o}),this._signalChannel.send(G7,o),this.emit("heartbeat-report",qe(Oe({},o),{bytes_sent:this._stats.totalBytesSent+this._signalChannel.bytesSent,bytes_received:this._stats.totalBytesReceived+this._signalChannel.bytesReceived}));let c=Date.now();this._lastHeartBeatTime>0&&c-this._lastHeartBeatTime>1e4&&this._log.warn("heartbeat took ".concat(c-this._lastHeartBeatTime)),this._signalChannel.isConnected&&(this._lastHeartBeatTime=c),!this._isRelayChanged&&this.isRelayMaybeFailed()&&(this.reJoin(),this._isRelayChanged=!0)})}onPublishedUserList(e){if(!this.isJoined)return;let t=e.data.userList.map(i=>{let{userId:r,srcTinyId:o,flag:c}=i;r===this.userId&&this.uplinkConnection&&(this.uplinkConnection.flag=c);let u=this.remotePublishedUserMap.get(r);return u&&this.checkSubscribeBigSmallVideo(u),{userId:r,tinyId:o,flag:c}});pe.emit(oe.RECEIVED_PUBLISHED_USER_LIST,{room:this,publishedUserList:t}),this.userManager.setRemotePublishedUserList(t)}closeUplink(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"you unpublished";this.uplinkConnection&&(this.localTracks.size>0&&this.uplinkConnection.doUnpublish(),this.uplinkConnection.close(e),this.uplinkConnection=null),this.localTracks.forEach(t=>t.unpublish()),this.localTracks.clear()}createDownlinkConnection(e){let{userId:t,tinyId:i,flag:r}=e,o=new(this.singlePC?BF:KR)({userId:t,tinyId:i,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,flag:r});this.userManager.addRemotePublishedUser(o),this.installDownlinkEvents(o,t),this.emit("remote-published",o)}closeDownLinkConnection(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"remote user unpublished",i=this.remotePublishedUserMap.get(e);i&&(i.close(t),this.emit("remote-unpublished",i))}installDownlinkEvents(e,t){e.on("error",i=>{let r=i.getCode();r!==ge.ICE_TRANSPORT_ERROR&&(r===ge.DOWNLINK_RECONNECTION_FAILED&&this.closeDownLinkConnection(t),this.emit("error",i))}),e.on("connection-state-changed",i=>{this.emit("media-connection-state-changed",qe(Oe({},i),{userId:e.userId}))}),e.on("firewall-restriction",()=>{this.emit("firewall-restriction")})}startSyncUserListInterval(){this._syncUserListInterval===-1&&(this._syncUserListInterval=Dt.run(ca,this.syncUserList.bind(this)))}stopSyncUserListInterval(){Dt.clearTask(this._syncUserListInterval),this._syncUserListInterval=-1}syncUserList(){return this.getUserList().then(e=>{this.userManager.setUserList(e)}).catch(e=>{this._log.debug("sync user list failed: ".concat(e))})}getUserList(){var e;return(e=this._signalChannel)!=null&&e.isConnected?this._signalChannel.sendWaitForResponse({command:eF,responseCommand:Je.USER_LIST_RES,enableLog:!1,timeout:2e3}).then(t=>{let{data:i}=t,{code:r,message:o}=i;if(r===0)return(i.data&&i.data.userList||[]).map(c=>{let{userId:u,srcTinyId:f,role:d}=c;return{userId:u,tinyId:f,role:d}});throw je({key:Ve.SIGNAL_RESPONSE_FAILED,data:{signalResponse:Je.USER_LIST_RES,code:r,message:o}})}):Promise.reject("not connected")}getAllConnections(){let e=[...this.remotePublishedUserMap.values()];return this.uplinkConnection&&e.push(this.uplinkConnection),e}isRelayMaybeFailed(){if(this._signalChannel&&!this._signalChannel.isOnline||!WR)return!1;if(this.singlePC)return this.singlePC.reconnectionCount>6;let e=this.getAllConnections();if(e.length===0)return!1;for(let t=0;t<e.length;t++)if(e[t].getReconnectionCount()<6)return!1;return!0}checkConnectionsToReconnect(){var e;this.singlePC?((e=this.singlePC.getPeerConnection())==null?void 0:e.connectionState)===Lt.CLOSED&&!this.singlePC.isReconnecting&&(this._log.warn("spc pc is closed but not reconnect"),this.singlePC.startReconnection()):this.getAllConnections().forEach(t=>{if(t instanceof Ys&&!t.getIsReconnecting()){let i=t.getPeerConnection();i&&i.connectionState===Lt.CLOSED&&(this._log.warn("[".concat(t.getUserId(),"] pc is closed but not reconnect")),t.startReconnection())}})}fallbackToMPC(){return B(this,null,function*(){var e;if(this._log.warn("fallback to multi pc"),Ht.uploadEvent({log:"stat-fallback",userId:this.userId}),this.enableSPC=!1,(e=this.singlePC)==null||e.close(),this.singlePC=null,this.isJoined&&(yield this.reJoin(!1)),this.uplinkConnection){let t=this.uplinkConnection;this.uplinkConnection=new a0({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}),t.isMainStreamPublished&&(yield this.uplinkConnection.publish({localAudioTrack:t.localMainAudioTrack,localVideoTrack:t.localMainVideoTrack,isAuxiliary:!1})),t.isAuxStreamPublished&&(yield this.uplinkConnection.publish({localAudioTrack:t.localAuxAudioTrack,localVideoTrack:t.localAuxVideoTrack,isAuxiliary:!0})),t.close()}this.remotePublishedUserMap.forEach(t=>{let i=new KR({userId:t.userId,tinyId:t.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,flag:t.flag,remoteAudioTrack:t.remoteAudioTrack,remoteVideoTrack:t.remoteVideoTrack,remoteAuxiliaryTrack:t.remoteAuxiliaryTrack});this.installDownlinkEvents(i,t.userId),this.remotePublishedUserMap.set(t.userId,i),t.isMainStreamSubscribed&&i.subscribe(t.subscribeState,"main"),t.isAuxStreamSubscribed&&i.subscribe(t.subscribeState,"auxiliary")})})}destroy(){this.isDestroyed||(this._signalChannel&&(this._log.info("destroying SignalChannel"),this._signalChannel.close(),this._signalChannel=null),super.destroy(),this._joinReject&&(this._joinReject(new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.CLIENT_DESTROYED,data:{funName:"join"}})})),this.clearJoinTimeout(),this.reset()),this.removeAllListeners())}switchRole(e){return B(this,null,function*(){this.role!==e&&(e==="audience"&&this.uplinkConnection&&this.closeUplink("you switch role to audience"),yield this.doSwitchRole(e))})}doSwitchRole(e){let t={command:tF,data:{role:e==="anchor"?20:21,privateMapKey:this.privateMapKey},responseCommand:Je.SWITCH_ROLE_RES,retries:1};return this._log.info("switchRole signal data: ".concat(JSON.stringify(t.data))),this._signalChannel.sendWaitForResponseWithRetry(t).then(i=>{let{code:r,message:o}=i.data;if(r!==0)throw new ke({code:ge.SWITCH_ROLE_FAILED,message:je({key:Ve.SWITCH_ROLE_FAILED,data:{message:o,code:r}})});this.role=e}).catch(i=>{throw i instanceof ke&&i.getCode()===ge.API_CALL_TIMEOUT&&(i=new ke({code:ge.SWITCH_ROLE_FAILED,message:je({key:Ve.SWITCH_ROLE_TIMEOUT})})),this._log.error(i),i})}publish(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return B(this,null,function*(){let r={},o={};t.forEach(d=>{d instanceof cr&&(d instanceof fl?o.audio=d:r.audio=d),d instanceof Mi&&(d instanceof zs&&d.mediaType===2?o.video=d:r.video=d)});let c=wl(r),u=wl(o);(!c||!u)&&!this.uplinkConnection&&(this.singlePC?this.uplinkConnection=new cC({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}):this.uplinkConnection=new a0({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}),this.uplinkConnection.on("connection-state-changed",d=>{this.emit("media-connection-state-changed",qe(Oe({},d),{userId:this.userId}))}),this.uplinkConnection.on("firewall-restriction",()=>{this.emit("firewall-restriction")}),this.uplinkConnection.on("error",d=>{let _=d.getCode();_!==ge.ICE_TRANSPORT_ERROR&&(_===ge.UPLINK_RECONNECTION_FAILED&&this.closeUplink(),this.emit("error",d))}));let f=t.map(d=>d.kind).join(",");c||(this._log.info("publish() => main ".concat(f)),yield this.uplinkConnection.publish({localAudioTrack:r.audio,localVideoTrack:r.video,isAuxiliary:!1}),this._log.info("main is published")),u||(this._log.info("publish() => aux ".concat(f)),yield this.uplinkConnection.publish({localAudioTrack:o.audio,localVideoTrack:o.video,isAuxiliary:!0}),this._log.info("aux is published"))})}unpublish(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return B(this,null,function*(){if(this.scene==="live"&&this.role!=="anchor"||!this.isMainStreamPublished&&!this.isAuxStreamPublished||!this.uplinkConnection)return;let r={},o={};t.forEach(c=>{!c.mediaTrack||!c.isPublished||(c instanceof cr&&(c instanceof fl?o.audio=c:r.audio=c),c instanceof Mi&&(c instanceof zs&&c.mediaType===2?o.video=c:r.video=c))});try{let c=t.map(u=>u.kind).join(",");wl(r)||(this._log.info("unpublish() => main ".concat(c)),yield this.uplinkConnection.unpublish({localAudioTrack:r.audio,localVideoTrack:r.video})),wl(o)||(this._log.info("unpublish() => aux ".concat(c)),yield this.uplinkConnection.unpublish({localAudioTrack:o.audio,localVideoTrack:o.video}))}catch{}this.localTracks.size===0&&this.closeUplink("you unpublished")})}addTrack(e){if(!this.uplinkConnection||!e.mediaTrack)return Promise.resolve();let t=this.uplinkConnection.addTrack(e);return e.publish(this,t),t}removeTrack(e){return this.uplinkConnection&&e.mediaTrack?this.uplinkConnection.removeTrack(e).then(t=>(e.unpublish(),t)):Promise.resolve()}replaceTrack(e){return this.uplinkConnection&&e.mediaTrack&&FA()?this.uplinkConnection.replaceTrack(e).then(t=>{pe.emit(oe.LOCAL_TRACK_REPLACED,{track:e})}):Promise.resolve()}setBandWidth(e){return B(this,null,function*(){!this.uplinkConnection||(yield this.uplinkConnection.setBandwidth(e),yield this.uplinkConnection.sendMediaSettings())})}enableSmall(e){return B(this,null,function*(){if(!this.uplinkConnection||!this.uplinkConnection.localMainVideoTrack)return Promise.resolve();e&&this.uplinkConnection.localMainVideoTrack.small&&(yield this.setBandWidth({type:N.VIDEO,videoType:N.SMALL,bandwidth:this.uplinkConnection.localMainVideoTrack.small.bitrate})),yield this.uplinkConnection.enableSmall(e)})}subscribe(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return B(this,null,function*(){if(t=t.filter(u=>!u.isSubscribed),t.length===0)return;let{userId:r}=t[0],o=this.remotePublishedUserMap.get(r);if(!o)return;let c=t.find(u=>u.mediaType===2)?"auxiliary":"main";try{let u=Oe({},o.subscribeState);t.forEach(d=>{switch(d.mediaType){case 1:u.audio=!0;break;case 4:u.video=!0;break;case 8:u.smallVideo=!0;break;case 2:u.auxiliary=!0}});let f=this._changeBigSmallRecords.get(r);f&&f.options.smallVideo&&o.muteState.hasSmall&&u.video&&(u.video=!1,u.smallVideo=!0),pe.emit(oe.SUBSCRIBE_START,{room:this,streamType:c,remotePublishedUser:o,subscribeState:u}),this._log.info("subscribe() => ".concat(r," ").concat(c," [").concat(r0(u),"] prev: [").concat(r0(o.subscribeState),"]")),yield o.subscribe(u,c),this._log.info("subscribe ".concat(r," ").concat(c," done"));for(let d of t)d.mediaTrack||(yield d.waitHasMediaTrack());pe.emit(oe.SUBSCRIBE_SUCCESS,{room:this,streamType:c,remotePublishedUser:o})}catch(u){let f=u instanceof ke?u.getCode():ge.UNKNOWN,d=u;throw u instanceof ke?f===ge.REMOTE_STREAM_NOT_EXIST&&(d=new ke({code:ge.API_CALL_ABORTED,message:je({key:Ve.API_CALL_ABORTED,data:{message:u.message,userId:r,streamType:c}})}),this._log.warn(d)):(d=new ke({code:f,message:je({key:Ve.SUBSCRIBE_FAILED,data:{message:u.message,userId:r,streamType:c}})}),this._log.error(d)),d}})}unsubscribe(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return B(this,null,function*(){let{userId:r}=t[0],o=this.remotePublishedUserMap.get(r);if(!o)return;let c=t.find(u=>u.mediaType===2)?"auxiliary":"main";this._log.info("unsubscribe() => ".concat(r," ").concat(c));try{yield o.unsubscribe({remoteTracks:t,streamType:c})}catch(u){this._log.warn("unsubscribe() => failed ".concat(u))}t.forEach(u=>{u.unsubscribe(),u.mediaType===8&&u.setMediaType(4)}),pe.emit(oe.UNSUBSCRIBE_SUCCESS,{room:this,streamType:c,remotePublishedUser:o})})}setEncodedDataProcessingListener(e){throw new Error("Method not implemented.")}enableAudioVolumeEvaluation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2e3,t=arguments.length>1?arguments[1]:void 0;if(e<=0)return this._enableAudioVolumeEvaluation=!1,void Dt.clearTask(this._audioVolumeIntervalId);e=Math.floor(Math.max(e,100)),pe.emit(oe.AUDIO_LEVEL_INTERVAL,{interval:e}),this._audioVolumeIntervalId&&Dt.clearTask(this._audioVolumeIntervalId),this._enableAudioVolumeEvaluation=!0,this._audioVolumeIntervalId=Dt.run(H_,()=>{var i;let r=[];(i=this.remotePublishedUserMap)==null||i.forEach(o=>{if(o.muteState.hasAudio){let c=Math.floor(100*o.remoteAudioTrack.getAudioLevel());r.push({userId:o.userId,volume:c})}}),this.emit("audio-volume",r)},{fps:1e3/e,backgroundTask:t})}getLocalAudioStats(){return B(this,null,function*(){let e={};if(e[this.userId]={bytesSent:0,packetsSent:0},this.uplinkConnection){let t=yield this._stats.getSenderStats(this.uplinkConnection);e[this.userId]={bytesSent:t.audio.bytesSent,packetsSent:t.audio.packetsSent}}return e})}getLocalVideoStats(){return B(this,null,function*(){let e={};if(e[this.userId]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},this.uplinkConnection){let{video:{bytesSent:t,packetsSent:i,framesEncoded:r,framesSent:o,frameWidth:c,frameHeight:u}}=yield this._stats.getSenderStats(this.uplinkConnection);e[this.userId]={bytesSent:t,packetsSent:i,framesEncoded:r,framesSent:o,frameWidth:c,frameHeight:u}}return e})}getTransportStats(){return B(this,null,function*(){let e={rtt:0,downlinksRTT:{}};if(this.uplinkConnection){let t=yield this._stats.getSenderStats(this.uplinkConnection);e.rtt=t.rtt}for(let[,t]of this.remotePublishedUserMap){let i=yield this._stats.getReceiverStats(t);e.downlinksRTT[i.userId]=i.rtt}return e})}getRemoteVideoStats(e){return B(this,null,function*(){let t={};for(let[i,r]of this.remotePublishedUserMap)e==="main"&&r.muteState.hasVideo&&(t[i]=r.remoteVideoTrack.stat),e==="auxiliary"&&r.muteState.hasAuxiliary&&(t[i]=r.remoteAuxiliaryTrack.stat);return t})}getRemoteAudioStats(){return B(this,null,function*(){let e={};for(let[t,i]of this.remotePublishedUserMap)i.muteState.hasAudio&&(e[t]=i.remoteAudioTrack.stat);return e})}setTurnServer(e,t){this._log.info("set turn server: ".concat(JSON.stringify(e)," ").concat(t||""));let i=[];Array.isArray(e)?e.forEach(r=>i.push(Sn.getTurnServer(r))):Sn.isPlainObject(e)&&i.push(Sn.getTurnServer(e)),this._turnServers=i,t&&(this._iceTransportPolicy=t)}sendStartMixTranscode(e){return this._signalChannel.sendWaitForResponse({command:Z7,data:e,timeout:5e3,responseCommand:Je.START_MIX_TRANSCODE_RES,commandDesc:"startMixTranscode"})}sendStopMixTranscode(e){return this._signalChannel.sendWaitForResponse({command:$7,data:e,timeout:5e3,responseCommand:Je.STOP_MIX_TRANSCODE_RES,commandDesc:"stopMixTranscode"})}sendStartPublishCDN(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return this._signalChannel.sendWaitForResponse({command:t?Y7:X7,data:e,timeout:5e3,responseCommand:t?Je.START_PUBLISH_TENCENT_CDN_RES:Je.START_PUBLISH_GIVEN_CDN_RES,commandDesc:"startPublishCDN"})}sendStopPublishCDN(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return this._signalChannel.sendWaitForResponse({command:t?q7:Q7,data:e,timeout:5e3,responseCommand:t?Je.STOP_PUBLISH_TENCENT_CDN_RES:Je.STOP_PUBLISH_GIVEN_CDN_RES,commandDesc:"stopPublishCDN"})}sendAbilityStatus(e){var t;(t=this._signalChannel)==null||t.sendWaitForResponse({command:oF,data:e,timeout:5e3,responseCommand:Je.ABILITY_STATUS_REPORT_RESULT,commandDesc:"ability status report"}).catch(i=>{})}getIceServers(){return this._turnServers.length===0&&this.scheduleResult.iceServers?this.scheduleResult.iceServers:this._turnServers}getIceTransportPolicy(){return this._iceTransportPolicy||this.scheduleResult.iceTransportPolicy||"all"}getLogger(){return this._log}enableAIVoice(){throw new Error("Method not implemented.")}getSignalChannelUrl(){let e={mainUrl:"",backupUrl:""},t=Sn.getEnv();return t?(e.mainUrl="wss://".concat(t,".rtc.qq.com"),e.backupUrl=e.mainUrl):this.proxy_ws?(e.mainUrl=this.proxy_ws,e.backupUrl=e.mainUrl):Array.isArray(this.scheduleResult.domains)&&this.scheduleResult.domains.length>0&&(e.mainUrl="wss://".concat(this.scheduleResult.domains[0]),e.backupUrl=e.mainUrl,this.scheduleResult.domains[1]&&(e.backupUrl="wss://".concat(this.scheduleResult.domains[1]))),e}getSignalInfo(){var e;return((e=this._signalChannel)==null?void 0:e.getSignalInfo())||{clientIp:"",relayIp:""}}reset(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.stopSyncUserListInterval(),this.stopHeartbeat(),this.closeConnections(),this.clearNetworkQuality(),this.closeUplink("you exitRoom"),this._signalChannel&&(e&&this._signalChannel.keepAlive&&this._signalChannel.isConnected?this._signalChannel.stopKeepAliveIn(3600):this._signalChannel.close(),this.setSignalChannel(null)),this._stats.reset(),this.userManager.clear(),this.userManager.removeAllListeners(),this.singlePC&&(this.singlePC.close(),this.singlePC=null),this.scheduleResult={domains:null,iceServers:null,iceTransportPolicy:null,trtcAutoConf:null}}checkSubscribeBigSmallVideo(e){return B(this,null,function*(){let{subscribeState:t,userId:i,muteState:{hasSmall:r,hasVideo:o}}=e;if(!r&&!o||!t.video&&!t.smallVideo)return;let c=this._changeBigSmallRecords.get(i);if(!c||c.isSubscribing||c.reSubscribeCount<=0)return;let{options:u,reSubscribeCount:f}=c;if(u.video&&t.video||u.smallVideo&&t.smallVideo&&r)return;let d={audio:e.remoteAudioTrack.isSubscribed||e.remoteAudioTrack.isSubscribing,auxiliary:e.remoteAuxiliaryTrack.isSubscribed||e.remoteAuxiliaryTrack.isSubscribing,video:u.video,smallVideo:u.smallVideo};try{if(!r&&d.smallVideo&&(d.video=!0,d.smallVideo=!1),d.smallVideo===t.smallVideo&&d.video===t.video)return;c.isSubscribing=!0,c.reSubscribeCount=f-1,yield e.subscribe(d,"main"),e.remoteVideoTrack.setMediaType(d.smallVideo?8:4),this._log.info("change [".concat(i,"] to ").concat(d.smallVideo?"small":"big"," video successfully. count ").concat(xc-c.reSubscribeCount,".")),c.isSubscribing=!1,c.reSubscribeCount=xc}catch{this._log.info("change [".concat(i,"] to ").concat(d.smallVideo?"small":"big"," video failed. count ").concat(xc-c.reSubscribeCount,".")),c.isSubscribing=!1,c.reSubscribeCount===0&&this._changeBigSmallRecords.delete(i)}})}changeType(e,t){let i={options:{video:!e,smallVideo:e},isSubscribing:!1,reSubscribeCount:xc};this._changeBigSmallRecords.set(t.userId,i),this._log.info("set [".concat(t.userId,"] video prefer type: ").concat(e?"small":"big"))}get smallStreamConfig(){return this._smallStreamConfig}_initBusinessInfo(e){this._businessInfo=e.businessInfo;let t={};if(pC(e.businessInfo)&&(t=JSON.parse(e.businessInfo)),!ka(e.pureAudioPushMode)){if(!Number.isInteger(Number(e.pureAudioPushMode)))throw new ke({code:ge.INVALID_PARAMETER,message:je({key:Ve.INVALID_PURE_AUDIO})});this._pureAudioPushMode=e.pureAudioPushMode,t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.pure_audio_push_mod=this._pureAudioPushMode}if(!ka(e.userDefineRecordId)){let i=/^[A-Za-z0-9_-]{1,64}$/gi;if(e.userDefineRecordId.match(i)===null)throw new ke({code:ge.INVALID_PARAMETER,message:je({key:Ve.INVALID_USER_DEFINE_RECORDID})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_record_id=e.userDefineRecordId}if(!ka(e.userDefinePushArgs)){if(!(pC(e.userDefinePushArgs)&&String(e.userDefinePushArgs)&&String(e.userDefinePushArgs).length<=256))throw new ke({code:ge.INVALID_PARAMETER,message:je({key:Ve.INVALID_USER_DEFINE_PUSH_ARGS})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_push_args=e.userDefinePushArgs}wl(t)||(this._businessInfo=JSON.stringify(t))}sendSEI(e,t){this.singlePC&&this.singlePC.sendSEI(e,t)}sendCustomMessage(e){var t;(t=this._customMessageManager)==null||t.send(e)}};return Ie([MR(["left",wt.INIT],"joined"),Rl({settings:{retries:1,timeout:0},onError(e,t,i){this._isUsingCachedSchedule&&!this.isDestroyed?(this._log.warn("is using cached schedule, retry join"),Br(!0),this.reset(),t()):this._signalChannel&&this._signalChannel.isConnected&&this._signalChannel.keepAlive?(this._log.warn("is using keepAlive ws, retry join"),this._signalChannel.close(),this.reset(),t()):(this.reset(),this._log.error(e),i(e))}}),St(e=>{let t=new M7;return function(i,r,o){return B(this,null,function*(){let c=String(i.roomId||i.strRoomId);if(this.userId=i.userId,this.sdkAppId=i.sdkAppId,this.userSig=i.userSig,this._log.setSdkAppId(this.sdkAppId),this._log.setUserId(this.userId),this.scene=r,i.privateMapKey=i.privateMapKey||"",this.isJoined)throw new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.INVALID_JOIN})});if(this.checkDestroy(),t.isJoined({userId:this.userId,roomId:c,sdkAppId:this.sdkAppId,room:this}))throw new ke({code:ge.INVALID_OPERATION,message:je({key:Ve.REPEAT_JOIN,data:this.userId})});t.add({room:this,roomId:c}),this.role=i.role===21?"audience":"anchor",this._log.info("Join() => joining room: ".concat(c," useStringRoomId: ").concat(this.useStringRoomId," scene: ").concat(this.scene," role: ").concat(this.role)),pe.emit(oe.JOIN_START,{room:this,roomId:c,params:i}),this.checkSystemResult=yield nl.checkSystemRequirementsInternal(),this.checkDestroy();let u=Sn.getEnv();u||(u=Ms.QCLOUD,this.proxy_ws&&(this.proxy_ws.startsWith(L_.OLD_CLOUD_LADDER)?u=Ms.OLD_CLOUD_LADDER:this.proxy_ws.startsWith(L_.WEBRTC)&&(u=Ms.WEBRTC))),Ht.setConfig({env:u,sdkAppId:String(this.sdkAppId),userId:this.userId,roomId:c}),L7.call(this);let{isH264EncodeSupported:f,isVp8EncodeSupported:d}=this.checkSystemResult.detail;if(!nl.isWebRTCSupported()||!f&&!d)throw new ke({code:ge.NOT_SUPPORTED,message:je({key:Ve.NOT_SUPPORTED_WEBRTC})});try{!this.proxy_ws&&!this.proxy_wt&&!this.scheduleResult.domains&&!Sn.getEnv()&&(yield this.schedule(c,o));let _=yield e.call(this,i,r,o);return this.roomId=c,this._joinedTimestamp=Sn.performanceNow(),pe.emit(oe.JOIN_SUCCESS,{room:this}),Ht.uploadEvent({log:"stat-conv-".concat(Number(Vs),"-").concat(location.hostname),userId:this.userId}),_}catch(_){throw t.delete({room:this,roomId:c}),pe.emit(oe.JOIN_FAILED,{room:this,error:_}),_}})}})],Zs.prototype,"join"),Ie([MR("joined","left",{ignoreError:!0,success(){this.reset(!0)}}),St(e=>function(){return B(this,null,function*(){pe.emit(oe.LEAVE_START,{room:this}),yield e.call(this),pe.emit(oe.LEAVE_SUCCESS,{room:this,roomId:this.roomId})})}),mR("leave room"),Eh({fnName:"publish",validateArgs:!1}),Eh({fnName:"unsubscribe",validateArgs:!1})],Zs.prototype,"leave"),Ie([Sa(),St(e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return B(this,null,function*(){if(this.scene==="live"&&this.role!=="anchor"||(i=i.filter(c=>c.outMediaTrack&&c.state==="capture"),!i.length))return;pe.emit("61",{room:this});let o=e.apply(this,i);return i.forEach(c=>c.publish(this,o)),o})}),Rl({settings:{retries:aa,timeout:e=>fa(e)},onError(e,t,i){var r;(r=e.message)!=null&&r.includes("timeout")?(this._log.warn("publish timeout"),t()):(this._log.error("publish failed: ".concat(e)),i(e),pe.emit(oe.PUBLISH_FAILED,{room:this}))}})],Zs.prototype,"publish"),Ie([Eh({fnName:"publish"}),(hC="api-call",function(e,t,i){let r=i.value;return i.value=function(){for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];let f=hl.get(this);if(f){let d=f.queue.filter((_,E)=>{if(E===0)return!0;let S=!0;return _.args.forEach(R=>{c.find(k=>k===R)||(S=!1)}),!S||(_.reject(new ke({code:ge.API_CALL_ABORTED,message:hC})),!1)});f.queue=d}return r.apply(this,c)},i}),Sa(),St(e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];let o=e.apply(this,i);return i.forEach(c=>c.unpublish()),o})],Zs.prototype,"unpublish"),Ie([ah(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[0].userId}),gR(),St(e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];let o=e.apply(this,i);return i.forEach(c=>!c.isSubscribed&&c.subscribe(o)),o}),Rl({settings:{retries:aa,timeout:e=>fa(e)},onError(e,t,i,r){e.message.includes("timeout")?(this._log.warn("subscribe timeout"),t()):(this._log.error("subscribe failed: ".concat(e)),i(e),pe.emit(oe.SUBSCRIBE_FAILED,{room:this,remoteTracks:r}))}})],Zs.prototype,"subscribe"),Ie([Eh({fnName:"subscribe",callback(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.singlePC||t.forEach(r=>{let o=this.remotePublishedUserMap.get(r.userId);o&&!o.isMainStreamSubscribed&&!o.isAuxStreamSubscribed&&o.close("you unsubscribed")})}}),ah(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[0].userId})],Zs.prototype,"unsubscribe"),vh.create=vh._create.bind(vh,Zs),vh})})(rk);var TH=rk.exports;const JC=EH(TH);var ja=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Un=[],Ki=[],SH=typeof Uint8Array<"u"?Uint8Array:Array,Mv=!1;function sk(){Mv=!0;for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=n.length;s<a;++s)Un[s]=n[s],Ki[n.charCodeAt(s)]=s;Ki[45]=62,Ki[95]=63}function IH(n,s,a){for(var l,h,p=[],m=s;m<a;m+=3)l=(n[m]<<16)+(n[m+1]<<8)+n[m+2],p.push(Un[(h=l)>>18&63]+Un[h>>12&63]+Un[h>>6&63]+Un[63&h]);return p.join("")}function YC(n){var s;Mv||sk();for(var a=n.length,l=a%3,h="",p=[],m=0,v=a-l;m<v;m+=16383)p.push(IH(n,m,m+16383>v?v:m+16383));return l===1?(s=n[a-1],h+=Un[s>>2],h+=Un[s<<4&63],h+="=="):l===2&&(s=(n[a-2]<<8)+n[a-1],h+=Un[s>>10],h+=Un[s>>4&63],h+=Un[s<<2&63],h+="="),p.push(h),p.join("")}function Oh(n,s,a,l,h){var p,m,v=8*h-l-1,y=(1<<v)-1,g=y>>1,T=-7,A=a?h-1:0,C=a?-1:1,I=n[s+A];for(A+=C,p=I&(1<<-T)-1,I>>=-T,T+=v;T>0;p=256*p+n[s+A],A+=C,T-=8);for(m=p&(1<<-T)-1,p>>=-T,T+=l;T>0;m=256*m+n[s+A],A+=C,T-=8);if(p===0)p=1-g;else{if(p===y)return m?NaN:1/0*(I?-1:1);m+=Math.pow(2,l),p-=g}return(I?-1:1)*m*Math.pow(2,p-l)}function ok(n,s,a,l,h,p){var m,v,y,g=8*p-h-1,T=(1<<g)-1,A=T>>1,C=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=l?0:p-1,O=l?1:-1,D=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(v=isNaN(s)?1:0,m=T):(m=Math.floor(Math.log(s)/Math.LN2),s*(y=Math.pow(2,-m))<1&&(m--,y*=2),(s+=m+A>=1?C/y:C*Math.pow(2,1-A))*y>=2&&(m++,y/=2),m+A>=T?(v=0,m=T):m+A>=1?(v=(s*y-1)*Math.pow(2,h),m+=A):(v=s*Math.pow(2,A-1)*Math.pow(2,h),m=0));h>=8;n[a+I]=255&v,I+=O,v/=256,h-=8);for(m=m<<h|v,g+=h;g>0;n[a+I]=255&m,I+=O,m/=256,g-=8);n[a+I-O]|=128*D}var bH={}.toString,ak=Array.isArray||function(n){return bH.call(n)=="[object Array]"};function rv(){return Q.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function gr(n,s){if(rv()<s)throw new RangeError("Invalid typed array length");return Q.TYPED_ARRAY_SUPPORT?(n=new Uint8Array(s)).__proto__=Q.prototype:(n===null&&(n=new Q(s)),n.length=s),n}function Q(n,s,a){if(!(Q.TYPED_ARRAY_SUPPORT||this instanceof Q))return new Q(n,s,a);if(typeof n=="number"){if(typeof s=="string")throw new Error("If encoding is specified then the first argument must be a string");return sv(this,n)}return ck(this,n,s,a)}function ck(n,s,a,l){if(typeof s=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer?function(h,p,m,v){if(p.byteLength,m<0||p.byteLength<m)throw new RangeError("'offset' is out of bounds");if(p.byteLength<m+(v||0))throw new RangeError("'length' is out of bounds");return p=m===void 0&&v===void 0?new Uint8Array(p):v===void 0?new Uint8Array(p,m):new Uint8Array(p,m,v),Q.TYPED_ARRAY_SUPPORT?(h=p).__proto__=Q.prototype:h=I0(h,p),h}(n,s,a,l):typeof s=="string"?function(h,p,m){if(typeof m=="string"&&m!==""||(m="utf8"),!Q.isEncoding(m))throw new TypeError('"encoding" must be a valid string encoding');var v=0|uk(p,m),y=(h=gr(h,v)).write(p,m);return y!==v&&(h=h.slice(0,y)),h}(n,s,a):function(h,p){if(Fn(p)){var m=0|Lv(p.length);return(h=gr(h,m)).length===0||p.copy(h,0,0,m),h}if(p){if(typeof ArrayBuffer<"u"&&p.buffer instanceof ArrayBuffer||"length"in p)return typeof p.length!="number"||(v=p.length)!=v?gr(h,0):I0(h,p);if(p.type==="Buffer"&&ak(p.data))return I0(h,p.data)}var v;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(n,s)}function lk(n){if(typeof n!="number")throw new TypeError('"size" argument must be a number');if(n<0)throw new RangeError('"size" argument must not be negative')}function sv(n,s){if(lk(s),n=gr(n,s<0?0:0|Lv(s)),!Q.TYPED_ARRAY_SUPPORT)for(var a=0;a<s;++a)n[a]=0;return n}function I0(n,s){var a=s.length<0?0:0|Lv(s.length);n=gr(n,a);for(var l=0;l<a;l+=1)n[l]=255&s[l];return n}function Lv(n){if(n>=rv())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+rv().toString(16)+" bytes");return 0|n}function Fn(n){return!(n==null||!n._isBuffer)}function uk(n,s){if(Fn(n))return n.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(n)||n instanceof ArrayBuffer))return n.byteLength;typeof n!="string"&&(n=""+n);var a=n.length;if(a===0)return 0;for(var l=!1;;)switch(s){case"ascii":case"latin1":case"binary":return a;case"utf8":case"utf-8":case void 0:return ip(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*a;case"hex":return a>>>1;case"base64":return fk(n).length;default:if(l)return ip(n).length;s=(""+s).toLowerCase(),l=!0}}function AH(n,s,a){var l=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((a===void 0||a>this.length)&&(a=this.length),a<=0)||(a>>>=0)<=(s>>>=0))return"";for(n||(n="utf8");;)switch(n){case"hex":return MH(this,s,a);case"utf8":case"utf-8":return hk(this,s,a);case"ascii":return OH(this,s,a);case"latin1":case"binary":return PH(this,s,a);case"base64":return DH(this,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return LH(this,s,a);default:if(l)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),l=!0}}function to(n,s,a){var l=n[s];n[s]=n[a],n[a]=l}function qC(n,s,a,l,h){if(n.length===0)return-1;if(typeof a=="string"?(l=a,a=0):a>2147483647?a=2147483647:a<-2147483648&&(a=-2147483648),a=+a,isNaN(a)&&(a=h?0:n.length-1),a<0&&(a=n.length+a),a>=n.length){if(h)return-1;a=n.length-1}else if(a<0){if(!h)return-1;a=0}if(typeof s=="string"&&(s=Q.from(s,l)),Fn(s))return s.length===0?-1:XC(n,s,a,l,h);if(typeof s=="number")return s&=255,Q.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?h?Uint8Array.prototype.indexOf.call(n,s,a):Uint8Array.prototype.lastIndexOf.call(n,s,a):XC(n,[s],a,l,h);throw new TypeError("val must be string, number or Buffer")}function XC(n,s,a,l,h){var p,m=1,v=n.length,y=s.length;if(l!==void 0&&((l=String(l).toLowerCase())==="ucs2"||l==="ucs-2"||l==="utf16le"||l==="utf-16le")){if(n.length<2||s.length<2)return-1;m=2,v/=2,y/=2,a/=2}function g(I,O){return m===1?I[O]:I.readUInt16BE(O*m)}if(h){var T=-1;for(p=a;p<v;p++)if(g(n,p)===g(s,T===-1?0:p-T)){if(T===-1&&(T=p),p-T+1===y)return T*m}else T!==-1&&(p-=p-T),T=-1}else for(a+y>v&&(a=v-y),p=a;p>=0;p--){for(var A=!0,C=0;C<y;C++)if(g(n,p+C)!==g(s,C)){A=!1;break}if(A)return p}return-1}function RH(n,s,a,l){a=Number(a)||0;var h=n.length-a;l?(l=Number(l))>h&&(l=h):l=h;var p=s.length;if(p%2!=0)throw new TypeError("Invalid hex string");l>p/2&&(l=p/2);for(var m=0;m<l;++m){var v=parseInt(s.substr(2*m,2),16);if(isNaN(v))return m;n[a+m]=v}return m}function CH(n,s,a,l){return vp(ip(s,n.length-a),n,a,l)}function dk(n,s,a,l){return vp(function(h){for(var p=[],m=0;m<h.length;++m)p.push(255&h.charCodeAt(m));return p}(s),n,a,l)}function wH(n,s,a,l){return dk(n,s,a,l)}function kH(n,s,a,l){return vp(fk(s),n,a,l)}function NH(n,s,a,l){return vp(function(h,p){for(var m,v,y,g=[],T=0;T<h.length&&!((p-=2)<0);++T)m=h.charCodeAt(T),v=m>>8,y=m%256,g.push(y),g.push(v);return g}(s,n.length-a),n,a,l)}function DH(n,s,a){return s===0&&a===n.length?YC(n):YC(n.slice(s,a))}function hk(n,s,a){a=Math.min(n.length,a);for(var l=[],h=s;h<a;){var p,m,v,y,g=n[h],T=null,A=g>239?4:g>223?3:g>191?2:1;if(h+A<=a)switch(A){case 1:g<128&&(T=g);break;case 2:(192&(p=n[h+1]))==128&&(y=(31&g)<<6|63&p)>127&&(T=y);break;case 3:p=n[h+1],m=n[h+2],(192&p)==128&&(192&m)==128&&(y=(15&g)<<12|(63&p)<<6|63&m)>2047&&(y<55296||y>57343)&&(T=y);break;case 4:p=n[h+1],m=n[h+2],v=n[h+3],(192&p)==128&&(192&m)==128&&(192&v)==128&&(y=(15&g)<<18|(63&p)<<12|(63&m)<<6|63&v)>65535&&y<1114112&&(T=y)}T===null?(T=65533,A=1):T>65535&&(T-=65536,l.push(T>>>10&1023|55296),T=56320|1023&T),l.push(T),h+=A}return function(C){var I=C.length;if(I<=QC)return String.fromCharCode.apply(String,C);for(var O="",D=0;D<I;)O+=String.fromCharCode.apply(String,C.slice(D,D+=QC));return O}(l)}Q.TYPED_ARRAY_SUPPORT=ja.TYPED_ARRAY_SUPPORT===void 0||ja.TYPED_ARRAY_SUPPORT,Q.poolSize=8192,Q._augment=function(n){return n.__proto__=Q.prototype,n},Q.from=function(n,s,a){return ck(null,n,s,a)},Q.TYPED_ARRAY_SUPPORT&&(Q.prototype.__proto__=Uint8Array.prototype,Q.__proto__=Uint8Array),Q.alloc=function(n,s,a){return function(l,h,p,m){return lk(h),h<=0?gr(l,h):p!==void 0?typeof m=="string"?gr(l,h).fill(p,m):gr(l,h).fill(p):gr(l,h)}(null,n,s,a)},Q.allocUnsafe=function(n){return sv(null,n)},Q.allocUnsafeSlow=function(n){return sv(null,n)},Q.isBuffer=nu,Q.compare=function(n,s){if(!Fn(n)||!Fn(s))throw new TypeError("Arguments must be Buffers");if(n===s)return 0;for(var a=n.length,l=s.length,h=0,p=Math.min(a,l);h<p;++h)if(n[h]!==s[h]){a=n[h],l=s[h];break}return a<l?-1:l<a?1:0},Q.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Q.concat=function(n,s){if(!ak(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return Q.alloc(0);var a;if(s===void 0)for(s=0,a=0;a<n.length;++a)s+=n[a].length;var l=Q.allocUnsafe(s),h=0;for(a=0;a<n.length;++a){var p=n[a];if(!Fn(p))throw new TypeError('"list" argument must be an Array of Buffers');p.copy(l,h),h+=p.length}return l},Q.byteLength=uk,Q.prototype._isBuffer=!0,Q.prototype.swap16=function(){var n=this.length;if(n%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var s=0;s<n;s+=2)to(this,s,s+1);return this},Q.prototype.swap32=function(){var n=this.length;if(n%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var s=0;s<n;s+=4)to(this,s,s+3),to(this,s+1,s+2);return this},Q.prototype.swap64=function(){var n=this.length;if(n%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var s=0;s<n;s+=8)to(this,s,s+7),to(this,s+1,s+6),to(this,s+2,s+5),to(this,s+3,s+4);return this},Q.prototype.toString=function(){var n=0|this.length;return n===0?"":arguments.length===0?hk(this,0,n):AH.apply(this,arguments)},Q.prototype.equals=function(n){if(!Fn(n))throw new TypeError("Argument must be a Buffer");return this===n||Q.compare(this,n)===0},Q.prototype.inspect=function(){var n="";return this.length>0&&(n=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(n+=" ... ")),"<Buffer "+n+">"},Q.prototype.compare=function(n,s,a,l,h){if(!Fn(n))throw new TypeError("Argument must be a Buffer");if(s===void 0&&(s=0),a===void 0&&(a=n?n.length:0),l===void 0&&(l=0),h===void 0&&(h=this.length),s<0||a>n.length||l<0||h>this.length)throw new RangeError("out of range index");if(l>=h&&s>=a)return 0;if(l>=h)return-1;if(s>=a)return 1;if(this===n)return 0;for(var p=(h>>>=0)-(l>>>=0),m=(a>>>=0)-(s>>>=0),v=Math.min(p,m),y=this.slice(l,h),g=n.slice(s,a),T=0;T<v;++T)if(y[T]!==g[T]){p=y[T],m=g[T];break}return p<m?-1:m<p?1:0},Q.prototype.includes=function(n,s,a){return this.indexOf(n,s,a)!==-1},Q.prototype.indexOf=function(n,s,a){return qC(this,n,s,a,!0)},Q.prototype.lastIndexOf=function(n,s,a){return qC(this,n,s,a,!1)},Q.prototype.write=function(n,s,a,l){if(s===void 0)l="utf8",a=this.length,s=0;else if(a===void 0&&typeof s=="string")l=s,a=this.length,s=0;else{if(!isFinite(s))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");s|=0,isFinite(a)?(a|=0,l===void 0&&(l="utf8")):(l=a,a=void 0)}var h=this.length-s;if((a===void 0||a>h)&&(a=h),n.length>0&&(a<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");l||(l="utf8");for(var p=!1;;)switch(l){case"hex":return RH(this,n,s,a);case"utf8":case"utf-8":return CH(this,n,s,a);case"ascii":return dk(this,n,s,a);case"latin1":case"binary":return wH(this,n,s,a);case"base64":return kH(this,n,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return NH(this,n,s,a);default:if(p)throw new TypeError("Unknown encoding: "+l);l=(""+l).toLowerCase(),p=!0}},Q.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var QC=4096;function OH(n,s,a){var l="";a=Math.min(n.length,a);for(var h=s;h<a;++h)l+=String.fromCharCode(127&n[h]);return l}function PH(n,s,a){var l="";a=Math.min(n.length,a);for(var h=s;h<a;++h)l+=String.fromCharCode(n[h]);return l}function MH(n,s,a){var l=n.length;(!s||s<0)&&(s=0),(!a||a<0||a>l)&&(a=l);for(var h="",p=s;p<a;++p)h+=VH(n[p]);return h}function LH(n,s,a){for(var l=n.slice(s,a),h="",p=0;p<l.length;p+=2)h+=String.fromCharCode(l[p]+256*l[p+1]);return h}function Jt(n,s,a){if(n%1!=0||n<0)throw new RangeError("offset is not uint");if(n+s>a)throw new RangeError("Trying to access beyond buffer length")}function Si(n,s,a,l,h,p){if(!Fn(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>h||s<p)throw new RangeError('"value" argument is out of bounds');if(a+l>n.length)throw new RangeError("Index out of range")}function Ph(n,s,a,l){s<0&&(s=65535+s+1);for(var h=0,p=Math.min(n.length-a,2);h<p;++h)n[a+h]=(s&255<<8*(l?h:1-h))>>>8*(l?h:1-h)}function Mh(n,s,a,l){s<0&&(s=4294967295+s+1);for(var h=0,p=Math.min(n.length-a,4);h<p;++h)n[a+h]=s>>>8*(l?h:3-h)&255}function pk(n,s,a,l,h,p){if(a+l>n.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("Index out of range")}function ZC(n,s,a,l,h){return h||pk(n,0,a,4),ok(n,s,a,l,23,4),a+4}function $C(n,s,a,l,h){return h||pk(n,0,a,8),ok(n,s,a,l,52,8),a+8}Q.prototype.slice=function(n,s){var a,l=this.length;if((n=~~n)<0?(n+=l)<0&&(n=0):n>l&&(n=l),(s=s===void 0?l:~~s)<0?(s+=l)<0&&(s=0):s>l&&(s=l),s<n&&(s=n),Q.TYPED_ARRAY_SUPPORT)(a=this.subarray(n,s)).__proto__=Q.prototype;else{var h=s-n;a=new Q(h,void 0);for(var p=0;p<h;++p)a[p]=this[p+n]}return a},Q.prototype.readUIntLE=function(n,s,a){n|=0,s|=0,a||Jt(n,s,this.length);for(var l=this[n],h=1,p=0;++p<s&&(h*=256);)l+=this[n+p]*h;return l},Q.prototype.readUIntBE=function(n,s,a){n|=0,s|=0,a||Jt(n,s,this.length);for(var l=this[n+--s],h=1;s>0&&(h*=256);)l+=this[n+--s]*h;return l},Q.prototype.readUInt8=function(n,s){return s||Jt(n,1,this.length),this[n]},Q.prototype.readUInt16LE=function(n,s){return s||Jt(n,2,this.length),this[n]|this[n+1]<<8},Q.prototype.readUInt16BE=function(n,s){return s||Jt(n,2,this.length),this[n]<<8|this[n+1]},Q.prototype.readUInt32LE=function(n,s){return s||Jt(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+16777216*this[n+3]},Q.prototype.readUInt32BE=function(n,s){return s||Jt(n,4,this.length),16777216*this[n]+(this[n+1]<<16|this[n+2]<<8|this[n+3])},Q.prototype.readIntLE=function(n,s,a){n|=0,s|=0,a||Jt(n,s,this.length);for(var l=this[n],h=1,p=0;++p<s&&(h*=256);)l+=this[n+p]*h;return l>=(h*=128)&&(l-=Math.pow(2,8*s)),l},Q.prototype.readIntBE=function(n,s,a){n|=0,s|=0,a||Jt(n,s,this.length);for(var l=s,h=1,p=this[n+--l];l>0&&(h*=256);)p+=this[n+--l]*h;return p>=(h*=128)&&(p-=Math.pow(2,8*s)),p},Q.prototype.readInt8=function(n,s){return s||Jt(n,1,this.length),128&this[n]?-1*(255-this[n]+1):this[n]},Q.prototype.readInt16LE=function(n,s){s||Jt(n,2,this.length);var a=this[n]|this[n+1]<<8;return 32768&a?4294901760|a:a},Q.prototype.readInt16BE=function(n,s){s||Jt(n,2,this.length);var a=this[n+1]|this[n]<<8;return 32768&a?4294901760|a:a},Q.prototype.readInt32LE=function(n,s){return s||Jt(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},Q.prototype.readInt32BE=function(n,s){return s||Jt(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},Q.prototype.readFloatLE=function(n,s){return s||Jt(n,4,this.length),Oh(this,n,!0,23,4)},Q.prototype.readFloatBE=function(n,s){return s||Jt(n,4,this.length),Oh(this,n,!1,23,4)},Q.prototype.readDoubleLE=function(n,s){return s||Jt(n,8,this.length),Oh(this,n,!0,52,8)},Q.prototype.readDoubleBE=function(n,s){return s||Jt(n,8,this.length),Oh(this,n,!1,52,8)},Q.prototype.writeUIntLE=function(n,s,a,l){n=+n,s|=0,a|=0,l||Si(this,n,s,a,Math.pow(2,8*a)-1,0);var h=1,p=0;for(this[s]=255&n;++p<a&&(h*=256);)this[s+p]=n/h&255;return s+a},Q.prototype.writeUIntBE=function(n,s,a,l){n=+n,s|=0,a|=0,l||Si(this,n,s,a,Math.pow(2,8*a)-1,0);var h=a-1,p=1;for(this[s+h]=255&n;--h>=0&&(p*=256);)this[s+h]=n/p&255;return s+a},Q.prototype.writeUInt8=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,1,255,0),Q.TYPED_ARRAY_SUPPORT||(n=Math.floor(n)),this[s]=255&n,s+1},Q.prototype.writeUInt16LE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,2,65535,0),Q.TYPED_ARRAY_SUPPORT?(this[s]=255&n,this[s+1]=n>>>8):Ph(this,n,s,!0),s+2},Q.prototype.writeUInt16BE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,2,65535,0),Q.TYPED_ARRAY_SUPPORT?(this[s]=n>>>8,this[s+1]=255&n):Ph(this,n,s,!1),s+2},Q.prototype.writeUInt32LE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,4,4294967295,0),Q.TYPED_ARRAY_SUPPORT?(this[s+3]=n>>>24,this[s+2]=n>>>16,this[s+1]=n>>>8,this[s]=255&n):Mh(this,n,s,!0),s+4},Q.prototype.writeUInt32BE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,4,4294967295,0),Q.TYPED_ARRAY_SUPPORT?(this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=255&n):Mh(this,n,s,!1),s+4},Q.prototype.writeIntLE=function(n,s,a,l){if(n=+n,s|=0,!l){var h=Math.pow(2,8*a-1);Si(this,n,s,a,h-1,-h)}var p=0,m=1,v=0;for(this[s]=255&n;++p<a&&(m*=256);)n<0&&v===0&&this[s+p-1]!==0&&(v=1),this[s+p]=(n/m>>0)-v&255;return s+a},Q.prototype.writeIntBE=function(n,s,a,l){if(n=+n,s|=0,!l){var h=Math.pow(2,8*a-1);Si(this,n,s,a,h-1,-h)}var p=a-1,m=1,v=0;for(this[s+p]=255&n;--p>=0&&(m*=256);)n<0&&v===0&&this[s+p+1]!==0&&(v=1),this[s+p]=(n/m>>0)-v&255;return s+a},Q.prototype.writeInt8=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,1,127,-128),Q.TYPED_ARRAY_SUPPORT||(n=Math.floor(n)),n<0&&(n=255+n+1),this[s]=255&n,s+1},Q.prototype.writeInt16LE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,2,32767,-32768),Q.TYPED_ARRAY_SUPPORT?(this[s]=255&n,this[s+1]=n>>>8):Ph(this,n,s,!0),s+2},Q.prototype.writeInt16BE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,2,32767,-32768),Q.TYPED_ARRAY_SUPPORT?(this[s]=n>>>8,this[s+1]=255&n):Ph(this,n,s,!1),s+2},Q.prototype.writeInt32LE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,4,2147483647,-2147483648),Q.TYPED_ARRAY_SUPPORT?(this[s]=255&n,this[s+1]=n>>>8,this[s+2]=n>>>16,this[s+3]=n>>>24):Mh(this,n,s,!0),s+4},Q.prototype.writeInt32BE=function(n,s,a){return n=+n,s|=0,a||Si(this,n,s,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),Q.TYPED_ARRAY_SUPPORT?(this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=255&n):Mh(this,n,s,!1),s+4},Q.prototype.writeFloatLE=function(n,s,a){return ZC(this,n,s,!0,a)},Q.prototype.writeFloatBE=function(n,s,a){return ZC(this,n,s,!1,a)},Q.prototype.writeDoubleLE=function(n,s,a){return $C(this,n,s,!0,a)},Q.prototype.writeDoubleBE=function(n,s,a){return $C(this,n,s,!1,a)},Q.prototype.copy=function(n,s,a,l){if(a||(a=0),l||l===0||(l=this.length),s>=n.length&&(s=n.length),s||(s=0),l>0&&l<a&&(l=a),l===a||n.length===0||this.length===0)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("sourceStart out of bounds");if(l<0)throw new RangeError("sourceEnd out of bounds");l>this.length&&(l=this.length),n.length-s<l-a&&(l=n.length-s+a);var h,p=l-a;if(this===n&&a<s&&s<l)for(h=p-1;h>=0;--h)n[h+s]=this[h+a];else if(p<1e3||!Q.TYPED_ARRAY_SUPPORT)for(h=0;h<p;++h)n[h+s]=this[h+a];else Uint8Array.prototype.set.call(n,this.subarray(a,a+p),s);return p},Q.prototype.fill=function(n,s,a,l){if(typeof n=="string"){if(typeof s=="string"?(l=s,s=0,a=this.length):typeof a=="string"&&(l=a,a=this.length),n.length===1){var h=n.charCodeAt(0);h<256&&(n=h)}if(l!==void 0&&typeof l!="string")throw new TypeError("encoding must be a string");if(typeof l=="string"&&!Q.isEncoding(l))throw new TypeError("Unknown encoding: "+l)}else typeof n=="number"&&(n&=255);if(s<0||this.length<s||this.length<a)throw new RangeError("Out of range index");if(a<=s)return this;var p;if(s>>>=0,a=a===void 0?this.length:a>>>0,n||(n=0),typeof n=="number")for(p=s;p<a;++p)this[p]=n;else{var m=Fn(n)?n:ip(new Q(n,l).toString()),v=m.length;for(p=0;p<a-s;++p)this[p+s]=m[p%v]}return this};var xH=/[^+\/0-9A-Za-z-_]/g;function VH(n){return n<16?"0"+n.toString(16):n.toString(16)}function ip(n,s){var a;s=s||1/0;for(var l=n.length,h=null,p=[],m=0;m<l;++m){if((a=n.charCodeAt(m))>55295&&a<57344){if(!h){if(a>56319){(s-=3)>-1&&p.push(239,191,189);continue}if(m+1===l){(s-=3)>-1&&p.push(239,191,189);continue}h=a;continue}if(a<56320){(s-=3)>-1&&p.push(239,191,189),h=a;continue}a=65536+(h-55296<<10|a-56320)}else h&&(s-=3)>-1&&p.push(239,191,189);if(h=null,a<128){if((s-=1)<0)break;p.push(a)}else if(a<2048){if((s-=2)<0)break;p.push(a>>6|192,63&a|128)}else if(a<65536){if((s-=3)<0)break;p.push(a>>12|224,a>>6&63|128,63&a|128)}else{if(!(a<1114112))throw new Error("Invalid code point");if((s-=4)<0)break;p.push(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}}return p}function fk(n){return function(s){var a,l,h,p,m,v;Mv||sk();var y=s.length;if(y%4>0)throw new Error("Invalid string. Length must be a multiple of 4");m=s[y-2]==="="?2:s[y-1]==="="?1:0,v=new SH(3*y/4-m),h=m>0?y-4:y;var g=0;for(a=0,l=0;a<h;a+=4,l+=3)p=Ki[s.charCodeAt(a)]<<18|Ki[s.charCodeAt(a+1)]<<12|Ki[s.charCodeAt(a+2)]<<6|Ki[s.charCodeAt(a+3)],v[g++]=p>>16&255,v[g++]=p>>8&255,v[g++]=255&p;return m===2?(p=Ki[s.charCodeAt(a)]<<2|Ki[s.charCodeAt(a+1)]>>4,v[g++]=255&p):m===1&&(p=Ki[s.charCodeAt(a)]<<10|Ki[s.charCodeAt(a+1)]<<4|Ki[s.charCodeAt(a+2)]>>2,v[g++]=p>>8&255,v[g++]=255&p),v}(function(s){if((s=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}(s).replace(xH,"")).length<2)return"";for(;s.length%4!=0;)s+="=";return s}(n))}function vp(n,s,a,l){for(var h=0;h<l&&!(h+a>=s.length||h>=n.length);++h)s[h+a]=n[h];return h}function nu(n){return n!=null&&(!!n._isBuffer||ew(n)||function(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&ew(s.slice(0,0))}(n))}function ew(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function nt(n,s){return n(s={exports:{}},s.exports),s.exports}var st=nt(function(n,s){var a;n.exports=(a=a||function(l,h){var p=Object.create||function(){function w(){}return function(L){var M;return w.prototype=L,M=new w,w.prototype=null,M}}(),m={},v=m.lib={},y=v.Base={extend:function(w){var L=p(this);return w&&L.mixIn(w),L.hasOwnProperty("init")&&this.init!==L.init||(L.init=function(){L.$super.init.apply(this,arguments)}),L.init.prototype=L,L.$super=this,L},create:function(){var w=this.extend();return w.init.apply(w,arguments),w},init:function(){},mixIn:function(w){for(var L in w)w.hasOwnProperty(L)&&(this[L]=w[L]);w.hasOwnProperty("toString")&&(this.toString=w.toString)},clone:function(){return this.init.prototype.extend(this)}},g=v.WordArray=y.extend({init:function(w,L){w=this.words=w||[],this.sigBytes=L??4*w.length},toString:function(w){return(w||A).stringify(this)},concat:function(w){var L=this.words,M=w.words,P=this.sigBytes,V=w.sigBytes;if(this.clamp(),P%4)for(var G=0;G<V;G++){var H=M[G>>>2]>>>24-G%4*8&255;L[P+G>>>2]|=H<<24-(P+G)%4*8}else for(var G=0;G<V;G+=4)L[P+G>>>2]=M[G>>>2];return this.sigBytes+=V,this},clamp:function(){var w=this.words,L=this.sigBytes;w[L>>>2]&=4294967295<<32-L%4*8,w.length=l.ceil(L/4)},clone:function(){var w=y.clone.call(this);return w.words=this.words.slice(0),w},random:function(w){for(var L,M=[],P=function(W){var W=W,z=987654321,Z=4294967295;return function(){var F=((z=36969*(65535&z)+(z>>16)&Z)<<16)+(W=18e3*(65535&W)+(W>>16)&Z)&Z;return F/=4294967296,(F+=.5)*(l.random()>.5?1:-1)}},V=0;V<w;V+=4){var G=P(4294967296*(L||l.random()));L=987654071*G(),M.push(4294967296*G()|0)}return new g.init(M,w)}}),T=m.enc={},A=T.Hex={stringify:function(w){for(var L=w.words,M=w.sigBytes,P=[],V=0;V<M;V++){var G=L[V>>>2]>>>24-V%4*8&255;P.push((G>>>4).toString(16)),P.push((15&G).toString(16))}return P.join("")},parse:function(w){for(var L=w.length,M=[],P=0;P<L;P+=2)M[P>>>3]|=parseInt(w.substr(P,2),16)<<24-P%8*4;return new g.init(M,L/2)}},C=T.Latin1={stringify:function(w){for(var L=w.words,M=w.sigBytes,P=[],V=0;V<M;V++){var G=L[V>>>2]>>>24-V%4*8&255;P.push(String.fromCharCode(G))}return P.join("")},parse:function(w){for(var L=w.length,M=[],P=0;P<L;P++)M[P>>>2]|=(255&w.charCodeAt(P))<<24-P%4*8;return new g.init(M,L)}},I=T.Utf8={stringify:function(w){try{return decodeURIComponent(escape(C.stringify(w)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(w){return C.parse(unescape(encodeURIComponent(w)))}},O=v.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(w){typeof w=="string"&&(w=I.parse(w)),this._data.concat(w),this._nDataBytes+=w.sigBytes},_process:function(w){var L=this._data,M=L.words,P=L.sigBytes,V=this.blockSize,G=4*V,H=P/G,W=(H=w?l.ceil(H):l.max((0|H)-this._minBufferSize,0))*V,z=l.min(4*W,P);if(W){for(var Z=0;Z<W;Z+=V)this._doProcessBlock(M,Z);var F=M.splice(0,W);L.sigBytes-=z}return new g.init(F,z)},clone:function(){var w=y.clone.call(this);return w._data=this._data.clone(),w},_minBufferSize:0}),D=(v.Hasher=O.extend({cfg:y.extend(),init:function(w){this.cfg=this.cfg.extend(w),this.reset()},reset:function(){O.reset.call(this),this._doReset()},update:function(w){return this._append(w),this._process(),this},finalize:function(w){w&&this._append(w);var L=this._doFinalize();return L},blockSize:16,_createHelper:function(w){return function(L,M){return new w.init(M).finalize(L)}},_createHmacHelper:function(w){return function(L,M){return new D.HMAC.init(w,M).finalize(L)}}}),m.algo={});return m}(Math),a)}),tw=(nt(function(n,s){var a,l,h,p,m,v;n.exports=(h=(l=a=st).lib,p=h.Base,m=h.WordArray,(v=l.x64={}).Word=p.extend({init:function(y,g){this.high=y,this.low=g}}),v.WordArray=p.extend({init:function(y,g){y=this.words=y||[],this.sigBytes=g??8*y.length},toX32:function(){for(var y=this.words,g=y.length,T=[],A=0;A<g;A++){var C=y[A];T.push(C.high),T.push(C.low)}return m.create(T,this.sigBytes)},clone:function(){for(var y=p.clone.call(this),g=y.words=this.words.slice(0),T=g.length,A=0;A<T;A++)g[A]=g[A].clone();return y}}),a)}),nt(function(n,s){var a;n.exports=(a=st,function(){if(typeof ArrayBuffer=="function"){var l=a.lib.WordArray,h=l.init;(l.init=function(p){if(p instanceof ArrayBuffer&&(p=new Uint8Array(p)),(p instanceof Int8Array||typeof Uint8ClampedArray<"u"&&p instanceof Uint8ClampedArray||p instanceof Int16Array||p instanceof Uint16Array||p instanceof Int32Array||p instanceof Uint32Array||p instanceof Float32Array||p instanceof Float64Array)&&(p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength)),p instanceof Uint8Array){for(var m=p.byteLength,v=[],y=0;y<m;y++)v[y>>>2]|=p[y]<<24-y%4*8;h.call(this,v,m)}else h.apply(this,arguments)}).prototype=l}}(),a.lib.WordArray)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib.WordArray,p=l.enc;function m(v){return v<<8&4278255360|v>>>8&16711935}p.Utf16=p.Utf16BE={stringify:function(v){for(var y=v.words,g=v.sigBytes,T=[],A=0;A<g;A+=2){var C=y[A>>>2]>>>16-A%4*8&65535;T.push(String.fromCharCode(C))}return T.join("")},parse:function(v){for(var y=v.length,g=[],T=0;T<y;T++)g[T>>>1]|=v.charCodeAt(T)<<16-T%2*16;return h.create(g,2*y)}},p.Utf16LE={stringify:function(v){for(var y=v.words,g=v.sigBytes,T=[],A=0;A<g;A+=2){var C=m(y[A>>>2]>>>16-A%4*8&65535);T.push(String.fromCharCode(C))}return T.join("")},parse:function(v){for(var y=v.length,g=[],T=0;T<y;T++)g[T>>>1]|=m(v.charCodeAt(T)<<16-T%2*16);return h.create(g,2*y)}}}(),a.enc.Utf16)}),nt(function(n,s){var a,l,h;n.exports=(h=(l=a=st).lib.WordArray,l.enc.Base64={stringify:function(p){var m=p.words,v=p.sigBytes,y=this._map;p.clamp();for(var g=[],T=0;T<v;T+=3)for(var A=(m[T>>>2]>>>24-T%4*8&255)<<16|(m[T+1>>>2]>>>24-(T+1)%4*8&255)<<8|m[T+2>>>2]>>>24-(T+2)%4*8&255,C=0;C<4&&T+.75*C<v;C++)g.push(y.charAt(A>>>6*(3-C)&63));var I=y.charAt(64);if(I)for(;g.length%4;)g.push(I);return g.join("")},parse:function(p){var m=p.length,v=this._map,y=this._reverseMap;if(!y){y=this._reverseMap=[];for(var g=0;g<v.length;g++)y[v.charCodeAt(g)]=g}var T=v.charAt(64);if(T){var A=p.indexOf(T);A!==-1&&(m=A)}return function(C,I,O){for(var D=[],w=0,L=0;L<I;L++)if(L%4){var M=O[C.charCodeAt(L-1)]<<L%4*2,P=O[C.charCodeAt(L)]>>>6-L%4*2;D[w>>>2]|=(M|P)<<24-w%4*8,w++}return h.create(D,w)}(p,m,y)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},a.enc.Base64)}),nt(function(n,s){var a;n.exports=(a=st,function(l){var h=a,p=h.lib,m=p.WordArray,v=p.Hasher,y=h.algo,g=[];(function(){for(var D=0;D<64;D++)g[D]=4294967296*l.abs(l.sin(D+1))|0})();var T=y.MD5=v.extend({_doReset:function(){this._hash=new m.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(D,w){for(var L=0;L<16;L++){var M=w+L,P=D[M];D[M]=16711935&(P<<8|P>>>24)|4278255360&(P<<24|P>>>8)}var V=this._hash.words,G=D[w+0],H=D[w+1],W=D[w+2],z=D[w+3],Z=D[w+4],F=D[w+5],J=D[w+6],X=D[w+7],ee=D[w+8],ve=D[w+9],Ce=D[w+10],Ae=D[w+11],Se=D[w+12],_e=D[w+13],Fe=D[w+14],dt=D[w+15],te=V[0],$=V[1],ne=V[2],de=V[3];te=A(te,$,ne,de,G,7,g[0]),de=A(de,te,$,ne,H,12,g[1]),ne=A(ne,de,te,$,W,17,g[2]),$=A($,ne,de,te,z,22,g[3]),te=A(te,$,ne,de,Z,7,g[4]),de=A(de,te,$,ne,F,12,g[5]),ne=A(ne,de,te,$,J,17,g[6]),$=A($,ne,de,te,X,22,g[7]),te=A(te,$,ne,de,ee,7,g[8]),de=A(de,te,$,ne,ve,12,g[9]),ne=A(ne,de,te,$,Ce,17,g[10]),$=A($,ne,de,te,Ae,22,g[11]),te=A(te,$,ne,de,Se,7,g[12]),de=A(de,te,$,ne,_e,12,g[13]),ne=A(ne,de,te,$,Fe,17,g[14]),te=C(te,$=A($,ne,de,te,dt,22,g[15]),ne,de,H,5,g[16]),de=C(de,te,$,ne,J,9,g[17]),ne=C(ne,de,te,$,Ae,14,g[18]),$=C($,ne,de,te,G,20,g[19]),te=C(te,$,ne,de,F,5,g[20]),de=C(de,te,$,ne,Ce,9,g[21]),ne=C(ne,de,te,$,dt,14,g[22]),$=C($,ne,de,te,Z,20,g[23]),te=C(te,$,ne,de,ve,5,g[24]),de=C(de,te,$,ne,Fe,9,g[25]),ne=C(ne,de,te,$,z,14,g[26]),$=C($,ne,de,te,ee,20,g[27]),te=C(te,$,ne,de,_e,5,g[28]),de=C(de,te,$,ne,W,9,g[29]),ne=C(ne,de,te,$,X,14,g[30]),te=I(te,$=C($,ne,de,te,Se,20,g[31]),ne,de,F,4,g[32]),de=I(de,te,$,ne,ee,11,g[33]),ne=I(ne,de,te,$,Ae,16,g[34]),$=I($,ne,de,te,Fe,23,g[35]),te=I(te,$,ne,de,H,4,g[36]),de=I(de,te,$,ne,Z,11,g[37]),ne=I(ne,de,te,$,X,16,g[38]),$=I($,ne,de,te,Ce,23,g[39]),te=I(te,$,ne,de,_e,4,g[40]),de=I(de,te,$,ne,G,11,g[41]),ne=I(ne,de,te,$,z,16,g[42]),$=I($,ne,de,te,J,23,g[43]),te=I(te,$,ne,de,ve,4,g[44]),de=I(de,te,$,ne,Se,11,g[45]),ne=I(ne,de,te,$,dt,16,g[46]),te=O(te,$=I($,ne,de,te,W,23,g[47]),ne,de,G,6,g[48]),de=O(de,te,$,ne,X,10,g[49]),ne=O(ne,de,te,$,Fe,15,g[50]),$=O($,ne,de,te,F,21,g[51]),te=O(te,$,ne,de,Se,6,g[52]),de=O(de,te,$,ne,z,10,g[53]),ne=O(ne,de,te,$,Ce,15,g[54]),$=O($,ne,de,te,H,21,g[55]),te=O(te,$,ne,de,ee,6,g[56]),de=O(de,te,$,ne,dt,10,g[57]),ne=O(ne,de,te,$,J,15,g[58]),$=O($,ne,de,te,_e,21,g[59]),te=O(te,$,ne,de,Z,6,g[60]),de=O(de,te,$,ne,Ae,10,g[61]),ne=O(ne,de,te,$,W,15,g[62]),$=O($,ne,de,te,ve,21,g[63]),V[0]=V[0]+te|0,V[1]=V[1]+$|0,V[2]=V[2]+ne|0,V[3]=V[3]+de|0},_doFinalize:function(){var D=this._data,w=D.words,L=8*this._nDataBytes,M=8*D.sigBytes;w[M>>>5]|=128<<24-M%32;var P=l.floor(L/4294967296),V=L;w[15+(M+64>>>9<<4)]=16711935&(P<<8|P>>>24)|4278255360&(P<<24|P>>>8),w[14+(M+64>>>9<<4)]=16711935&(V<<8|V>>>24)|4278255360&(V<<24|V>>>8),D.sigBytes=4*(w.length+1),this._process();for(var G=this._hash,H=G.words,W=0;W<4;W++){var z=H[W];H[W]=16711935&(z<<8|z>>>24)|4278255360&(z<<24|z>>>8)}return G},clone:function(){var D=v.clone.call(this);return D._hash=this._hash.clone(),D}});function A(D,w,L,M,P,V,G){var H=D+(w&L|~w&M)+P+G;return(H<<V|H>>>32-V)+w}function C(D,w,L,M,P,V,G){var H=D+(w&M|L&~M)+P+G;return(H<<V|H>>>32-V)+w}function I(D,w,L,M,P,V,G){var H=D+(w^L^M)+P+G;return(H<<V|H>>>32-V)+w}function O(D,w,L,M,P,V,G){var H=D+(L^(w|~M))+P+G;return(H<<V|H>>>32-V)+w}h.MD5=v._createHelper(T),h.HmacMD5=v._createHmacHelper(T)}(Math),a.MD5)}),nt(function(n,s){var a,l,h,p,m,v,y,g;n.exports=(h=(l=a=st).lib,p=h.WordArray,m=h.Hasher,v=l.algo,y=[],g=v.SHA1=m.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(T,A){for(var C=this._hash.words,I=C[0],O=C[1],D=C[2],w=C[3],L=C[4],M=0;M<80;M++){if(M<16)y[M]=0|T[A+M];else{var P=y[M-3]^y[M-8]^y[M-14]^y[M-16];y[M]=P<<1|P>>>31}var V=(I<<5|I>>>27)+L+y[M];V+=M<20?1518500249+(O&D|~O&w):M<40?1859775393+(O^D^w):M<60?(O&D|O&w|D&w)-1894007588:(O^D^w)-899497514,L=w,w=D,D=O<<30|O>>>2,O=I,I=V}C[0]=C[0]+I|0,C[1]=C[1]+O|0,C[2]=C[2]+D|0,C[3]=C[3]+w|0,C[4]=C[4]+L|0},_doFinalize:function(){var T=this._data,A=T.words,C=8*this._nDataBytes,I=8*T.sigBytes;return A[I>>>5]|=128<<24-I%32,A[14+(I+64>>>9<<4)]=Math.floor(C/4294967296),A[15+(I+64>>>9<<4)]=C,T.sigBytes=4*A.length,this._process(),this._hash},clone:function(){var T=m.clone.call(this);return T._hash=this._hash.clone(),T}}),l.SHA1=m._createHelper(g),l.HmacSHA1=m._createHmacHelper(g),a.SHA1)}),nt(function(n,s){var a;n.exports=(a=st,function(l){var h=a,p=h.lib,m=p.WordArray,v=p.Hasher,y=h.algo,g=[],T=[];(function(){function I(L){for(var M=l.sqrt(L),P=2;P<=M;P++)if(!(L%P))return!1;return!0}function O(L){return 4294967296*(L-(0|L))|0}for(var D=2,w=0;w<64;)I(D)&&(w<8&&(g[w]=O(l.pow(D,.5))),T[w]=O(l.pow(D,1/3)),w++),D++})();var A=[],C=y.SHA256=v.extend({_doReset:function(){this._hash=new m.init(g.slice(0))},_doProcessBlock:function(I,O){for(var D=this._hash.words,w=D[0],L=D[1],M=D[2],P=D[3],V=D[4],G=D[5],H=D[6],W=D[7],z=0;z<64;z++){if(z<16)A[z]=0|I[O+z];else{var Z=A[z-15],F=(Z<<25|Z>>>7)^(Z<<14|Z>>>18)^Z>>>3,J=A[z-2],X=(J<<15|J>>>17)^(J<<13|J>>>19)^J>>>10;A[z]=F+A[z-7]+X+A[z-16]}var ee=w&L^w&M^L&M,ve=(w<<30|w>>>2)^(w<<19|w>>>13)^(w<<10|w>>>22),Ce=W+((V<<26|V>>>6)^(V<<21|V>>>11)^(V<<7|V>>>25))+(V&G^~V&H)+T[z]+A[z];W=H,H=G,G=V,V=P+Ce|0,P=M,M=L,L=w,w=Ce+(ve+ee)|0}D[0]=D[0]+w|0,D[1]=D[1]+L|0,D[2]=D[2]+M|0,D[3]=D[3]+P|0,D[4]=D[4]+V|0,D[5]=D[5]+G|0,D[6]=D[6]+H|0,D[7]=D[7]+W|0},_doFinalize:function(){var I=this._data,O=I.words,D=8*this._nDataBytes,w=8*I.sigBytes;return O[w>>>5]|=128<<24-w%32,O[14+(w+64>>>9<<4)]=l.floor(D/4294967296),O[15+(w+64>>>9<<4)]=D,I.sigBytes=4*O.length,this._process(),this._hash},clone:function(){var I=v.clone.call(this);return I._hash=this._hash.clone(),I}});h.SHA256=v._createHelper(C),h.HmacSHA256=v._createHmacHelper(C)}(Math),a.SHA256)}),nt(function(n,s){var a,l,h,p,m,v;n.exports=(h=(l=a=st).lib.WordArray,p=l.algo,m=p.SHA256,v=p.SHA224=m.extend({_doReset:function(){this._hash=new h.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var y=m._doFinalize.call(this);return y.sigBytes-=4,y}}),l.SHA224=m._createHelper(v),l.HmacSHA224=m._createHmacHelper(v),a.SHA224)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib.Hasher,p=l.x64,m=p.Word,v=p.WordArray,y=l.algo;function g(){return m.create.apply(m,arguments)}var T=[g(1116352408,3609767458),g(1899447441,602891725),g(3049323471,3964484399),g(3921009573,2173295548),g(961987163,4081628472),g(1508970993,3053834265),g(2453635748,2937671579),g(2870763221,3664609560),g(3624381080,2734883394),g(310598401,1164996542),g(607225278,1323610764),g(1426881987,3590304994),g(1925078388,4068182383),g(2162078206,991336113),g(2614888103,633803317),g(3248222580,3479774868),g(3835390401,2666613458),g(4022224774,944711139),g(264347078,2341262773),g(604807628,2007800933),g(770255983,1495990901),g(1249150122,1856431235),g(1555081692,3175218132),g(1996064986,2198950837),g(2554220882,3999719339),g(2821834349,766784016),g(2952996808,2566594879),g(3210313671,3203337956),g(3336571891,1034457026),g(3584528711,2466948901),g(113926993,3758326383),g(338241895,168717936),g(666307205,1188179964),g(773529912,1546045734),g(1294757372,1522805485),g(1396182291,2643833823),g(1695183700,2343527390),g(1986661051,1014477480),g(2177026350,1206759142),g(2456956037,344077627),g(2730485921,1290863460),g(2820302411,3158454273),g(3259730800,3505952657),g(3345764771,106217008),g(3516065817,3606008344),g(3600352804,1432725776),g(4094571909,1467031594),g(275423344,851169720),g(430227734,3100823752),g(506948616,1363258195),g(659060556,3750685593),g(883997877,3785050280),g(958139571,3318307427),g(1322822218,3812723403),g(1537002063,2003034995),g(1747873779,3602036899),g(1955562222,1575990012),g(2024104815,1125592928),g(2227730452,2716904306),g(2361852424,442776044),g(2428436474,593698344),g(2756734187,3733110249),g(3204031479,2999351573),g(3329325298,3815920427),g(3391569614,3928383900),g(3515267271,566280711),g(3940187606,3454069534),g(4118630271,4000239992),g(116418474,1914138554),g(174292421,2731055270),g(289380356,3203993006),g(460393269,320620315),g(685471733,587496836),g(852142971,1086792851),g(1017036298,365543100),g(1126000580,2618297676),g(1288033470,3409855158),g(1501505948,4234509866),g(1607167915,987167468),g(1816402316,1246189591)],A=[];(function(){for(var I=0;I<80;I++)A[I]=g()})();var C=y.SHA512=h.extend({_doReset:function(){this._hash=new v.init([new m.init(1779033703,4089235720),new m.init(3144134277,2227873595),new m.init(1013904242,4271175723),new m.init(2773480762,1595750129),new m.init(1359893119,2917565137),new m.init(2600822924,725511199),new m.init(528734635,4215389547),new m.init(1541459225,327033209)])},_doProcessBlock:function(I,O){for(var D=this._hash.words,w=D[0],L=D[1],M=D[2],P=D[3],V=D[4],G=D[5],H=D[6],W=D[7],z=w.high,Z=w.low,F=L.high,J=L.low,X=M.high,ee=M.low,ve=P.high,Ce=P.low,Ae=V.high,Se=V.low,_e=G.high,Fe=G.low,dt=H.high,te=H.low,$=W.high,ne=W.low,de=z,Pt=Z,at=F,jt=J,Ci=X,yt=ee,Qi=ve,fn=Ce,ii=Ae,x=Se,j=_e,q=Fe,ce=dt,ae=te,fe=$,ye=ne,he=0;he<80;he++){var me=A[he];if(he<16)var ue=me.high=0|I[O+2*he],Ee=me.low=0|I[O+2*he+1];else{var Pe=A[he-15],we=Pe.high,Me=Pe.low,Ge=(we>>>1|Me<<31)^(we>>>8|Me<<24)^we>>>7,tt=(Me>>>1|we<<31)^(Me>>>8|we<<24)^(Me>>>7|we<<25),ht=A[he-2],Et=ht.high,Vt=ht.low,di=(Et>>>19|Vt<<13)^(Et<<3|Vt>>>29)^Et>>>6,jn=(Vt>>>19|Et<<13)^(Vt<<3|Et>>>29)^(Vt>>>6|Et<<26),mn=A[he-7],mt=mn.high,Ut=mn.low,Wt=A[he-16],Ro=Wt.high,lt=Wt.low;ue=(ue=(ue=Ge+mt+((Ee=tt+Ut)>>>0<tt>>>0?1:0))+di+((Ee+=jn)>>>0<jn>>>0?1:0))+Ro+((Ee+=lt)>>>0<lt>>>0?1:0),me.high=ue,me.low=Ee}var _n,yp=ii&j^~ii&ce,zt=x&q^~x&ae,Ep=de&at^de&Ci^at&Ci,Tp=Pt&jt^Pt&yt^jt&yt,Sp=(de>>>28|Pt<<4)^(de<<30|Pt>>>2)^(de<<25|Pt>>>7),Ft=(Pt>>>28|de<<4)^(Pt<<30|de>>>2)^(Pt<<25|de>>>7),au=(ii>>>14|x<<18)^(ii>>>18|x<<14)^(ii<<23|x>>>9),Mt=(x>>>14|ii<<18)^(x>>>18|ii<<14)^(x<<23|ii>>>9),Ga=T[he],vi=Ga.high,Ka=Ga.low,Wn=fe+au+((_n=ye+Mt)>>>0<ye>>>0?1:0),cu=Ft+Tp;fe=ce,ye=ae,ce=j,ae=q,j=ii,q=x,ii=Qi+(Wn=(Wn=(Wn=Wn+yp+((_n+=zt)>>>0<zt>>>0?1:0))+vi+((_n+=Ka)>>>0<Ka>>>0?1:0))+ue+((_n+=Ee)>>>0<Ee>>>0?1:0))+((x=fn+_n|0)>>>0<fn>>>0?1:0)|0,Qi=Ci,fn=yt,Ci=at,yt=jt,at=de,jt=Pt,de=Wn+(Sp+Ep+(cu>>>0<Ft>>>0?1:0))+((Pt=_n+cu|0)>>>0<_n>>>0?1:0)|0}Z=w.low=Z+Pt,w.high=z+de+(Z>>>0<Pt>>>0?1:0),J=L.low=J+jt,L.high=F+at+(J>>>0<jt>>>0?1:0),ee=M.low=ee+yt,M.high=X+Ci+(ee>>>0<yt>>>0?1:0),Ce=P.low=Ce+fn,P.high=ve+Qi+(Ce>>>0<fn>>>0?1:0),Se=V.low=Se+x,V.high=Ae+ii+(Se>>>0<x>>>0?1:0),Fe=G.low=Fe+q,G.high=_e+j+(Fe>>>0<q>>>0?1:0),te=H.low=te+ae,H.high=dt+ce+(te>>>0<ae>>>0?1:0),ne=W.low=ne+ye,W.high=$+fe+(ne>>>0<ye>>>0?1:0)},_doFinalize:function(){var I=this._data,O=I.words,D=8*this._nDataBytes,w=8*I.sigBytes;return O[w>>>5]|=128<<24-w%32,O[30+(w+128>>>10<<5)]=Math.floor(D/4294967296),O[31+(w+128>>>10<<5)]=D,I.sigBytes=4*O.length,this._process(),this._hash.toX32()},clone:function(){var I=h.clone.call(this);return I._hash=this._hash.clone(),I},blockSize:32});l.SHA512=h._createHelper(C),l.HmacSHA512=h._createHmacHelper(C)}(),a.SHA512)}),nt(function(n,s){var a,l,h,p,m,v,y,g;n.exports=(h=(l=a=st).x64,p=h.Word,m=h.WordArray,v=l.algo,y=v.SHA512,g=v.SHA384=y.extend({_doReset:function(){this._hash=new m.init([new p.init(3418070365,3238371032),new p.init(1654270250,914150663),new p.init(2438529370,812702999),new p.init(355462360,4144912697),new p.init(1731405415,4290775857),new p.init(2394180231,1750603025),new p.init(3675008525,1694076839),new p.init(1203062813,3204075428)])},_doFinalize:function(){var T=y._doFinalize.call(this);return T.sigBytes-=16,T}}),l.SHA384=y._createHelper(g),l.HmacSHA384=y._createHmacHelper(g),a.SHA384)}),nt(function(n,s){var a;n.exports=(a=st,function(l){var h=a,p=h.lib,m=p.WordArray,v=p.Hasher,y=h.x64.Word,g=h.algo,T=[],A=[],C=[];(function(){for(var D=1,w=0,L=0;L<24;L++){T[D+5*w]=(L+1)*(L+2)/2%64;var M=(2*D+3*w)%5;D=w%5,w=M}for(D=0;D<5;D++)for(w=0;w<5;w++)A[D+5*w]=w+(2*D+3*w)%5*5;for(var P=1,V=0;V<24;V++){for(var G=0,H=0,W=0;W<7;W++){if(1&P){var z=(1<<W)-1;z<32?H^=1<<z:G^=1<<z-32}128&P?P=P<<1^113:P<<=1}C[V]=y.create(G,H)}})();var I=[];(function(){for(var D=0;D<25;D++)I[D]=y.create()})();var O=g.SHA3=v.extend({cfg:v.cfg.extend({outputLength:512}),_doReset:function(){for(var D=this._state=[],w=0;w<25;w++)D[w]=new y.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(D,w){for(var L=this._state,M=this.blockSize/2,P=0;P<M;P++){var V=D[w+2*P],G=D[w+2*P+1];V=16711935&(V<<8|V>>>24)|4278255360&(V<<24|V>>>8),G=16711935&(G<<8|G>>>24)|4278255360&(G<<24|G>>>8),(ne=L[P]).high^=G,ne.low^=V}for(var H=0;H<24;H++){for(var W=0;W<5;W++){for(var z=0,Z=0,F=0;F<5;F++)z^=(ne=L[W+5*F]).high,Z^=ne.low;var J=I[W];J.high=z,J.low=Z}for(W=0;W<5;W++){var X=I[(W+4)%5],ee=I[(W+1)%5],ve=ee.high,Ce=ee.low;for(z=X.high^(ve<<1|Ce>>>31),Z=X.low^(Ce<<1|ve>>>31),F=0;F<5;F++)(ne=L[W+5*F]).high^=z,ne.low^=Z}for(var Ae=1;Ae<25;Ae++){var Se=(ne=L[Ae]).high,_e=ne.low,Fe=T[Ae];Fe<32?(z=Se<<Fe|_e>>>32-Fe,Z=_e<<Fe|Se>>>32-Fe):(z=_e<<Fe-32|Se>>>64-Fe,Z=Se<<Fe-32|_e>>>64-Fe);var dt=I[A[Ae]];dt.high=z,dt.low=Z}var te=I[0],$=L[0];for(te.high=$.high,te.low=$.low,W=0;W<5;W++)for(F=0;F<5;F++){var ne=L[Ae=W+5*F],de=I[Ae],Pt=I[(W+1)%5+5*F],at=I[(W+2)%5+5*F];ne.high=de.high^~Pt.high&at.high,ne.low=de.low^~Pt.low&at.low}ne=L[0];var jt=C[H];ne.high^=jt.high,ne.low^=jt.low}},_doFinalize:function(){var D=this._data,w=D.words,L=(this._nDataBytes,8*D.sigBytes),M=32*this.blockSize;w[L>>>5]|=1<<24-L%32,w[(l.ceil((L+1)/M)*M>>>5)-1]|=128,D.sigBytes=4*w.length,this._process();for(var P=this._state,V=this.cfg.outputLength/8,G=V/8,H=[],W=0;W<G;W++){var z=P[W],Z=z.high,F=z.low;Z=16711935&(Z<<8|Z>>>24)|4278255360&(Z<<24|Z>>>8),F=16711935&(F<<8|F>>>24)|4278255360&(F<<24|F>>>8),H.push(F),H.push(Z)}return new m.init(H,V)},clone:function(){for(var D=v.clone.call(this),w=D._state=this._state.slice(0),L=0;L<25;L++)w[L]=w[L].clone();return D}});h.SHA3=v._createHelper(O),h.HmacSHA3=v._createHmacHelper(O)}(Math),a.SHA3)}),nt(function(n,s){var a;n.exports=(a=st,function(l){var h=a,p=h.lib,m=p.WordArray,v=p.Hasher,y=h.algo,g=m.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),T=m.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),A=m.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),C=m.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),I=m.create([0,1518500249,1859775393,2400959708,2840853838]),O=m.create([1352829926,1548603684,1836072691,2053994217,0]),D=y.RIPEMD160=v.extend({_doReset:function(){this._hash=m.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(H,W){for(var z=0;z<16;z++){var Z=W+z,F=H[Z];H[Z]=16711935&(F<<8|F>>>24)|4278255360&(F<<24|F>>>8)}var J,X,ee,ve,Ce,Ae,Se,_e,Fe,dt,te,$=this._hash.words,ne=I.words,de=O.words,Pt=g.words,at=T.words,jt=A.words,Ci=C.words;for(Ae=J=$[0],Se=X=$[1],_e=ee=$[2],Fe=ve=$[3],dt=Ce=$[4],z=0;z<80;z+=1)te=J+H[W+Pt[z]]|0,te+=z<16?w(X,ee,ve)+ne[0]:z<32?L(X,ee,ve)+ne[1]:z<48?M(X,ee,ve)+ne[2]:z<64?P(X,ee,ve)+ne[3]:V(X,ee,ve)+ne[4],te=(te=G(te|=0,jt[z]))+Ce|0,J=Ce,Ce=ve,ve=G(ee,10),ee=X,X=te,te=Ae+H[W+at[z]]|0,te+=z<16?V(Se,_e,Fe)+de[0]:z<32?P(Se,_e,Fe)+de[1]:z<48?M(Se,_e,Fe)+de[2]:z<64?L(Se,_e,Fe)+de[3]:w(Se,_e,Fe)+de[4],te=(te=G(te|=0,Ci[z]))+dt|0,Ae=dt,dt=Fe,Fe=G(_e,10),_e=Se,Se=te;te=$[1]+ee+Fe|0,$[1]=$[2]+ve+dt|0,$[2]=$[3]+Ce+Ae|0,$[3]=$[4]+J+Se|0,$[4]=$[0]+X+_e|0,$[0]=te},_doFinalize:function(){var H=this._data,W=H.words,z=8*this._nDataBytes,Z=8*H.sigBytes;W[Z>>>5]|=128<<24-Z%32,W[14+(Z+64>>>9<<4)]=16711935&(z<<8|z>>>24)|4278255360&(z<<24|z>>>8),H.sigBytes=4*(W.length+1),this._process();for(var F=this._hash,J=F.words,X=0;X<5;X++){var ee=J[X];J[X]=16711935&(ee<<8|ee>>>24)|4278255360&(ee<<24|ee>>>8)}return F},clone:function(){var H=v.clone.call(this);return H._hash=this._hash.clone(),H}});function w(H,W,z){return H^W^z}function L(H,W,z){return H&W|~H&z}function M(H,W,z){return(H|~W)^z}function P(H,W,z){return H&z|W&~z}function V(H,W,z){return H^(W|~z)}function G(H,W){return H<<W|H>>>32-W}h.RIPEMD160=v._createHelper(D),h.HmacRIPEMD160=v._createHmacHelper(D)}(),a.RIPEMD160)}),nt(function(n,s){var a,l,h,p,m,v;n.exports=(l=(a=st).lib,h=l.Base,p=a.enc,m=p.Utf8,v=a.algo,void(v.HMAC=h.extend({init:function(y,g){y=this._hasher=new y.init,typeof g=="string"&&(g=m.parse(g));var T=y.blockSize,A=4*T;g.sigBytes>A&&(g=y.finalize(g)),g.clamp();for(var C=this._oKey=g.clone(),I=this._iKey=g.clone(),O=C.words,D=I.words,w=0;w<T;w++)O[w]^=1549556828,D[w]^=909522486;C.sigBytes=I.sigBytes=A,this.reset()},reset:function(){var y=this._hasher;y.reset(),y.update(this._iKey)},update:function(y){return this._hasher.update(y),this},finalize:function(y){var g=this._hasher,T=g.finalize(y);g.reset();var A=g.finalize(this._oKey.clone().concat(T));return A}})))}),nt(function(n,s){var a,l,h,p,m,v,y,g,T;n.exports=(h=(l=a=st).lib,p=h.Base,m=h.WordArray,v=l.algo,y=v.SHA1,g=v.HMAC,T=v.PBKDF2=p.extend({cfg:p.extend({keySize:4,hasher:y,iterations:1}),init:function(A){this.cfg=this.cfg.extend(A)},compute:function(A,C){for(var I=this.cfg,O=g.create(I.hasher,A),D=m.create(),w=m.create([1]),L=D.words,M=w.words,P=I.keySize,V=I.iterations;L.length<P;){var G=O.update(C).finalize(w);O.reset();for(var H=G.words,W=H.length,z=G,Z=1;Z<V;Z++){z=O.finalize(z),O.reset();for(var F=z.words,J=0;J<W;J++)H[J]^=F[J]}D.concat(G),M[0]++}return D.sigBytes=4*P,D}}),l.PBKDF2=function(A,C,I){return T.create(I).compute(A,C)},a.PBKDF2)}),nt(function(n,s){var a,l,h,p,m,v,y,g;n.exports=(h=(l=a=st).lib,p=h.Base,m=h.WordArray,v=l.algo,y=v.MD5,g=v.EvpKDF=p.extend({cfg:p.extend({keySize:4,hasher:y,iterations:1}),init:function(T){this.cfg=this.cfg.extend(T)},compute:function(T,A){for(var C=this.cfg,I=C.hasher.create(),O=m.create(),D=O.words,w=C.keySize,L=C.iterations;D.length<w;){M&&I.update(M);var M=I.update(T).finalize(A);I.reset();for(var P=1;P<L;P++)M=I.finalize(M),I.reset();O.concat(M)}return O.sigBytes=4*w,O}}),l.EvpKDF=function(T,A,C){return g.create(C).compute(T,A)},a.EvpKDF)}),nt(function(n,s){var a,l,h,p,m,v,y,g,T,A,C,I,O,D,w,L,M,P,V,G,H,W,z,Z;n.exports=void((a=st).lib.Cipher||(h=a,p=h.lib,m=p.Base,v=p.WordArray,y=p.BufferedBlockAlgorithm,g=h.enc,g.Utf8,T=g.Base64,A=h.algo,C=A.EvpKDF,I=p.Cipher=y.extend({cfg:m.extend(),createEncryptor:function(F,J){return this.create(this._ENC_XFORM_MODE,F,J)},createDecryptor:function(F,J){return this.create(this._DEC_XFORM_MODE,F,J)},init:function(F,J,X){this.cfg=this.cfg.extend(X),this._xformMode=F,this._key=J,this.reset()},reset:function(){y.reset.call(this),this._doReset()},process:function(F){return this._append(F),this._process()},finalize:function(F){F&&this._append(F);var J=this._doFinalize();return J},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function F(J){return typeof J=="string"?Z:H}return function(J){return{encrypt:function(X,ee,ve){return F(ee).encrypt(J,X,ee,ve)},decrypt:function(X,ee,ve){return F(ee).decrypt(J,X,ee,ve)}}}}()}),p.StreamCipher=I.extend({_doFinalize:function(){var F=this._process(!0);return F},blockSize:1}),O=h.mode={},D=p.BlockCipherMode=m.extend({createEncryptor:function(F,J){return this.Encryptor.create(F,J)},createDecryptor:function(F,J){return this.Decryptor.create(F,J)},init:function(F,J){this._cipher=F,this._iv=J}}),w=O.CBC=function(){var F=D.extend();function J(X,ee,ve){var Ce=this._iv;if(Ce){var Ae=Ce;this._iv=l}else var Ae=this._prevBlock;for(var Se=0;Se<ve;Se++)X[ee+Se]^=Ae[Se]}return F.Encryptor=F.extend({processBlock:function(X,ee){var ve=this._cipher,Ce=ve.blockSize;J.call(this,X,ee,Ce),ve.encryptBlock(X,ee),this._prevBlock=X.slice(ee,ee+Ce)}}),F.Decryptor=F.extend({processBlock:function(X,ee){var ve=this._cipher,Ce=ve.blockSize,Ae=X.slice(ee,ee+Ce);ve.decryptBlock(X,ee),J.call(this,X,ee,Ce),this._prevBlock=Ae}}),F}(),L=h.pad={},M=L.Pkcs7={pad:function(F,J){for(var X=4*J,ee=X-F.sigBytes%X,ve=ee<<24|ee<<16|ee<<8|ee,Ce=[],Ae=0;Ae<ee;Ae+=4)Ce.push(ve);var Se=v.create(Ce,ee);F.concat(Se)},unpad:function(F){var J=255&F.words[F.sigBytes-1>>>2];F.sigBytes-=J}},p.BlockCipher=I.extend({cfg:I.cfg.extend({mode:w,padding:M}),reset:function(){I.reset.call(this);var F=this.cfg,J=F.iv,X=F.mode;if(this._xformMode==this._ENC_XFORM_MODE)var ee=X.createEncryptor;else{var ee=X.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==ee?this._mode.init(this,J&&J.words):(this._mode=ee.call(X,this,J&&J.words),this._mode.__creator=ee)},_doProcessBlock:function(F,J){this._mode.processBlock(F,J)},_doFinalize:function(){var F=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){F.pad(this._data,this.blockSize);var J=this._process(!0)}else{var J=this._process(!0);F.unpad(J)}return J},blockSize:4}),P=p.CipherParams=m.extend({init:function(F){this.mixIn(F)},toString:function(F){return(F||this.formatter).stringify(this)}}),V=h.format={},G=V.OpenSSL={stringify:function(F){var J=F.ciphertext,X=F.salt;if(X)var ee=v.create([1398893684,1701076831]).concat(X).concat(J);else var ee=J;return ee.toString(T)},parse:function(F){var J=T.parse(F),X=J.words;if(X[0]==1398893684&&X[1]==1701076831){var ee=v.create(X.slice(2,4));X.splice(0,4),J.sigBytes-=16}return P.create({ciphertext:J,salt:ee})}},H=p.SerializableCipher=m.extend({cfg:m.extend({format:G}),encrypt:function(F,J,X,ee){ee=this.cfg.extend(ee);var ve=F.createEncryptor(X,ee),Ce=ve.finalize(J),Ae=ve.cfg;return P.create({ciphertext:Ce,key:X,iv:Ae.iv,algorithm:F,mode:Ae.mode,padding:Ae.padding,blockSize:F.blockSize,formatter:ee.format})},decrypt:function(F,J,X,ee){ee=this.cfg.extend(ee),J=this._parse(J,ee.format);var ve=F.createDecryptor(X,ee).finalize(J.ciphertext);return ve},_parse:function(F,J){return typeof F=="string"?J.parse(F,this):F}}),W=h.kdf={},z=W.OpenSSL={execute:function(F,J,X,ee){ee||(ee=v.random(8));var ve=C.create({keySize:J+X}).compute(F,ee),Ce=v.create(ve.words.slice(J),4*X);return ve.sigBytes=4*J,P.create({key:ve,iv:Ce,salt:ee})}},Z=p.PasswordBasedCipher=H.extend({cfg:H.cfg.extend({kdf:z}),encrypt:function(F,J,X,ee){var ve=(ee=this.cfg.extend(ee)).kdf.execute(X,F.keySize,F.ivSize);ee.iv=ve.iv;var Ce=H.encrypt.call(this,F,J,ve.key,ee);return Ce.mixIn(ve),Ce},decrypt:function(F,J,X,ee){ee=this.cfg.extend(ee),J=this._parse(J,ee.format);var ve=ee.kdf.execute(X,F.keySize,F.ivSize,J.salt);ee.iv=ve.iv;var Ce=H.decrypt.call(this,F,J,ve.key,ee);return Ce}})))}),nt(function(n,s){var a;n.exports=((a=st).mode.CFB=function(){var l=a.lib.BlockCipherMode.extend();function h(p,m,v,y){var g=this._iv;if(g){var T=g.slice(0);this._iv=void 0}else T=this._prevBlock;y.encryptBlock(T,0);for(var A=0;A<v;A++)p[m+A]^=T[A]}return l.Encryptor=l.extend({processBlock:function(p,m){var v=this._cipher,y=v.blockSize;h.call(this,p,m,y,v),this._prevBlock=p.slice(m,m+y)}}),l.Decryptor=l.extend({processBlock:function(p,m){var v=this._cipher,y=v.blockSize,g=p.slice(m,m+y);h.call(this,p,m,y,v),this._prevBlock=g}}),l}(),a.mode.CFB)}),nt(function(n,s){var a,l,h;n.exports=((a=st).mode.CTR=(l=a.lib.BlockCipherMode.extend(),h=l.Encryptor=l.extend({processBlock:function(p,m){var v=this._cipher,y=v.blockSize,g=this._iv,T=this._counter;g&&(T=this._counter=g.slice(0),this._iv=void 0);var A=T.slice(0);v.encryptBlock(A,0),T[y-1]=T[y-1]+1|0;for(var C=0;C<y;C++)p[m+C]^=A[C]}}),l.Decryptor=h,l),a.mode.CTR)}),nt(function(n,s){var a;n.exports=((a=st).mode.CTRGladman=function(){var l=a.lib.BlockCipherMode.extend();function h(m){if((m>>24&255)==255){var v=m>>16&255,y=m>>8&255,g=255&m;v===255?(v=0,y===255?(y=0,g===255?g=0:++g):++y):++v,m=0,m+=v<<16,m+=y<<8,m+=g}else m+=1<<24;return m}var p=l.Encryptor=l.extend({processBlock:function(m,v){var y=this._cipher,g=y.blockSize,T=this._iv,A=this._counter;T&&(A=this._counter=T.slice(0),this._iv=void 0),function(O){(O[0]=h(O[0]))===0&&(O[1]=h(O[1]))}(A);var C=A.slice(0);y.encryptBlock(C,0);for(var I=0;I<g;I++)m[v+I]^=C[I]}});return l.Decryptor=p,l}(),a.mode.CTRGladman)}),nt(function(n,s){var a,l,h;n.exports=((a=st).mode.OFB=(l=a.lib.BlockCipherMode.extend(),h=l.Encryptor=l.extend({processBlock:function(p,m){var v=this._cipher,y=v.blockSize,g=this._iv,T=this._keystream;g&&(T=this._keystream=g.slice(0),this._iv=void 0),v.encryptBlock(T,0);for(var A=0;A<y;A++)p[m+A]^=T[A]}}),l.Decryptor=h,l),a.mode.OFB)}),nt(function(n,s){var a,l;n.exports=((a=st).mode.ECB=((l=a.lib.BlockCipherMode.extend()).Encryptor=l.extend({processBlock:function(h,p){this._cipher.encryptBlock(h,p)}}),l.Decryptor=l.extend({processBlock:function(h,p){this._cipher.decryptBlock(h,p)}}),l),a.mode.ECB)}),nt(function(n,s){var a;n.exports=((a=st).pad.AnsiX923={pad:function(l,h){var p=l.sigBytes,m=4*h,v=m-p%m,y=p+v-1;l.clamp(),l.words[y>>>2]|=v<<24-y%4*8,l.sigBytes+=v},unpad:function(l){var h=255&l.words[l.sigBytes-1>>>2];l.sigBytes-=h}},a.pad.Ansix923)}),nt(function(n,s){var a;n.exports=((a=st).pad.Iso10126={pad:function(l,h){var p=4*h,m=p-l.sigBytes%p;l.concat(a.lib.WordArray.random(m-1)).concat(a.lib.WordArray.create([m<<24],1))},unpad:function(l){var h=255&l.words[l.sigBytes-1>>>2];l.sigBytes-=h}},a.pad.Iso10126)}),nt(function(n,s){var a;n.exports=((a=st).pad.Iso97971={pad:function(l,h){l.concat(a.lib.WordArray.create([2147483648],1)),a.pad.ZeroPadding.pad(l,h)},unpad:function(l){a.pad.ZeroPadding.unpad(l),l.sigBytes--}},a.pad.Iso97971)}),nt(function(n,s){var a;n.exports=((a=st).pad.ZeroPadding={pad:function(l,h){var p=4*h;l.clamp(),l.sigBytes+=p-(l.sigBytes%p||p)},unpad:function(l){for(var h=l.words,p=l.sigBytes-1;!(h[p>>>2]>>>24-p%4*8&255);)p--;l.sigBytes=p+1}},a.pad.ZeroPadding)}),nt(function(n,s){var a;n.exports=((a=st).pad.NoPadding={pad:function(){},unpad:function(){}},a.pad.NoPadding)}),nt(function(n,s){var a,l,h,p;n.exports=(h=(l=a=st).lib.CipherParams,p=l.enc.Hex,l.format.Hex={stringify:function(m){return m.ciphertext.toString(p)},parse:function(m){var v=p.parse(m);return h.create({ciphertext:v})}},a.format.Hex)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib.BlockCipher,p=l.algo,m=[],v=[],y=[],g=[],T=[],A=[],C=[],I=[],O=[],D=[];(function(){for(var M=[],P=0;P<256;P++)M[P]=P<128?P<<1:P<<1^283;var V=0,G=0;for(P=0;P<256;P++){var H=G^G<<1^G<<2^G<<3^G<<4;H=H>>>8^255&H^99,m[V]=H,v[H]=V;var W=M[V],z=M[W],Z=M[z],F=257*M[H]^16843008*H;y[V]=F<<24|F>>>8,g[V]=F<<16|F>>>16,T[V]=F<<8|F>>>24,A[V]=F,F=16843009*Z^65537*z^257*W^16843008*V,C[H]=F<<24|F>>>8,I[H]=F<<16|F>>>16,O[H]=F<<8|F>>>24,D[H]=F,V?(V=W^M[M[M[Z^W]]],G^=M[M[G]]):V=G=1}})();var w=[0,1,2,4,8,16,32,64,128,27,54],L=p.AES=h.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var M=this._keyPriorReset=this._key,P=M.words,V=M.sigBytes/4,G=4*((this._nRounds=V+6)+1),H=this._keySchedule=[],W=0;W<G;W++)if(W<V)H[W]=P[W];else{var z=H[W-1];W%V?V>6&&W%V==4&&(z=m[z>>>24]<<24|m[z>>>16&255]<<16|m[z>>>8&255]<<8|m[255&z]):(z=m[(z=z<<8|z>>>24)>>>24]<<24|m[z>>>16&255]<<16|m[z>>>8&255]<<8|m[255&z],z^=w[W/V|0]<<24),H[W]=H[W-V]^z}for(var Z=this._invKeySchedule=[],F=0;F<G;F++)W=G-F,z=F%4?H[W]:H[W-4],Z[F]=F<4||W<=4?z:C[m[z>>>24]]^I[m[z>>>16&255]]^O[m[z>>>8&255]]^D[m[255&z]]}},encryptBlock:function(M,P){this._doCryptBlock(M,P,this._keySchedule,y,g,T,A,m)},decryptBlock:function(M,P){var V=M[P+1];M[P+1]=M[P+3],M[P+3]=V,this._doCryptBlock(M,P,this._invKeySchedule,C,I,O,D,v),V=M[P+1],M[P+1]=M[P+3],M[P+3]=V},_doCryptBlock:function(M,P,V,G,H,W,z,Z){for(var F=this._nRounds,J=M[P]^V[0],X=M[P+1]^V[1],ee=M[P+2]^V[2],ve=M[P+3]^V[3],Ce=4,Ae=1;Ae<F;Ae++){var Se=G[J>>>24]^H[X>>>16&255]^W[ee>>>8&255]^z[255&ve]^V[Ce++],_e=G[X>>>24]^H[ee>>>16&255]^W[ve>>>8&255]^z[255&J]^V[Ce++],Fe=G[ee>>>24]^H[ve>>>16&255]^W[J>>>8&255]^z[255&X]^V[Ce++],dt=G[ve>>>24]^H[J>>>16&255]^W[X>>>8&255]^z[255&ee]^V[Ce++];J=Se,X=_e,ee=Fe,ve=dt}Se=(Z[J>>>24]<<24|Z[X>>>16&255]<<16|Z[ee>>>8&255]<<8|Z[255&ve])^V[Ce++],_e=(Z[X>>>24]<<24|Z[ee>>>16&255]<<16|Z[ve>>>8&255]<<8|Z[255&J])^V[Ce++],Fe=(Z[ee>>>24]<<24|Z[ve>>>16&255]<<16|Z[J>>>8&255]<<8|Z[255&X])^V[Ce++],dt=(Z[ve>>>24]<<24|Z[J>>>16&255]<<16|Z[X>>>8&255]<<8|Z[255&ee])^V[Ce++],M[P]=Se,M[P+1]=_e,M[P+2]=Fe,M[P+3]=dt},keySize:8});l.AES=h._createHelper(L)}(),a.AES)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib,p=h.WordArray,m=h.BlockCipher,v=l.algo,y=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],g=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],T=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],A=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],C=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],I=v.DES=m.extend({_doReset:function(){for(var L=this._key.words,M=[],P=0;P<56;P++){var V=y[P]-1;M[P]=L[V>>>5]>>>31-V%32&1}for(var G=this._subKeys=[],H=0;H<16;H++){var W=G[H]=[],z=T[H];for(P=0;P<24;P++)W[P/6|0]|=M[(g[P]-1+z)%28]<<31-P%6,W[4+(P/6|0)]|=M[28+(g[P+24]-1+z)%28]<<31-P%6;for(W[0]=W[0]<<1|W[0]>>>31,P=1;P<7;P++)W[P]=W[P]>>>4*(P-1)+3;W[7]=W[7]<<5|W[7]>>>27}var Z=this._invSubKeys=[];for(P=0;P<16;P++)Z[P]=G[15-P]},encryptBlock:function(L,M){this._doCryptBlock(L,M,this._subKeys)},decryptBlock:function(L,M){this._doCryptBlock(L,M,this._invSubKeys)},_doCryptBlock:function(L,M,P){this._lBlock=L[M],this._rBlock=L[M+1],O.call(this,4,252645135),O.call(this,16,65535),D.call(this,2,858993459),D.call(this,8,16711935),O.call(this,1,1431655765);for(var V=0;V<16;V++){for(var G=P[V],H=this._lBlock,W=this._rBlock,z=0,Z=0;Z<8;Z++)z|=A[Z][((W^G[Z])&C[Z])>>>0];this._lBlock=W,this._rBlock=H^z}var F=this._lBlock;this._lBlock=this._rBlock,this._rBlock=F,O.call(this,1,1431655765),D.call(this,8,16711935),D.call(this,2,858993459),O.call(this,16,65535),O.call(this,4,252645135),L[M]=this._lBlock,L[M+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function O(L,M){var P=(this._lBlock>>>L^this._rBlock)&M;this._rBlock^=P,this._lBlock^=P<<L}function D(L,M){var P=(this._rBlock>>>L^this._lBlock)&M;this._lBlock^=P,this._rBlock^=P<<L}l.DES=m._createHelper(I);var w=v.TripleDES=m.extend({_doReset:function(){var L=this._key.words;this._des1=I.createEncryptor(p.create(L.slice(0,2))),this._des2=I.createEncryptor(p.create(L.slice(2,4))),this._des3=I.createEncryptor(p.create(L.slice(4,6)))},encryptBlock:function(L,M){this._des1.encryptBlock(L,M),this._des2.decryptBlock(L,M),this._des3.encryptBlock(L,M)},decryptBlock:function(L,M){this._des3.decryptBlock(L,M),this._des2.encryptBlock(L,M),this._des1.decryptBlock(L,M)},keySize:6,ivSize:2,blockSize:2});l.TripleDES=m._createHelper(w)}(),a.TripleDES)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib.StreamCipher,p=l.algo,m=p.RC4=h.extend({_doReset:function(){for(var g=this._key,T=g.words,A=g.sigBytes,C=this._S=[],I=0;I<256;I++)C[I]=I;I=0;for(var O=0;I<256;I++){var D=I%A,w=T[D>>>2]>>>24-D%4*8&255;O=(O+C[I]+w)%256;var L=C[I];C[I]=C[O],C[O]=L}this._i=this._j=0},_doProcessBlock:function(g,T){g[T]^=v.call(this)},keySize:8,ivSize:0});function v(){for(var g=this._S,T=this._i,A=this._j,C=0,I=0;I<4;I++){A=(A+g[T=(T+1)%256])%256;var O=g[T];g[T]=g[A],g[A]=O,C|=g[(g[T]+g[A])%256]<<24-8*I}return this._i=T,this._j=A,C}l.RC4=h._createHelper(m);var y=p.RC4Drop=m.extend({cfg:m.cfg.extend({drop:192}),_doReset:function(){m._doReset.call(this);for(var g=this.cfg.drop;g>0;g--)v.call(this)}});l.RC4Drop=h._createHelper(y)}(),a.RC4)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib.StreamCipher,p=l.algo,m=[],v=[],y=[],g=p.Rabbit=h.extend({_doReset:function(){for(var A=this._key.words,C=this.cfg.iv,I=0;I<4;I++)A[I]=16711935&(A[I]<<8|A[I]>>>24)|4278255360&(A[I]<<24|A[I]>>>8);var O=this._X=[A[0],A[3]<<16|A[2]>>>16,A[1],A[0]<<16|A[3]>>>16,A[2],A[1]<<16|A[0]>>>16,A[3],A[2]<<16|A[1]>>>16],D=this._C=[A[2]<<16|A[2]>>>16,4294901760&A[0]|65535&A[1],A[3]<<16|A[3]>>>16,4294901760&A[1]|65535&A[2],A[0]<<16|A[0]>>>16,4294901760&A[2]|65535&A[3],A[1]<<16|A[1]>>>16,4294901760&A[3]|65535&A[0]];for(this._b=0,I=0;I<4;I++)T.call(this);for(I=0;I<8;I++)D[I]^=O[I+4&7];if(C){var w=C.words,L=w[0],M=w[1],P=16711935&(L<<8|L>>>24)|4278255360&(L<<24|L>>>8),V=16711935&(M<<8|M>>>24)|4278255360&(M<<24|M>>>8),G=P>>>16|4294901760&V,H=V<<16|65535&P;for(D[0]^=P,D[1]^=G,D[2]^=V,D[3]^=H,D[4]^=P,D[5]^=G,D[6]^=V,D[7]^=H,I=0;I<4;I++)T.call(this)}},_doProcessBlock:function(A,C){var I=this._X;T.call(this),m[0]=I[0]^I[5]>>>16^I[3]<<16,m[1]=I[2]^I[7]>>>16^I[5]<<16,m[2]=I[4]^I[1]>>>16^I[7]<<16,m[3]=I[6]^I[3]>>>16^I[1]<<16;for(var O=0;O<4;O++)m[O]=16711935&(m[O]<<8|m[O]>>>24)|4278255360&(m[O]<<24|m[O]>>>8),A[C+O]^=m[O]},blockSize:4,ivSize:2});function T(){for(var A=this._X,C=this._C,I=0;I<8;I++)v[I]=C[I];for(C[0]=C[0]+1295307597+this._b|0,C[1]=C[1]+3545052371+(C[0]>>>0<v[0]>>>0?1:0)|0,C[2]=C[2]+886263092+(C[1]>>>0<v[1]>>>0?1:0)|0,C[3]=C[3]+1295307597+(C[2]>>>0<v[2]>>>0?1:0)|0,C[4]=C[4]+3545052371+(C[3]>>>0<v[3]>>>0?1:0)|0,C[5]=C[5]+886263092+(C[4]>>>0<v[4]>>>0?1:0)|0,C[6]=C[6]+1295307597+(C[5]>>>0<v[5]>>>0?1:0)|0,C[7]=C[7]+3545052371+(C[6]>>>0<v[6]>>>0?1:0)|0,this._b=C[7]>>>0<v[7]>>>0?1:0,I=0;I<8;I++){var O=A[I]+C[I],D=65535&O,w=O>>>16,L=((D*D>>>17)+D*w>>>15)+w*w,M=((4294901760&O)*O|0)+((65535&O)*O|0);y[I]=L^M}A[0]=y[0]+(y[7]<<16|y[7]>>>16)+(y[6]<<16|y[6]>>>16)|0,A[1]=y[1]+(y[0]<<8|y[0]>>>24)+y[7]|0,A[2]=y[2]+(y[1]<<16|y[1]>>>16)+(y[0]<<16|y[0]>>>16)|0,A[3]=y[3]+(y[2]<<8|y[2]>>>24)+y[1]|0,A[4]=y[4]+(y[3]<<16|y[3]>>>16)+(y[2]<<16|y[2]>>>16)|0,A[5]=y[5]+(y[4]<<8|y[4]>>>24)+y[3]|0,A[6]=y[6]+(y[5]<<16|y[5]>>>16)+(y[4]<<16|y[4]>>>16)|0,A[7]=y[7]+(y[6]<<8|y[6]>>>24)+y[5]|0}l.Rabbit=h._createHelper(g)}(),a.Rabbit)}),nt(function(n,s){var a;n.exports=(a=st,function(){var l=a,h=l.lib.StreamCipher,p=l.algo,m=[],v=[],y=[],g=p.RabbitLegacy=h.extend({_doReset:function(){var A=this._key.words,C=this.cfg.iv,I=this._X=[A[0],A[3]<<16|A[2]>>>16,A[1],A[0]<<16|A[3]>>>16,A[2],A[1]<<16|A[0]>>>16,A[3],A[2]<<16|A[1]>>>16],O=this._C=[A[2]<<16|A[2]>>>16,4294901760&A[0]|65535&A[1],A[3]<<16|A[3]>>>16,4294901760&A[1]|65535&A[2],A[0]<<16|A[0]>>>16,4294901760&A[2]|65535&A[3],A[1]<<16|A[1]>>>16,4294901760&A[3]|65535&A[0]];this._b=0;for(var D=0;D<4;D++)T.call(this);for(D=0;D<8;D++)O[D]^=I[D+4&7];if(C){var w=C.words,L=w[0],M=w[1],P=16711935&(L<<8|L>>>24)|4278255360&(L<<24|L>>>8),V=16711935&(M<<8|M>>>24)|4278255360&(M<<24|M>>>8),G=P>>>16|4294901760&V,H=V<<16|65535&P;for(O[0]^=P,O[1]^=G,O[2]^=V,O[3]^=H,O[4]^=P,O[5]^=G,O[6]^=V,O[7]^=H,D=0;D<4;D++)T.call(this)}},_doProcessBlock:function(A,C){var I=this._X;T.call(this),m[0]=I[0]^I[5]>>>16^I[3]<<16,m[1]=I[2]^I[7]>>>16^I[5]<<16,m[2]=I[4]^I[1]>>>16^I[7]<<16,m[3]=I[6]^I[3]>>>16^I[1]<<16;for(var O=0;O<4;O++)m[O]=16711935&(m[O]<<8|m[O]>>>24)|4278255360&(m[O]<<24|m[O]>>>8),A[C+O]^=m[O]},blockSize:4,ivSize:2});function T(){for(var A=this._X,C=this._C,I=0;I<8;I++)v[I]=C[I];for(C[0]=C[0]+1295307597+this._b|0,C[1]=C[1]+3545052371+(C[0]>>>0<v[0]>>>0?1:0)|0,C[2]=C[2]+886263092+(C[1]>>>0<v[1]>>>0?1:0)|0,C[3]=C[3]+1295307597+(C[2]>>>0<v[2]>>>0?1:0)|0,C[4]=C[4]+3545052371+(C[3]>>>0<v[3]>>>0?1:0)|0,C[5]=C[5]+886263092+(C[4]>>>0<v[4]>>>0?1:0)|0,C[6]=C[6]+1295307597+(C[5]>>>0<v[5]>>>0?1:0)|0,C[7]=C[7]+3545052371+(C[6]>>>0<v[6]>>>0?1:0)|0,this._b=C[7]>>>0<v[7]>>>0?1:0,I=0;I<8;I++){var O=A[I]+C[I],D=65535&O,w=O>>>16,L=((D*D>>>17)+D*w>>>15)+w*w,M=((4294901760&O)*O|0)+((65535&O)*O|0);y[I]=L^M}A[0]=y[0]+(y[7]<<16|y[7]>>>16)+(y[6]<<16|y[6]>>>16)|0,A[1]=y[1]+(y[0]<<8|y[0]>>>24)+y[7]|0,A[2]=y[2]+(y[1]<<16|y[1]>>>16)+(y[0]<<16|y[0]>>>16)|0,A[3]=y[3]+(y[2]<<8|y[2]>>>24)+y[1]|0,A[4]=y[4]+(y[3]<<16|y[3]>>>16)+(y[2]<<16|y[2]>>>16)|0,A[5]=y[5]+(y[4]<<8|y[4]>>>24)+y[3]|0,A[6]=y[6]+(y[5]<<16|y[5]>>>16)+(y[4]<<16|y[4]>>>16)|0,A[7]=y[7]+(y[6]<<8|y[6]>>>24)+y[5]|0}l.RabbitLegacy=h._createHelper(g)}(),a.RabbitLegacy)}),nt(function(n,s){n.exports=st}));function mk(){throw new Error("setTimeout has not been defined")}function _k(){throw new Error("clearTimeout has not been defined")}var es=mk,ts=_k;function gk(n){if(es===setTimeout)return setTimeout(n,0);if((es===mk||!es)&&setTimeout)return es=setTimeout,setTimeout(n,0);try{return es(n,0)}catch{try{return es.call(null,n,0)}catch{return es.call(this,n,0)}}}typeof ja.setTimeout=="function"&&(es=setTimeout),typeof ja.clearTimeout=="function"&&(ts=clearTimeout);var co,vr=[],Va=!1,Kh=-1;function UH(){Va&&co&&(Va=!1,co.length?vr=co.concat(vr):Kh=-1,vr.length&&vk())}function vk(){if(!Va){var n=gk(UH);Va=!0;for(var s=vr.length;s;){for(co=vr,vr=[];++Kh<s;)co&&co[Kh].run();Kh=-1,s=vr.length}co=null,Va=!1,function(a){if(ts===clearTimeout)return clearTimeout(a);if((ts===_k||!ts)&&clearTimeout)return ts=clearTimeout,clearTimeout(a);try{ts(a)}catch{try{return ts.call(null,a)}catch{return ts.call(this,a)}}}(n)}}function $t(n){var s=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)s[a-1]=arguments[a];vr.push(new yk(n,s)),vr.length!==1||Va||gk(vk)}function yk(n,s){this.fun=n,this.array=s}yk.prototype.run=function(){this.fun.apply(null,this.array)};var Nl=ja.performance||{};Nl.now||Nl.mozNow||Nl.msNow||Nl.oNow||Nl.webkitNow;function is(){}function rt(){rt.init.call(this)}function Ek(n){return n._maxListeners===void 0?rt.defaultMaxListeners:n._maxListeners}function FH(n,s,a){if(s)n.call(a);else for(var l=n.length,h=ru(n,l),p=0;p<l;++p)h[p].call(a)}function BH(n,s,a,l){if(s)n.call(a,l);else for(var h=n.length,p=ru(n,h),m=0;m<h;++m)p[m].call(a,l)}function HH(n,s,a,l,h){if(s)n.call(a,l,h);else for(var p=n.length,m=ru(n,p),v=0;v<p;++v)m[v].call(a,l,h)}function jH(n,s,a,l,h,p){if(s)n.call(a,l,h,p);else for(var m=n.length,v=ru(n,m),y=0;y<m;++y)v[y].call(a,l,h,p)}function WH(n,s,a,l){if(s)n.apply(a,l);else for(var h=n.length,p=ru(n,h),m=0;m<h;++m)p[m].apply(a,l)}function iw(n,s,a,l){var h,p,m,v;if(typeof a!="function")throw new TypeError('"listener" argument must be a function');if((p=n._events)?(p.newListener&&(n.emit("newListener",s,a.listener?a.listener:a),p=n._events),m=p[s]):(p=n._events=new is,n._eventsCount=0),m){if(typeof m=="function"?m=p[s]=l?[a,m]:[m,a]:l?m.unshift(a):m.push(a),!m.warned&&(h=Ek(n))&&h>0&&m.length>h){m.warned=!0;var y=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+s+" listeners added. Use emitter.setMaxListeners() to increase limit");y.name="MaxListenersExceededWarning",y.emitter=n,y.type=s,y.count=m.length,v=y,typeof console.warn=="function"?console.warn(v):console.log(v)}}else m=p[s]=a,++n._eventsCount;return n}function nw(n,s,a){var l=!1;function h(){n.removeListener(s,h),l||(l=!0,a.apply(n,arguments))}return h.listener=a,h}function rw(n){var s=this._events;if(s){var a=s[n];if(typeof a=="function")return 1;if(a)return a.length}return 0}function ru(n,s){for(var a=new Array(s);s--;)a[s]=n[s];return a}is.prototype=Object.create(null),rt.EventEmitter=rt,rt.usingDomains=!1,rt.prototype.domain=void 0,rt.prototype._events=void 0,rt.prototype._maxListeners=void 0,rt.defaultMaxListeners=10,rt.init=function(){this.domain=null,rt.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new is,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},rt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},rt.prototype.getMaxListeners=function(){return Ek(this)},rt.prototype.emit=function(n){var s,a,l,h,p,m,v,y=n==="error";if(m=this._events)y=y&&m.error==null;else if(!y)return!1;if(v=this.domain,y){if(s=arguments[1],!v){if(s instanceof Error)throw s;var g=new Error('Uncaught, unspecified "error" event. ('+s+")");throw g.context=s,g}return s||(s=new Error('Uncaught, unspecified "error" event')),s.domainEmitter=this,s.domain=v,s.domainThrown=!1,v.emit("error",s),!1}if(!(a=m[n]))return!1;var T=typeof a=="function";switch(l=arguments.length){case 1:FH(a,T,this);break;case 2:BH(a,T,this,arguments[1]);break;case 3:HH(a,T,this,arguments[1],arguments[2]);break;case 4:jH(a,T,this,arguments[1],arguments[2],arguments[3]);break;default:for(h=new Array(l-1),p=1;p<l;p++)h[p-1]=arguments[p];WH(a,T,this,h)}return!0},rt.prototype.addListener=function(n,s){return iw(this,n,s,!1)},rt.prototype.on=rt.prototype.addListener,rt.prototype.prependListener=function(n,s){return iw(this,n,s,!0)},rt.prototype.once=function(n,s){if(typeof s!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,nw(this,n,s)),this},rt.prototype.prependOnceListener=function(n,s){if(typeof s!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,nw(this,n,s)),this},rt.prototype.removeListener=function(n,s){var a,l,h,p,m;if(typeof s!="function")throw new TypeError('"listener" argument must be a function');if(!(l=this._events))return this;if(!(a=l[n]))return this;if(a===s||a.listener&&a.listener===s)--this._eventsCount==0?this._events=new is:(delete l[n],l.removeListener&&this.emit("removeListener",n,a.listener||s));else if(typeof a!="function"){for(h=-1,p=a.length;p-- >0;)if(a[p]===s||a[p].listener&&a[p].listener===s){m=a[p].listener,h=p;break}if(h<0)return this;if(a.length===1){if(a[0]=void 0,--this._eventsCount==0)return this._events=new is,this;delete l[n]}else(function(v,y){for(var g=y,T=g+1,A=v.length;T<A;g+=1,T+=1)v[g]=v[T];v.pop()})(a,h);l.removeListener&&this.emit("removeListener",n,m||s)}return this},rt.prototype.removeAllListeners=function(n){var s,a;if(!(a=this._events))return this;if(!a.removeListener)return arguments.length===0?(this._events=new is,this._eventsCount=0):a[n]&&(--this._eventsCount==0?this._events=new is:delete a[n]),this;if(arguments.length===0){for(var l,h=Object.keys(a),p=0;p<h.length;++p)(l=h[p])!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=new is,this._eventsCount=0,this}if(typeof(s=a[n])=="function")this.removeListener(n,s);else if(s)do this.removeListener(n,s[s.length-1]);while(s[0]);return this},rt.prototype.listeners=function(n){var s,a=this._events;return a&&(s=a[n])?typeof s=="function"?[s.listener||s]:function(l){for(var h=new Array(l.length),p=0;p<h.length;++p)h[p]=l[p].listener||l[p];return h}(s):[]},rt.listenerCount=function(n,s){return typeof n.listenerCount=="function"?n.listenerCount(s):rw.call(n,s)},rt.prototype.listenerCount=rw,rt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var bi=typeof Object.create=="function"?function(n,s){n.super_=s,n.prototype=Object.create(s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}})}:function(n,s){n.super_=s;var a=function(){};a.prototype=s.prototype,n.prototype=new a,n.prototype.constructor=n},zH=/%[sdj%]/g;function GH(n){if(!ov(n)){for(var s=[],a=0;a<arguments.length;a++)s.push(ps(arguments[a]));return s.join(" ")}a=1;for(var l=arguments,h=l.length,p=String(n).replace(zH,function(v){if(v==="%%")return"%";if(a>=h)return v;switch(v){case"%s":return String(l[a++]);case"%d":return Number(l[a++]);case"%j":try{return JSON.stringify(l[a++])}catch{return"[Circular]"}default:return v}}),m=l[a];a<h;m=l[++a])xv(m)||!su(m)?p+=" "+m:p+=" "+ps(m);return p}function Tk(n,s){if(cs(ja.process))return function(){return Tk(n,s).apply(this,arguments)};var a=!1;return function(){return a||(console.error(s),a=!0),n.apply(this,arguments)}}var b0,Lh={};function ps(n,s){var a={seen:[],stylize:JH};return arguments.length>=3&&(a.depth=arguments[2]),arguments.length>=4&&(a.colors=arguments[3]),Sk(s)?a.showHidden=s:s&&function(l,h){if(!h||!su(h))return l;for(var p=Object.keys(h),m=p.length;m--;)l[p[m]]=h[p[m]]}(a,s),cs(a.showHidden)&&(a.showHidden=!1),cs(a.depth)&&(a.depth=2),cs(a.colors)&&(a.colors=!1),cs(a.customInspect)&&(a.customInspect=!0),a.colors&&(a.stylize=KH),np(a,n,a.depth)}function KH(n,s){var a=ps.styles[s];return a?"\x1B["+ps.colors[a][0]+"m"+n+"\x1B["+ps.colors[a][1]+"m":n}function JH(n,s){return n}function np(n,s,a){if(n.customInspect&&s&&k0(s.inspect)&&s.inspect!==ps&&(!s.constructor||s.constructor.prototype!==s)){var l=s.inspect(a,n);return ov(l)||(l=np(n,l,a)),l}var h=function(I,O){if(cs(O))return I.stylize("undefined","undefined");if(ov(O)){var D="'"+JSON.stringify(O).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return I.stylize(D,"string")}if(w=O,typeof w=="number")return I.stylize(""+O,"number");var w;if(Sk(O))return I.stylize(""+O,"boolean");if(xv(O))return I.stylize("null","null")}(n,s);if(h)return h;var p=Object.keys(s),m=function(I){var O={};return I.forEach(function(D,w){O[D]=!0}),O}(p);if(n.showHidden&&(p=Object.getOwnPropertyNames(s)),w0(s)&&(p.indexOf("message")>=0||p.indexOf("description")>=0))return A0(s);if(p.length===0){if(k0(s)){var v=s.name?": "+s.name:"";return n.stylize("[Function"+v+"]","special")}if(C0(s))return n.stylize(RegExp.prototype.toString.call(s),"regexp");if(sw(s))return n.stylize(Date.prototype.toString.call(s),"date");if(w0(s))return A0(s)}var y,g,T="",A=!1,C=["{","}"];return y=s,Array.isArray(y)&&(A=!0,C=["[","]"]),k0(s)&&(T=" [Function"+(s.name?": "+s.name:"")+"]"),C0(s)&&(T=" "+RegExp.prototype.toString.call(s)),sw(s)&&(T=" "+Date.prototype.toUTCString.call(s)),w0(s)&&(T=" "+A0(s)),p.length!==0||A&&s.length!=0?a<0?C0(s)?n.stylize(RegExp.prototype.toString.call(s),"regexp"):n.stylize("[Object]","special"):(n.seen.push(s),g=A?function(I,O,D,w,L){for(var M=[],P=0,V=O.length;P<V;++P)Ik(O,String(P))?M.push(R0(I,O,D,w,String(P),!0)):M.push("");return L.forEach(function(G){G.match(/^\d+$/)||M.push(R0(I,O,D,w,G,!0))}),M}(n,s,a,m,p):p.map(function(I){return R0(n,s,a,m,I,A)}),n.seen.pop(),function(I,O,D){return I.reduce(function(w,L){return L.indexOf(`
`),w+L.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?D[0]+(O===""?"":O+`
 `)+" "+I.join(`,
  `)+" "+D[1]:D[0]+O+" "+I.join(", ")+" "+D[1]}(g,T,C)):C[0]+T+C[1]}function A0(n){return"["+Error.prototype.toString.call(n)+"]"}function R0(n,s,a,l,h,p){var m,v,y;if((y=Object.getOwnPropertyDescriptor(s,h)||{value:s[h]}).get?v=y.set?n.stylize("[Getter/Setter]","special"):n.stylize("[Getter]","special"):y.set&&(v=n.stylize("[Setter]","special")),Ik(l,h)||(m="["+h+"]"),v||(n.seen.indexOf(y.value)<0?(v=xv(a)?np(n,y.value,null):np(n,y.value,a-1)).indexOf(`
`)>-1&&(v=p?v.split(`
`).map(function(g){return"  "+g}).join(`
`).substr(2):`
`+v.split(`
`).map(function(g){return"   "+g}).join(`
`)):v=n.stylize("[Circular]","special")),cs(m)){if(p&&h.match(/^\d+$/))return v;(m=JSON.stringify(""+h)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(m=m.substr(1,m.length-2),m=n.stylize(m,"name")):(m=m.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),m=n.stylize(m,"string"))}return m+": "+v}function Sk(n){return typeof n=="boolean"}function xv(n){return n===null}function ov(n){return typeof n=="string"}function cs(n){return n===void 0}function C0(n){return su(n)&&Vv(n)==="[object RegExp]"}function su(n){return typeof n=="object"&&n!==null}function sw(n){return su(n)&&Vv(n)==="[object Date]"}function w0(n){return su(n)&&(Vv(n)==="[object Error]"||n instanceof Error)}function k0(n){return typeof n=="function"}function Vv(n){return Object.prototype.toString.call(n)}function Ik(n,s){return Object.prototype.hasOwnProperty.call(n,s)}function ro(){this.head=null,this.tail=null,this.length=0}ps.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},ps.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},ro.prototype.push=function(n){var s={data:n,next:null};this.length>0?this.tail.next=s:this.head=s,this.tail=s,++this.length},ro.prototype.unshift=function(n){var s={data:n,next:this.head};this.length===0&&(this.tail=s),this.head=s,++this.length},ro.prototype.shift=function(){if(this.length!==0){var n=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,n}},ro.prototype.clear=function(){this.head=this.tail=null,this.length=0},ro.prototype.join=function(n){if(this.length===0)return"";for(var s=this.head,a=""+s.data;s=s.next;)a+=n+s.data;return a},ro.prototype.concat=function(n){if(this.length===0)return Q.alloc(0);if(this.length===1)return this.head.data;for(var s=Q.allocUnsafe(n>>>0),a=this.head,l=0;a;)a.data.copy(s,l),l+=a.data.length,a=a.next;return s};var YH=Q.isEncoding||function(n){switch(n&&n.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Bl(n){switch(this.encoding=(n||"utf8").toLowerCase().replace(/[-_]/,""),function(s){if(s&&!YH(s))throw new Error("Unknown encoding: "+s)}(n),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=XH;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=QH;break;default:return void(this.write=qH)}this.charBuffer=new Q(6),this.charReceived=0,this.charLength=0}function qH(n){return n.toString(this.encoding)}function XH(n){this.charReceived=n.length%2,this.charLength=this.charReceived?2:0}function QH(n){this.charReceived=n.length%3,this.charLength=this.charReceived?3:0}Bl.prototype.write=function(n){for(var s="";this.charLength;){var a=n.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:n.length;if(n.copy(this.charBuffer,this.charReceived,0,a),this.charReceived+=a,this.charReceived<this.charLength)return"";if(n=n.slice(a,n.length),!((h=(s=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(s.length-1))>=55296&&h<=56319)){if(this.charReceived=this.charLength=0,n.length===0)return s;break}this.charLength+=this.surrogateSize,s=""}this.detectIncompleteChar(n);var l=n.length;this.charLength&&(n.copy(this.charBuffer,0,n.length-this.charReceived,l),l-=this.charReceived);var h;if(l=(s+=n.toString(this.encoding,0,l)).length-1,(h=s.charCodeAt(l))>=55296&&h<=56319){var p=this.surrogateSize;return this.charLength+=p,this.charReceived+=p,this.charBuffer.copy(this.charBuffer,p,0,p),n.copy(this.charBuffer,0,0,p),s.substring(0,l)}return s},Bl.prototype.detectIncompleteChar=function(n){for(var s=n.length>=3?3:n.length;s>0;s--){var a=n[n.length-s];if(s==1&&a>>5==6){this.charLength=2;break}if(s<=2&&a>>4==14){this.charLength=3;break}if(s<=3&&a>>3==30){this.charLength=4;break}}this.charReceived=s},Bl.prototype.end=function(n){var s="";if(n&&n.length&&(s=this.write(n)),this.charReceived){var a=this.charReceived,l=this.charBuffer,h=this.encoding;s+=l.slice(0,a).toString(h)}return s},Ot.ReadableState=bk;var ft=function(n){return cs(b0)&&(b0=""),n=n.toUpperCase(),Lh[n]||(new RegExp("\\b"+n+"\\b","i").test(b0)?Lh[n]=function(){var s=GH.apply(null,arguments);console.error("%s %d: %s",n,0,s)}:Lh[n]=function(){}),Lh[n]}("stream");function bk(n,s){n=n||{},this.objectMode=!!n.objectMode,s instanceof Xi&&(this.objectMode=this.objectMode||!!n.readableObjectMode);var a=n.highWaterMark,l=this.objectMode?16:16384;this.highWaterMark=a||a===0?a:l,this.highWaterMark=~~this.highWaterMark,this.buffer=new ro,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=n.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,n.encoding&&(this.decoder=new Bl(n.encoding),this.encoding=n.encoding)}function Ot(n){if(!(this instanceof Ot))return new Ot(n);this._readableState=new bk(n,this),this.readable=!0,n&&typeof n.read=="function"&&(this._read=n.read),rt.call(this)}function ow(n,s,a,l,h){var p=function(g,T){var A=null;return nu(T)||typeof T=="string"||T==null||g.objectMode||(A=new TypeError("Invalid non-string/buffer chunk")),A}(s,a);if(p)n.emit("error",p);else if(a===null)s.reading=!1,function(g,T){if(!T.ended){if(T.decoder){var A=T.decoder.end();A&&A.length&&(T.buffer.push(A),T.length+=T.objectMode?1:A.length)}T.ended=!0,rp(g)}}(n,s);else if(s.objectMode||a&&a.length>0)if(s.ended&&!h){var m=new Error("stream.push() after EOF");n.emit("error",m)}else if(s.endEmitted&&h){var v=new Error("stream.unshift() after end event");n.emit("error",v)}else{var y;!s.decoder||h||l||(a=s.decoder.write(a),y=!s.objectMode&&a.length===0),h||(s.reading=!1),y||(s.flowing&&s.length===0&&!s.sync?(n.emit("data",a),n.read(0)):(s.length+=s.objectMode?1:a.length,h?s.buffer.unshift(a):s.buffer.push(a),s.needReadable&&rp(n))),function(g,T){T.readingMore||(T.readingMore=!0,$t(ZH,g,T))}(n,s)}else h||(s.reading=!1);return function(g){return!g.ended&&(g.needReadable||g.length<g.highWaterMark||g.length===0)}(s)}bi(Ot,rt),Ot.prototype.push=function(n,s){var a=this._readableState;return a.objectMode||typeof n!="string"||(s=s||a.defaultEncoding)!==a.encoding&&(n=Q.from(n,s),s=""),ow(this,a,n,s,!1)},Ot.prototype.unshift=function(n){return ow(this,this._readableState,n,"",!0)},Ot.prototype.isPaused=function(){return this._readableState.flowing===!1},Ot.prototype.setEncoding=function(n){return this._readableState.decoder=new Bl(n),this._readableState.encoding=n,this};var aw=8388608;function cw(n,s){return n<=0||s.length===0&&s.ended?0:s.objectMode?1:n!=n?s.flowing&&s.length?s.buffer.head.data.length:s.length:(n>s.highWaterMark&&(s.highWaterMark=function(a){return a>=aw?a=aw:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}(n)),n<=s.length?n:s.ended?s.length:(s.needReadable=!0,0))}function rp(n){var s=n._readableState;s.needReadable=!1,s.emittedReadable||(ft("emitReadable",s.flowing),s.emittedReadable=!0,s.sync?$t(lw,n):lw(n))}function lw(n){ft("emit readable"),n.emit("readable"),Uv(n)}function ZH(n,s){for(var a=s.length;!s.reading&&!s.flowing&&!s.ended&&s.length<s.highWaterMark&&(ft("maybeReadMore read 0"),n.read(0),a!==s.length);)a=s.length;s.readingMore=!1}function $H(n){ft("readable nexttick read 0"),n.read(0)}function ej(n,s){s.reading||(ft("resume read 0"),n.read(0)),s.resumeScheduled=!1,s.awaitDrain=0,n.emit("resume"),Uv(n),s.flowing&&!s.reading&&n.read(0)}function Uv(n){var s=n._readableState;for(ft("flow",s.flowing);s.flowing&&n.read()!==null;);}function uw(n,s){return s.length===0?null:(s.objectMode?a=s.buffer.shift():!n||n>=s.length?(a=s.decoder?s.buffer.join(""):s.buffer.length===1?s.buffer.head.data:s.buffer.concat(s.length),s.buffer.clear()):a=function(l,h,p){var m;return l<h.head.data.length?(m=h.head.data.slice(0,l),h.head.data=h.head.data.slice(l)):m=l===h.head.data.length?h.shift():p?function(v,y){var g=y.head,T=1,A=g.data;for(v-=A.length;g=g.next;){var C=g.data,I=v>C.length?C.length:v;if(I===C.length?A+=C:A+=C.slice(0,v),(v-=I)===0){I===C.length?(++T,g.next?y.head=g.next:y.head=y.tail=null):(y.head=g,g.data=C.slice(I));break}++T}return y.length-=T,A}(l,h):function(v,y){var g=Q.allocUnsafe(v),T=y.head,A=1;for(T.data.copy(g),v-=T.data.length;T=T.next;){var C=T.data,I=v>C.length?C.length:v;if(C.copy(g,g.length-v,0,I),(v-=I)===0){I===C.length?(++A,T.next?y.head=T.next:y.head=y.tail=null):(y.head=T,T.data=C.slice(I));break}++A}return y.length-=A,g}(l,h),m}(n,s.buffer,s.decoder),a);var a}function N0(n){var s=n._readableState;if(s.length>0)throw new Error('"endReadable()" called on non-empty stream');s.endEmitted||(s.ended=!0,$t(tj,s,n))}function tj(n,s){n.endEmitted||n.length!==0||(n.endEmitted=!0,s.readable=!1,s.emit("end"))}function dw(n,s){for(var a=0,l=n.length;a<l;a++)if(n[a]===s)return a;return-1}function ij(){}function nj(n,s,a){this.chunk=n,this.encoding=s,this.callback=a,this.next=null}function av(n,s){Object.defineProperty(this,"buffer",{get:Tk(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),n=n||{},this.objectMode=!!n.objectMode,s instanceof Xi&&(this.objectMode=this.objectMode||!!n.writableObjectMode);var a=n.highWaterMark,l=this.objectMode?16:16384;this.highWaterMark=a||a===0?a:l,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var h=n.decodeStrings===!1;this.decodeStrings=!h,this.defaultEncoding=n.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(p){(function(m,v){var y=m._writableState,g=y.sync,T=y.writecb;if(function(C){C.writing=!1,C.writecb=null,C.length-=C.writelen,C.writelen=0}(y),v)(function(C,I,O,D,w){--I.pendingcb,O?$t(w,D):w(D),C._writableState.errorEmitted=!0,C.emit("error",D)})(m,y,g,v,T);else{var A=Rk(y);A||y.corked||y.bufferProcessing||!y.bufferedRequest||Ak(m,y),g?$t(hw,m,y,A,T):hw(m,y,A,T)}})(s,p)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new wk(this)}function li(n){if(!(this instanceof li||this instanceof Xi))return new li(n);this._writableState=new av(n,this),this.writable=!0,n&&(typeof n.write=="function"&&(this._write=n.write),typeof n.writev=="function"&&(this._writev=n.writev)),rt.call(this)}function cv(n,s,a,l,h,p,m){s.writelen=l,s.writecb=m,s.writing=!0,s.sync=!0,a?n._writev(h,s.onwrite):n._write(h,p,s.onwrite),s.sync=!1}function hw(n,s,a,l){a||function(h,p){p.length===0&&p.needDrain&&(p.needDrain=!1,h.emit("drain"))}(n,s),s.pendingcb--,l(),Ck(n,s)}function Ak(n,s){s.bufferProcessing=!0;var a=s.bufferedRequest;if(n._writev&&a&&a.next){var l=s.bufferedRequestCount,h=new Array(l),p=s.corkedRequestsFree;p.entry=a;for(var m=0;a;)h[m]=a,a=a.next,m+=1;cv(n,s,!0,s.length,h,"",p.finish),s.pendingcb++,s.lastBufferedRequest=null,p.next?(s.corkedRequestsFree=p.next,p.next=null):s.corkedRequestsFree=new wk(s)}else{for(;a;){var v=a.chunk,y=a.encoding,g=a.callback;if(cv(n,s,!1,s.objectMode?1:v.length,v,y,g),a=a.next,s.writing)break}a===null&&(s.lastBufferedRequest=null)}s.bufferedRequestCount=0,s.bufferedRequest=a,s.bufferProcessing=!1}function Rk(n){return n.ending&&n.length===0&&n.bufferedRequest===null&&!n.finished&&!n.writing}function pw(n,s){s.prefinished||(s.prefinished=!0,n.emit("prefinish"))}function Ck(n,s){var a=Rk(s);return a&&(s.pendingcb===0?(pw(n,s),s.finished=!0,n.emit("finish")):pw(n,s)),a}function wk(n){var s=this;this.next=null,this.entry=null,this.finish=function(a){var l=s.entry;for(s.entry=null;l;){var h=l.callback;n.pendingcb--,h(a),l=l.next}n.corkedRequestsFree?n.corkedRequestsFree.next=s:n.corkedRequestsFree=s}}Ot.prototype.read=function(n){ft("read",n),n=parseInt(n,10);var s=this._readableState,a=n;if(n!==0&&(s.emittedReadable=!1),n===0&&s.needReadable&&(s.length>=s.highWaterMark||s.ended))return ft("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?N0(this):rp(this),null;if((n=cw(n,s))===0&&s.ended)return s.length===0&&N0(this),null;var l,h=s.needReadable;return ft("need readable",h),(s.length===0||s.length-n<s.highWaterMark)&&ft("length less than watermark",h=!0),s.ended||s.reading?ft("reading or ended",h=!1):h&&(ft("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,s.reading||(n=cw(a,s))),(l=n>0?uw(n,s):null)===null?(s.needReadable=!0,n=0):s.length-=n,s.length===0&&(s.ended||(s.needReadable=!0),a!==n&&s.ended&&N0(this)),l!==null&&this.emit("data",l),l},Ot.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Ot.prototype.pipe=function(n,s){var a=this,l=this._readableState;switch(l.pipesCount){case 0:l.pipes=n;break;case 1:l.pipes=[l.pipes,n];break;default:l.pipes.push(n)}l.pipesCount+=1,ft("pipe count=%d opts=%j",l.pipesCount,s);var h=!s||s.end!==!1?m:g;function p(w){ft("onunpipe"),w===a&&g()}function m(){ft("onend"),n.end()}l.endEmitted?$t(h):a.once("end",h),n.on("unpipe",p);var v=function(w){return function(){var L=w._readableState;ft("pipeOnDrain",L.awaitDrain),L.awaitDrain&&L.awaitDrain--,L.awaitDrain===0&&w.listeners("data").length&&(L.flowing=!0,Uv(w))}}(a);n.on("drain",v);var y=!1;function g(){ft("cleanup"),n.removeListener("close",I),n.removeListener("finish",O),n.removeListener("drain",v),n.removeListener("error",C),n.removeListener("unpipe",p),a.removeListener("end",m),a.removeListener("end",g),a.removeListener("data",A),y=!0,!l.awaitDrain||n._writableState&&!n._writableState.needDrain||v()}var T=!1;function A(w){ft("ondata"),T=!1,n.write(w)!==!1||T||((l.pipesCount===1&&l.pipes===n||l.pipesCount>1&&dw(l.pipes,n)!==-1)&&!y&&(ft("false write response, pause",a._readableState.awaitDrain),a._readableState.awaitDrain++,T=!0),a.pause())}function C(w){var L;ft("onerror",w),D(),n.removeListener("error",C),L="error",n.listeners(L).length===0&&n.emit("error",w)}function I(){n.removeListener("finish",O),D()}function O(){ft("onfinish"),n.removeListener("close",I),D()}function D(){ft("unpipe"),a.unpipe(n)}return a.on("data",A),function(w,L,M){if(typeof w.prependListener=="function")return w.prependListener(L,M);w._events&&w._events[L]?Array.isArray(w._events[L])?w._events[L].unshift(M):w._events[L]=[M,w._events[L]]:w.on(L,M)}(n,"error",C),n.once("close",I),n.once("finish",O),n.emit("pipe",a),l.flowing||(ft("pipe resume"),a.resume()),n},Ot.prototype.unpipe=function(n){var s=this._readableState;if(s.pipesCount===0)return this;if(s.pipesCount===1)return n&&n!==s.pipes?this:(n||(n=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,n&&n.emit("unpipe",this),this);if(!n){var a=s.pipes,l=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var h=0;h<l;h++)a[h].emit("unpipe",this);return this}var p=dw(s.pipes,n);return p===-1?this:(s.pipes.splice(p,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),n.emit("unpipe",this),this)},Ot.prototype.on=function(n,s){var a=rt.prototype.on.call(this,n,s);if(n==="data")this._readableState.flowing!==!1&&this.resume();else if(n==="readable"){var l=this._readableState;l.endEmitted||l.readableListening||(l.readableListening=l.needReadable=!0,l.emittedReadable=!1,l.reading?l.length&&rp(this):$t($H,this))}return a},Ot.prototype.addListener=Ot.prototype.on,Ot.prototype.resume=function(){var n=this._readableState;return n.flowing||(ft("resume"),n.flowing=!0,function(s,a){a.resumeScheduled||(a.resumeScheduled=!0,$t(ej,s,a))}(this,n)),this},Ot.prototype.pause=function(){return ft("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(ft("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Ot.prototype.wrap=function(n){var s=this._readableState,a=!1,l=this;for(var h in n.on("end",function(){if(ft("wrapped end"),s.decoder&&!s.ended){var p=s.decoder.end();p&&p.length&&l.push(p)}l.push(null)}),n.on("data",function(p){ft("wrapped data"),s.decoder&&(p=s.decoder.write(p)),s.objectMode&&p==null||(s.objectMode||p&&p.length)&&(l.push(p)||(a=!0,n.pause()))}),n)this[h]===void 0&&typeof n[h]=="function"&&(this[h]=function(p){return function(){return n[p].apply(n,arguments)}}(h));return function(p,m){for(var v=0,y=p.length;v<y;v++)m(p[v],v)}(["error","close","destroy","pause","resume"],function(p){n.on(p,l.emit.bind(l,p))}),l._read=function(p){ft("wrapped _read",p),a&&(a=!1,n.resume())},l},Ot._fromList=uw,li.WritableState=av,bi(li,rt),av.prototype.getBuffer=function(){for(var n=this.bufferedRequest,s=[];n;)s.push(n),n=n.next;return s},li.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},li.prototype.write=function(n,s,a){var l=this._writableState,h=!1;return typeof s=="function"&&(a=s,s=null),Q.isBuffer(n)?s="buffer":s||(s=l.defaultEncoding),typeof a!="function"&&(a=ij),l.ended?function(p,m){var v=new Error("write after end");p.emit("error",v),$t(m,v)}(this,a):function(p,m,v,y){var g=!0,T=!1;return v===null?T=new TypeError("May not write null values to stream"):Q.isBuffer(v)||typeof v=="string"||v===void 0||m.objectMode||(T=new TypeError("Invalid non-string/buffer chunk")),T&&(p.emit("error",T),$t(y,T),g=!1),g}(this,l,n,a)&&(l.pendingcb++,h=function(p,m,v,y,g){v=function(I,O,D){return I.objectMode||I.decodeStrings===!1||typeof O!="string"||(O=Q.from(O,D)),O}(m,v,y),Q.isBuffer(v)&&(y="buffer");var T=m.objectMode?1:v.length;m.length+=T;var A=m.length<m.highWaterMark;if(A||(m.needDrain=!0),m.writing||m.corked){var C=m.lastBufferedRequest;m.lastBufferedRequest=new nj(v,y,g),C?C.next=m.lastBufferedRequest:m.bufferedRequest=m.lastBufferedRequest,m.bufferedRequestCount+=1}else cv(p,m,!1,T,v,y,g);return A}(this,l,n,s,a)),h},li.prototype.cork=function(){this._writableState.corked++},li.prototype.uncork=function(){var n=this._writableState;n.corked&&(n.corked--,n.writing||n.corked||n.finished||n.bufferProcessing||!n.bufferedRequest||Ak(this,n))},li.prototype.setDefaultEncoding=function(n){if(typeof n=="string"&&(n=n.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((n+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+n);return this._writableState.defaultEncoding=n,this},li.prototype._write=function(n,s,a){a(new Error("not implemented"))},li.prototype._writev=null,li.prototype.end=function(n,s,a){var l=this._writableState;typeof n=="function"?(a=n,n=null,s=null):typeof s=="function"&&(a=s,s=null),n!=null&&this.write(n,s),l.corked&&(l.corked=1,this.uncork()),l.ending||l.finished||function(h,p,m){p.ending=!0,Ck(h,p),m&&(p.finished?$t(m):h.once("finish",m)),p.ended=!0,h.writable=!1}(this,l,a)},bi(Xi,Ot);for(var fw=Object.keys(li.prototype),D0=0;D0<fw.length;D0++){var O0=fw[D0];Xi.prototype[O0]||(Xi.prototype[O0]=li.prototype[O0])}function Xi(n){if(!(this instanceof Xi))return new Xi(n);Ot.call(this,n),li.call(this,n),n&&n.readable===!1&&(this.readable=!1),n&&n.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,n&&n.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",rj)}function rj(){this.allowHalfOpen||this._writableState.ended||$t(sj,this)}function sj(n){n.end()}function oj(n){this.afterTransform=function(s,a){return function(l,h,p){var m=l._transformState;m.transforming=!1;var v=m.writecb;if(!v)return l.emit("error",new Error("no writecb in Transform class"));m.writechunk=null,m.writecb=null,p!=null&&l.push(p),v(h);var y=l._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&l._read(y.highWaterMark)}(n,s,a)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Ji(n){if(!(this instanceof Ji))return new Ji(n);Xi.call(this,n),this._transformState=new oj(this);var s=this;this._readableState.needReadable=!0,this._readableState.sync=!1,n&&(typeof n.transform=="function"&&(this._transform=n.transform),typeof n.flush=="function"&&(this._flush=n.flush)),this.once("prefinish",function(){typeof this._flush=="function"?this._flush(function(a){mw(s,a)}):mw(s)})}function mw(n,s){if(s)return n.emit("error",s);var a=n._writableState,l=n._transformState;if(a.length)throw new Error("Calling transform done when ws.length != 0");if(l.transforming)throw new Error("Calling transform done when still transforming");return n.push(null)}function Hl(n){if(!(this instanceof Hl))return new Hl(n);Ji.call(this,n)}function hr(){rt.call(this)}bi(Ji,Xi),Ji.prototype.push=function(n,s){return this._transformState.needTransform=!1,Xi.prototype.push.call(this,n,s)},Ji.prototype._transform=function(n,s,a){throw new Error("Not implemented")},Ji.prototype._write=function(n,s,a){var l=this._transformState;if(l.writecb=a,l.writechunk=n,l.writeencoding=s,!l.transforming){var h=this._readableState;(l.needTransform||h.needReadable||h.length<h.highWaterMark)&&this._read(h.highWaterMark)}},Ji.prototype._read=function(n){var s=this._transformState;s.writechunk!==null&&s.writecb&&!s.transforming?(s.transforming=!0,this._transform(s.writechunk,s.writeencoding,s.afterTransform)):s.needTransform=!0},bi(Hl,Ji),Hl.prototype._transform=function(n,s,a){a(null,n)},bi(hr,rt),hr.Readable=Ot,hr.Writable=li,hr.Duplex=Xi,hr.Transform=Ji,hr.PassThrough=Hl,hr.Stream=hr,hr.prototype.pipe=function(n,s){var a=this;function l(T){n.writable&&n.write(T)===!1&&a.pause&&a.pause()}function h(){a.readable&&a.resume&&a.resume()}a.on("data",l),n.on("drain",h),n._isStdio||s&&s.end===!1||(a.on("end",m),a.on("close",v));var p=!1;function m(){p||(p=!0,n.end())}function v(){p||(p=!0,typeof n.destroy=="function"&&n.destroy())}function y(T){if(g(),rt.listenerCount(this,"error")===0)throw T}function g(){a.removeListener("data",l),n.removeListener("drain",h),a.removeListener("end",m),a.removeListener("close",v),a.removeListener("error",y),n.removeListener("error",y),a.removeListener("end",g),a.removeListener("close",g),n.removeListener("close",g)}return a.on("error",y),n.on("error",y),a.on("end",g),a.on("close",g),n.on("close",g),n.emit("pipe",a),n};var kk={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function aj(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function _r(n,s,a,l,h){if(s.subarray&&n.subarray)n.set(s.subarray(a,a+l),h);else for(var p=0;p<l;p++)n[h+p]=s[a+p]}var sp=Uint8Array,Yi=Uint16Array,op=Int32Array,cj=4,_w=0,gw=1,lj=2;function za(n){for(var s=n.length;--s>=0;)n[s]=0}var uj=0,Nk=1,dj=2,Fv=29,ou=256,Xl=ou+1+Fv,Ua=30,Bv=19,vw=2*Xl+1,lo=15,P0=16,hj=7,Hv=256,Dk=16,Ok=17,Pk=18,lv=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Jh=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],pj=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],yw=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],mr=new Array(2*(Xl+2));za(mr);var jl=new Array(2*Ua);za(jl);var Ql=new Array(512);za(Ql);var Zl=new Array(256);za(Zl);var jv=new Array(Fv);za(jv);var Ew,Tw,Sw,ap=new Array(Ua);function M0(n,s,a,l,h){this.static_tree=n,this.extra_bits=s,this.extra_base=a,this.elems=l,this.max_length=h,this.has_stree=n&&n.length}function L0(n,s){this.dyn_tree=n,this.max_code=0,this.stat_desc=s}function Mk(n){return n<256?Ql[n]:Ql[256+(n>>>7)]}function $l(n,s){n.pending_buf[n.pending++]=255&s,n.pending_buf[n.pending++]=s>>>8&255}function Ai(n,s,a){n.bi_valid>P0-a?(n.bi_buf|=s<<n.bi_valid&65535,$l(n,n.bi_buf),n.bi_buf=s>>P0-n.bi_valid,n.bi_valid+=a-P0):(n.bi_buf|=s<<n.bi_valid&65535,n.bi_valid+=a)}function Bn(n,s,a){Ai(n,a[2*s],a[2*s+1])}function Lk(n,s){var a=0;do a|=1&n,n>>>=1,a<<=1;while(--s>0);return a>>>1}function xk(n,s,a){var l,h,p=new Array(lo+1),m=0;for(l=1;l<=lo;l++)p[l]=m=m+a[l-1]<<1;for(h=0;h<=s;h++){var v=n[2*h+1];v!==0&&(n[2*h]=Lk(p[v]++,v))}}function Vk(n){var s;for(s=0;s<Xl;s++)n.dyn_ltree[2*s]=0;for(s=0;s<Ua;s++)n.dyn_dtree[2*s]=0;for(s=0;s<Bv;s++)n.bl_tree[2*s]=0;n.dyn_ltree[2*Hv]=1,n.opt_len=n.static_len=0,n.last_lit=n.matches=0}function Uk(n){n.bi_valid>8?$l(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0}function Iw(n,s,a,l){var h=2*s,p=2*a;return n[h]<n[p]||n[h]===n[p]&&l[s]<=l[a]}function x0(n,s,a){for(var l=n.heap[a],h=a<<1;h<=n.heap_len&&(h<n.heap_len&&Iw(s,n.heap[h+1],n.heap[h],n.depth)&&h++,!Iw(s,l,n.heap[h],n.depth));)n.heap[a]=n.heap[h],a=h,h<<=1;n.heap[a]=l}function bw(n,s,a){var l,h,p,m,v=0;if(n.last_lit!==0)do l=n.pending_buf[n.d_buf+2*v]<<8|n.pending_buf[n.d_buf+2*v+1],h=n.pending_buf[n.l_buf+v],v++,l===0?Bn(n,h,s):(Bn(n,(p=Zl[h])+ou+1,s),(m=lv[p])!==0&&Ai(n,h-=jv[p],m),Bn(n,p=Mk(--l),a),(m=Jh[p])!==0&&Ai(n,l-=ap[p],m));while(v<n.last_lit);Bn(n,Hv,s)}function V0(n,s){var a,l,h,p=s.dyn_tree,m=s.stat_desc.static_tree,v=s.stat_desc.has_stree,y=s.stat_desc.elems,g=-1;for(n.heap_len=0,n.heap_max=vw,a=0;a<y;a++)p[2*a]!==0?(n.heap[++n.heap_len]=g=a,n.depth[a]=0):p[2*a+1]=0;for(;n.heap_len<2;)p[2*(h=n.heap[++n.heap_len]=g<2?++g:0)]=1,n.depth[h]=0,n.opt_len--,v&&(n.static_len-=m[2*h+1]);for(s.max_code=g,a=n.heap_len>>1;a>=1;a--)x0(n,p,a);h=y;do a=n.heap[1],n.heap[1]=n.heap[n.heap_len--],x0(n,p,1),l=n.heap[1],n.heap[--n.heap_max]=a,n.heap[--n.heap_max]=l,p[2*h]=p[2*a]+p[2*l],n.depth[h]=(n.depth[a]>=n.depth[l]?n.depth[a]:n.depth[l])+1,p[2*a+1]=p[2*l+1]=h,n.heap[1]=h++,x0(n,p,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],function(T,A){var C,I,O,D,w,L,M=A.dyn_tree,P=A.max_code,V=A.stat_desc.static_tree,G=A.stat_desc.has_stree,H=A.stat_desc.extra_bits,W=A.stat_desc.extra_base,z=A.stat_desc.max_length,Z=0;for(D=0;D<=lo;D++)T.bl_count[D]=0;for(M[2*T.heap[T.heap_max]+1]=0,C=T.heap_max+1;C<vw;C++)(D=M[2*M[2*(I=T.heap[C])+1]+1]+1)>z&&(D=z,Z++),M[2*I+1]=D,I>P||(T.bl_count[D]++,w=0,I>=W&&(w=H[I-W]),L=M[2*I],T.opt_len+=L*(D+w),G&&(T.static_len+=L*(V[2*I+1]+w)));if(Z!==0){do{for(D=z-1;T.bl_count[D]===0;)D--;T.bl_count[D]--,T.bl_count[D+1]+=2,T.bl_count[z]--,Z-=2}while(Z>0);for(D=z;D!==0;D--)for(I=T.bl_count[D];I!==0;)(O=T.heap[--C])>P||(M[2*O+1]!==D&&(T.opt_len+=(D-M[2*O+1])*M[2*O],M[2*O+1]=D),I--)}}(n,s),xk(p,g,n.bl_count)}function Aw(n,s,a){var l,h,p=-1,m=s[1],v=0,y=7,g=4;for(m===0&&(y=138,g=3),s[2*(a+1)+1]=65535,l=0;l<=a;l++)h=m,m=s[2*(l+1)+1],++v<y&&h===m||(v<g?n.bl_tree[2*h]+=v:h!==0?(h!==p&&n.bl_tree[2*h]++,n.bl_tree[2*Dk]++):v<=10?n.bl_tree[2*Ok]++:n.bl_tree[2*Pk]++,v=0,p=h,m===0?(y=138,g=3):h===m?(y=6,g=3):(y=7,g=4))}function Rw(n,s,a){var l,h,p=-1,m=s[1],v=0,y=7,g=4;for(m===0&&(y=138,g=3),l=0;l<=a;l++)if(h=m,m=s[2*(l+1)+1],!(++v<y&&h===m)){if(v<g)do Bn(n,h,n.bl_tree);while(--v!=0);else h!==0?(h!==p&&(Bn(n,h,n.bl_tree),v--),Bn(n,Dk,n.bl_tree),Ai(n,v-3,2)):v<=10?(Bn(n,Ok,n.bl_tree),Ai(n,v-3,3)):(Bn(n,Pk,n.bl_tree),Ai(n,v-11,7));v=0,p=h,m===0?(y=138,g=3):h===m?(y=6,g=3):(y=7,g=4)}}za(ap);var Cw=!1;function fj(n){Cw||(function(){var s,a,l,h,p,m=new Array(lo+1);for(l=0,h=0;h<Fv-1;h++)for(jv[h]=l,s=0;s<1<<lv[h];s++)Zl[l++]=h;for(Zl[l-1]=h,p=0,h=0;h<16;h++)for(ap[h]=p,s=0;s<1<<Jh[h];s++)Ql[p++]=h;for(p>>=7;h<Ua;h++)for(ap[h]=p<<7,s=0;s<1<<Jh[h]-7;s++)Ql[256+p++]=h;for(a=0;a<=lo;a++)m[a]=0;for(s=0;s<=143;)mr[2*s+1]=8,s++,m[8]++;for(;s<=255;)mr[2*s+1]=9,s++,m[9]++;for(;s<=279;)mr[2*s+1]=7,s++,m[7]++;for(;s<=287;)mr[2*s+1]=8,s++,m[8]++;for(xk(mr,Xl+1,m),s=0;s<Ua;s++)jl[2*s+1]=5,jl[2*s]=Lk(s,5);Ew=new M0(mr,lv,ou+1,Xl,lo),Tw=new M0(jl,Jh,0,Ua,lo),Sw=new M0(new Array(0),pj,0,Bv,hj)}(),Cw=!0),n.l_desc=new L0(n.dyn_ltree,Ew),n.d_desc=new L0(n.dyn_dtree,Tw),n.bl_desc=new L0(n.bl_tree,Sw),n.bi_buf=0,n.bi_valid=0,Vk(n)}function Fk(n,s,a,l){Ai(n,(uj<<1)+(l?1:0),3),function(h,p,m,v){Uk(h),$l(h,m),$l(h,~m),_r(h.pending_buf,h.window,p,m,h.pending),h.pending+=m}(n,s,a)}function mj(n){Ai(n,Nk<<1,3),Bn(n,Hv,mr),function(s){s.bi_valid===16?($l(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)}(n)}function _j(n,s,a,l){var h,p,m=0;n.level>0?(n.strm.data_type===lj&&(n.strm.data_type=function(v){var y,g=4093624447;for(y=0;y<=31;y++,g>>>=1)if(1&g&&v.dyn_ltree[2*y]!==0)return _w;if(v.dyn_ltree[18]!==0||v.dyn_ltree[20]!==0||v.dyn_ltree[26]!==0)return gw;for(y=32;y<ou;y++)if(v.dyn_ltree[2*y]!==0)return gw;return _w}(n)),V0(n,n.l_desc),V0(n,n.d_desc),m=function(v){var y;for(Aw(v,v.dyn_ltree,v.l_desc.max_code),Aw(v,v.dyn_dtree,v.d_desc.max_code),V0(v,v.bl_desc),y=Bv-1;y>=3&&v.bl_tree[2*yw[y]+1]===0;y--);return v.opt_len+=3*(y+1)+5+5+4,y}(n),h=n.opt_len+3+7>>>3,(p=n.static_len+3+7>>>3)<=h&&(h=p)):h=p=a+5,a+4<=h&&s!==-1?Fk(n,s,a,l):n.strategy===cj||p===h?(Ai(n,(Nk<<1)+(l?1:0),3),bw(n,mr,jl)):(Ai(n,(dj<<1)+(l?1:0),3),function(v,y,g,T){var A;for(Ai(v,y-257,5),Ai(v,g-1,5),Ai(v,T-4,4),A=0;A<T;A++)Ai(v,v.bl_tree[2*yw[A]+1],3);Rw(v,v.dyn_ltree,y-1),Rw(v,v.dyn_dtree,g-1)}(n,n.l_desc.max_code+1,n.d_desc.max_code+1,m+1),bw(n,n.dyn_ltree,n.dyn_dtree)),Vk(n),l&&Uk(n)}function fs(n,s,a){return n.pending_buf[n.d_buf+2*n.last_lit]=s>>>8&255,n.pending_buf[n.d_buf+2*n.last_lit+1]=255&s,n.pending_buf[n.l_buf+n.last_lit]=255&a,n.last_lit++,s===0?n.dyn_ltree[2*a]++:(n.matches++,s--,n.dyn_ltree[2*(Zl[a]+ou+1)]++,n.dyn_dtree[2*Mk(s)]++),n.last_lit===n.lit_bufsize-1}function uv(n,s,a,l){for(var h=65535&n|0,p=n>>>16&65535|0,m=0;a!==0;){a-=m=a>2e3?2e3:a;do p=p+(h=h+s[l++]|0)|0;while(--m);h%=65521,p%=65521}return h|p<<16|0}var gj=function(){for(var n,s=[],a=0;a<256;a++){n=a;for(var l=0;l<8;l++)n=1&n?3988292384^n>>>1:n>>>1;s[a]=n}return s}();function Yt(n,s,a,l){var h=gj,p=l+a;n^=-1;for(var m=l;m<p;m++)n=n>>>8^h[255&(n^s[m])];return-1^n}var Pa,Io=0,vj=1,yj=3,as=4,ww=5,oo=0,kw=1,bo=-2,Ej=-3,U0=-5,Tj=-1,Sj=1,xh=2,Ij=3,bj=4,Aj=2,Wv=8,Rj=9,dv=286,Cj=30,wj=19,kj=2*dv+1,Nj=15,ut=3,ls=258,pn=ls+ut+1,Dj=32,zv=42,hv=69,Yh=73,qh=91,Xh=103,uo=113,Pl=666,qt=1,Wl=2,ho=3,Fa=4,Oj=3;function us(n,s){return n.msg=kk[s],s}function Nw(n){return(n<<1)-(n>4?9:0)}function ao(n){for(var s=n.length;--s>=0;)n[s]=0}function ns(n){var s=n.state,a=s.pending;a>n.avail_out&&(a=n.avail_out),a!==0&&(_r(n.output,s.pending_buf,s.pending_out,a,n.next_out),n.next_out+=a,s.pending_out+=a,n.total_out+=a,n.avail_out-=a,s.pending-=a,s.pending===0&&(s.pending_out=0))}function ei(n,s){_j(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,s),n.block_start=n.strstart,ns(n.strm)}function ct(n,s){n.pending_buf[n.pending++]=s}function Dl(n,s){n.pending_buf[n.pending++]=s>>>8&255,n.pending_buf[n.pending++]=255&s}function Bk(n,s){var a,l,h=n.max_chain_length,p=n.strstart,m=n.prev_length,v=n.nice_match,y=n.strstart>n.w_size-pn?n.strstart-(n.w_size-pn):0,g=n.window,T=n.w_mask,A=n.prev,C=n.strstart+ls,I=g[p+m-1],O=g[p+m];n.prev_length>=n.good_match&&(h>>=2),v>n.lookahead&&(v=n.lookahead);do if(g[(a=s)+m]===O&&g[a+m-1]===I&&g[a]===g[p]&&g[++a]===g[p+1]){p+=2,a++;do;while(g[++p]===g[++a]&&g[++p]===g[++a]&&g[++p]===g[++a]&&g[++p]===g[++a]&&g[++p]===g[++a]&&g[++p]===g[++a]&&g[++p]===g[++a]&&g[++p]===g[++a]&&p<C);if(l=ls-(C-p),p=C-ls,l>m){if(n.match_start=s,m=l,l>=v)break;I=g[p+m-1],O=g[p+m]}}while((s=A[s&T])>y&&--h!=0);return m<=n.lookahead?m:n.lookahead}function eu(n){var s,a,l,h,p,m,v,y,g,T,A=n.w_size;do{if(h=n.window_size-n.lookahead-n.strstart,n.strstart>=A+(A-pn)){_r(n.window,n.window,A,A,0),n.match_start-=A,n.strstart-=A,n.block_start-=A,s=a=n.hash_size;do l=n.head[--s],n.head[s]=l>=A?l-A:0;while(--a);s=a=A;do l=n.prev[--s],n.prev[s]=l>=A?l-A:0;while(--a);h+=A}if(n.strm.avail_in===0)break;if(m=n.strm,v=n.window,y=n.strstart+n.lookahead,g=h,T=void 0,(T=m.avail_in)>g&&(T=g),a=T===0?0:(m.avail_in-=T,_r(v,m.input,m.next_in,T,y),m.state.wrap===1?m.adler=uv(m.adler,v,T,y):m.state.wrap===2&&(m.adler=Yt(m.adler,v,T,y)),m.next_in+=T,m.total_in+=T,T),n.lookahead+=a,n.lookahead+n.insert>=ut)for(p=n.strstart-n.insert,n.ins_h=n.window[p],n.ins_h=(n.ins_h<<n.hash_shift^n.window[p+1])&n.hash_mask;n.insert&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[p+ut-1])&n.hash_mask,n.prev[p&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=p,p++,n.insert--,!(n.lookahead+n.insert<ut)););}while(n.lookahead<pn&&n.strm.avail_in!==0)}function F0(n,s){for(var a,l;;){if(n.lookahead<pn){if(eu(n),n.lookahead<pn&&s===Io)return qt;if(n.lookahead===0)break}if(a=0,n.lookahead>=ut&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+ut-1])&n.hash_mask,a=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),a!==0&&n.strstart-a<=n.w_size-pn&&(n.match_length=Bk(n,a)),n.match_length>=ut)if(l=fs(n,n.strstart-n.match_start,n.match_length-ut),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=ut){n.match_length--;do n.strstart++,n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+ut-1])&n.hash_mask,a=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+1])&n.hash_mask;else l=fs(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(l&&(ei(n,!1),n.strm.avail_out===0))return qt}return n.insert=n.strstart<ut-1?n.strstart:ut-1,s===as?(ei(n,!0),n.strm.avail_out===0?ho:Fa):n.last_lit&&(ei(n,!1),n.strm.avail_out===0)?qt:Wl}function Na(n,s){for(var a,l,h;;){if(n.lookahead<pn){if(eu(n),n.lookahead<pn&&s===Io)return qt;if(n.lookahead===0)break}if(a=0,n.lookahead>=ut&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+ut-1])&n.hash_mask,a=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=ut-1,a!==0&&n.prev_length<n.max_lazy_match&&n.strstart-a<=n.w_size-pn&&(n.match_length=Bk(n,a),n.match_length<=5&&(n.strategy===Sj||n.match_length===ut&&n.strstart-n.match_start>4096)&&(n.match_length=ut-1)),n.prev_length>=ut&&n.match_length<=n.prev_length){h=n.strstart+n.lookahead-ut,l=fs(n,n.strstart-1-n.prev_match,n.prev_length-ut),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=h&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+ut-1])&n.hash_mask,a=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=ut-1,n.strstart++,l&&(ei(n,!1),n.strm.avail_out===0))return qt}else if(n.match_available){if((l=fs(n,0,n.window[n.strstart-1]))&&ei(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return qt}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(l=fs(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<ut-1?n.strstart:ut-1,s===as?(ei(n,!0),n.strm.avail_out===0?ho:Fa):n.last_lit&&(ei(n,!1),n.strm.avail_out===0)?qt:Wl}function Pn(n,s,a,l,h){this.good_length=n,this.max_lazy=s,this.nice_length=a,this.max_chain=l,this.func=h}function Pj(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Wv,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Yi(2*kj),this.dyn_dtree=new Yi(2*(2*Cj+1)),this.bl_tree=new Yi(2*(2*wj+1)),ao(this.dyn_ltree),ao(this.dyn_dtree),ao(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Yi(Nj+1),this.heap=new Yi(2*dv+1),ao(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Yi(2*dv+1),ao(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dw(n){var s,a=function(l){var h;return l&&l.state?(l.total_in=l.total_out=0,l.data_type=Aj,(h=l.state).pending=0,h.pending_out=0,h.wrap<0&&(h.wrap=-h.wrap),h.status=h.wrap?zv:uo,l.adler=h.wrap===2?0:1,h.last_flush=Io,fj(h),oo):us(l,bo)}(n);return a===oo&&((s=n.state).window_size=2*s.w_size,ao(s.head),s.max_lazy_match=Pa[s.level].max_lazy,s.good_match=Pa[s.level].good_length,s.nice_match=Pa[s.level].nice_length,s.max_chain_length=Pa[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=ut-1,s.match_available=0,s.ins_h=0),a}function Mj(n,s){var a,l,h,p;if(!n||!n.state||s>ww||s<0)return n?us(n,bo):bo;if(l=n.state,!n.output||!n.input&&n.avail_in!==0||l.status===Pl&&s!==as)return us(n,n.avail_out===0?U0:bo);if(l.strm=n,a=l.last_flush,l.last_flush=s,l.status===zv)if(l.wrap===2)n.adler=0,ct(l,31),ct(l,139),ct(l,8),l.gzhead?(ct(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),ct(l,255&l.gzhead.time),ct(l,l.gzhead.time>>8&255),ct(l,l.gzhead.time>>16&255),ct(l,l.gzhead.time>>24&255),ct(l,l.level===9?2:l.strategy>=xh||l.level<2?4:0),ct(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(ct(l,255&l.gzhead.extra.length),ct(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(n.adler=Yt(n.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=hv):(ct(l,0),ct(l,0),ct(l,0),ct(l,0),ct(l,0),ct(l,l.level===9?2:l.strategy>=xh||l.level<2?4:0),ct(l,Oj),l.status=uo);else{var m=Wv+(l.w_bits-8<<4)<<8;m|=(l.strategy>=xh||l.level<2?0:l.level<6?1:l.level===6?2:3)<<6,l.strstart!==0&&(m|=Dj),m+=31-m%31,l.status=uo,Dl(l,m),l.strstart!==0&&(Dl(l,n.adler>>>16),Dl(l,65535&n.adler)),n.adler=1}if(l.status===hv)if(l.gzhead.extra){for(h=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>h&&(n.adler=Yt(n.adler,l.pending_buf,l.pending-h,h)),ns(n),h=l.pending,l.pending!==l.pending_buf_size));)ct(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>h&&(n.adler=Yt(n.adler,l.pending_buf,l.pending-h,h)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=Yh)}else l.status=Yh;if(l.status===Yh)if(l.gzhead.name){h=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>h&&(n.adler=Yt(n.adler,l.pending_buf,l.pending-h,h)),ns(n),h=l.pending,l.pending===l.pending_buf_size)){p=1;break}p=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,ct(l,p)}while(p!==0);l.gzhead.hcrc&&l.pending>h&&(n.adler=Yt(n.adler,l.pending_buf,l.pending-h,h)),p===0&&(l.gzindex=0,l.status=qh)}else l.status=qh;if(l.status===qh)if(l.gzhead.comment){h=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>h&&(n.adler=Yt(n.adler,l.pending_buf,l.pending-h,h)),ns(n),h=l.pending,l.pending===l.pending_buf_size)){p=1;break}p=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,ct(l,p)}while(p!==0);l.gzhead.hcrc&&l.pending>h&&(n.adler=Yt(n.adler,l.pending_buf,l.pending-h,h)),p===0&&(l.status=Xh)}else l.status=Xh;if(l.status===Xh&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&ns(n),l.pending+2<=l.pending_buf_size&&(ct(l,255&n.adler),ct(l,n.adler>>8&255),n.adler=0,l.status=uo)):l.status=uo),l.pending!==0){if(ns(n),n.avail_out===0)return l.last_flush=-1,oo}else if(n.avail_in===0&&Nw(s)<=Nw(a)&&s!==as)return us(n,U0);if(l.status===Pl&&n.avail_in!==0)return us(n,U0);if(n.avail_in!==0||l.lookahead!==0||s!==Io&&l.status!==Pl){var v=l.strategy===xh?function(y,g){for(var T;;){if(y.lookahead===0&&(eu(y),y.lookahead===0)){if(g===Io)return qt;break}if(y.match_length=0,T=fs(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++,T&&(ei(y,!1),y.strm.avail_out===0))return qt}return y.insert=0,g===as?(ei(y,!0),y.strm.avail_out===0?ho:Fa):y.last_lit&&(ei(y,!1),y.strm.avail_out===0)?qt:Wl}(l,s):l.strategy===Ij?function(y,g){for(var T,A,C,I,O=y.window;;){if(y.lookahead<=ls){if(eu(y),y.lookahead<=ls&&g===Io)return qt;if(y.lookahead===0)break}if(y.match_length=0,y.lookahead>=ut&&y.strstart>0&&(A=O[C=y.strstart-1])===O[++C]&&A===O[++C]&&A===O[++C]){I=y.strstart+ls;do;while(A===O[++C]&&A===O[++C]&&A===O[++C]&&A===O[++C]&&A===O[++C]&&A===O[++C]&&A===O[++C]&&A===O[++C]&&C<I);y.match_length=ls-(I-C),y.match_length>y.lookahead&&(y.match_length=y.lookahead)}if(y.match_length>=ut?(T=fs(y,1,y.match_length-ut),y.lookahead-=y.match_length,y.strstart+=y.match_length,y.match_length=0):(T=fs(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++),T&&(ei(y,!1),y.strm.avail_out===0))return qt}return y.insert=0,g===as?(ei(y,!0),y.strm.avail_out===0?ho:Fa):y.last_lit&&(ei(y,!1),y.strm.avail_out===0)?qt:Wl}(l,s):Pa[l.level].func(l,s);if(v!==ho&&v!==Fa||(l.status=Pl),v===qt||v===ho)return n.avail_out===0&&(l.last_flush=-1),oo;if(v===Wl&&(s===vj?mj(l):s!==ww&&(Fk(l,0,0,!1),s===yj&&(ao(l.head),l.lookahead===0&&(l.strstart=0,l.block_start=0,l.insert=0))),ns(n),n.avail_out===0))return l.last_flush=-1,oo}return s!==as?oo:l.wrap<=0?kw:(l.wrap===2?(ct(l,255&n.adler),ct(l,n.adler>>8&255),ct(l,n.adler>>16&255),ct(l,n.adler>>24&255),ct(l,255&n.total_in),ct(l,n.total_in>>8&255),ct(l,n.total_in>>16&255),ct(l,n.total_in>>24&255)):(Dl(l,n.adler>>>16),Dl(l,65535&n.adler)),ns(n),l.wrap>0&&(l.wrap=-l.wrap),l.pending!==0?oo:kw)}Pa=[new Pn(0,0,0,0,function(n,s){var a=65535;for(a>n.pending_buf_size-5&&(a=n.pending_buf_size-5);;){if(n.lookahead<=1){if(eu(n),n.lookahead===0&&s===Io)return qt;if(n.lookahead===0)break}n.strstart+=n.lookahead,n.lookahead=0;var l=n.block_start+a;if((n.strstart===0||n.strstart>=l)&&(n.lookahead=n.strstart-l,n.strstart=l,ei(n,!1),n.strm.avail_out===0)||n.strstart-n.block_start>=n.w_size-pn&&(ei(n,!1),n.strm.avail_out===0))return qt}return n.insert=0,s===as?(ei(n,!0),n.strm.avail_out===0?ho:Fa):(n.strstart>n.block_start&&(ei(n,!1),n.strm.avail_out),qt)}),new Pn(4,4,8,4,F0),new Pn(4,5,16,8,F0),new Pn(4,6,32,32,F0),new Pn(4,4,16,16,Na),new Pn(8,16,32,32,Na),new Pn(8,16,128,128,Na),new Pn(8,32,128,256,Na),new Pn(32,128,258,1024,Na),new Pn(32,258,258,4096,Na)];var Vh=30,Lj=12;function xj(n,s){var a,l,h,p,m,v,y,g,T,A,C,I,O,D,w,L,M,P,V,G,H,W,z,Z,F;a=n.state,l=n.next_in,Z=n.input,h=l+(n.avail_in-5),p=n.next_out,F=n.output,m=p-(s-n.avail_out),v=p+(n.avail_out-257),y=a.dmax,g=a.wsize,T=a.whave,A=a.wnext,C=a.window,I=a.hold,O=a.bits,D=a.lencode,w=a.distcode,L=(1<<a.lenbits)-1,M=(1<<a.distbits)-1;e:do{O<15&&(I+=Z[l++]<<O,O+=8,I+=Z[l++]<<O,O+=8),P=D[I&L];t:for(;;){if(I>>>=V=P>>>24,O-=V,(V=P>>>16&255)===0)F[p++]=65535&P;else{if(!(16&V)){if(!(64&V)){P=D[(65535&P)+(I&(1<<V)-1)];continue t}if(32&V){a.mode=Lj;break e}n.msg="invalid literal/length code",a.mode=Vh;break e}G=65535&P,(V&=15)&&(O<V&&(I+=Z[l++]<<O,O+=8),G+=I&(1<<V)-1,I>>>=V,O-=V),O<15&&(I+=Z[l++]<<O,O+=8,I+=Z[l++]<<O,O+=8),P=w[I&M];i:for(;;){if(I>>>=V=P>>>24,O-=V,!(16&(V=P>>>16&255))){if(!(64&V)){P=w[(65535&P)+(I&(1<<V)-1)];continue i}n.msg="invalid distance code",a.mode=Vh;break e}if(H=65535&P,O<(V&=15)&&(I+=Z[l++]<<O,(O+=8)<V&&(I+=Z[l++]<<O,O+=8)),(H+=I&(1<<V)-1)>y){n.msg="invalid distance too far back",a.mode=Vh;break e}if(I>>>=V,O-=V,H>(V=p-m)){if((V=H-V)>T&&a.sane){n.msg="invalid distance too far back",a.mode=Vh;break e}if(W=0,z=C,A===0){if(W+=g-V,V<G){G-=V;do F[p++]=C[W++];while(--V);W=p-H,z=F}}else if(A<V){if(W+=g+A-V,(V-=A)<G){G-=V;do F[p++]=C[W++];while(--V);if(W=0,A<G){G-=V=A;do F[p++]=C[W++];while(--V);W=p-H,z=F}}}else if(W+=A-V,V<G){G-=V;do F[p++]=C[W++];while(--V);W=p-H,z=F}for(;G>2;)F[p++]=z[W++],F[p++]=z[W++],F[p++]=z[W++],G-=3;G&&(F[p++]=z[W++],G>1&&(F[p++]=z[W++]))}else{W=p-H;do F[p++]=F[W++],F[p++]=F[W++],F[p++]=F[W++],G-=3;while(G>2);G&&(F[p++]=F[W++],G>1&&(F[p++]=F[W++]))}break}}break}}while(l<h&&p<v);l-=G=O>>3,I&=(1<<(O-=G<<3))-1,n.next_in=l,n.next_out=p,n.avail_in=l<h?h-l+5:5-(l-h),n.avail_out=p<v?v-p+257:257-(p-v),a.hold=I,a.bits=O}var Da=15,Ow=852,Pw=592,Mw=0,B0=1,Lw=2,Vj=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Uj=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Fj=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Bj=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function zl(n,s,a,l,h,p,m,v){var y,g,T,A,C,I,O,D,w,L=v.bits,M=0,P=0,V=0,G=0,H=0,W=0,z=0,Z=0,F=0,J=0,X=null,ee=0,ve=new Yi(Da+1),Ce=new Yi(Da+1),Ae=null,Se=0;for(M=0;M<=Da;M++)ve[M]=0;for(P=0;P<l;P++)ve[s[a+P]]++;for(H=L,G=Da;G>=1&&ve[G]===0;G--);if(H>G&&(H=G),G===0)return h[p++]=20971520,h[p++]=20971520,v.bits=1,0;for(V=1;V<G&&ve[V]===0;V++);for(H<V&&(H=V),Z=1,M=1;M<=Da;M++)if(Z<<=1,(Z-=ve[M])<0)return-1;if(Z>0&&(n===Mw||G!==1))return-1;for(Ce[1]=0,M=1;M<Da;M++)Ce[M+1]=Ce[M]+ve[M];for(P=0;P<l;P++)s[a+P]!==0&&(m[Ce[s[a+P]]++]=P);if(n===Mw?(X=Ae=m,I=19):n===B0?(X=Vj,ee-=257,Ae=Uj,Se-=257,I=256):(X=Fj,Ae=Bj,I=-1),J=0,P=0,M=V,C=p,W=H,z=0,T=-1,A=(F=1<<H)-1,n===B0&&F>Ow||n===Lw&&F>Pw)return 1;for(;;){O=M-z,m[P]<I?(D=0,w=m[P]):m[P]>I?(D=Ae[Se+m[P]],w=X[ee+m[P]]):(D=96,w=0),y=1<<M-z,V=g=1<<W;do h[C+(J>>z)+(g-=y)]=O<<24|D<<16|w|0;while(g!==0);for(y=1<<M-1;J&y;)y>>=1;if(y!==0?(J&=y-1,J+=y):J=0,P++,--ve[M]==0){if(M===G)break;M=s[a+m[P]]}if(M>H&&(J&A)!==T){for(z===0&&(z=H),C+=V,Z=1<<(W=M-z);W+z<G&&!((Z-=ve[W+z])<=0);)W++,Z<<=1;if(F+=1<<W,n===B0&&F>Ow||n===Lw&&F>Pw)return 1;h[T=J&A]=H<<24|W<<16|C-p|0}}return J!==0&&(h[C+J]=M-z<<24|64<<16|0),v.bits=H,0}var Hj=0,Hk=1,jk=2,xw=4,jj=5,Uh=6,cp=0,Wj=1,zj=2,ms=-2,Gj=-3,Kj=-4,Jj=-5,Vw=8,Wk=1,Uw=2,Fw=3,Bw=4,Hw=5,jw=6,Ww=7,zw=8,Gw=9,Kw=10,Jw=11,pr=12,H0=13,Yw=14,j0=15,qw=16,Xw=17,Qw=18,Zw=19,Fh=20,Bh=21,$w=22,e2=23,t2=24,i2=25,n2=26,W0=27,r2=28,s2=29,bt=30,Yj=31,qj=32,Xj=852,Qj=592;function o2(n){return(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24)}function Zj(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Yi(320),this.work=new Yi(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function zk(n){var s;return n&&n.state?((s=n.state).wsize=0,s.whave=0,s.wnext=0,function(a){var l;return a&&a.state?(l=a.state,a.total_in=a.total_out=l.total=0,a.msg="",l.wrap&&(a.adler=1&l.wrap),l.mode=Wk,l.last=0,l.havedict=0,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new op(Xj),l.distcode=l.distdyn=new op(Qj),l.sane=1,l.back=-1,cp):ms}(n)):ms}function $j(n,s){var a,l;return n?(l=new Zj,n.state=l,l.window=null,(a=function(h,p){var m,v;return h&&h.state?(v=h.state,p<0?(m=0,p=-p):(m=1+(p>>4),p<48&&(p&=15)),p&&(p<8||p>15)?ms:(v.window!==null&&v.wbits!==p&&(v.window=null),v.wrap=m,v.wbits=p,zk(h))):ms}(n,s))!==cp&&(n.state=null),a):ms}var z0,G0,a2=!0;function eW(n){if(a2){var s;for(z0=new op(512),G0=new op(32),s=0;s<144;)n.lens[s++]=8;for(;s<256;)n.lens[s++]=9;for(;s<280;)n.lens[s++]=7;for(;s<288;)n.lens[s++]=8;for(zl(Hk,n.lens,0,288,z0,0,n.work,{bits:9}),s=0;s<32;)n.lens[s++]=5;zl(jk,n.lens,0,32,G0,0,n.work,{bits:5}),a2=!1}n.lencode=z0,n.lenbits=9,n.distcode=G0,n.distbits=5}function tW(n,s){var a,l,h,p,m,v,y,g,T,A,C,I,O,D,w,L,M,P,V,G,H,W,z,Z,F=0,J=new sp(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!n||!n.state||!n.output||!n.input&&n.avail_in!==0)return ms;(a=n.state).mode===pr&&(a.mode=H0),m=n.next_out,h=n.output,y=n.avail_out,p=n.next_in,l=n.input,v=n.avail_in,g=a.hold,T=a.bits,A=v,C=y,W=cp;e:for(;;)switch(a.mode){case Wk:if(a.wrap===0){a.mode=H0;break}for(;T<16;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(2&a.wrap&&g===35615){a.check=0,J[0]=255&g,J[1]=g>>>8&255,a.check=Yt(a.check,J,2,0),g=0,T=0,a.mode=Uw;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&g)<<8)+(g>>8))%31){n.msg="incorrect header check",a.mode=bt;break}if((15&g)!==Vw){n.msg="unknown compression method",a.mode=bt;break}if(T-=4,H=8+(15&(g>>>=4)),a.wbits===0)a.wbits=H;else if(H>a.wbits){n.msg="invalid window size",a.mode=bt;break}a.dmax=1<<H,n.adler=a.check=1,a.mode=512&g?Kw:pr,g=0,T=0;break;case Uw:for(;T<16;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(a.flags=g,(255&a.flags)!==Vw){n.msg="unknown compression method",a.mode=bt;break}if(57344&a.flags){n.msg="unknown header flags set",a.mode=bt;break}a.head&&(a.head.text=g>>8&1),512&a.flags&&(J[0]=255&g,J[1]=g>>>8&255,a.check=Yt(a.check,J,2,0)),g=0,T=0,a.mode=Fw;case Fw:for(;T<32;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}a.head&&(a.head.time=g),512&a.flags&&(J[0]=255&g,J[1]=g>>>8&255,J[2]=g>>>16&255,J[3]=g>>>24&255,a.check=Yt(a.check,J,4,0)),g=0,T=0,a.mode=Bw;case Bw:for(;T<16;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}a.head&&(a.head.xflags=255&g,a.head.os=g>>8),512&a.flags&&(J[0]=255&g,J[1]=g>>>8&255,a.check=Yt(a.check,J,2,0)),g=0,T=0,a.mode=Hw;case Hw:if(1024&a.flags){for(;T<16;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}a.length=g,a.head&&(a.head.extra_len=g),512&a.flags&&(J[0]=255&g,J[1]=g>>>8&255,a.check=Yt(a.check,J,2,0)),g=0,T=0}else a.head&&(a.head.extra=null);a.mode=jw;case jw:if(1024&a.flags&&((I=a.length)>v&&(I=v),I&&(a.head&&(H=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),_r(a.head.extra,l,p,I,H)),512&a.flags&&(a.check=Yt(a.check,l,I,p)),v-=I,p+=I,a.length-=I),a.length))break e;a.length=0,a.mode=Ww;case Ww:if(2048&a.flags){if(v===0)break e;I=0;do H=l[p+I++],a.head&&H&&a.length<65536&&(a.head.name+=String.fromCharCode(H));while(H&&I<v);if(512&a.flags&&(a.check=Yt(a.check,l,I,p)),v-=I,p+=I,H)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=zw;case zw:if(4096&a.flags){if(v===0)break e;I=0;do H=l[p+I++],a.head&&H&&a.length<65536&&(a.head.comment+=String.fromCharCode(H));while(H&&I<v);if(512&a.flags&&(a.check=Yt(a.check,l,I,p)),v-=I,p+=I,H)break e}else a.head&&(a.head.comment=null);a.mode=Gw;case Gw:if(512&a.flags){for(;T<16;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(g!==(65535&a.check)){n.msg="header crc mismatch",a.mode=bt;break}g=0,T=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),n.adler=a.check=0,a.mode=pr;break;case Kw:for(;T<32;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}n.adler=a.check=o2(g),g=0,T=0,a.mode=Jw;case Jw:if(a.havedict===0)return n.next_out=m,n.avail_out=y,n.next_in=p,n.avail_in=v,a.hold=g,a.bits=T,zj;n.adler=a.check=1,a.mode=pr;case pr:if(s===jj||s===Uh)break e;case H0:if(a.last){g>>>=7&T,T-=7&T,a.mode=W0;break}for(;T<3;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}switch(a.last=1&g,T-=1,3&(g>>>=1)){case 0:a.mode=Yw;break;case 1:if(eW(a),a.mode=Fh,s===Uh){g>>>=2,T-=2;break e}break;case 2:a.mode=Xw;break;case 3:n.msg="invalid block type",a.mode=bt}g>>>=2,T-=2;break;case Yw:for(g>>>=7&T,T-=7&T;T<32;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if((65535&g)!=(g>>>16^65535)){n.msg="invalid stored block lengths",a.mode=bt;break}if(a.length=65535&g,g=0,T=0,a.mode=j0,s===Uh)break e;case j0:a.mode=qw;case qw:if(I=a.length){if(I>v&&(I=v),I>y&&(I=y),I===0)break e;_r(h,l,p,I,m),v-=I,p+=I,y-=I,m+=I,a.length-=I;break}a.mode=pr;break;case Xw:for(;T<14;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(a.nlen=257+(31&g),g>>>=5,T-=5,a.ndist=1+(31&g),g>>>=5,T-=5,a.ncode=4+(15&g),g>>>=4,T-=4,a.nlen>286||a.ndist>30){n.msg="too many length or distance symbols",a.mode=bt;break}a.have=0,a.mode=Qw;case Qw:for(;a.have<a.ncode;){for(;T<3;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}a.lens[X[a.have++]]=7&g,g>>>=3,T-=3}for(;a.have<19;)a.lens[X[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,z={bits:a.lenbits},W=zl(Hj,a.lens,0,19,a.lencode,0,a.work,z),a.lenbits=z.bits,W){n.msg="invalid code lengths set",a.mode=bt;break}a.have=0,a.mode=Zw;case Zw:for(;a.have<a.nlen+a.ndist;){for(;L=(F=a.lencode[g&(1<<a.lenbits)-1])>>>16&255,M=65535&F,!((w=F>>>24)<=T);){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(M<16)g>>>=w,T-=w,a.lens[a.have++]=M;else{if(M===16){for(Z=w+2;T<Z;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(g>>>=w,T-=w,a.have===0){n.msg="invalid bit length repeat",a.mode=bt;break}H=a.lens[a.have-1],I=3+(3&g),g>>>=2,T-=2}else if(M===17){for(Z=w+3;T<Z;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}T-=w,H=0,I=3+(7&(g>>>=w)),g>>>=3,T-=3}else{for(Z=w+7;T<Z;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}T-=w,H=0,I=11+(127&(g>>>=w)),g>>>=7,T-=7}if(a.have+I>a.nlen+a.ndist){n.msg="invalid bit length repeat",a.mode=bt;break}for(;I--;)a.lens[a.have++]=H}}if(a.mode===bt)break;if(a.lens[256]===0){n.msg="invalid code -- missing end-of-block",a.mode=bt;break}if(a.lenbits=9,z={bits:a.lenbits},W=zl(Hk,a.lens,0,a.nlen,a.lencode,0,a.work,z),a.lenbits=z.bits,W){n.msg="invalid literal/lengths set",a.mode=bt;break}if(a.distbits=6,a.distcode=a.distdyn,z={bits:a.distbits},W=zl(jk,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,z),a.distbits=z.bits,W){n.msg="invalid distances set",a.mode=bt;break}if(a.mode=Fh,s===Uh)break e;case Fh:a.mode=Bh;case Bh:if(v>=6&&y>=258){n.next_out=m,n.avail_out=y,n.next_in=p,n.avail_in=v,a.hold=g,a.bits=T,xj(n,C),m=n.next_out,h=n.output,y=n.avail_out,p=n.next_in,l=n.input,v=n.avail_in,g=a.hold,T=a.bits,a.mode===pr&&(a.back=-1);break}for(a.back=0;L=(F=a.lencode[g&(1<<a.lenbits)-1])>>>16&255,M=65535&F,!((w=F>>>24)<=T);){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(L&&!(240&L)){for(P=w,V=L,G=M;L=(F=a.lencode[G+((g&(1<<P+V)-1)>>P)])>>>16&255,M=65535&F,!(P+(w=F>>>24)<=T);){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}g>>>=P,T-=P,a.back+=P}if(g>>>=w,T-=w,a.back+=w,a.length=M,L===0){a.mode=n2;break}if(32&L){a.back=-1,a.mode=pr;break}if(64&L){n.msg="invalid literal/length code",a.mode=bt;break}a.extra=15&L,a.mode=$w;case $w:if(a.extra){for(Z=a.extra;T<Z;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}a.length+=g&(1<<a.extra)-1,g>>>=a.extra,T-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=e2;case e2:for(;L=(F=a.distcode[g&(1<<a.distbits)-1])>>>16&255,M=65535&F,!((w=F>>>24)<=T);){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(!(240&L)){for(P=w,V=L,G=M;L=(F=a.distcode[G+((g&(1<<P+V)-1)>>P)])>>>16&255,M=65535&F,!(P+(w=F>>>24)<=T);){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}g>>>=P,T-=P,a.back+=P}if(g>>>=w,T-=w,a.back+=w,64&L){n.msg="invalid distance code",a.mode=bt;break}a.offset=M,a.extra=15&L,a.mode=t2;case t2:if(a.extra){for(Z=a.extra;T<Z;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}a.offset+=g&(1<<a.extra)-1,g>>>=a.extra,T-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){n.msg="invalid distance too far back",a.mode=bt;break}a.mode=i2;case i2:if(y===0)break e;if(I=C-y,a.offset>I){if((I=a.offset-I)>a.whave&&a.sane){n.msg="invalid distance too far back",a.mode=bt;break}I>a.wnext?(I-=a.wnext,O=a.wsize-I):O=a.wnext-I,I>a.length&&(I=a.length),D=a.window}else D=h,O=m-a.offset,I=a.length;I>y&&(I=y),y-=I,a.length-=I;do h[m++]=D[O++];while(--I);a.length===0&&(a.mode=Bh);break;case n2:if(y===0)break e;h[m++]=a.length,y--,a.mode=Bh;break;case W0:if(a.wrap){for(;T<32;){if(v===0)break e;v--,g|=l[p++]<<T,T+=8}if(C-=y,n.total_out+=C,a.total+=C,C&&(n.adler=a.check=a.flags?Yt(a.check,h,C,m-C):uv(a.check,h,C,m-C)),C=y,(a.flags?g:o2(g))!==a.check){n.msg="incorrect data check",a.mode=bt;break}g=0,T=0}a.mode=r2;case r2:if(a.wrap&&a.flags){for(;T<32;){if(v===0)break e;v--,g+=l[p++]<<T,T+=8}if(g!==(4294967295&a.total)){n.msg="incorrect length check",a.mode=bt;break}g=0,T=0}a.mode=s2;case s2:W=Wj;break e;case bt:W=Gj;break e;case Yj:return Kj;case qj:default:return ms}return n.next_out=m,n.avail_out=y,n.next_in=p,n.avail_in=v,a.hold=g,a.bits=T,(a.wsize||C!==n.avail_out&&a.mode<bt&&(a.mode<W0||s!==xw))&&function(ee,ve,Ce,Ae){var Se,_e=ee.state;_e.window===null&&(_e.wsize=1<<_e.wbits,_e.wnext=0,_e.whave=0,_e.window=new sp(_e.wsize)),Ae>=_e.wsize?(_r(_e.window,ve,Ce-_e.wsize,_e.wsize,0),_e.wnext=0,_e.whave=_e.wsize):((Se=_e.wsize-_e.wnext)>Ae&&(Se=Ae),_r(_e.window,ve,Ce-Ae,Se,_e.wnext),(Ae-=Se)?(_r(_e.window,ve,Ce-Ae,Ae,0),_e.wnext=Ae,_e.whave=_e.wsize):(_e.wnext+=Se,_e.wnext===_e.wsize&&(_e.wnext=0),_e.whave<_e.wsize&&(_e.whave+=Se)))}(n,n.output,n.next_out,C-n.avail_out),A-=n.avail_in,C-=n.avail_out,n.total_in+=A,n.total_out+=C,a.total+=C,a.wrap&&C&&(n.adler=a.check=a.flags?Yt(a.check,h,C,n.next_out-C):uv(a.check,h,C,n.next_out-C)),n.data_type=a.bits+(a.last?64:0)+(a.mode===pr?128:0)+(a.mode===Fh||a.mode===j0?256:0),(A===0&&C===0||s===xw)&&W===cp&&(W=Jj),W}var Hh,Ma=1,Gl=7;function Mn(n){if(n<Ma||n>Gl)throw new TypeError("Bad argument");this.mode=n,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function iW(n,s){for(var a=0;a<n.length;a++)this[s+a]=n[a]}Mn.prototype.init=function(n,s,a,l,h){var p;switch(this.windowBits=n,this.level=s,this.memLevel=a,this.strategy=l,this.mode!==3&&this.mode!==4||(this.windowBits+=16),this.mode===Gl&&(this.windowBits+=32),this.mode!==5&&this.mode!==6||(this.windowBits=-this.windowBits),this.strm=new aj,this.mode){case Ma:case 3:case 5:p=function(m,v,y,g,T,A){if(!m)return bo;var C=1;if(v===Tj&&(v=6),g<0?(C=0,g=-g):g>15&&(C=2,g-=16),T<1||T>Rj||y!==Wv||g<8||g>15||v<0||v>9||A<0||A>bj)return us(m,bo);g===8&&(g=9);var I=new Pj;return m.state=I,I.strm=m,I.wrap=C,I.gzhead=null,I.w_bits=g,I.w_size=1<<I.w_bits,I.w_mask=I.w_size-1,I.hash_bits=T+7,I.hash_size=1<<I.hash_bits,I.hash_mask=I.hash_size-1,I.hash_shift=~~((I.hash_bits+ut-1)/ut),I.window=new sp(2*I.w_size),I.head=new Yi(I.hash_size),I.prev=new Yi(I.w_size),I.lit_bufsize=1<<T+6,I.pending_buf_size=4*I.lit_bufsize,I.pending_buf=new sp(I.pending_buf_size),I.d_buf=1*I.lit_bufsize,I.l_buf=3*I.lit_bufsize,I.level=v,I.strategy=A,I.method=y,Dw(m)}(this.strm,this.level,8,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case Gl:p=$j(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}p===0?(this.write_in_progress=!1,this.init_done=!0):this._error(p)},Mn.prototype.params=function(){throw new Error("deflateParams Not supported")},Mn.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===0)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},Mn.prototype.write=function(n,s,a,l,h,p,m){this._writeCheck(),this.write_in_progress=!0;var v=this;return $t(function(){v.write_in_progress=!1;var y=v._write(n,s,a,l,h,p,m);v.callback(y[0],y[1]),v.pending_close&&v.close()}),this},Mn.prototype.writeSync=function(n,s,a,l,h,p,m){return this._writeCheck(),this._write(n,s,a,l,h,p,m)},Mn.prototype._write=function(n,s,a,l,h,p,m){if(this.write_in_progress=!0,n!==0&&n!==1&&n!==2&&n!==3&&n!==4&&n!==5)throw new Error("Invalid flush value");s==null&&(s=new Q(0),l=0,a=0),h._set?h.set=h._set:h.set=iW;var v,y=this.strm;switch(y.avail_in=l,y.input=s,y.next_in=a,y.avail_out=m,y.output=h,y.next_out=p,this.mode){case Ma:case 3:case 5:v=Mj(y,n);break;case Gl:case 2:case 4:case 6:v=tW(y,n);break;default:throw new Error("Unknown mode "+this.mode)}return v!==1&&v!==0&&this._error(v),this.write_in_progress=!1,[y.avail_in,y.avail_out]},Mn.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,this.mode===Ma||this.mode===3||this.mode===5?function(n){var s;n&&n.state&&((s=n.state.status)!==zv&&s!==hv&&s!==Yh&&s!==qh&&s!==Xh&&s!==uo&&s!==Pl?us(n,bo):(n.state=null,s===uo&&us(n,Ej)))}(this.strm):function(n){if(!n||!n.state)return ms;var s=n.state;s.window&&(s.window=null),n.state=null}(this.strm),this.mode=0)},Mn.prototype.reset=function(){switch(this.mode){case Ma:case 5:Hh=Dw(this.strm);break;case 2:case 6:Hh=zk(this.strm)}Hh!==0&&this._error(Hh)},Mn.prototype._error=function(n){this.onerror(kk[n]+": "+this.strm.msg,n),this.write_in_progress=!1,this.pending_close&&this.close()};var c2=Object.freeze({NONE:0,DEFLATE:Ma,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:Gl,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:Mn}),be={};Object.keys(c2).forEach(function(n){be[n]=c2[n]}),be.Z_MIN_WINDOWBITS=8,be.Z_MAX_WINDOWBITS=15,be.Z_DEFAULT_WINDOWBITS=15,be.Z_MIN_CHUNK=64,be.Z_MAX_CHUNK=1/0,be.Z_DEFAULT_CHUNK=16384,be.Z_MIN_MEMLEVEL=1,be.Z_MAX_MEMLEVEL=9,be.Z_DEFAULT_MEMLEVEL=8,be.Z_MIN_LEVEL=-1,be.Z_MAX_LEVEL=9,be.Z_DEFAULT_LEVEL=be.Z_DEFAULT_COMPRESSION;var Qh={Z_OK:be.Z_OK,Z_STREAM_END:be.Z_STREAM_END,Z_NEED_DICT:be.Z_NEED_DICT,Z_ERRNO:be.Z_ERRNO,Z_STREAM_ERROR:be.Z_STREAM_ERROR,Z_DATA_ERROR:be.Z_DATA_ERROR,Z_MEM_ERROR:be.Z_MEM_ERROR,Z_BUF_ERROR:be.Z_BUF_ERROR,Z_VERSION_ERROR:be.Z_VERSION_ERROR};function io(n,s,a){var l=[],h=0;function p(){for(var v;(v=n.read())!==null;)l.push(v),h+=v.length;n.once("readable",p)}function m(){var v=Q.concat(l,h);l=[],a(null,v),n.close()}n.on("error",function(v){n.removeListener("end",m),n.removeListener("readable",p),a(v)}),n.on("end",m),n.end(s),p()}function no(n,s){if(typeof s=="string"&&(s=new Q(s)),!nu(s))throw new TypeError("Not a string or buffer");var a=be.Z_FINISH;return n._processChunk(s,a)}function po(n){if(!(this instanceof po))return new po(n);kt.call(this,n,be.DEFLATE)}function fo(n){if(!(this instanceof fo))return new fo(n);kt.call(this,n,be.INFLATE)}function mo(n){if(!(this instanceof mo))return new mo(n);kt.call(this,n,be.GZIP)}function _o(n){if(!(this instanceof _o))return new _o(n);kt.call(this,n,be.GUNZIP)}function go(n){if(!(this instanceof go))return new go(n);kt.call(this,n,be.DEFLATERAW)}function vo(n){if(!(this instanceof vo))return new vo(n);kt.call(this,n,be.INFLATERAW)}function yo(n){if(!(this instanceof yo))return new yo(n);kt.call(this,n,be.UNZIP)}function kt(n,s){if(this._opts=n=n||{},this._chunkSize=n.chunkSize||be.Z_DEFAULT_CHUNK,Ji.call(this,n),n.flush&&n.flush!==be.Z_NO_FLUSH&&n.flush!==be.Z_PARTIAL_FLUSH&&n.flush!==be.Z_SYNC_FLUSH&&n.flush!==be.Z_FULL_FLUSH&&n.flush!==be.Z_FINISH&&n.flush!==be.Z_BLOCK)throw new Error("Invalid flush flag: "+n.flush);if(this._flushFlag=n.flush||be.Z_NO_FLUSH,n.chunkSize&&(n.chunkSize<be.Z_MIN_CHUNK||n.chunkSize>be.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+n.chunkSize);if(n.windowBits&&(n.windowBits<be.Z_MIN_WINDOWBITS||n.windowBits>be.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+n.windowBits);if(n.level&&(n.level<be.Z_MIN_LEVEL||n.level>be.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+n.level);if(n.memLevel&&(n.memLevel<be.Z_MIN_MEMLEVEL||n.memLevel>be.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+n.memLevel);if(n.strategy&&n.strategy!=be.Z_FILTERED&&n.strategy!=be.Z_HUFFMAN_ONLY&&n.strategy!=be.Z_RLE&&n.strategy!=be.Z_FIXED&&n.strategy!=be.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+n.strategy);if(n.dictionary&&!nu(n.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new be.Zlib(s);var a=this;this._hadError=!1,this._binding.onerror=function(p,m){a._binding=null,a._hadError=!0;var v=new Error(p);v.errno=m,v.code=be.codes[m],a.emit("error",v)};var l=be.Z_DEFAULT_COMPRESSION;typeof n.level=="number"&&(l=n.level);var h=be.Z_DEFAULT_STRATEGY;typeof n.strategy=="number"&&(h=n.strategy),this._binding.init(n.windowBits||be.Z_DEFAULT_WINDOWBITS,l,n.memLevel||be.Z_DEFAULT_MEMLEVEL,h,n.dictionary),this._buffer=new Q(this._chunkSize),this._offset=0,this._closed=!1,this._level=l,this._strategy=h,this.once("end",this.close)}Object.keys(Qh).forEach(function(n){Qh[Qh[n]]=n}),bi(kt,Ji),kt.prototype.params=function(n,s,a){if(n<be.Z_MIN_LEVEL||n>be.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+n);if(s!=be.Z_FILTERED&&s!=be.Z_HUFFMAN_ONLY&&s!=be.Z_RLE&&s!=be.Z_FIXED&&s!=be.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+s);if(this._level!==n||this._strategy!==s){var l=this;this.flush(be.Z_SYNC_FLUSH,function(){l._binding.params(n,s),l._hadError||(l._level=n,l._strategy=s,a&&a())})}else $t(a)},kt.prototype.reset=function(){return this._binding.reset()},kt.prototype._flush=function(n){this._transform(new Q(0),"",n)},kt.prototype.flush=function(n,s){var a=this._writableState;if((typeof n=="function"||n===void 0&&!s)&&(s=n,n=be.Z_FULL_FLUSH),a.ended)s&&$t(s);else if(a.ending)s&&this.once("end",s);else if(a.needDrain){var l=this;this.once("drain",function(){l.flush(s)})}else this._flushFlag=n,this.write(new Q(0),"",s)},kt.prototype.close=function(n){if(n&&$t(n),!this._closed){this._closed=!0,this._binding.close();var s=this;$t(function(){s.emit("close")})}},kt.prototype._transform=function(n,s,a){var l,h=this._writableState,p=(h.ending||h.ended)&&(!n||h.length===n.length);if(!n===null&&!nu(n))return a(new Error("invalid input"));p?l=be.Z_FINISH:(l=this._flushFlag,n.length>=h.length&&(this._flushFlag=this._opts.flush||be.Z_NO_FLUSH)),this._processChunk(n,l,a)},kt.prototype._processChunk=function(n,s,a){var l=n&&n.length,h=this._chunkSize-this._offset,p=0,m=this,v=typeof a=="function";if(!v){var y,g=[],T=0;this.on("error",function(D){y=D});do var A=this._binding.writeSync(s,n,p,l,this._buffer,this._offset,h);while(!this._hadError&&O(A[0],A[1]));if(this._hadError)throw y;var C=Q.concat(g,T);return this.close(),C}var I=this._binding.write(s,n,p,l,this._buffer,this._offset,h);function O(D,w){if(!m._hadError){var L=h-w;if(function(V,G){if(!V)throw new Error(G)}(L>=0,"have should not go down"),L>0){var M=m._buffer.slice(m._offset,m._offset+L);m._offset+=L,v?m.push(M):(g.push(M),T+=M.length)}if((w===0||m._offset>=m._chunkSize)&&(h=m._chunkSize,m._offset=0,m._buffer=new Q(m._chunkSize)),w===0){if(p+=l-D,l=D,!v)return!0;var P=m._binding.write(s,n,p,l,m._buffer,m._offset,m._chunkSize);return P.callback=O,void(P.buffer=n)}if(!v)return!1;a()}}I.buffer=n,I.callback=O},bi(po,kt),bi(fo,kt),bi(mo,kt),bi(_o,kt),bi(go,kt),bi(vo,kt),bi(yo,kt);var l2={codes:Qh,createDeflate:function(n){return new po(n)},createInflate:function(n){return new fo(n)},createDeflateRaw:function(n){return new go(n)},createInflateRaw:function(n){return new vo(n)},createGzip:function(n){return new mo(n)},createGunzip:function(n){return new _o(n)},createUnzip:function(n){return new yo(n)},deflate:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new po(s),n,a)},deflateSync:function(n,s){return no(new po(s),n)},gzip:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new mo(s),n,a)},gzipSync:function(n,s){return no(new mo(s),n)},deflateRaw:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new go(s),n,a)},deflateRawSync:function(n,s){return no(new go(s),n)},unzip:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new yo(s),n,a)},unzipSync:function(n,s){return no(new yo(s),n)},inflate:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new fo(s),n,a)},inflateSync:function(n,s){return no(new fo(s),n)},gunzip:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new _o(s),n,a)},gunzipSync:function(n,s){return no(new _o(s),n)},inflateRaw:function(n,s,a){return typeof s=="function"&&(a=s,s={}),io(new vo(s),n,a)},inflateRawSync:function(n,s){return no(new vo(s),n)},Deflate:po,Inflate:fo,Gzip:mo,Gunzip:_o,DeflateRaw:go,InflateRaw:vo,Unzip:yo,Zlib:kt};class nW{constructor(s,a,l){this.SDKAPPID=s,this.EXPIRETIME=l,this.PRIVATEKEY=a}genTestUserSig(s){return this._isNumber(this.SDKAPPID)?this._isString(this.PRIVATEKEY)?this._isString(s)?this._isNumber(this.EXPIRETIME)?(console.log("sdkAppID="+this.SDKAPPID+" key="+this.PRIVATEKEY+" userID="+s+" expire="+this.EXPIRETIME),this.genSigWithUserbuf(s,this.EXPIRETIME,null)):(console.error("expireTime must be a number"),""):(console.error("userID must be a string"),""):(console.error("privateKey must be a string"),""):(console.error("sdkAppID must be a number"),"")}newBuffer(s,a){return Q.from?Q.from(s,a):new Q(s,a)}unescape(s){return s.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}escape(s){return s.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}encode(s){return this.escape(this.newBuffer(s).toString("base64"))}decode(s){return this.newBuffer(this.unescape(s),"base64")}base64encode(s){return this.newBuffer(s).toString("base64")}base64decode(s){return this.newBuffer(s,"base64").toString()}_hmacsha256(s,a,l,h){let p="TLS.identifier:"+s+`
`;p+="TLS.sdkappid:"+this.SDKAPPID+`
`,p+="TLS.time:"+a+`
`,p+="TLS.expire:"+l+`
`,h!=null&&(p+="TLS.userbuf:"+h+`
`);let m=tw.HmacSHA256(p,this.PRIVATEKEY);return tw.enc.Base64.stringify(m)}_utc(){return Math.round(Date.now()/1e3)}_isNumber(s){return s!==null&&(typeof s=="number"&&!isNaN(s-0)||typeof s=="object"&&s.constructor===Number)}_isString(s){return typeof s=="string"}genSigWithUserbuf(s,a,l){let h=this._utc(),p={"TLS.ver":"2.0","TLS.identifier":s,"TLS.sdkappid":this.SDKAPPID,"TLS.time":h,"TLS.expire":a},m="";if(l!=null){let T=this.base64encode(l);p["TLS.userbuf"]=T,m=this._hmacsha256(s,h,a,T)}else m=this._hmacsha256(s,h,a,null);p["TLS.sig"]=m;let v=JSON.stringify(p),y=l2.deflateSync(this.newBuffer(v)).toString("base64"),g=this.escape(y);return console.log("ret="+g),g}validate(s){let a=this.decode(s),l=l2.inflateSync(a);console.log("validate ret="+l)}}function rW({sdkAppId:n,userId:s,sdkSecretKey:a}){if(!s){console.error("Missing userID parameter.");return}if(!n){console.error("Missing SDKAppID parameter.");return}if(!a){console.error("Missing SecretKey parameter.");return}const l=n,h=604800,p=a;return{userSig:new nW(l,p,h).genTestUserSig(s),SDKAppID:n}}const sW={class:"flex items-center flex-col text-center p-12 h-screen"},oW={class:"relative h-full mb-4"},aW={ref:"localVideo",class:"w-96 h-full bg-gray-200 mb-4 object-cover",id:"localvideo"},cW={ref:"remoteVideo",class:"w-32 h-48 absolute bottom-0 right-0 object-cover",id:"remotevideo"},u2=20009280,lW="304be4b653f1d54a6ab7199bb6d8b3ca7ccc4e4f488154492d8bb9934ec7c898",uW=QB({__name:"App",setup(n){const s=`user_${Math.floor(Math.random()*1e8)}`;let a;const l=JC.create();H2(()=>{a=rW({sdkAppId:u2,userId:s,sdkSecretKey:lW}).userSig,l.on(JC.EVENT.REMOTE_VIDEO_AVAILABLE,({userId:y,streamType:g})=>{const T=document.getElementById("remotevideo");l.startRemoteVideo({userId:y,streamType:g,view:T})})});const h=async()=>{await l.exitRoom()},p=async()=>{try{await l.enterRoom({sdkAppId:u2,userId:s,userSig:a,roomId:8888}),console.log("enter room successfully")}catch(y){console.error("failed to enter room "+y)}};async function m(){await l.startLocalAudio()}const v=async()=>{const y=document.getElementById("localvideo");await l.startLocalVideo({view:y})};return(y,g)=>(w9(),D9("div",sW,[Ln("div",oW,[Ln("div",aW,null,512),Ln("div",cW,null,512)]),Ln("div",{class:"flex gap-2 mb-4"},[Ln("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white",onClick:p},"  "),Ln("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white",onClick:m},"  "),Ln("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white",onClick:v},"  "),Ln("button",{class:"rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white",onClick:h},"  ")])]))}});gH(uW).mount("#app");
